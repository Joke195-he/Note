"use strict";var mu=Object.defineProperty;var po=s=>{throw TypeError(s)};var vu=(s,e,t)=>e in s?mu(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var us=(s,e,t)=>vu(s,typeof e!="symbol"?e+"":e,t),Wr=(s,e,t)=>e.has(s)||po("Cannot "+t);var M=(s,e,t)=>(Wr(s,e,"read from private field"),t?t.call(s):e.get(s)),be=(s,e,t)=>e.has(s)?po("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t),Y=(s,e,t,i)=>(Wr(s,e,"write to private field"),i?i.call(s,t):e.set(s,t),t),et=(s,e,t)=>(Wr(s,e,"access private method"),t);const F=require("obsidian"),dl=!1;var Pn=Array.isArray,ku=Array.prototype.indexOf,Aa=Array.from,lr=Object.defineProperty,Yi=Object.getOwnPropertyDescriptor,fl=Object.getOwnPropertyDescriptors,yu=Object.prototype,bu=Array.prototype,Na=Object.getPrototypeOf,go=Object.isExtensible;const ws=()=>{};function wu(s){return typeof(s==null?void 0:s.then)=="function"}function Tu(s){return s()}function cr(s){for(var e=0;e<s.length;e++)s[e]()}function _u(){var s,e,t=new Promise((i,n)=>{s=i,e=n});return{promise:t,resolve:s,reject:e}}function Fi(s,e){if(Array.isArray(s))return s;if(!(Symbol.iterator in s))return Array.from(s);const t=[];for(const i of s)if(t.push(i),t.length===e)break;return t}const yt=2,La=4,_r=8,Rs=16,ki=32,ns=64,Da=128,Lt=256,ur=512,Ge=1024,$t=2048,yi=4096,Gt=8192,rs=16384,Fa=32768,En=65536,mo=1<<17,Iu=1<<18,Bs=1<<19,hl=1<<20,da=1<<21,xa=1<<22,Ji=1<<23,Ai=Symbol("$state"),Su=Symbol("legacy props"),$a=new class extends Error{constructor(){super(...arguments);us(this,"name","StaleReactionError");us(this,"message","The reaction that called `getAbortSignal()` was re-run or destroyed")}};function pl(s){return s===this.v}function gl(s,e){return s!=s?e==e:s!==e||s!==null&&typeof s=="object"||typeof s=="function"}function ml(s){return!gl(s,this.v)}function vl(s){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Pu(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Eu(s){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Cu(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Ou(s){throw new Error("https://svelte.dev/e/effect_orphan")}function Au(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Nu(s){throw new Error("https://svelte.dev/e/props_invalid_value")}function Lu(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Du(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Fu(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function xu(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}let Us=!1,$u=!1;function Mu(){Us=!0}const Ir=1,Sr=2,kl=4,ju=8,Ru=16,Bu=1,Uu=2,qu=4,Hu=8,Ku=16,Vu=1,zu=2,ze=Symbol(),Gu="http://www.w3.org/1999/xhtml";let De=null;function xi(s){De=s}function gt(s,e=!1,t){De={p:De,c:null,e:null,s,x:null,l:Us&&!e?{s:null,u:null,$:[]}:null}}function mt(s){var e=De,t=e.e;if(t!==null){e.e=null;for(var i of t)Rl(i)}return s!==void 0&&(e.x=s),De=e.p,s??{}}function qs(){return!Us||De!==null&&De.l===null}let Ci=[],dr=[];function yl(){var s=Ci;Ci=[],cr(s)}function Wu(){var s=dr;dr=[],cr(s)}function Yu(){return Ci.length>0||dr.length>0}function Hs(s){if(Ci.length===0&&!on){var e=Ci;queueMicrotask(()=>{e===Ci&&yl()})}Ci.push(s)}function Ju(){Ci.length>0&&yl(),dr.length>0&&Wu()}function Xu(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function Qu(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}let Zu=!1;function ms(s){if(typeof s!="object"||s===null||Ai in s)return s;const e=Na(s);if(e!==yu&&e!==bu)return s;var t=new Map,i=Pn(s),n=bi(0),r=Xi,a=o=>{if(Xi===r)return o();var l=re,c=Xi;Ye(null),_o(r);var d=o();return Ye(l),_o(c),d};return i&&t.set("length",bi(s.length)),new Proxy(s,{defineProperty(o,l,c){(!("value"in c)||c.configurable===!1||c.enumerable===!1||c.writable===!1)&&Lu();var d=t.get(l);return d===void 0?d=a(()=>{var g=bi(c.value);return t.set(l,g),g}):x(d,c.value,!0),!0},deleteProperty(o,l){var c=t.get(l);if(c===void 0){if(l in o){const d=a(()=>bi(ze));t.set(l,d),ln(n)}}else x(c,ze),ln(n);return!0},get(o,l,c){var u;if(l===Ai)return s;var d=t.get(l),g=l in o;if(d===void 0&&(!g||(u=Yi(o,l))!=null&&u.writable)&&(d=a(()=>{var f=ms(g?o[l]:ze),p=bi(f);return p}),t.set(l,d)),d!==void 0){var h=I(d);return h===ze?void 0:h}return Reflect.get(o,l,c)},getOwnPropertyDescriptor(o,l){var c=Reflect.getOwnPropertyDescriptor(o,l);if(c&&"value"in c){var d=t.get(l);d&&(c.value=I(d))}else if(c===void 0){var g=t.get(l),h=g==null?void 0:g.v;if(g!==void 0&&h!==ze)return{enumerable:!0,configurable:!0,value:h,writable:!0}}return c},has(o,l){var h;if(l===Ai)return!0;var c=t.get(l),d=c!==void 0&&c.v!==ze||Reflect.has(o,l);if(c!==void 0||ce!==null&&(!d||(h=Yi(o,l))!=null&&h.writable)){c===void 0&&(c=a(()=>{var u=d?ms(o[l]):ze,f=bi(u);return f}),t.set(l,c));var g=I(c);if(g===ze)return!1}return d},set(o,l,c,d){var y;var g=t.get(l),h=l in o;if(i&&l==="length")for(var u=c;u<g.v;u+=1){var f=t.get(u+"");f!==void 0?x(f,ze):u in o&&(f=a(()=>bi(ze)),t.set(u+"",f))}if(g===void 0)(!h||(y=Yi(o,l))!=null&&y.writable)&&(g=a(()=>bi(void 0)),x(g,ms(c)),t.set(l,g));else{h=g.v!==ze;var p=a(()=>ms(c));x(g,p)}var m=Reflect.getOwnPropertyDescriptor(o,l);if(m!=null&&m.set&&m.set.call(d,c),!h){if(i&&typeof l=="string"){var v=t.get("length"),w=Number(l);Number.isInteger(w)&&w>=v.v&&x(v,w+1)}ln(n)}return!0},ownKeys(o){I(n);var l=Reflect.ownKeys(o).filter(g=>{var h=t.get(g);return h===void 0||h.v!==ze});for(var[c,d]of t)d.v!==ze&&!(c in o)&&l.push(c);return l},setPrototypeOf(){Du()}})}function vo(s){try{if(s!==null&&typeof s=="object"&&Ai in s)return s[Ai]}catch{}return s}function ed(s,e){return Object.is(vo(s),vo(e))}var ko,bl,wl,Tl;function td(){if(ko===void 0){ko=window,bl=/Firefox/.test(navigator.userAgent);var s=Element.prototype,e=Node.prototype,t=Text.prototype;wl=Yi(e,"firstChild").get,Tl=Yi(e,"nextSibling").get,go(s)&&(s.__click=void 0,s.__className=void 0,s.__attributes=null,s.__style=void 0,s.__e=void 0),go(t)&&(t.__t=void 0)}}function as(s=""){return document.createTextNode(s)}function fr(s){return wl.call(s)}function Cn(s){return Tl.call(s)}function N(s,e){return fr(s)}function Me(s,e=!1){{var t=fr(s);return t instanceof Comment&&t.data===""?Cn(t):t}}function $(s,e=1,t=!1){let i=s;for(;e--;)i=Cn(i);return i}function id(s){s.textContent=""}function Ma(){return!1}const sd=new WeakMap;function _l(s){var e=ce;if(e===null)return re.f|=Ji,s;if((e.f&Fa)===0){if((e.f&Da)===0)throw!e.parent&&s instanceof Error&&Il(s),s;e.b.error(s)}else As(s,e)}function As(s,e){for(;e!==null;){if((e.f&Da)!==0)try{e.b.error(s);return}catch(t){s=t}e=e.parent}throw s instanceof Error&&Il(s),s}function Il(s){const e=sd.get(s);e&&(lr(s,"message",{value:e.message}),lr(s,"stack",{value:e.stack}))}const Yr=new Set;let Se=null,Qn=null,fa=new Set,ts=[],Pr=null,ha=!1,on=!1;var wn,Es,_i,Tn,_n,Ki,Cs,Vi,Ii,Os,In,Sn,Wt,Sl,Zn,pa;const br=class br{constructor(){be(this,Wt);us(this,"current",new Map);be(this,wn,new Map);be(this,Es,new Set);be(this,_i,0);be(this,Tn,null);be(this,_n,!1);be(this,Ki,[]);be(this,Cs,[]);be(this,Vi,[]);be(this,Ii,[]);be(this,Os,[]);be(this,In,[]);be(this,Sn,[]);us(this,"skipped_effects",new Set)}process(e){var n;ts=[],Qn=null;for(const r of e)et(this,Wt,Sl).call(this,r);if(M(this,Ki).length===0&&M(this,_i)===0){et(this,Wt,pa).call(this);var t=M(this,Vi),i=M(this,Ii);Y(this,Vi,[]),Y(this,Ii,[]),Y(this,Os,[]),Qn=Se,Se=null,yo(t),yo(i),Se===null?Se=this:Yr.delete(this),(n=M(this,Tn))==null||n.resolve()}else et(this,Wt,Zn).call(this,M(this,Vi)),et(this,Wt,Zn).call(this,M(this,Ii)),et(this,Wt,Zn).call(this,M(this,Os));for(const r of M(this,Ki))Qi(r);for(const r of M(this,Cs))Qi(r);Y(this,Ki,[]),Y(this,Cs,[])}capture(e,t){M(this,wn).has(e)||M(this,wn).set(e,t),this.current.set(e,e.v)}activate(){Se=this}deactivate(){Se=null,Qn=null;for(const e of fa)if(fa.delete(e),e(),Se!==null)break}neuter(){Y(this,_n,!0)}flush(){ts.length>0?El():et(this,Wt,pa).call(this),Se===this&&(M(this,_i)===0&&Yr.delete(this),this.deactivate())}increment(){Y(this,_i,M(this,_i)+1)}decrement(){if(Y(this,_i,M(this,_i)-1),M(this,_i)===0){for(const e of M(this,In))rt(e,$t),Ns(e);for(const e of M(this,Sn))rt(e,yi),Ns(e);Y(this,Vi,[]),Y(this,Ii,[]),this.flush()}else this.deactivate()}add_callback(e){M(this,Es).add(e)}settled(){return(M(this,Tn)??Y(this,Tn,_u())).promise}static ensure(){if(Se===null){const e=Se=new br;Yr.add(Se),on||br.enqueue(()=>{Se===e&&e.flush()})}return Se}static enqueue(e){Hs(e)}};wn=new WeakMap,Es=new WeakMap,_i=new WeakMap,Tn=new WeakMap,_n=new WeakMap,Ki=new WeakMap,Cs=new WeakMap,Vi=new WeakMap,Ii=new WeakMap,Os=new WeakMap,In=new WeakMap,Sn=new WeakMap,Wt=new WeakSet,Sl=function(e){var d;e.f^=Ge;for(var t=e.first;t!==null;){var i=t.f,n=(i&(ki|ns))!==0,r=n&&(i&Ge)!==0,a=r||(i&Gt)!==0||this.skipped_effects.has(t);if(!a&&t.fn!==null){if(n)t.f^=Ge;else if((i&La)!==0)M(this,Ii).push(t);else if((i&Ge)===0)if((i&xa)!==0){var o=(d=t.b)!=null&&d.is_pending()?M(this,Cs):M(this,Ki);o.push(t)}else An(t)&&((t.f&Rs)!==0&&M(this,Os).push(t),Qi(t));var l=t.first;if(l!==null){t=l;continue}}var c=t.parent;for(t=t.next;t===null&&c!==null;)t=c.next,c=c.parent}},Zn=function(e){for(const t of e)((t.f&$t)!==0?M(this,In):M(this,Sn)).push(t),rt(t,Ge);e.length=0},pa=function(){if(!M(this,_n))for(const e of M(this,Es))e();M(this,Es).clear()};let Ni=br;function Pl(s){var e=on;on=!0;try{for(var t;;){if(Ju(),ts.length===0&&!Yu()&&(Se==null||Se.flush(),ts.length===0))return Pr=null,t;El()}}finally{on=e}}function El(){var s=Ts;ha=!0;try{var e=0;for(wo(!0);ts.length>0;){var t=Ni.ensure();if(e++>1e3){var i,n;nd()}t.process(ts),Li.clear()}}finally{ha=!1,wo(s),Pr=null}}function nd(){try{Au()}catch(s){As(s,Pr)}}let fi=null;function yo(s){var e=s.length;if(e!==0){for(var t=0;t<e;){var i=s[t++];if((i.f&(rs|Gt))===0&&An(i)&&(fi=[],Qi(i),i.deps===null&&i.first===null&&i.nodes_start===null&&(i.teardown===null&&i.ac===null?Hl(i):i.fn=null),(fi==null?void 0:fi.length)>0)){Li.clear();for(const n of fi)Qi(n);fi=[]}}fi=null}}function Ns(s){for(var e=Pr=s;e.parent!==null;){e=e.parent;var t=e.f;if(ha&&e===ce&&(t&Rs)!==0)return;if((t&(ns|ki))!==0){if((t&Ge)===0)return;e.f^=Ge}}ts.push(e)}function rd(s){let e=0,t=mi(0),i;return()=>{_d()&&(I(t),Ln(()=>(e===0&&(i=ee(()=>s(()=>ln(t)))),e+=1,()=>{Hs(()=>{e-=1,e===0&&(i==null||i(),i=void 0,ln(t))})})))}}var ad=En|Bs|Da;function od(s,e,t){new ld(s,e,t)}var Vt,Ot,Oa,ti,zi,ii,At,lt,si,Si,Gi,Pi,Wi,Ei,wr,Tr,at,cd,ud,er,tr,ga;class ld{constructor(e,t,i){be(this,at);us(this,"parent");be(this,Vt,!1);be(this,Ot);be(this,Oa,null);be(this,ti);be(this,zi);be(this,ii);be(this,At,null);be(this,lt,null);be(this,si,null);be(this,Si,null);be(this,Gi,0);be(this,Pi,0);be(this,Wi,!1);be(this,Ei,null);be(this,wr,()=>{M(this,Ei)&&ri(M(this,Ei),M(this,Gi))});be(this,Tr,rd(()=>(Y(this,Ei,mi(M(this,Gi))),()=>{Y(this,Ei,null)})));Y(this,Ot,e),Y(this,ti,t),Y(this,zi,i),this.parent=ce.b,Y(this,Vt,!!M(this,ti).pending),Y(this,ii,Dn(()=>{ce.b=this;{try{Y(this,At,st(()=>i(M(this,Ot))))}catch(n){this.error(n)}M(this,Pi)>0?et(this,at,tr).call(this):Y(this,Vt,!1)}},ad))}is_pending(){return M(this,Vt)||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!M(this,ti).pending}update_pending_count(e){et(this,at,ga).call(this,e),Y(this,Gi,M(this,Gi)+e),fa.add(M(this,wr))}get_effect_pending(){return M(this,Tr).call(this),I(M(this,Ei))}error(e){var t=M(this,ti).onerror;let i=M(this,ti).failed;if(M(this,Wi)||!t&&!i)throw e;M(this,At)&&(Dt(M(this,At)),Y(this,At,null)),M(this,lt)&&(Dt(M(this,lt)),Y(this,lt,null)),M(this,si)&&(Dt(M(this,si)),Y(this,si,null));var n=!1,r=!1;const a=()=>{if(n){Qu();return}n=!0,r&&xu(),Ni.ensure(),Y(this,Gi,0),M(this,si)!==null&&ai(M(this,si),()=>{Y(this,si,null)}),Y(this,Vt,this.has_pending_snippet()),Y(this,At,et(this,at,er).call(this,()=>(Y(this,Wi,!1),st(()=>M(this,zi).call(this,M(this,Ot)))))),M(this,Pi)>0?et(this,at,tr).call(this):Y(this,Vt,!1)};var o=re;try{Ye(null),r=!0,t==null||t(e,a),r=!1}catch(l){As(l,M(this,ii)&&M(this,ii).parent)}finally{Ye(o)}i&&Hs(()=>{Y(this,si,et(this,at,er).call(this,()=>{Y(this,Wi,!0);try{return st(()=>{i(M(this,Ot),()=>e,()=>a)})}catch(l){return As(l,M(this,ii).parent),null}finally{Y(this,Wi,!1)}}))})}}Vt=new WeakMap,Ot=new WeakMap,Oa=new WeakMap,ti=new WeakMap,zi=new WeakMap,ii=new WeakMap,At=new WeakMap,lt=new WeakMap,si=new WeakMap,Si=new WeakMap,Gi=new WeakMap,Pi=new WeakMap,Wi=new WeakMap,Ei=new WeakMap,wr=new WeakMap,Tr=new WeakMap,at=new WeakSet,cd=function(){try{Y(this,At,st(()=>M(this,zi).call(this,M(this,Ot))))}catch(e){this.error(e)}Y(this,Vt,!1)},ud=function(){const e=M(this,ti).pending;e&&(Y(this,lt,st(()=>e(M(this,Ot)))),Ni.enqueue(()=>{Y(this,At,et(this,at,er).call(this,()=>(Ni.ensure(),st(()=>M(this,zi).call(this,M(this,Ot)))))),M(this,Pi)>0?et(this,at,tr).call(this):(ai(M(this,lt),()=>{Y(this,lt,null)}),Y(this,Vt,!1))}))},er=function(e){var t=ce,i=re,n=De;Mt(M(this,ii)),Ye(M(this,ii)),xi(M(this,ii).ctx);try{return e()}catch(r){return _l(r),null}finally{Mt(t),Ye(i),xi(n)}},tr=function(){const e=M(this,ti).pending;M(this,At)!==null&&(Y(this,Si,document.createDocumentFragment()),dd(M(this,At),M(this,Si))),M(this,lt)===null&&Y(this,lt,st(()=>e(M(this,Ot))))},ga=function(e){var t;if(!this.has_pending_snippet()){this.parent&&et(t=this.parent,at,ga).call(t,e);return}Y(this,Pi,M(this,Pi)+e),M(this,Pi)===0&&(Y(this,Vt,!1),M(this,lt)&&ai(M(this,lt),()=>{Y(this,lt,null)}),M(this,Si)&&(M(this,Ot).before(M(this,Si)),Y(this,Si,null)))};function dd(s,e){for(var t=s.nodes_start,i=s.nodes_end;t!==null;){var n=t===i?null:Cn(t);e.append(t),t=n}}function fd(s,e,t){const i=qs()?On:Er;if(e.length===0){t(s.map(i));return}var n=Se,r=ce,a=hd();Promise.all(e.map(o=>pd(o))).then(o=>{n==null||n.activate(),a();try{t([...s.map(i),...o])}catch(l){(r.f&rs)===0&&As(l,r)}n==null||n.deactivate(),Cl()}).catch(o=>{As(o,r)})}function hd(){var s=ce,e=re,t=De,i=Se;return function(){Mt(s),Ye(e),xi(t),i==null||i.activate()}}function Cl(){Mt(null),Ye(null),xi(null)}function On(s){var e=yt|$t,t=re!==null&&(re.f&yt)!==0?re:null;return ce===null||t!==null&&(t.f&Lt)!==0?e|=Lt:ce.f|=Bs,{ctx:De,deps:null,effects:null,equals:pl,f:e,fn:s,reactions:null,rv:0,v:ze,wv:0,parent:t??ce,ac:null}}function pd(s,e){let t=ce;t===null&&Pu();var i=t.b,n=void 0,r=mi(ze),a=null,o=!re;return Pd(()=>{try{var l=s();a&&Promise.resolve(l).catch(()=>{})}catch(u){l=Promise.reject(u)}var c=()=>l;n=(a==null?void 0:a.then(c,c))??Promise.resolve(l),a=n;var d=Se,g=i.is_pending();o&&(i.update_pending_count(1),g||d.increment());const h=(u,f=void 0)=>{a=null,g||d.activate(),f?f!==$a&&(r.f|=Ji,ri(r,f)):((r.f&Ji)!==0&&(r.f^=Ji),ri(r,u)),o&&(i.update_pending_count(-1),g||d.decrement()),Cl()};if(n.then(h,u=>h(null,u||"unknown")),d)return()=>{queueMicrotask(()=>d.neuter())}}),new Promise(l=>{function c(d){function g(){d===n?l(r):c(n)}d.then(g,g)}c(n)})}function $i(s){const e=On(s);return Ll(e),e}function Er(s){const e=On(s);return e.equals=ml,e}function Ol(s){var e=s.effects;if(e!==null){s.effects=null;for(var t=0;t<e.length;t+=1)Dt(e[t])}}function gd(s){for(var e=s.parent;e!==null;){if((e.f&yt)===0)return e;e=e.parent}return null}function ja(s){var e,t=ce;Mt(gd(s));try{Ol(s),e=$l(s)}finally{Mt(t)}return e}function Al(s){var e=ja(s);if(s.equals(e)||(s.v=e,s.wv=Fl()),!os){var t=(Oi||(s.f&Lt)!==0)&&s.deps!==null?yi:Ge;rt(s,t)}}const Li=new Map;function mi(s,e){var t={f:0,v:s,reactions:null,equals:pl,rv:0,wv:0};return t}function bi(s,e){const t=mi(s);return Ll(t),t}function z(s,e=!1,t=!0){var n;const i=mi(s);return e||(i.equals=ml),Us&&t&&De!==null&&De.l!==null&&((n=De.l).s??(n.s=[])).push(i),i}function x(s,e,t=!1){re!==null&&(!zt||(re.f&mo)!==0)&&qs()&&(re.f&(yt|Rs|xa|mo))!==0&&!(nt!=null&&nt.includes(s))&&Fu();let i=t?ms(e):e;return ri(s,i)}function ri(s,e){if(!s.equals(e)){var t=s.v;os?Li.set(s,e):Li.set(s,t),s.v=e;var i=Ni.ensure();i.capture(s,t),(s.f&yt)!==0&&((s.f&$t)!==0&&ja(s),rt(s,(s.f&Lt)===0?Ge:yi)),s.wv=Fl(),Nl(s,$t),qs()&&ce!==null&&(ce.f&Ge)!==0&&(ce.f&(ki|ns))===0&&(Et===null?kd([s]):Et.push(s))}return e}function ln(s){x(s,s.v+1)}function Nl(s,e){var t=s.reactions;if(t!==null)for(var i=qs(),n=t.length,r=0;r<n;r++){var a=t[r],o=a.f;if(!(!i&&a===ce)){var l=(o&$t)===0;l&&rt(a,e),(o&yt)!==0?Nl(a,yi):l&&((o&Rs)!==0&&fi!==null&&fi.push(a),Ns(a))}}}let Ti=null;function md(s){var e=Ti;try{if(Ti=new Set,ee(s),e!==null)for(var t of Ti)e.add(t);return Ti}finally{Ti=e}}function hn(s){for(var e of md(s))ri(e,e.v)}let bo=!1;function vd(){bo||(bo=!0,document.addEventListener("reset",s=>{Promise.resolve().then(()=>{var e;if(!s.defaultPrevented)for(const t of s.target.elements)(e=t.__on_r)==null||e.call(t)})},{capture:!0}))}function Cr(s){var e=re,t=ce;Ye(null),Mt(null);try{return s()}finally{Ye(e),Mt(t)}}function Ra(s,e,t,i=t){s.addEventListener(e,()=>Cr(t));const n=s.__on_r;n?s.__on_r=()=>{n(),i(!0)}:s.__on_r=()=>i(!0),vd()}let Ts=!1;function wo(s){Ts=s}let os=!1;function To(s){os=s}let re=null,zt=!1;function Ye(s){re=s}let ce=null;function Mt(s){ce=s}let nt=null;function Ll(s){re!==null&&(nt===null?nt=[s]:nt.push(s))}let tt=null,vt=0,Et=null;function kd(s){Et=s}let Dl=1,pn=0,Xi=pn;function _o(s){Xi=s}let Oi=!1;function Fl(){return++Dl}function An(s){var g;var e=s.f;if((e&$t)!==0)return!0;if((e&yi)!==0){var t=s.deps,i=(e&Lt)!==0;if(t!==null){var n,r,a=(e&ur)!==0,o=i&&ce!==null&&!Oi,l=t.length;if((a||o)&&(ce===null||(ce.f&rs)===0)){var c=s,d=c.parent;for(n=0;n<l;n++)r=t[n],(a||!((g=r==null?void 0:r.reactions)!=null&&g.includes(c)))&&(r.reactions??(r.reactions=[])).push(c);a&&(c.f^=ur),o&&d!==null&&(d.f&Lt)===0&&(c.f^=Lt)}for(n=0;n<l;n++)if(r=t[n],An(r)&&Al(r),r.wv>s.wv)return!0}(!i||ce!==null&&!Oi)&&rt(s,Ge)}return!1}function xl(s,e,t=!0){var i=s.reactions;if(i!==null&&!(nt!=null&&nt.includes(s)))for(var n=0;n<i.length;n++){var r=i[n];(r.f&yt)!==0?xl(r,e,!1):e===r&&(t?rt(r,$t):(r.f&Ge)!==0&&rt(r,yi),Ns(r))}}function $l(s){var p;var e=tt,t=vt,i=Et,n=re,r=Oi,a=nt,o=De,l=zt,c=Xi,d=s.f;tt=null,vt=0,Et=null,Oi=(d&Lt)!==0&&(zt||!Ts||re===null),re=(d&(ki|ns))===0?s:null,nt=null,xi(s.ctx),zt=!1,Xi=++pn,s.ac!==null&&(Cr(()=>{s.ac.abort($a)}),s.ac=null);try{s.f|=da;var g=s.fn,h=g(),u=s.deps;if(tt!==null){var f;if(hr(s,vt),u!==null&&vt>0)for(u.length=vt+tt.length,f=0;f<tt.length;f++)u[vt+f]=tt[f];else s.deps=u=tt;if(!Oi||(d&yt)!==0&&s.reactions!==null)for(f=vt;f<u.length;f++)((p=u[f]).reactions??(p.reactions=[])).push(s)}else u!==null&&vt<u.length&&(hr(s,vt),u.length=vt);if(qs()&&Et!==null&&!zt&&u!==null&&(s.f&(yt|yi|$t))===0)for(f=0;f<Et.length;f++)xl(Et[f],s);return n!==null&&n!==s&&(pn++,Et!==null&&(i===null?i=Et:i.push(...Et))),(s.f&Ji)!==0&&(s.f^=Ji),h}catch(m){return _l(m)}finally{s.f^=da,tt=e,vt=t,Et=i,re=n,Oi=r,nt=a,xi(o),zt=l,Xi=c}}function yd(s,e){let t=e.reactions;if(t!==null){var i=ku.call(t,s);if(i!==-1){var n=t.length-1;n===0?t=e.reactions=null:(t[i]=t[n],t.pop())}}t===null&&(e.f&yt)!==0&&(tt===null||!tt.includes(e))&&(rt(e,yi),(e.f&(Lt|ur))===0&&(e.f^=ur),Ol(e),hr(e,0))}function hr(s,e){var t=s.deps;if(t!==null)for(var i=e;i<t.length;i++)yd(s,t[i])}function Qi(s){var e=s.f;if((e&rs)===0){rt(s,Ge);var t=ce,i=Ts;ce=s,Ts=!0;try{(e&Rs)!==0?Ed(s):ql(s),Ul(s);var n=$l(s);s.teardown=typeof n=="function"?n:null,s.wv=Dl;var r;dl&&$u&&(s.f&$t)!==0&&s.deps}finally{Ts=i,ce=t}}}async function bd(){await Promise.resolve(),Pl()}function I(s){var e=s.f,t=(e&yt)!==0;if(Ti==null||Ti.add(s),re!==null&&!zt){var i=ce!==null&&(ce.f&rs)!==0;if(!i&&!(nt!=null&&nt.includes(s))){var n=re.deps;if((re.f&da)!==0)s.rv<pn&&(s.rv=pn,tt===null&&n!==null&&n[vt]===s?vt++:tt===null?tt=[s]:(!Oi||!tt.includes(s))&&tt.push(s));else{(re.deps??(re.deps=[])).push(s);var r=s.reactions;r===null?s.reactions=[re]:r.includes(re)||r.push(re)}}}else if(t&&s.deps===null&&s.effects===null){var a=s,o=a.parent;o!==null&&(o.f&Lt)===0&&(a.f^=Lt)}if(os){if(Li.has(s))return Li.get(s);if(t){a=s;var l=a.v;return((a.f&Ge)===0&&a.reactions!==null||Ml(a))&&(l=ja(a)),Li.set(a,l),l}}else t&&(a=s,An(a)&&Al(a));if((s.f&Ji)!==0)throw s.v;return s.v}function Ml(s){if(s.v===ze)return!0;if(s.deps===null)return!1;for(const e of s.deps)if(Li.has(e)||(e.f&yt)!==0&&Ml(e))return!0;return!1}function ee(s){var e=zt;try{return zt=!0,s()}finally{zt=e}}const wd=-7169;function rt(s,e){s.f=s.f&wd|e}function Yt(s){if(!(typeof s!="object"||!s||s instanceof EventTarget)){if(Ai in s)ma(s);else if(!Array.isArray(s))for(let e in s){const t=s[e];typeof t=="object"&&t&&Ai in t&&ma(t)}}}function ma(s,e=new Set){if(typeof s=="object"&&s!==null&&!(s instanceof EventTarget)&&!e.has(s)){e.add(s),s instanceof Date&&s.getTime();for(let i in s)try{ma(s[i],e)}catch{}const t=Na(s);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const i=fl(t);for(let n in i){const r=i[n].get;if(r)try{r.call(s)}catch{}}}}}function jl(s){ce===null&&re===null&&Ou(),re!==null&&(re.f&Lt)!==0&&ce===null&&Cu(),os&&Eu()}function Td(s,e){var t=e.last;t===null?e.last=e.first=s:(t.next=s,s.prev=t,e.last=s)}function di(s,e,t,i=!0){var n=ce;n!==null&&(n.f&Gt)!==0&&(s|=Gt);var r={ctx:De,deps:null,nodes_start:null,nodes_end:null,f:s|$t,first:null,fn:e,last:null,next:null,parent:n,b:n&&n.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(t)try{Qi(r),r.f|=Fa}catch(l){throw Dt(r),l}else e!==null&&Ns(r);if(i){var a=r;if(t&&a.deps===null&&a.teardown===null&&a.nodes_start===null&&a.first===a.last&&(a.f&Bs)===0&&(a=a.first),a!==null&&(a.parent=n,n!==null&&Td(a,n),re!==null&&(re.f&yt)!==0&&(s&ns)===0)){var o=re;(o.effects??(o.effects=[])).push(a)}}return r}function _d(){return re!==null&&!zt}function Or(s){const e=di(_r,null,!1);return rt(e,Ge),e.teardown=s,e}function va(s){jl();var e=ce.f,t=!re&&(e&ki)!==0&&(e&Fa)===0;if(t){var i=De;(i.e??(i.e=[])).push(s)}else return Rl(s)}function Rl(s){return di(La|hl,s,!1)}function Id(s){return jl(),di(_r|hl,s,!0)}function Sd(s){Ni.ensure();const e=di(ns|Bs,s,!0);return(t={})=>new Promise(i=>{t.outro?ai(e,()=>{Dt(e),i(void 0)}):(Dt(e),i(void 0))})}function Bl(s){return di(La,s,!1)}function ut(s,e){var t=De,i={effect:null,ran:!1,deps:s};t.l.$.push(i),i.effect=Ln(()=>{s(),!i.ran&&(i.ran=!0,ee(e))})}function Nn(){var s=De;Ln(()=>{for(var e of s.l.$){e.deps();var t=e.effect;(t.f&Ge)!==0&&rt(t,yi),An(t)&&Qi(t),e.ran=!1}})}function Pd(s){return di(xa|Bs,s,!0)}function Ln(s,e=0){return di(_r|e,s,!0)}function ae(s,e=[],t=[]){fd(e,t,i=>{di(_r,()=>s(...i.map(I)),!0)})}function Dn(s,e=0){var t=di(Rs|e,s,!0);return t}function st(s,e=!0){return di(ki|Bs,s,!0,e)}function Ul(s){var e=s.teardown;if(e!==null){const t=os,i=re;To(!0),Ye(null);try{e.call(null)}finally{To(t),Ye(i)}}}function ql(s,e=!1){var t=s.first;for(s.first=s.last=null;t!==null;){const n=t.ac;n!==null&&Cr(()=>{n.abort($a)});var i=t.next;(t.f&ns)!==0?t.parent=null:Dt(t,e),t=i}}function Ed(s){for(var e=s.first;e!==null;){var t=e.next;(e.f&ki)===0&&Dt(e),e=t}}function Dt(s,e=!0){var t=!1;(e||(s.f&Iu)!==0)&&s.nodes_start!==null&&s.nodes_end!==null&&(Cd(s.nodes_start,s.nodes_end),t=!0),ql(s,e&&!t),hr(s,0),rt(s,rs);var i=s.transitions;if(i!==null)for(const r of i)r.stop();Ul(s);var n=s.parent;n!==null&&n.first!==null&&Hl(s),s.next=s.prev=s.teardown=s.ctx=s.deps=s.fn=s.nodes_start=s.nodes_end=s.ac=null}function Cd(s,e){for(;s!==null;){var t=s===e?null:Cn(s);s.remove(),s=t}}function Hl(s){var e=s.parent,t=s.prev,i=s.next;t!==null&&(t.next=i),i!==null&&(i.prev=t),e!==null&&(e.first===s&&(e.first=i),e.last===s&&(e.last=t))}function ai(s,e){var t=[];Ba(s,t,!0),Kl(t,()=>{Dt(s),e&&e()})}function Kl(s,e){var t=s.length;if(t>0){var i=()=>--t||e();for(var n of s)n.out(i)}else e()}function Ba(s,e,t){if((s.f&Gt)===0){if(s.f^=Gt,s.transitions!==null)for(const a of s.transitions)(a.is_global||t)&&e.push(a);for(var i=s.first;i!==null;){var n=i.next,r=(i.f&En)!==0||(i.f&ki)!==0;Ba(i,e,r?t:!1),i=n}}}function _s(s){Vl(s,!0)}function Vl(s,e){if((s.f&Gt)!==0){s.f^=Gt,(s.f&Ge)===0&&(rt(s,$t),Ns(s));for(var t=s.first;t!==null;){var i=t.next,n=(t.f&En)!==0||(t.f&ki)!==0;Vl(t,n?e:!1),t=i}if(s.transitions!==null)for(const r of s.transitions)(r.is_global||e)&&r.in()}}const Od=["touchstart","touchmove"];function Ad(s){return Od.includes(s)}const Nd=new Set,Io=new Set;function Ld(s,e,t,i={}){function n(r){if(i.capture||tn.call(e,r),!r.cancelBubble)return Cr(()=>t==null?void 0:t.call(this,r))}return s.startsWith("pointer")||s.startsWith("touch")||s==="wheel"?Hs(()=>{e.addEventListener(s,n,i)}):e.addEventListener(s,n,i),n}function pe(s,e,t,i,n){var r={capture:i,passive:n},a=Ld(s,e,t,r);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&Or(()=>{e.removeEventListener(s,a,r)})}let So=null;function tn(s){var w;var e=this,t=e.ownerDocument,i=s.type,n=((w=s.composedPath)==null?void 0:w.call(s))||[],r=n[0]||s.target;So=s;var a=0,o=So===s&&s.__root;if(o){var l=n.indexOf(o);if(l!==-1&&(e===document||e===window)){s.__root=e;return}var c=n.indexOf(e);if(c===-1)return;l<=c&&(a=l)}if(r=n[a]||s.target,r!==e){lr(s,"currentTarget",{configurable:!0,get(){return r||t}});var d=re,g=ce;Ye(null),Mt(null);try{for(var h,u=[];r!==null;){var f=r.assignedSlot||r.parentNode||r.host||null;try{var p=r["__"+i];if(p!=null&&(!r.disabled||s.target===r))if(Pn(p)){var[m,...v]=p;m.apply(r,[s,...v])}else p.call(r,s)}catch(y){h?u.push(y):h=y}if(s.cancelBubble||f===e||f===null)break;r=f}if(h){for(let y of u)queueMicrotask(()=>{throw y});throw h}}finally{s.__root=e,delete s.currentTarget,Ye(d),Mt(g)}}}function Dd(s){var e=document.createElement("template");return e.innerHTML=s.replaceAll("<!>","<!---->"),e.content}function pr(s,e){var t=ce;t.nodes_start===null&&(t.nodes_start=s,t.nodes_end=e)}function G(s,e){var t=(e&Vu)!==0,i=(e&zu)!==0,n,r=!s.startsWith("<!>");return()=>{n===void 0&&(n=Dd(r?s:"<!>"+s),t||(n=fr(n)));var a=i||bl?document.importNode(n,!0):n.cloneNode(!0);if(t){var o=fr(a),l=a.lastChild;pr(o,l)}else pr(a,a);return a}}function Po(s=""){{var e=as(s+"");return pr(e,e),e}}function Nt(){var s=document.createDocumentFragment(),e=document.createComment(""),t=as();return s.append(e,t),pr(e,t),s}function U(s,e){s!==null&&s.before(e)}function ne(s,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(s.__t??(s.__t=s.nodeValue))&&(s.__t=t,s.nodeValue=t+"")}function zl(s,e){return Fd(s,e)}const ds=new Map;function Fd(s,{target:e,anchor:t,props:i={},events:n,context:r,intro:a=!0}){td();var o=new Set,l=g=>{for(var h=0;h<g.length;h++){var u=g[h];if(!o.has(u)){o.add(u);var f=Ad(u);e.addEventListener(u,tn,{passive:f});var p=ds.get(u);p===void 0?(document.addEventListener(u,tn,{passive:f}),ds.set(u,1)):ds.set(u,p+1)}}};l(Aa(Nd)),Io.add(l);var c=void 0,d=Sd(()=>{var g=t??e.appendChild(as());return od(g,{pending:()=>{}},h=>{if(r){gt({});var u=De;u.c=r}n&&(i.$$events=n),c=s(h,i)||{},r&&mt()}),()=>{var f;for(var h of o){e.removeEventListener(h,tn);var u=ds.get(h);--u===0?(document.removeEventListener(h,tn),ds.delete(h)):ds.set(h,u)}Io.delete(l),g!==t&&((f=g.parentNode)==null||f.removeChild(g))}});return ka.set(c,d),c}let ka=new WeakMap;function Gl(s,e){const t=ka.get(s);return t?(ka.delete(s),t(e)):Promise.resolve()}const Jr=0,qn=1,Xr=2;function xd(s,e,t,i,n){var r=s,a=qs(),o=De,l=ze,c,d,g,h=a?mi(void 0):z(void 0,!1,!1),u=a?mi(void 0):z(void 0,!1,!1),f=!1;function p(v,w){f=!0,w&&(Mt(m),Ye(m),xi(o));try{v===Jr&&t&&(c?_s(c):c=st(()=>t(r))),v===qn&&i&&(d?_s(d):d=st(()=>i(r,h))),v===Xr&&n&&(g?_s(g):g=st(()=>n(r,u))),v!==Jr&&c&&ai(c,()=>c=null),v!==qn&&d&&ai(d,()=>d=null),v!==Xr&&g&&ai(g,()=>g=null)}finally{w&&(xi(null),Ye(null),Mt(null),Pl())}}var m=Dn(()=>{if(l!==(l=e())){if(wu(l)){var v=l;f=!1,v.then(w=>{v===l&&(ri(h,w),p(qn,!0))},w=>{if(v===l&&(ri(u,w),p(Xr,!0),!n))throw u.v}),Hs(()=>{f||p(Jr,!0)})}else ri(h,l),p(qn,!1);return()=>l=ze}})}function Oe(s,e,t=!1){var i=s,n=null,r=null,a=ze,o=t?En:0,l=!1;const c=(u,f=!0)=>{l=!0,h(f,u)};var d=null;function g(){d!==null&&(d.lastChild.remove(),i.before(d),d=null);var u=a?n:r,f=a?r:n;u&&_s(u),f&&ai(f,()=>{a?r=null:n=null})}const h=(u,f)=>{if(a!==(a=u)){var p=Ma(),m=i;if(p&&(d=document.createDocumentFragment(),d.append(m=as())),a?n??(n=f&&st(()=>f(m))):r??(r=f&&st(()=>f(m))),p){var v=Se,w=a?n:r,y=a?r:n;w&&v.skipped_effects.delete(w),y&&v.skipped_effects.add(y),v.add_callback(g)}else g()}};Dn(()=>{l=!1,e(c),l||h(null,null)},o)}function jt(s,e){return e}function $d(s,e,t){for(var i=s.items,n=[],r=e.length,a=0;a<r;a++)Ba(e[a].e,n,!0);var o=r>0&&n.length===0&&t!==null;if(o){var l=t.parentNode;id(l),l.append(t),i.clear(),ei(s,e[0].prev,e[r-1].next)}Kl(n,()=>{for(var c=0;c<r;c++){var d=e[c];o||(i.delete(d.k),ei(s,d.prev,d.next)),Dt(d.e,!o)}})}function Rt(s,e,t,i,n,r=null){var a=s,o={flags:e,items:new Map,first:null},l=(e&kl)!==0;if(l){var c=s;a=c.appendChild(as())}var d=null,g=!1,h=new Map,u=Er(()=>{var v=t();return Pn(v)?v:v==null?[]:Aa(v)}),f,p;function m(){Md(p,f,o,h,a,n,e,i,t),r!==null&&(f.length===0?d?_s(d):d=st(()=>r(a)):d!==null&&ai(d,()=>{d=null}))}Dn(()=>{p??(p=ce),f=I(u);var v=f.length;if(!(g&&v===0)){g=v===0;var w,y,k,E;if(Ma()){var T=new Set,S=Se;for(y=0;y<v;y+=1){k=f[y],E=i(k,y);var P=o.items.get(E)??h.get(E);P?(e&(Ir|Sr))!==0&&Wl(P,k,y,e):(w=Yl(null,o,null,null,k,E,y,n,e,t,!0),h.set(E,w)),T.add(E)}for(const[L,A]of o.items)T.has(L)||S.skipped_effects.add(A.e);S.add_callback(m)}else m();I(u)}})}function Md(s,e,t,i,n,r,a,o,l){var ge,me,le,Te;var c=(a&ju)!==0,d=(a&(Ir|Sr))!==0,g=e.length,h=t.items,u=t.first,f=u,p,m=null,v,w=[],y=[],k,E,T,S;if(c)for(S=0;S<g;S+=1)k=e[S],E=o(k,S),T=h.get(E),T!==void 0&&((ge=T.a)==null||ge.measure(),(v??(v=new Set)).add(T));for(S=0;S<g;S+=1){if(k=e[S],E=o(k,S),T=h.get(E),T===void 0){var P=i.get(E);if(P!==void 0){i.delete(E),h.set(E,P);var L=m?m.next:f;ei(t,m,P),ei(t,P,L),Qr(P,L,n),m=P}else{var A=f?f.e.nodes_start:n;m=Yl(A,t,m,m===null?t.first:m.next,k,E,S,r,a,l)}h.set(E,m),w=[],y=[],f=m.next;continue}if(d&&Wl(T,k,S,a),(T.e.f&Gt)!==0&&(_s(T.e),c&&((me=T.a)==null||me.unfix(),(v??(v=new Set)).delete(T))),T!==f){if(p!==void 0&&p.has(T)){if(w.length<y.length){var _=y[0],C;m=_.prev;var D=w[0],q=w[w.length-1];for(C=0;C<w.length;C+=1)Qr(w[C],_,n);for(C=0;C<y.length;C+=1)p.delete(y[C]);ei(t,D.prev,q.next),ei(t,m,D),ei(t,q,_),f=_,m=q,S-=1,w=[],y=[]}else p.delete(T),Qr(T,f,n),ei(t,T.prev,T.next),ei(t,T,m===null?t.first:m.next),ei(t,m,T),m=T;continue}for(w=[],y=[];f!==null&&f.k!==E;)(f.e.f&Gt)===0&&(p??(p=new Set)).add(f),y.push(f),f=f.next;if(f===null)continue;T=f}w.push(T),m=T,f=T.next}if(f!==null||p!==void 0){for(var W=p===void 0?[]:Aa(p);f!==null;)(f.e.f&Gt)===0&&W.push(f),f=f.next;var R=W.length;if(R>0){var Q=(a&kl)!==0&&g===0?n:null;if(c){for(S=0;S<R;S+=1)(le=W[S].a)==null||le.measure();for(S=0;S<R;S+=1)(Te=W[S].a)==null||Te.fix()}$d(t,W,Q)}}c&&Hs(()=>{var se;if(v!==void 0)for(T of v)(se=T.a)==null||se.apply()}),s.first=t.first&&t.first.e,s.last=m&&m.e;for(var oe of i.values())Dt(oe.e);i.clear()}function Wl(s,e,t,i){(i&Ir)!==0&&ri(s.v,e),(i&Sr)!==0?ri(s.i,t):s.i=t}function Yl(s,e,t,i,n,r,a,o,l,c,d){var g=(l&Ir)!==0,h=(l&Ru)===0,u=g?h?z(n,!1,!1):mi(n):n,f=(l&Sr)===0?a:mi(a),p={i:f,v:u,k:r,a:null,e:null,prev:t,next:i};try{if(s===null){var m=document.createDocumentFragment();m.append(s=as())}return p.e=st(()=>o(s,u,f,c),Zu),p.e.prev=t&&t.e,p.e.next=i&&i.e,t===null?d||(e.first=p):(t.next=p,t.e.next=p.e),i!==null&&(i.prev=p,i.e.prev=p.e),p}finally{}}function Qr(s,e,t){for(var i=s.next?s.next.e.nodes_start:t,n=e?e.e.nodes_start:t,r=s.e.nodes_start;r!==null&&r!==i;){var a=Cn(r);n.before(r),r=a}}function ei(s,e,t){e===null?s.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function jd(s,e,t,i,n){var o;var r=(o=e.$$slots)==null?void 0:o[t],a=!1;r===!0&&(r=e.children,a=!0),r===void 0||r(s,a?()=>i:i)}function Rd(s,e,t){var i=s,n,r,a=null,o=null;function l(){r&&(ai(r),r=null),a&&(a.lastChild.remove(),i.before(a),a=null),r=o,o=null}Dn(()=>{if(n!==(n=e())){var c=Ma();if(n){var d=i;c&&(a=document.createDocumentFragment(),a.append(d=as()),r&&Se.skipped_effects.add(r)),o=st(()=>t(d,n))}c?Se.add_callback(l):l()}},En)}function Jl(s,e,t){Bl(()=>{var i=ee(()=>e(s,t==null?void 0:t())||{});if(i!=null&&i.destroy)return()=>i.destroy()})}function Bd(s,e,t){var i=s==null?"":""+s;return i===""?null:i}function Ud(s,e){return s==null?null:String(s)}function Ua(s,e,t,i,n,r){var a=s.__className;if(a!==t||a===void 0){var o=Bd(t);o==null?s.removeAttribute("class"):s.className=o,s.__className=t}return r}function Eo(s,e,t,i){var n=s.__style;if(n!==e){var r=Ud(e);r==null?s.removeAttribute("style"):s.style.cssText=r,s.__style=e}return i}function Ar(s,e,t=!1){if(s.multiple){if(e==null)return;if(!Pn(e))return Xu();for(var i of s.options)i.selected=e.includes(cn(i));return}for(i of s.options){var n=cn(i);if(ed(n,e)){i.selected=!0;return}}(!t||e!==void 0)&&(s.selectedIndex=-1)}function qa(s){var e=new MutationObserver(()=>{Ar(s,s.__value)});e.observe(s,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Or(()=>{e.disconnect()})}function gn(s,e,t=e){var i=!0;Ra(s,"change",n=>{var r=n?"[selected]":":checked",a;if(s.multiple)a=[].map.call(s.querySelectorAll(r),cn);else{var o=s.querySelector(r)??s.querySelector("option:not([disabled])");a=o&&cn(o)}t(a)}),Bl(()=>{var n=e();if(Ar(s,n,i),i&&n===void 0){var r=s.querySelector(":checked");r!==null&&(n=cn(r),t(n))}s.__value=n,i=!1}),qa(s)}function cn(s){return"__value"in s?s.__value:s.value}const qd=Symbol("is custom element"),Hd=Symbol("is html");function ya(s,e){var t=Xl(s);t.checked!==(t.checked=e??void 0)&&(s.checked=e)}function Kd(s,e,t,i){var n=Xl(s);n[e]!==(n[e]=t)&&(Vd(s).includes(e)?s[e]=t:s.setAttribute(e,t))}function Xl(s){return s.__attributes??(s.__attributes={[qd]:s.nodeName.includes("-"),[Hd]:s.namespaceURI===Gu})}var Co=new Map;function Vd(s){var e=s.getAttribute("is")||s.nodeName,t=Co.get(e);if(t)return t;Co.set(e,t=[]);for(var i,n=s,r=Element.prototype;r!==n;){i=fl(n);for(var a in i)i[a].set&&t.push(a);n=Na(n)}return t}function Ls(s,e,t=e){var i=new WeakSet;Ra(s,"input",async n=>{var r=n?s.defaultValue:s.value;if(r=Zr(s)?ea(r):r,t(r),Se!==null&&i.add(Se),await bd(),r!==(r=e())){var a=s.selectionStart,o=s.selectionEnd;s.value=r??"",o!==null&&(s.selectionStart=a,s.selectionEnd=Math.min(o,s.value.length))}}),ee(e)==null&&s.value&&(t(Zr(s)?ea(s.value):s.value),Se!==null&&i.add(Se)),Ln(()=>{var n=e();if(s===document.activeElement){var r=Qn??Se;if(i.has(r))return}Zr(s)&&n===ea(s.value)||s.type==="date"&&!n&&!s.value||n!==s.value&&(s.value=n??"")})}function Ha(s,e,t=e){Ra(s,"change",i=>{var n=i?s.defaultChecked:s.checked;t(n)}),ee(e)==null&&t(s.checked),Ln(()=>{var i=e();s.checked=!!i})}function Zr(s){var e=s.type;return e==="number"||e==="range"}function ea(s){return s===""?null:+s}function zd(s,e,t){var i=Yi(s,e);i&&i.set&&(s[e]=t,Or(()=>{s[e]=null}))}function wt(s=!1){const e=De,t=e.l.u;if(!t)return;let i=()=>Yt(e.s);if(s){let n=0,r={};const a=On(()=>{let o=!1;const l=e.s;for(const c in l)l[c]!==r[c]&&(r[c]=l[c],o=!0);return o&&n++,n});i=()=>I(a)}t.b.length&&Id(()=>{Oo(e,i),cr(t.b)}),va(()=>{const n=ee(()=>t.m.map(Tu));return()=>{for(const r of n)typeof r=="function"&&r()}}),t.a.length&&va(()=>{Oo(e,i),cr(t.a)})}function Oo(s,e){if(s.l.s)for(const t of s.l.s)I(t);e()}let Hn=!1,ba=Symbol();function Fn(s,e,t){const i=t[e]??(t[e]={store:null,source:z(void 0),unsubscribe:ws});if(i.store!==s&&!(ba in t))if(i.unsubscribe(),i.store=s??null,s==null)i.source.v=void 0,i.unsubscribe=ws;else{var n=!0;i.unsubscribe=Ql(s,r=>{n?i.source.v=r:x(i.source,r)}),n=!1}return s&&ba in t?Xd(s):I(i.source)}function xn(){const s={};function e(){Or(()=>{for(var t in s)s[t].unsubscribe();lr(s,ba,{enumerable:!1,value:!0})})}return[s,e]}function Gd(s,e,t){return s.set(t),e}function Wd(s){var e=Hn;try{return Hn=!1,[s(),Hn]}finally{Hn=e}}function Le(s,e,t,i){var y;var n=!Us||(t&Uu)!==0,r=(t&Hu)!==0,a=(t&Ku)!==0,o=i,l=!0,c=()=>(l&&(l=!1,o=a?ee(i):i),o),d;if(r){var g=Ai in s||Su in s;d=((y=Yi(s,e))==null?void 0:y.set)??(g&&e in s?k=>s[e]=k:void 0)}var h,u=!1;r?[h,u]=Wd(()=>s[e]):h=s[e],h===void 0&&i!==void 0&&(h=c(),d&&(n&&Nu(),d(h)));var f;if(n?f=()=>{var k=s[e];return k===void 0?c():(l=!0,k)}:f=()=>{var k=s[e];return k!==void 0&&(o=void 0),k===void 0?o:k},n&&(t&qu)===0)return f;if(d){var p=s.$$legacy;return(function(k,E){return arguments.length>0?((!n||!E||p||u)&&d(E?f():k),k):f()})}var m=!1,v=((t&Bu)!==0?On:Er)(()=>(m=!1,f()));r&&I(v);var w=ce;return(function(k,E){if(arguments.length>0){const T=E?I(v):n&&r?ms(k):k;return x(v,T),m=!0,o!==void 0&&(o=T),k}return os&&m||(w.f&rs)!==0?v.v:I(v)})}function Ks(s){De===null&&vl(),Us&&De.l!==null?Jd(De).m.push(s):va(()=>{const e=ee(s);if(typeof e=="function")return e})}function Yd(s,e,{bubbles:t=!1,cancelable:i=!1}={}){return new CustomEvent(s,{detail:e,bubbles:t,cancelable:i})}function $n(){const s=De;return s===null&&vl(),(e,t,i)=>{var r;const n=(r=s.s.$$events)==null?void 0:r[e];if(n){const a=Pn(n)?n.slice():[n],o=Yd(e,t,i);for(const l of a)l.call(s.x,o);return!o.defaultPrevented}return!0}}function Jd(s){var e=s.l;return e.u??(e.u={a:[],b:[],m:[]})}function Ql(s,e,t){if(s==null)return e(void 0),ws;const i=ee(()=>s.subscribe(e,t));return i.unsubscribe?()=>i.unsubscribe():i}const fs=[];function Zl(s,e=ws){let t=null;const i=new Set;function n(o){if(gl(s,o)&&(s=o,t)){const l=!fs.length;for(const c of i)c[1](),fs.push(c,s);if(l){for(let c=0;c<fs.length;c+=2)fs[c][0](fs[c+1]);fs.length=0}}}function r(o){n(o(s))}function a(o,l=ws){const c=[o,l];return i.add(c),i.size===1&&(t=e(n,r)||ws),o(s),()=>{i.delete(c),i.size===0&&t&&(t(),t=null)}}return{set:n,update:r,subscribe:a}}function Xd(s){let e;return Ql(s,t=>e=t)(),e}let Xs=null,Ke;function Qd(s){if(Ke)return;Xs=s;const{subscribe:e,set:t,update:i}=Zl(Je);function n(r){Object.assign(Je,r),Xs&&Zd(Je)}Ke={subscribe:e,update:r=>{i(a=>{const o=r(a);return n(o),o})},set:async r=>{t(r),n(r),await(Xs==null?void 0:Xs.saveSettings())}}}const ec={baseURL:"ticktick.com",automaticSynchronizationInterval:300,enableFullVaultSync:!1,tagAndOr:1,debugMode:!1,logLevel:"info",SyncProject:"",SyncTag:"",defaultProjectId:"",defaultProjectName:"Inbox",TickTickTasksFilePath:"/",keepProjectFolders:!1,syncNotes:!0,noteDelimiter:"-------------------------------------------------------------",fileLinksInTickTick:"taskLink",taskLinksInObsidian:"taskLink",bkupFolder:"/",inboxID:"",inboxName:"Inbox",checkPoint:0,skipBackup:!1,fileMetadata:{},TickTickTasksData:{projects:[],tasks:[]}};let Je={...ec};const O=()=>Je,Zd=s=>{Je=s},He=s=>(Je={...Je,...s},Ke.set(Je),O()),Zi=()=>Je.TickTickTasksData.projects,tc=s=>(Je.TickTickTasksData.projects=s,Zi()),Ct=()=>Je.TickTickTasksData.tasks,Bi=s=>(Je.TickTickTasksData.tasks=s,Ct()),ef=()=>Je.TickTickTasksData.projectGroups,ic=s=>(Je.TickTickTasksData.projectGroups=s,ef()),ct=()=>Je.TickTickTasksFilePath==="/"?"":Je.TickTickTasksFilePath;function sc(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var sn={exports:{}},tf=sn.exports,Ao;function sf(){return Ao||(Ao=1,(function(s,e){(function(t,i){var n="1.0.41",r="",a="?",o="function",l="undefined",c="object",d="string",g="major",h="model",u="name",f="type",p="vendor",m="version",v="architecture",w="console",y="mobile",k="tablet",E="smarttv",T="wearable",S="embedded",P=500,L="Amazon",A="Apple",_="ASUS",C="BlackBerry",D="Browser",q="Chrome",W="Edge",R="Firefox",Q="Google",oe="Honor",ge="Huawei",me="Lenovo",le="LG",Te="Microsoft",se="Motorola",ve="Nvidia",K="OnePlus",ke="Opera",H="OPPO",ue="Samsung",qe="Sharp",j="Sony",Ee="Xiaomi",Be="Zebra",Qe="Facebook",Tt="Chromium OS",fe="Mac OS",B=" Browser",te=function(ie,de){var J={};for(var Ie in ie)de[Ie]&&de[Ie].length%2===0?J[Ie]=de[Ie].concat(ie[Ie]):J[Ie]=ie[Ie];return J},he=function(ie){for(var de={},J=0;J<ie.length;J++)de[ie[J].toUpperCase()]=ie[J];return de},Ce=function(ie,de){return typeof ie===d?V(de).indexOf(V(ie))!==-1:!1},V=function(ie){return ie.toLowerCase()},ye=function(ie){return typeof ie===d?ie.replace(/[^\d\.]/g,r).split(".")[0]:i},Ae=function(ie,de){if(typeof ie===d)return ie=ie.replace(/^\s\s*/,r),typeof de===l?ie:ie.substring(0,P)},Ne=function(ie,de){for(var J=0,Ie,Ht,Xt,we,X,Qt;J<de.length&&!X;){var Gr=de[J],ho=de[J+1];for(Ie=Ht=0;Ie<Gr.length&&!X&&Gr[Ie];)if(X=Gr[Ie++].exec(ie),X)for(Xt=0;Xt<ho.length;Xt++)Qt=X[++Ht],we=ho[Xt],typeof we===c&&we.length>0?we.length===2?typeof we[1]==o?this[we[0]]=we[1].call(this,Qt):this[we[0]]=we[1]:we.length===3?typeof we[1]===o&&!(we[1].exec&&we[1].test)?this[we[0]]=Qt?we[1].call(this,Qt,we[2]):i:this[we[0]]=Qt?Qt.replace(we[1],we[2]):i:we.length===4&&(this[we[0]]=Qt?we[3].call(this,Qt.replace(we[1],we[2])):i):this[we]=Qt||i;J+=2}},Fe=function(ie,de){for(var J in de)if(typeof de[J]===c&&de[J].length>0){for(var Ie=0;Ie<de[J].length;Ie++)if(Ce(de[J][Ie],ie))return J===a?i:J}else if(Ce(de[J],ie))return J===a?i:J;return de.hasOwnProperty("*")?de["*"]:ie},Ve={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},ot={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},_t={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[m,[u,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[m,[u,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[u,m],[/opios[\/ ]+([\w\.]+)/i],[m,[u,ke+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[m,[u,ke+" GX"]],[/\bopr\/([\w\.]+)/i],[m,[u,ke]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[m,[u,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[m,[u,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[u,m],[/quark(?:pc)?\/([-\w\.]+)/i],[m,[u,"Quark"]],[/\bddg\/([\w\.]+)/i],[m,[u,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[m,[u,"UC"+D]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[m,[u,"WeChat"]],[/konqueror\/([\w\.]+)/i],[m,[u,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[m,[u,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[m,[u,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[m,[u,"Smart Lenovo "+D]],[/(avast|avg)\/([\w\.]+)/i],[[u,/(.+)/,"$1 Secure "+D],m],[/\bfocus\/([\w\.]+)/i],[m,[u,R+" Focus"]],[/\bopt\/([\w\.]+)/i],[m,[u,ke+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[m,[u,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[m,[u,"Dolphin"]],[/coast\/([\w\.]+)/i],[m,[u,ke+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[m,[u,"MIUI"+B]],[/fxios\/([\w\.-]+)/i],[m,[u,R]],[/\bqihoobrowser\/?([\w\.]*)/i],[m,[u,"360"]],[/\b(qq)\/([\w\.]+)/i],[[u,/(.+)/,"$1Browser"],m],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[u,/(.+)/,"$1"+B],m],[/samsungbrowser\/([\w\.]+)/i],[m,[u,ue+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[m,[u,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[u,"Sogou Mobile"],m],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[u,m],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[u],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[m,u],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[u,Qe],m],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[u,m],[/\bgsa\/([\w\.]+) .*safari\//i],[m,[u,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[m,[u,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[m,[u,q+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[u,q+" WebView"],m],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[m,[u,"Android "+D]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[u,m],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[m,[u,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[m,u],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[u,[m,Fe,Ve]],[/(webkit|khtml)\/([\w\.]+)/i],[u,m],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[u,"Netscape"],m],[/(wolvic|librewolf)\/([\w\.]+)/i],[u,m],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[m,[u,R+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[u,[m,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[u,[m,/master.|lts./,""]]],cpu:[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[[v,"amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)(pc)?\b/i],[[v,"ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[[v,"arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[[v,"armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[[v,"arm"]],[/((ppc|powerpc)(64)?)( mac|;|\))/i],[[v,/ower/,r,V]],[/ sun4\w[;\)]/i],[[v,"sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i],[[v,V]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[h,[p,ue],[f,k]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[h,[p,ue],[f,y]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[h,[p,A],[f,y]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[h,[p,A],[f,k]],[/(macintosh);/i],[h,[p,A]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[h,[p,qe],[f,y]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[h,[p,oe],[f,k]],[/honor([-\w ]+)[;\)]/i],[h,[p,oe],[f,y]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[h,[p,ge],[f,k]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[h,[p,ge],[f,y]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[h,/_/g," "],[p,Ee],[f,k]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[h,/_/g," "],[p,Ee],[f,y]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[h,[p,H],[f,y]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[h,[p,Fe,{OnePlus:["304","403","203"],"*":H}],[f,k]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[h,[p,"Vivo"],[f,y]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[h,[p,"Realme"],[f,y]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto(?! 360)[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[h,[p,se],[f,y]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[h,[p,se],[f,k]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[h,[p,le],[f,k]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv|watch)\w+)/i,/\blg-?([\d\w]+) bui/i],[h,[p,le],[f,y]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[h,[p,me],[f,k]],[/(nokia) (t[12][01])/i],[p,h,[f,k]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,/nokia[-_ ]?(([-\w\. ]*))/i],[[h,/_/g," "],[f,y],[p,"Nokia"]],[/(pixel (c|tablet))\b/i],[h,[p,Q],[f,k]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[h,[p,Q],[f,y]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[h,[p,j],[f,y]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[h,"Xperia Tablet"],[p,j],[f,k]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[h,[p,K],[f,y]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[h,[p,L],[f,k]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[h,/(.+)/g,"Fire Phone $1"],[p,L],[f,y]],[/(playbook);[-\w\),; ]+(rim)/i],[h,p,[f,k]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[h,[p,C],[f,y]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[h,[p,_],[f,k]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[h,[p,_],[f,y]],[/(nexus 9)/i],[h,[p,"HTC"],[f,k]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[p,[h,/_/g," "],[f,y]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[h,[p,"TCL"],[f,k]],[/(itel) ((\w+))/i],[[p,V],h,[f,Fe,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[h,[p,"Acer"],[f,k]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[h,[p,"Meizu"],[f,y]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[h,[p,"Ulefone"],[f,y]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[h,[p,"Energizer"],[f,y]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[h,[p,"Cat"],[f,y]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[h,[p,"Smartfren"],[f,y]],[/droid.+; (a(?:015|06[35]|142p?))/i],[h,[p,"Nothing"],[f,y]],[/; (x67 5g|tikeasy \w+|ac[1789]\d\w+)( b|\))/i,/archos ?(5|gamepad2?|([\w ]*[t1789]|hello) ?\d+[\w ]*)( b|\))/i],[h,[p,"Archos"],[f,k]],[/archos ([\w ]+)( b|\))/i,/; (ac[3-6]\d\w{2,8})( b|\))/i],[h,[p,"Archos"],[f,y]],[/(imo) (tab \w+)/i,/(infinix) (x1101b?)/i],[p,h,[f,k]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (hmd|imo) ([\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i,/(oppo) ?([\w ]+) bui/i],[p,h,[f,y]],[/(kobo)\s(ereader|touch)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[p,h,[f,k]],[/(surface duo)/i],[h,[p,Te],[f,k]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[h,[p,"Fairphone"],[f,y]],[/(u304aa)/i],[h,[p,"AT&T"],[f,y]],[/\bsie-(\w*)/i],[h,[p,"Siemens"],[f,y]],[/\b(rct\w+) b/i],[h,[p,"RCA"],[f,k]],[/\b(venue[\d ]{2,7}) b/i],[h,[p,"Dell"],[f,k]],[/\b(q(?:mv|ta)\w+) b/i],[h,[p,"Verizon"],[f,k]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[h,[p,"Barnes & Noble"],[f,k]],[/\b(tm\d{3}\w+) b/i],[h,[p,"NuVision"],[f,k]],[/\b(k88) b/i],[h,[p,"ZTE"],[f,k]],[/\b(nx\d{3}j) b/i],[h,[p,"ZTE"],[f,y]],[/\b(gen\d{3}) b.+49h/i],[h,[p,"Swiss"],[f,y]],[/\b(zur\d{3}) b/i],[h,[p,"Swiss"],[f,k]],[/\b((zeki)?tb.*\b) b/i],[h,[p,"Zeki"],[f,k]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[p,"Dragon Touch"],h,[f,k]],[/\b(ns-?\w{0,9}) b/i],[h,[p,"Insignia"],[f,k]],[/\b((nxa|next)-?\w{0,9}) b/i],[h,[p,"NextBook"],[f,k]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[p,"Voice"],h,[f,y]],[/\b(lvtel\-)?(v1[12]) b/i],[[p,"LvTel"],h,[f,y]],[/\b(ph-1) /i],[h,[p,"Essential"],[f,y]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[h,[p,"Envizen"],[f,k]],[/\b(trio[-\w\. ]+) b/i],[h,[p,"MachSpeed"],[f,k]],[/\btu_(1491) b/i],[h,[p,"Rotor"],[f,k]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[h,[p,ve],[f,k]],[/(sprint) (\w+)/i],[p,h,[f,y]],[/(kin\.[onetw]{3})/i],[[h,/\./g," "],[p,Te],[f,y]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[h,[p,Be],[f,k]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[h,[p,Be],[f,y]],[/smart-tv.+(samsung)/i],[p,[f,E]],[/hbbtv.+maple;(\d+)/i],[[h,/^/,"SmartTV"],[p,ue],[f,E]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[p,le],[f,E]],[/(apple) ?tv/i],[p,[h,A+" TV"],[f,E]],[/crkey/i],[[h,q+"cast"],[p,Q],[f,E]],[/droid.+aft(\w+)( bui|\))/i],[h,[p,L],[f,E]],[/(shield \w+ tv)/i],[h,[p,ve],[f,E]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[h,[p,qe],[f,E]],[/(bravia[\w ]+)( bui|\))/i],[h,[p,j],[f,E]],[/(mi(tv|box)-?\w+) bui/i],[h,[p,Ee],[f,E]],[/Hbbtv.*(technisat) (.*);/i],[p,h,[f,E]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[p,Ae],[h,Ae],[f,E]],[/droid.+; ([\w- ]+) (?:android tv|smart[- ]?tv)/i],[h,[f,E]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[f,E]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[p,h,[f,w]],[/droid.+; (shield)( bui|\))/i],[h,[p,ve],[f,w]],[/(playstation \w+)/i],[h,[p,j],[f,w]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[h,[p,Te],[f,w]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[h,[p,ue],[f,T]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[p,h,[f,T]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[h,[p,H],[f,T]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[h,[p,A],[f,T]],[/(opwwe\d{3})/i],[h,[p,K],[f,T]],[/(moto 360)/i],[h,[p,se],[f,T]],[/(smartwatch 3)/i],[h,[p,j],[f,T]],[/(g watch r)/i],[h,[p,le],[f,T]],[/droid.+; (wt63?0{2,3})\)/i],[h,[p,Be],[f,T]],[/droid.+; (glass) \d/i],[h,[p,Q],[f,T]],[/(pico) (4|neo3(?: link|pro)?)/i],[p,h,[f,T]],[/; (quest( \d| pro)?)/i],[h,[p,Qe],[f,T]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[p,[f,S]],[/(aeobc)\b/i],[h,[p,L],[f,S]],[/(homepod).+mac os/i],[h,[p,A],[f,S]],[/windows iot/i],[[f,S]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[h,[f,y]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[h,[f,k]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[f,k]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[f,y]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[h,[p,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[m,[u,W+"HTML"]],[/(arkweb)\/([\w\.]+)/i],[u,m],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[m,[u,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[u,m],[/ladybird\//i],[[u,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[m,u]],os:[[/microsoft (windows) (vista|xp)/i],[u,m],[/(windows (?:phone(?: os)?|mobile|iot))[\/ ]?([\d\.\w ]*)/i],[u,[m,Fe,ot]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[m,Fe,ot],[u,"Windows"]],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[m,/_/g,"."],[u,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[u,fe],[m,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[m,u],[/(ubuntu) ([\w\.]+) like android/i],[[u,/(.+)/,"$1 Touch"],m],[/(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen|webos)\w*[-\/; ]?([\d\.]*)/i],[u,m],[/\(bb(10);/i],[m,[u,C]],[/(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\/ ]?([\w\.]*)/i],[m,[u,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[m,[u,R+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[m,[u,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[m,[u,"watchOS"]],[/crkey\/([\d\.]+)/i],[m,[u,q+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[u,Tt],m],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux)(?: arm\w*| x86\w*| ?)([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[u,m],[/(sunos) ?([\w\.\d]*)/i],[[u,"Solaris"],m],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[u,m]]},Ue=function(ie,de){if(typeof ie===c&&(de=ie,ie=i),!(this instanceof Ue))return new Ue(ie,de).getResult();var J=typeof t!==l&&t.navigator?t.navigator:i,Ie=ie||(J&&J.userAgent?J.userAgent:r),Ht=J&&J.userAgentData?J.userAgentData:i,Xt=de?te(_t,de):_t,we=J&&J.userAgent==Ie;return this.getBrowser=function(){var X={};return X[u]=i,X[m]=i,Ne.call(X,Ie,Xt.browser),X[g]=ye(X[m]),we&&J&&J.brave&&typeof J.brave.isBrave==o&&(X[u]="Brave"),X},this.getCPU=function(){var X={};return X[v]=i,Ne.call(X,Ie,Xt.cpu),X},this.getDevice=function(){var X={};return X[p]=i,X[h]=i,X[f]=i,Ne.call(X,Ie,Xt.device),we&&!X[f]&&Ht&&Ht.mobile&&(X[f]=y),we&&X[h]=="Macintosh"&&J&&typeof J.standalone!==l&&J.maxTouchPoints&&J.maxTouchPoints>2&&(X[h]="iPad",X[f]=k),X},this.getEngine=function(){var X={};return X[u]=i,X[m]=i,Ne.call(X,Ie,Xt.engine),X},this.getOS=function(){var X={};return X[u]=i,X[m]=i,Ne.call(X,Ie,Xt.os),we&&!X[u]&&Ht&&Ht.platform&&Ht.platform!="Unknown"&&(X[u]=Ht.platform.replace(/chrome os/i,Tt).replace(/macos/i,fe)),X},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Ie},this.setUA=function(X){return Ie=typeof X===d&&X.length>P?Ae(X,P):X,this},this.setUA(Ie),this};Ue.VERSION=n,Ue.BROWSER=he([u,m,g]),Ue.CPU=he([v]),Ue.DEVICE=he([h,p,f,w,y,E,k,T,S]),Ue.ENGINE=Ue.OS=he([u,m]),s.exports&&(e=s.exports=Ue),e.UAParser=Ue;var _e=typeof t!==l&&(t.jQuery||t.Zepto);if(_e&&!_e.ua){var Ze=new Ue;_e.ua=Ze.getResult(),_e.ua.get=function(){return Ze.getUA()},_e.ua.set=function(ie){Ze.setUA(ie);var de=Ze.getResult();for(var J in de)_e.ua[J]=de[J]}}})(typeof window=="object"?window:tf)})(sn,sn.exports)),sn.exports}var nf=sf(),ta,No;function rf(){if(No)return ta;No=1;for(var s=Math.floor(Math.random()*16777215),e=c.index=parseInt(Math.random()*16777215,10),t=(typeof process>"u"||typeof process.pid!="number"?Math.floor(Math.random()*1e5):process.pid)%65535,i=(()=>{try{return _Buffer}catch{try{return Buffer}catch{return null}}})(),n=function(u){return!!(u!=null&&u.constructor&&typeof u.constructor.isBuffer=="function"&&u.constructor.isBuffer(u))},r=[],a=0;a<256;a++)r[a]=(a<=15?"0":"")+a.toString(16);var o=new RegExp("^[0-9a-fA-F]{24}$"),l=[];for(a=0;a<10;)l[48+a]=a++;for(;a<16;)l[55+a]=l[87+a]=a++;function c(u){if(!(this instanceof c))return new c(u);if(u&&(u instanceof c||u._bsontype==="ObjectID"))return u;if(this._bsontype="ObjectID",u==null||typeof u=="number"){this.id=this.generate(u);return}var f=c.isValid(u);if(!f&&u!=null)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");if(f&&typeof u=="string"&&u.length===24)return c.createFromHexString(u);if(u!=null&&u.length===12)this.id=u;else{if(u!=null&&typeof u.toHexString=="function")return u;throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters")}}ta=c,c.default=c,c.createFromTime=function(u){return u=parseInt(u,10)%4294967295,new c(g(8,u)+"0000000000000000")},c.createFromHexString=function(u){if(typeof u>"u"||u!=null&&u.length!==24)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");for(var f="",p=0;p<24;)f+=String.fromCharCode(l[u.charCodeAt(p++)]<<4|l[u.charCodeAt(p++)]);return new c(f)},c.isValid=function(u){return u==null?!1:typeof u=="number"?!0:typeof u=="string"?u.length===12||u.length===24&&o.test(u):u instanceof c?!0:n(u)?c.isValid(u.toString("hex")):typeof u.toHexString=="function"&&i&&(u.id instanceof i||typeof u.id=="string")?u.id.length===12||u.id.length===24&&o.test(u.id):!1},c.prototype={constructor:c,toHexString:function(){if(!this.id||!this.id.length)throw new Error("invalid ObjectId, ObjectId.id must be either a string or a Buffer, but is ["+JSON.stringify(this.id)+"]");if(this.id.length===24)return this.id;if(n(this.id))return this.id.toString("hex");for(var u="",f=0;f<this.id.length;f++)u+=r[this.id.charCodeAt(f)];return u},equals:function(u){return u instanceof c?this.toString()===u.toString():typeof u=="string"&&c.isValid(u)&&u.length===12&&n(this.id)?u===this.id.toString("binary"):typeof u=="string"&&c.isValid(u)&&u.length===24?u.toLowerCase()===this.toHexString():typeof u=="string"&&c.isValid(u)&&u.length===12?u===this.id:u!=null&&(u instanceof c||u.toHexString)?u.toHexString()===this.toHexString():!1},getTimestamp:function(){var u=new Date,f;return n(this.id)?f=this.id[3]|this.id[2]<<8|this.id[1]<<16|this.id[0]<<24:f=this.id.charCodeAt(3)|this.id.charCodeAt(2)<<8|this.id.charCodeAt(1)<<16|this.id.charCodeAt(0)<<24,u.setTime(Math.floor(f)*1e3),u},generate:function(u){typeof u!="number"&&(u=~~(Date.now()/1e3)),u=parseInt(u,10)%4294967295;var f=d();return String.fromCharCode(u>>24&255,u>>16&255,u>>8&255,u&255,s>>16&255,s>>8&255,s&255,t>>8&255,t&255,f>>16&255,f>>8&255,f&255)}};function d(){return e=(e+1)%16777215}function g(u,f){return f=f.toString(16),f.length===u?f:"00000000".substring(f.length,u)+f}var h=Symbol&&Symbol.for&&Symbol.for("nodejs.util.inspect.custom")||"inspect";return c.prototype[h]=function(){return"ObjectID("+this+")"},c.prototype.toJSON=c.prototype.toHexString,c.prototype.toString=c.prototype.toHexString,ta}var af=rf();const nn=sc(af),of={signInEndPoint:"user/signon?wc=true&remember=true",userPreferencesEndPoint:"user/preferences/settings",allProjectGroupsEndPoint:"batch/check/",allProjectsEndPoint:"projects",allTasksEndPoint:"batch/check/",TaskEndPoint:"task",updateTaskEndPoint:"batch/task",getSections:"column/project/",getAllCompletedItems:"project/all/completedInAll/",exportData:"data/export",projectMove:"batch/taskProject",parentMove:"batch/taskParent",userStatus:"user/status"};var ir={exports:{}},lf=ir.exports,Lo;function cf(){return Lo||(Lo=1,(function(s){(function(e,t){s.exports?s.exports=t():e.log=t()})(lf,function(){var e=function(){},t="undefined",i=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),n=["trace","debug","info","warn","error"],r={},a=null;function o(p,m){var v=p[m];if(typeof v.bind=="function")return v.bind(p);try{return Function.prototype.bind.call(v,p)}catch{return function(){return Function.prototype.apply.apply(v,[p,arguments])}}}function l(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function c(p){return p==="debug"&&(p="log"),typeof console===t?!1:p==="trace"&&i?l:console[p]!==void 0?o(console,p):console.log!==void 0?o(console,"log"):e}function d(){for(var p=this.getLevel(),m=0;m<n.length;m++){var v=n[m];this[v]=m<p?e:this.methodFactory(v,p,this.name)}if(this.log=this.debug,typeof console===t&&p<this.levels.SILENT)return"No console available for logging"}function g(p){return function(){typeof console!==t&&(d.call(this),this[p].apply(this,arguments))}}function h(p,m,v){return c(p)||g.apply(this,arguments)}function u(p,m){var v=this,w,y,k,E="loglevel";typeof p=="string"?E+=":"+p:typeof p=="symbol"&&(E=void 0);function T(_){var C=(n[_]||"silent").toUpperCase();if(!(typeof window===t||!E)){try{window.localStorage[E]=C;return}catch{}try{window.document.cookie=encodeURIComponent(E)+"="+C+";"}catch{}}}function S(){var _;if(!(typeof window===t||!E)){try{_=window.localStorage[E]}catch{}if(typeof _===t)try{var C=window.document.cookie,D=encodeURIComponent(E),q=C.indexOf(D+"=");q!==-1&&(_=/^([^;]+)/.exec(C.slice(q+D.length+1))[1])}catch{}return v.levels[_]===void 0&&(_=void 0),_}}function P(){if(!(typeof window===t||!E)){try{window.localStorage.removeItem(E)}catch{}try{window.document.cookie=encodeURIComponent(E)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function L(_){var C=_;if(typeof C=="string"&&v.levels[C.toUpperCase()]!==void 0&&(C=v.levels[C.toUpperCase()]),typeof C=="number"&&C>=0&&C<=v.levels.SILENT)return C;throw new TypeError("log.setLevel() called with invalid level: "+_)}v.name=p,v.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},v.methodFactory=m||h,v.getLevel=function(){return k??y??w},v.setLevel=function(_,C){return k=L(_),C!==!1&&T(k),d.call(v)},v.setDefaultLevel=function(_){y=L(_),S()||v.setLevel(_,!1)},v.resetLevel=function(){k=null,P(),d.call(v)},v.enableAll=function(_){v.setLevel(v.levels.TRACE,_)},v.disableAll=function(_){v.setLevel(v.levels.SILENT,_)},v.rebuild=function(){if(a!==v&&(w=L(a.getLevel())),d.call(v),a===v)for(var _ in r)r[_].rebuild()},w=L(a?a.getLevel():"WARN");var A=S();A!=null&&(k=L(A)),d.call(v)}a=new u,a.getLogger=function(m){if(typeof m!="symbol"&&typeof m!="string"||m==="")throw new TypeError("You must supply a name when creating a logger.");var v=r[m];return v||(v=r[m]=new u(m,a.methodFactory)),v};var f=typeof window!==t?window.log:void 0;return a.noConflict=function(){return typeof window!==t&&window.log===a&&(window.log=f),a},a.getLoggers=function(){return r},a.default=a,a})})(ir)),ir.exports}var uf=cf();const b=sc(uf),{TaskEndPoint:Do,updateTaskEndPoint:Fo,allProjectGroupsEndPoint:df,allProjectsEndPoint:ff,allTasksEndPoint:Kn,signInEndPoint:hf,userPreferencesEndPoint:pf,getSections:gf,getAllCompletedItems:mf,exportData:vf,projectMove:kf,parentMove:yf,userStatus:bf}=of;class wf{constructor({username:e,password:t,baseUrl:i,token:n,checkPoint:r}){this.ticktickServer="ticktick.com",this.protocol="https://",this.apiProtocol="https://api.",this.apiVersion="/api/v2",this.username=e,this.password=t,this.token=n,this.inboxProperties={id:"",sortOrder:0},this.userAgent=this.getUserAgent(),this.deviceAgent=this.getXDevice(),i?(this.apiUrl=`${this.apiProtocol}${i}${this.apiVersion}`,this.loginUrl=`${this.protocol}${i}${this.apiVersion}`,this.originUrl=`${this.protocol}${i}`):(this.apiUrl=`${this.apiProtocol}${this.ticktickServer}${this.apiVersion}`,this.loginUrl=`${this.protocol}${this.ticktickServer}${this.apiVersion}`,this.originUrl=`${this.protocol}${this.ticktickServer}`),r!=null?this._checkpoint=r:this.getPreviousCheckPoint()}get checkpoint(){return this._checkpoint}set checkpoint(e){this._checkpoint=e}get inboxId(){return this.inboxProperties.id}get lastError(){return this._lastError}set lastError(e){this._lastError=e}async login(){try{const e=`${this.loginUrl}/${hf}`,t={username:this.username,password:this.password},i=await this.makeRequest("Login",e,"POST",t);if(b.debug("Signed in Response: ",i),i&&i.token)return this._checkpoint=0,{token:i.token,inboxId:i.inboxId}}catch(e){this.setError("Login",null,e),b.error(e)}return null}async getUserSettings(){try{const e=`${this.apiUrl}/${pf}`,t=await this.makeRequest("Get User Settings",e,"GET",void 0);return t||null}catch(e){return b.error("Get Inbox Properties failed: ",e),this.setError("Get Inbox Properties",null,e),null}}async getUserStatus(){try{const e=`${this.apiUrl}/${bf}`,t=await this.makeRequest("Get User status",e,"GET",void 0);return t?{token:this.token,inboxId:t.inboxId,userID:t.username}:null}catch(e){return b.error("Get User Status failed: ",e),this.setError("Get User Status",null,e),null}}async getInboxProperties(){try{for(let e=0;e<10;e++){e!==0&&this.reset();const t=`${this.apiUrl}/${Kn}`+this._checkpoint,i=await this.makeRequest("Get Inbox Properties",t,"GET");if(i)return i.syncTaskBean.update.forEach(n=>{n.projectId==this.inboxProperties.id&&n.sortOrder<this.inboxProperties.sortOrder&&(this.inboxProperties.sortOrder=n.sortOrder)}),this.inboxProperties.sortOrder--,!0}}catch(e){b.error("Get Inbox Properties failed: ",e),this.setError("Get Inbox Properties",null,e)}return!1}async getProjectGroups(){try{const e=`${this.apiUrl}/${df}`,t=await this.makeRequest("Get Project Groups",e,"GET",void 0);if(t)return t}catch(e){b.error("Get Project Groups failed: ",e),this.setError("Get Project Groups",null,e)}return[]}async getProjects(){try{const e=`${this.apiUrl}/${ff}`,t=await this.makeRequest("Get Projects",e,"GET",void 0);if(t)return t}catch(e){b.error("Get Projects failed: ",e),this.setError("Get Projects",null,e)}return[]}async getProjectSections(e){try{const t=`${this.apiUrl}/${gf}/${e}`,i=await this.makeRequest("Get Project Sections",t,"GET",void 0);return i||[]}catch(t){return b.error("Get Project Sections failed: ",t),this.setError("Get Project Sections",null,t),[]}}async getAllResources(){try{let e=10;for(;e>0;){const t=new Date(this._checkpoint);b.debug("Get All Resources",this._checkpoint?"as of: "+t.toISOString():"from the beginning of time. ");const i=`${this.apiUrl}/${Kn}`+this._checkpoint,n=await this.makeRequest("Get All Resources",i,"GET",void 0);if(n)return n;e-=1,this.getPreviousCheckPoint()}}catch(e){b.error("Get All Resources failed: ",e),this.setError("Get All Resources",null,e)}return null}async getTaskDetails(){try{let e=10;for(;e>0;){const t=`${this.apiUrl}/${Kn}`+this._checkpoint,i=await this.makeRequest("Get Task Details",t,"GET",void 0);if(i){if(i.syncTaskBean.update.length>0)return O().checkPoint!=i.checkPoint&&(this._checkpoint=i.checkPoint,O().checkPoint=this._checkpoint,He({checkPoint:this._checkpoint})),i.syncTaskBean;e-=1,this.getPreviousCheckPoint()}else e-=1,this.getPreviousCheckPoint()}return[]}catch(e){return b.error("Get Tasks Details failed: ",e),this.setError("Get Tasks",null,e),[]}}async getTasks(){try{let e=3;for(;e>0;){const t=`${this.apiUrl}/${Kn}`+this._checkpoint,i=await this.makeRequest("Get Tasks",t,"GET",void 0);if(i)return b.debug("Got: ",i.syncTaskBean.update.length),i.syncTaskBean.update;if(e>0)this.getPreviousCheckPoint(),e=e-1;else return[]}}catch(e){return b.error("Get Tasks failed: ",e),this.setError("Get Tasks",null,e),[]}}async getTask(e,t){try{let i=`${this.apiUrl}/${Do}/${e}`;const n=`?projectID=${t}`;t&&(i=i+n);const r=await this.makeRequest("Get Tasks",i,"GET",void 0);return r||null}catch(i){return b.error("Get Tasks failed: ",i),this.setError("Get Tasks",null,i),null}}async getAllCompletedItems(){try{const e=`${this.apiUrl}/${mf}`,t=await this.makeRequest("Get All Completed Items",e,"GET",void 0);return t?t.syncTaskBean.update:[]}catch(e){return b.error("Get All Completed Items failed: ",e),this.setError("Get All Completed Tasks",null,e),[]}}async addTask(e){try{let t=!0;e.isAllDay==null?t=!0:t=e.isAllDay;const i={id:e.id?e.id:nn(),projectId:e.projectId?e.projectId:this.inboxProperties.id,sortOrder:e.sortOrder?e.sortOrder:this.inboxProperties.sortOrder,title:e.title,content:e.content?e.content:"",desc:e.desc?e.desc:"",startDate:e.startDate?e.startDate:null,dueDate:e.dueDate?e.dueDate:null,timeZone:e.timeZone?e.timeZone:"America/New_York",isAllDay:t,reminder:e.reminder?e.reminder:null,reminders:e.reminders?e.reminders:[{id:nn(),trigger:"TRIGGER:PT0S"}],repeatFlag:e.repeatFlag?e.repeatFlag:null,priority:e.priority?e.priority:0,status:e.status?e.status:0,items:e.items?e.items:[],progress:e.progress?e.progress:0,modifiedTime:e.modifiedTime?e.modifiedTime:new Date().toISOString().replace("Z","+0000"),deleted:e.deleted?e.deleted:0,assignee:e.assignee?e.assignee:null,isDirty:e.isDirty?e.isDirty:!0,local:e.local?e.local:!0,remindTime:e.remindTime?e.remindTime:null,tags:e.tags?e.tags:[],childIds:e.childIds?e.childIds:[],parentId:e.parentId?e.parentId:null},n=`${this.apiUrl}/${Do}`,r=await this.makeRequest("Add Task",n,"POST",i);if(r){let a;return a=r.sortOrder,this.inboxProperties.sortOrder=a-1,r}else return[]}catch(t){return b.error("Add Task failed: ",t),this.setError("Add Task",null,t),[]}}async updateTask(e){try{let t=!0;e.isAllDay==null?t=!0:t=e.isAllDay;const i={id:e.id?e.id:nn(),projectId:e.projectId?e.projectId:this.inboxProperties.id,sortOrder:e.sortOrder?e.sortOrder:this.inboxProperties.sortOrder,title:e.title,content:e.content?e.content:"",desc:e.desc?e.desc:"",startDate:e.startDate?e.startDate:null,dueDate:e.dueDate?e.dueDate:null,timeZone:e.timeZone?e.timeZone:"America/New_York",isAllDay:t,reminder:e.reminder?e.reminder:null,reminders:e.reminders?e.reminders:[{id:nn(),trigger:"TRIGGER:PT0S"}],repeatFlag:e.repeatFlag?e.repeatFlag:null,priority:e.priority?e.priority:0,status:e.status?e.status:0,items:e.items?e.items:[],progress:e.progress?e.progress:0,modifiedTime:e.modifiedTime?e.modifiedTime:new Date().toISOString().replace("Z","+0000"),deleted:e.deleted?e.deleted:0,assignee:e.assignee?e.assignee:null,isDirty:e.isDirty?e.isDirty:!0,local:e.local?e.local:!0,remindTime:e.remindTime?e.remindTime:null,tags:e.tags?e.tags:[],childIds:e.childIds?e.childIds:[],parentId:e.parentId?e.parentId:null};b.debug("Update Task: ",i.id,i.projectId);let n;n={add:[],addAttachments:[],delete:[],deleteAttachments:[],updateAttachments:[],update:[i]};const r=`${this.apiUrl}/${Fo}`,a=await this.makeRequest("Update Task",r,"POST",n);return a||null}catch(t){return b.error("Update Task failed: ",t),this.setError("Update Task",null,t),null}}async deleteTask(e,t){if(!e||!t)throw new Error("Both Task Id and Project ID are required for a delete, otherwise TickTick will fail silently.");try{const i={taskId:e,projectId:t};let n;n={add:[],addAttachments:[],delete:[i],deleteAttachments:[],updateAttachments:[],update:[]};const r=`${this.apiUrl}/${Fo}`,a=await this.makeRequest("Delete Task",r,"POST",n);return a?(this.inboxProperties.sortOrder=a.sortOrder-1,a):null}catch(i){return b.error("Delete Task  failed: ",i),this.setError("Delete Task Tasks",null,i),null}}async exportData(){try{const e=`${this.apiUrl}/${vf}`,t=await this.makeRequest("Export",e,"GET",void 0);if(t){let i=t;return i=i.substring(1),i=i.substring(0,i.length-1),i=i.replace(/\\\"/g,'"'),i=i.replace(/\\n/g,`
`),i}else return null}catch(e){return b.error("Export failed: ",e),this.setError("Export",null,e),null}}async projectMove(e,t,i){try{const n=`${this.apiUrl}/${kf}`,r=[{fromProjectId:t,toProjectId:i,taskId:e,sortOrder:this.inboxProperties.sortOrder}],a=await this.makeRequest("Project Move",n,"POST",r);return a?(this.inboxProperties.sortOrder=a.sortOrder-1,a):null}catch(n){return b.error("Project Move failed: ",n),this.setError("Project Move",null,n),null}}async parentMove(e,t,i){try{const n=`${this.apiUrl}/${yf}`,r=[{parentId:t,projectId:i,taskId:e}],a=await this.makeRequest("Project Move",n,"POST",r);if(a)return this.inboxProperties.sortOrder=a.sortOrder-1,a}catch(n){return b.error("Parent Move failed: ",n),this.setError("Parent Move",null,n),null}}async makeRequest(e,t,i,n=void 0){this.lastError=void 0;try{let r={};e=="Login"?r=this.createLoginRequestOptions(t,n):(this.cookieHeader||(this.cookieHeader=localStorage.getItem("TTS_Cookies")),r=this.createRequestOptions(i,t,n));const a=await F.requestUrl(r);return a.status!=200?(this.setError(e,a,null),null):(this.cookies=a.headers["set-cookie"]??[],this.cookieHeader=this.cookies.join("; ")+";",localStorage.setItem("TTS_Cookies",this.cookieHeader),a.json)}catch(r){return this.setError(e,null,r),b.error(r),null}}createLoginRequestOptions(e,t){const i={Accept:"*/*","x-device":this.deviceAgent,"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"};return{method:"POST",url:e,headers:i,contentType:"application/json",body:t?JSON.stringify(t):void 0,throw:!1}}createRequestOptions(e,t,i){let n={"Content-Type":"application/json","User-Agent":`${this.userAgent}`,"x-device":`${this.deviceAgent}`,Cookie:`t=${this.token};`+this.cookieHeader,t:`${this.token}`};return{method:e,url:t,headers:n,contentType:"application/json",body:i?JSON.stringify(i):void 0,throw:!1}}setError(e,t,i){if(t){const n=t.status;let r;if(n==429)r="Error: "+n+" TickTick reporting too many requests.",this._lastError={operation:e,statusCode:n,errorMessage:r};else{try{r=t.json}catch{b.debug("Bad JSON response"),b.debug("Trying Text.");try{r=this.extractTitleContent(t.text),b.error("Error: ",r)}catch{b.debug("Bad text response"),b.debug("No error message."),r="No Error message received."}}this._lastError={operation:e,statusCode:n,errorMessage:r}}}else{let n,r=666;i?n=i:n="Unknown Error",b.error(e,n),this._lastError={operation:e,statusCode:r,errorMessage:n}}}getPreviousCheckPoint(){let e=new Date;return e.setDate(e.getDate()-15),this._checkpoint=e.getTime(),b.debug("Checkpoint has been changed.",this._checkpoint),this._checkpoint}extractTitleContent(e){const t="<title>",i="</title>",n=e.indexOf(t)+t.length,r=e.indexOf(i);return e.substring(n,r)}getUserAgent(){return navigator.userAgent}getXDevice(){const e=this.generateRandomID(),t=6070;return nf.UAParser(navigator.userAgent),JSON.stringify({platform:"web",os:"Windows 10",device:"Firefox 117.0",name:"",version:t,id:e,channel:"website",campaign:"",websocket:""})}getPlatform(){if(F.Platform.isIosApp)return"ios";if(F.Platform.isAndroidApp)return"android";if(F.Platform.isMacOS)return"macOS";if(F.Platform.isWin)return"windows";if(F.Platform.isLinux)return"linux";if(F.Platform.isSafari)return"safari"}reset(){this._checkpoint=this.getPreviousCheckPoint()}generateRandomID(){let e=localStorage.getItem("TTS_UniqueID");if(e&&e.includes("-")&&(localStorage.removeItem("TTS_UniqueID"),e=null),!e){const n="0123456789abcdef";e="66";const r=22;for(let a=0;a<r;a++){const o=Math.floor(Math.random()*n.length);e+=n[o]}localStorage.setItem("TTS_UniqueID",e)}return e}generateRandomVersion(){let e;do e=Math.floor(Math.random()*4e3)+6e3;while(e<6e3||e>9999);return e}}const ia={};async function It(s,e){ia[s]||(ia[s]=[]);const t=ia[s],i=t.length===0;let n=()=>{};const r=new Promise(a=>{n=a});t.push(r),i||await t[t.length-2];try{return await e()}catch(a){throw a}finally{t.splice(0,1),n()}}class nc extends F.Modal{constructor(e,t,i,n){super(e),this.title="Task Deletion Confirmation",this.message="The following Task(s) will be deleted because: ",this.cancelLabel="Cancel",this.confirmLabel="Confirm Deletion",this.taskTitles=[],this.taskTitles=t,this.reason=i,this.onSubmit=n}onOpen(){const{titleEl:e,contentEl:t}=this;e.setText(this.title),t.createEl("p",{text:`${this.message}${this.reason}`});const i=t.createEl("ul");this.taskTitles.forEach(n=>{i.createEl("li",{text:n})}),new F.Setting(t).addButton(n=>{n.setClass("ts_button"),n.setButtonText(this.cancelLabel),n.onClick(()=>{this.result=!1,this.onSubmit(this.result),this.close()})}).addButton(n=>{n.setClass("ts_button"),n.setWarning(),n.setButtonText(this.confirmLabel),n.onClick(()=>{this.result=!0,this.onSubmit(this.result),this.close()})})}onClose(){this.titleEl.empty(),this.contentEl.empty(),super.onClose(),this.resolvePromise(this.result)}showModal(){return this.open(),new Promise(e=>this.resolvePromise=e)}}class ni{constructor(e,t,i){this.fileLines=[],this.app=e,this.plugin=t,this.file=i}addTask(e,t,i=-1){let n=this.fileLines.length;i>=0?n=i:e.parentId?n=this.getTaskEndLineByTaskID(e.parentId)+1:n=this.fileLines.length;let r=t.split(`
`);return this.fileLines.splice(n,0,...r),n}updateTask(e,t,i=!1){let n=this.getTaskIndex(e.id),r=0,a=0;n>=0?(r=this.getTaskEndLineByTaskID(e.id),a=r-n+1):n=0;let o={};e.childIds&&e.childIds.length>0&&(o=this.buildMoveMap(e.id,e.childIds,o));const l=t.split(`
`);if(this.fileLines.splice(n,a,...l),i){let c=0;e.parentId?c=this.getTaskIndex(e.parentId):c=n,n!=c&&this.moveTask(n,c),e.childIds&&e.childIds.length>0&&(o[e.id].tabs=this.plugin.taskParser.getTabs(t),this.fixUpChildren(o))}}deleteTask(e,t=!1){if(!t)this.deleteTaskAndLines(e);else{let i={};const n=this.plugin.taskParser.getTabs(this.fileLines[e]),r=this.findChildren(this.getTaskIndex(e),n);i=this.buildMoveMap(e,r,i),Object.entries(i).sort(([,o],[,l])=>o.depth-l.depth).forEach(([o,l])=>{this.deleteTaskAndLines(o)})}}getFileLines(){return this.fileLines.join(`
`)}getTaskRecord(e){return this.getTaskLines(e)}getNumParentTabs(e){return this.plugin.taskParser.getNumTabs(this.fileLines[this.getTaskIndex(e)])}getTaskItems(e){const t=this.getTaskIndex(e),i=[];for(let n=t+1;n<this.fileLines.length;n++){const r=this.fileLines[n];if(this.plugin.taskParser.isMarkdownTask(r)){if(this.plugin.taskParser.getTickTickId(r))break;this.plugin.taskParser.getLineItemId(r)&&i.push(r)}}return i}getFilePath(){return this.file.path}getTaskIndex(e){return this.fileLines.findIndex(t=>this.plugin.taskParser.isMarkdownTask(t)&&t.includes(e))}getTaskString(e){return this.fileLines[this.getTaskIndex(e)]}async init(e=null){let t;e?t=e:t=await this.app.vault.read(this.file),t&&(this.fileLines=t.split(`
`))}getTaskItemRecord(e){const t={},i=this.fileLines[this.getTaskIndex(e)];return t.parentId=this.getParentId(e),t.ID=this.plugin.taskParser.getLineItemId(i),t}getTaskItemRecordByLine(e){const t={},i=this.fileLines[e],n=this.getParentIDByIdx(e);return t.ID=this.plugin.taskParser.getLineItemId(i),t.parentId=n,t}async getTaskRecordByLine(e){let t={};const i=this.getParentIDByIdx(e);if(t=this.getTaskLinesByIdx(e,t),t.parentId=i,t.taskLines&&t.taskLines.length>0){this.fileLines.splice(e+1,t.taskLines.length-1);const n=this.fileLines.join(`
`);await this.app.vault.modify(this.file,n)}return t}markAllTasks(){var i,n,r,a,o,l;let e=!1;const t=this.fileLines;for(let c=0;c<t.length;c++){const d=t[c];if(!((i=this.plugin.taskParser)!=null&&i.isMarkdownTask(d))||((n=this.plugin.taskParser)==null?void 0:n.getTaskContentFromLineText(d))=="")continue;const g=/^\s{2}- \[(x|X| )\]/.test(d),h=!!((r=this.plugin.taskParser)!=null&&r.getLineItemId(d)),u=!!((a=this.plugin.taskParser)!=null&&a.hasTickTickId(d)),f=!!((o=this.plugin.taskParser)!=null&&o.hasTickTickTag(d));if(!u&&!f&&!h&&!g){let p=(l=this.plugin.taskParser)==null?void 0:l.addTickTickTag(d);t[c]=p,e=!0}}return e}modifyTask(e,t){this.fileLines[t]=e}hasTasks(e){return this.fileLines.some(t=>this.plugin.taskParser.isMarkdownTask(t)&&(e||this.plugin.taskParser.hasTickTickId(t)))}fixChildTabs(e,t){let i=this.plugin.taskParser.getTabs(this.fileLines[t]);return i+="	",this.fixTabs(e,i)}deleteTaskAndLines(e){const t=this.getTaskIndex(e),i=this.getTaskEndLineByTaskID(e)-t+1;this.fileLines.splice(t,i)}getTaskEndLineByTaskID(e){const t=this.getTaskIndex(e);return this.getTaskEndLineByIdx(t)}getTaskEndLineByIdx(e){const t=this.plugin.taskParser.getTabs(this.fileLines[e]),i=t.length,n=t+"  ";for(let r=e+1;r<this.fileLines.length;r++){const a=this.fileLines[r],o=this.plugin.taskParser.getNumTabs(a);if(this.plugin.taskParser.isMarkdownTask(a)&&this.plugin.taskParser.hasTickTickId(a)||o<i)return r-1;if(!(this.plugin.taskParser.isMarkdownTask(a)&&this.plugin.taskParser.getLineItemId(a)||a.startsWith(n))&&(o<i||!a.startsWith(n)))return r-1}return this.fileLines.length-1}getTaskLines(e){let t={};const i=this.getTaskIndex(e);return t=this.getTaskLinesByIdx(i,t),t}getTaskLinesByIdx(e,t){var g,h;const i=[],n=this.fileLines[e],r=this.plugin.taskParser.getTabs(n),a=r.length,o=r+"  ";t.parentId=this.getParentIDByIdx(e),t.task=n;const l=O().noteDelimiter,c=typeof l=="string"&&l.length>0;let d=e+1;if(c){let u=-1,f="";if(d<this.fileLines.length){const m=this.fileLines[d];if(m.startsWith(o)&&!this.plugin.taskParser.isMarkdownTask(m)){const v=m.slice(o.length).trim();v.length>0&&(u=d,f=v)}}if(u!==-1){let m=-1;for(let v=u+1;v<this.fileLines.length;v++){const w=this.fileLines[v];if(!w.startsWith(o))break;if(!this.plugin.taskParser.isMarkdownTask(w)&&w.slice(o.length).trim()===f){m=v;break}}if(m!==-1){for(let v=u;v<=m;v++)v===u||v===m?i.push(o+l):i.push(this.fileLines[v]);return t.taskLines=i,t}}const p=[];for(;d<this.fileLines.length;d++){const m=this.fileLines[d],v=this.plugin.taskParser.getNumTabs(m)===a,w=this.plugin.taskParser.isMarkdownTask(m),y=w&&!this.plugin.taskParser.getLineItemId(m)&&!this.plugin.taskParser.hasTickTickId(m);if(v&&m.startsWith(o)&&(!w||y))p.push(m);else break}p.length>0&&(i.push(o+l),i.push(...p),i.push(o+l))}else{for(;d<this.fileLines.length;d++){const u=this.fileLines[d],f=this.plugin.taskParser.getNumTabs(u)===a,p=this.plugin.taskParser.isMarkdownTask(u),m=p&&!this.plugin.taskParser.getLineItemId(u)&&!this.plugin.taskParser.hasTickTickId(u);if(f&&u.startsWith(o)&&(!p||m))i.push(u);else break}i.length>=2&&((g=i[0])==null||g.slice(o.length).trim(),(h=i[i.length-1])==null||h.slice(o.length).trim())}return t.taskLines=i,t}getParentId(e){const t=this.getTaskIndex(e);return this.getParentIDByIdx(t)}getParentIDByIdx(e){let t=this.plugin.taskParser.getNumTabs(this.fileLines[e]),i="";for(let n=e-1;n>=0;n--){const r=this.fileLines[n];if(this.plugin.taskParser.isMarkdownTask(r)){const a=this.plugin.taskParser.getNumTabs(this.fileLines[n]),o=this.plugin.taskParser.getTickTickId(r);if(a<t){i=o||"";break}}}return i}fixUpChildren(e){Object.entries(e).sort(([,i],[,n])=>i.depth-n.depth).forEach(([i,n])=>{n.depth==0&&n.tabs;const r=this.getTaskIndex(i);n.children.forEach(a=>{const o=this.getTaskIndex(a),l=this.fixChildTabs(a,r);this.fileLines.splice(o,l.length,...l),this.moveTask(o,r)})})}fixTabs(e,t){const i=this.getTaskIndex(e),n=this.getTaskEndLineByTaskID(e)+1,r=this.fileLines.slice(i,n);for(let a=0;a<r.length;a++){let o=t;this.plugin.taskParser.isMarkdownTask(r[a])&&a>0&&(o=t+"	"),r[a].startsWith("	")?r[a]=r[a].replace(/\t+/g,o):r[a]=o+r[a]}return r}moveTask(e,t){const i=this.getTaskEndLineByIdx(e)-e+1,n=this.plugin.taskParser.getTickTickId(this.fileLines[t]),r=this.fileLines.splice(e,i);n&&(t=this.getTaskEndLineByIdx(this.getTaskIndex(n))+1),this.fileLines.splice(t,0,...r)}findChildren(e,t){const i=[],n=t.length+1;for(let r=e+1;r<this.fileLines.length;r++){const a=this.fileLines[r],o=this.plugin.taskParser.getTickTickId(a);this.plugin.taskParser.getNumTabs(a)===n&&this.plugin.taskParser.isMarkdownTask(a)&&o&&i.push(o)}return i}buildMoveMap(e,t,i,n=0){const r=this.getTaskIndex(e),a=this.plugin.taskParser.getTabs(this.fileLines[r]),o=t;return i[e]={tabs:a,children:o,depth:n},o&&o.length>0&&o.forEach(l=>{const c=this.getTaskIndex(l),d=this.plugin.taskParser.getTabs(this.fileLines[c]),g=this.findChildren(c,d);this.buildMoveMap(l,g,i,n+1)}),i}}class Tf{constructor(e,t){this.app=e,this.plugin=t}async deletedTaskCheck(e){var l,c,d,g,h;let t,i,n,r;if(e){if(t=this.app.vault.getAbstractFileByPath(e),t&&t instanceof F.TFolder)return;r=e,t instanceof F.TFile&&(i=await this.app.vault.read(t))}else n=this.app.workspace.getActiveViewOfType(F.MarkdownView),t=this.app.workspace.getActiveFile(),r=t==null?void 0:t.path,i=n==null?void 0:n.data;let a=await((l=this.plugin.cacheOperation)==null?void 0:l.getFileMetadata(r,null));if(!a||!a.TickTickTasks)return;let o=a.TickTickTasks;if(i){const u=i.replace(/^---[\s\S]*?---\n/,""),f=await this.findMissingTaskIds(u,o,r);if(f.length>0){if(await this.deleteTasksByIds(f),a=await((c=this.plugin.cacheOperation)==null?void 0:c.getFileMetadata(r,null)),!a||!a.TickTickTasks)return;o=a.TickTickTasks}const m=[];for(const v of o)if(v.taskItems){for(const w of v.taskItems)u.includes(w)||m.push(w);if(m.length>0)try{let w=await((d=this.plugin.cacheOperation)==null?void 0:d.removeTaskItem(a,v.taskId,m));if(w){let y=this.plugin.taskParser.getObsidianUrlFromFilepath(r);y&&(w.title=w.title+" "+y);let k=await((g=this.plugin.tickTickRestAPI)==null?void 0:g.UpdateTask(w))}}catch(w){b.error("Task Item removal failed: ",w)}}}else{let u=o.map(f=>f.taskId);if(u.length>0){let f=[];for(const p of u){const m=(h=this.plugin.cacheOperation)==null?void 0:h.getFilepathForTask(p);m&&m!=r&&(b.debug("== found:",p,m),f.push(p))}u=u.filter(p=>!f.includes(p))}u.length>0&&(b.error("Content not readable.",i,r," file could open elsewhere or deleted."),new F.Notice(`All content from ${e} APPEARS to have been removed.
If this is correct, please confirm task deletion. Otherwise, cancel task deletion.`,0),await this.deleteTasksByIds(u))}}async findMissingTaskIds(e,t,i){var l;const n=/%%\[ticktick_id:: ([a-f0-9]{24})\]%%/g,r=e.matchAll(n),a=new Set([...r].map(c=>c[1]));let o=t.filter(c=>!a.has(c.taskId)).map(c=>c.taskId);if(o&&o.length>0){let c=[];for(const d of o){const g=(l=this.plugin.cacheOperation)==null?void 0:l.getFilepathForTask(d);g&&g!=i&&(b.debug("Task found in different file:",d,g),c.push(d))}o=o.filter(d=>!c.includes(d))}return o}async lineNewContentTaskCheck(e,t){var d;(d=t.file)==null||d.path;const i=t==null?void 0:t.data,n=e.getCursor(),r=n.line,a=e.getLine(r);let o=i==null?void 0:i.length;const l=new ni(this.app,this.plugin,t.file);await l.init(i),await this.addTask(a,r,e,n,l);let c=i==null?void 0:i.length;return o!=c}async addTask(e,t,i,n,r){var a,o,l,c,d,g,h,u;if(!(!e||e.length==0)&&!this.plugin.taskParser.hasTickTickId(e)&&this.plugin.taskParser.hasTickTickTag(e))try{const f=await this.plugin.taskParser.convertLineToTask(e,t,r.getFilePath(),r,null),p=await((a=this.plugin.tickTickRestAPI)==null?void 0:a.AddTask(f));if(f.parentId){let k=(o=this.plugin.cacheOperation)==null?void 0:o.loadTaskFromCacheID(f.parentId);k=this.plugin.taskParser.addChildToParent(k,f.parentId),k=await((l=this.plugin.tickTickRestAPI)==null?void 0:l.UpdateTask(k)),await((c=this.plugin.cacheOperation)==null?void 0:c.updateTaskToCache(k))}const m=p.id;new F.Notice(`new task ${p.title} id is ${p.id}`),f.status!=0&&(await((d=this.plugin.tickTickRestAPI)==null?void 0:d.CloseTask(p.id,p.projectId)),await((g=this.plugin.cacheOperation)==null?void 0:g.closeTaskToCacheByID(m))),p.dateHolder=f.dateHolder,await this.updateTaskLine(p,e,i,n,t,r);const v=r.getTaskRecord(p.id),y=v.task+this.plugin.taskParser.getNoteString(v,p.id);p.lineHash=await((h=this.plugin.taskParser)==null?void 0:h.getLineHash(y)),await((u=this.plugin.cacheOperation)==null?void 0:u.appendTaskToCache(p,r.getFilePath())),await this.plugin.saveSettings()}catch(f){b.error("Error adding task:",f),b.error(`The error occurred in file: ${r.getFilePath()}`)}}async fullTextNewTaskCheck(e){var o,l;let t,i=null,n=null;if(e){if(t=this.app.vault.getAbstractFileByPath(e),t&&t instanceof F.TFolder)return!1;if(!t)return b.error(`File: ${e} not found. Removing from Meta Data`),await((o=this.plugin.cacheOperation)==null?void 0:o.deleteFilepathFromMetadata(e)),!1}else throw new Error("No file path provided");const r=new ni(this.app,this.plugin,t);await r.init(),O().enableFullVaultSync&&await((l=this.plugin.fileOperation)==null?void 0:l.addTickTickTagToFile(r));const a=r.getFileLines().split(`
`);for(let c=0;c<a.length;c++){const d=a[c];await this.addTask(d,c,i,n,r)}return!0}async lineModifiedTaskCheck(e,t,i,n){var o,l,c,d,g,h,u,f,p,m,v,w,y,k,E,T,S,P,L,A,_,C,D,q,W,R,Q,oe,ge,me,le,Te;let r=!1;if(O().enableFullVaultSync){if(!await((o=this.plugin.cacheOperation)==null?void 0:o.getFileMetadata(e)))return!1;await this.plugin.saveSettings()}let a;if((l=this.plugin.taskParser)!=null&&l.hasTickTickId(t)&&((c=this.plugin.taskParser)!=null&&c.hasTickTickTag(t))){const se=this.plugin.taskParser.getTickTickId(t),ve=n.getTaskRecord(se);if(!ve)return b.error("Task Not Found in file map",n.file,e,se),!1;if(!ve.task)return b.error("Task Not Found in file map",ve,se),!1;let K="";ve.taskLines&&ve.taskLines.length>1&&(K=this.plugin.taskParser.getNoteString(ve,se));const ke=await((d=this.plugin.taskParser)==null?void 0:d.getLineHash(t+K)),H=(g=this.plugin.cacheOperation)==null?void 0:g.loadTaskFromCacheID(se);let ue=!1,qe="";if(H&&H.lineHash)if(ke==H.lineHash){a=!1;const V=await this.checkForMoves(se,e);ue=V.projectMoved,qe=V.oldFilePath;const ye=(ve.parentId?ve.parentId:"")!=(H.parentId?H.parentId:"");if(!ue&&!ye)return!1;b.debug("Task Moved.",{projectMoved:ue,parentChanged:ye,taskrecordparentid:ve.parentId,savedtaskparentid:H.parentId,lineText:t,savedTaskTitle:H.title,newHash:ke,oldHash:H.lineHash})}else O().debugMode&&b.debug("Task Hash Changed.",`
`,t,`
`,H.title,`
`,ke,`
`,H.lineHash),a=!0;const j=await((h=this.plugin.taskParser)==null?void 0:h.convertLineToTask(t,i,e,n,ve));if(H)H.dateHolder||(H.dateHolder=(f=this.plugin.dateMan)==null?void 0:f.getEmptydateHolder(),await((p=this.plugin.cacheOperation)==null?void 0:p.updateTaskToCache(H,null))),H.lineHash||(H.lineHash=await((m=this.plugin.taskParser)==null?void 0:m.getLineHash(ke)));else{b.error(`There is no task for ${t.substring(0,10)} in the local cache. It will be deleted from file ${e}`),new F.Notice(`There is no task ${this.plugin.taskParser.getTaskContentFromLineText(t)} in the local cache. It will be deleted`);const V=this.plugin.app.vault.getAbstractFileByPath(e);return await((u=this.plugin.fileOperation)==null?void 0:u.deleteTaskFromSpecificFile(V,j,!0)),!1}const Ee=j.title,Be=(v=this.plugin.taskParser)==null?void 0:v.isTitleChanged(j,H),Qe=(w=this.plugin.taskParser)==null?void 0:w.isTagsChanged(j,H),Tt=(y=this.plugin.taskParser)==null?void 0:y.isStatusChanged(j,H),fe=(k=this.plugin.dateMan)==null?void 0:k.areDatesChanged(j,H),B=(E=this.plugin.taskParser)==null?void 0:E.isParentIdChanged(j,H),te=j.priority!=H.priority,he=this.plugin.taskParser.areItemsChanged(j.items,H.items);let Ce=!1;O().syncNotes&&(j.content?Ce=this.plugin.taskParser.areNotesChanged(j.content,H.content):j.desc&&(Ce=this.plugin.taskParser.areNotesChanged(j.desc,H.desc)));try{let V=!1,ye=!1,Ae=!1,Ne=!1,Fe=!1,Ve=!1,ot=!1,_t=!1,Ue=!1;if(Be&&(O().debugMode&&b.debug(`Title modified for task ${se}
"New:" ${j.title}
"Cached:" ${H.title}`),V=!0),Qe&&(O().debugMode&&b.debug(`Tags modified for task ${se}, , ${j.tags}, ${H.tags}`),ye=!0),fe&&(O().debugMode&&b.debug(`Dates modified for task ${se}`),Fe=!0),j.timeZone=H.timeZone,ue){await((T=this.plugin.tickTickRestAPI)==null?void 0:T.moveTaskProject(j,H.projectId,j.projectId));let _e="";O().debugMode&&b.debug("Project Moved"),_e=`Task ${se}: ${this.plugin.taskParser.getTaskContentFromLineText(Ee)} has moved from ${qe} to ${e} 
If any children were moved, they will be updated to ${O().baseURL} on the next Sync event`,new F.Notice(_e,5e3),O().debugMode&&b.debug(_e),Ae=!0}if(B){let _e=await((S=this.plugin.cacheOperation)==null?void 0:S.loadTaskFromCacheID(H.parentId)),Ze=await((P=this.plugin.cacheOperation)==null?void 0:P.loadTaskFromCacheID(j.parentId)),ie=`Task ${se}:
${(L=this.plugin.taskParser)==null?void 0:L.stripOBSUrl(Ee).trim()}
used to be a child of:
${_e?_e.title.trim():"No old parent found"}
but is now a child of:
${Ze?Ze.title.trim():"No new parent found."}
If any children were moved, they will be updated to ${O().baseURL} on the next Sync event`;await((A=this.plugin.tickTickRestAPI)==null?void 0:A.moveTaskParent(se,H.parentId,j.parentId,j.projectId)),new F.Notice(ie,5e3),O().debugMode&&b.debug(ie),Ve=!0}if(te&&(ot=!0),he&&(O().debugMode&&b.debug("Number of items changed: ",(_=j.items)==null?void 0:_.length,(C=H.items)==null?void 0:C.length),_t=!0),Ce&&(O().debugMode&&(j.content?b.debug("Notes changed: ",j.content,H.content):b.debug("Desc changed: ",j.desc,H.desc)),Ue=!0),V||ye||Fe||Ae||Ve||ot||Ve||_t||Ue){H.modifiedTime=(D=this.plugin.dateMan)==null?void 0:D.formatDateToISO(new Date);const _e=j.dateHolder,Ze=await((q=this.plugin.tickTickRestAPI)==null?void 0:q.UpdateTask(j));Ze.dateHolder=_e,Ze.lineHash=ke,Ae?await((R=this.plugin.cacheOperation)==null?void 0:R.updateTaskToCache(Ze,e)):await((W=this.plugin.cacheOperation)==null?void 0:W.updateTaskToCache(Ze,null)),r=!0}if(Tt&&(O().debugMode&&b.debug(`Status modified for task ${se}`),j.status!=0?(O().debugMode&&b.debug("task completed"),(Q=this.plugin.tickTickRestAPI)==null||Q.CloseTask(j.id,j.projectId),await((oe=this.plugin.cacheOperation)==null?void 0:oe.closeTaskToCacheByID(j.id))):(O().debugMode&&b.debug("task not completed"),(ge=this.plugin.tickTickRestAPI)==null||ge.OpenTask(j.id,j.projectId),await((me=this.plugin.cacheOperation)==null?void 0:me.reopenTaskToCacheByID(j.id))),Ne=!0,new F.Notice(`Task Status for ${se} updated `)),V||ye||Fe||Ae||Ve||ot||Ve||_t||Ue){await this.plugin.saveSettings();let _e=`Task ${se} is updated.`;new F.Notice(_e),V&&(_e+=`
Content was changed.`),Ne&&(_e+=`
Status was changed.`),Fe&&(_e+=`
Due date was changed.`),ye&&(_e+=`
Tags were changed.`),Ae&&(_e+=`
Project was changed.`),ot&&(_e+=`
Priority was changed.`),B&&(_e+=`
Parent was changed.`),_t&&(_e+=`
Task Items changed`),Ue&&(_e+=`
Notes Changed`),O().debugMode&&b.debug("Task Changed: ",j.id,`
`,_e)}}catch(V){b.error("Error updating task:",V)}if(!r&&a){const V=await((le=this.plugin.taskParser)==null?void 0:le.getLineHash(t+K));j.lineHash=V,await((Te=this.plugin.cacheOperation)==null?void 0:Te.updateTaskToCache(j,null)),await this.plugin.saveSettings(),b.debug(`Updated hash: ${V}`)}}else this.plugin.taskParser.isMarkdownTask(t)&&(r=await this.handleTaskItem(t,n,i));return r}async deleteTaskItemCheck(e,t,i,n){var r,a,o,l,c,d,g,h,u,f,p;if(!((r=this.plugin.taskParser)!=null&&r.hasTickTickId(t))&&!((a=this.plugin.taskParser)!=null&&a.hasTickTickTag(t))&&((o=this.plugin.taskParser)!=null&&o.isMarkdownTask(t))){let m=!1;if(!((l=this.plugin.taskParser)!=null&&l.isMarkdownTask(t)))return;let v=(c=this.plugin.taskParser)==null?void 0:c.taskFromLine(t),w=v==null?void 0:v.indent,y=v==null?void 0:v.description;v==null||v.status;let k;if(w>0){const E=n.split(`
`);for(let T=i-1;T>=0;T--){const S=E[T];if((d=this.plugin.taskParser)!=null&&d.hasTickTickId(S)&&((g=this.plugin.taskParser)!=null&&g.hasTickTickTag(S))){const P=this.plugin.taskParser.getTickTickId(S);if(k=await((h=this.plugin.cacheOperation)==null?void 0:h.loadTaskFromCacheID(P)),k&&k.items){let L="",_=/%%(.*)%%/.exec(y);if(_){L=_[1],k.items.find(D=>D.id===L)&&(k.items=k.items.filter(D=>D.id!==L),m=!0);break}else{b.debug(`${L} Not found.`);break}}else break}}m&&(k.modifiedTime=(u=this.plugin.dateMan)==null?void 0:u.formatDateToISO(new Date),await((f=this.plugin.tickTickRestAPI)==null?void 0:f.UpdateTask(k)),await((p=this.plugin.cacheOperation)==null?void 0:p.updateTaskToCache(k)))}}}async fullTextModifiedTaskCheck(e){var t;try{let i,n,r;if(e){if(i=this.app.vault.getAbstractFileByPath(e),i&&i instanceof F.TFolder)return}else r=this.app.workspace.getActiveViewOfType(F.MarkdownView),i=this.app.workspace.getActiveFile(),e=i==null?void 0:i.path;let a=!1;const o=new ni(this.app,this.plugin,i);await o.init();const l=o.getFileLines().split(`
`);for(let c=0;c<l.length;c++){const d=l[c];if((t=this.plugin.taskParser)!=null&&t.isMarkdownTask(d))try{await this.lineModifiedTaskCheck(e,d,c,o),a=!0}catch(g){b.error("Error modifying task:",g)}}}catch(i){b.error("Error:",i)}}async closeTask(e){var t,i;try{let n=await((t=this.plugin.cacheOperation)==null?void 0:t.closeTaskToCacheByID(e));await((i=this.plugin.tickTickRestAPI)==null?void 0:i.CloseTask(e,n)),await this.plugin.saveSettings(),new F.Notice(`Task ${e} is closed.`)}catch(n){throw b.error("Error closing task:",n),n}}async reopenTask(e){var t,i;try{let n=await((t=this.plugin.cacheOperation)==null?void 0:t.reopenTaskToCacheByID(e));await((i=this.plugin.tickTickRestAPI)==null?void 0:i.OpenTask(e,n)),await this.plugin.fileOperation.uncompleteTaskInTheFile(e),await this.plugin.saveSettings(),new F.Notice(`Task ${e} is reopened.`)}catch(n){throw b.error("Error opening task:",n),n}}async deleteTasksByIds(e){var n,r,a;const t=[];if(!await this.confirmDeletion(e,"The tasks were removed from the file"))return new F.Notice("Tasks will not be deleted. Please rectify the issue before the next sync.",5e3),[];for(const o of e)try{let l,c=await((n=this.plugin.cacheOperation)==null?void 0:n.getProjectIdForTask(o));c&&(l=await((r=this.plugin.tickTickRestAPI)==null?void 0:r.deleteTask(o,c))),l&&new F.Notice(`Task ${o} is deleted.`),t.push(o)}catch(l){b.error(`Failed to delete task ${o}: ${l}`)}return t.length?(await((a=this.plugin.cacheOperation)==null?void 0:a.deleteTaskFromCacheByIDs(t)),await this.plugin.saveSettings(),t):(O().debugMode&&b.debug("Task not deleted:",t),[])}async syncCompletedTaskStatusToObsidian(e){var t,i;try{const n=[];for(const r of e)await this.plugin.fileOperation.completeTaskInTheFile(r.object_id),await((t=this.plugin.cacheOperation)==null?void 0:t.closeTaskToCacheByID(r.object_id)),new F.Notice(`Task ${r.object_id} is closed.`),n.push(r);await((i=this.plugin.cacheOperation)==null?void 0:i.appendTaskToCache(n)),await this.plugin.saveSettings()}catch(n){b.error("Error synchronizing task status:",n)}}async syncUncompletedTaskStatusToObsidian(e){var t,i;try{const n=[];for(const r of e)await this.plugin.fileOperation.uncompleteTaskInTheFile(r.object_id),await((t=this.plugin.cacheOperation)==null?void 0:t.reopenTaskToCacheByID(r.object_id)),new F.Notice(`Task ${r.object_id} is reopened.`),n.push(r);await((i=this.plugin.cacheOperation)==null?void 0:i.appendTaskToCache(n)),await this.plugin.saveSettings()}catch(n){b.error("Error synchronizing task status:",n)}}async syncTickTickToObsidian(){var e,t,i,n,r,a,o,l,c;try{if(!await this.plugin.saveProjectsToCache())return b.error("probable network connection error."),!1;let g=!1;const h=await((e=this.plugin.tickTickRestAPI)==null?void 0:e.getAllResources());if(!h)return b.error("probable network connection error."),!1;h.projectGroups&&ic(h.projectGroups);const u=h.syncTaskBean;let f=u.update,p=u.delete,m=O().SyncTag;if(m&&(m=m.toLowerCase(),m.includes("/")&&(m=m.replace(/\//g,"-"))),m&&O().SyncProject)if(O().tagAndOr==1){let _;_=f.filter(C=>{var D;return _=(D=C.tags)==null?void 0:D.includes(m),_}),_&&(f=_.filter(C=>C.projectId===O().SyncProject))}else{let _=f.filter(D=>{var q;return(q=D.tags)==null?void 0:q.includes(m)}),C=f.filter(D=>D.projectId===O().SyncProject);f=[..._,...C].reduce((D,q)=>{const W=D.find(R=>R.id===q.id);return W?Object.assign(W,q):D.push(q),D},[])}else(m||O().SyncProject)&&(f=f.filter(A=>{var D;const _=(D=A.tags)==null?void 0:D.includes(m),C=A.projectId===O().SyncProject;return _||C}));let v=await((t=this.plugin.cacheOperation)==null?void 0:t.loadTasksFromCache());if(O().debugMode){if(f){b.debug("We have: ",f.length," recent tasks on "+((n=(i=this.plugin.tickTickRestAPI)==null?void 0:i.api)==null?void 0:n.apiUrl));const A=f.filter(C=>C.status!=0),_=f.filter(C=>C.status===0);b.debug("openTasks",_.length,"closedTasks",A.length)}else b.debug("No tasks found.");v?b.debug("There are: ",v.length," tasks in Cache."):b.debug("There are no tasks in cache.")}v?v=v.sort((A,_)=>A.id>_.id?1:_.id>A.id?-1:0):v=[],f?f=f.sort((A,_)=>A.id>_.id?1:_.id>A.id?-1:0):f=[];let w=[];Object.keys(O().fileMetadata).length===0?w=f:w=f.filter(A=>!v.some(_=>_.id===A.id)),w.length>0&&(w.forEach(_=>{var C;(C=this.plugin.dateMan)==null||C.addDateHolderToTask(_)}),await((r=this.plugin.fileOperation)==null?void 0:r.synchronizeToVault(w,!1))&&await new Promise(_=>setTimeout(_,1e3)),g=!0);const k=v.filter(A=>!f.some(_=>_.id===A.id)).filter(A=>p.some(_=>_.taskId===A.id));if(k.length>0){const A=k.map(C=>C.id);if(await this.confirmDeletion(A,"tasks deleted from TickTick")){k.sort((C,D)=>!C.parentId&&D.parentId?-1:C.parentId&&!D.parentId?1:0);for(const C of k){try{await((a=this.plugin.fileOperation)==null?void 0:a.deleteTaskFromFile(C))}catch(D){b.debug("Task deletion failed.",D)}try{await((o=this.plugin.cacheOperation)==null?void 0:o.deleteTaskFromCache(C.id)),g=!0}catch(D){b.debug("Task deletion failed.",D),g=!0}}}}const T=v.filter(A=>!f.some(_=>_.id===A.id)).filter(A=>k.some(_=>_.taskId===A.id));for(const A of T)await((l=this.plugin.tickTickRestAPI)==null?void 0:l.AddTask(A)),g=!0;const S=f.filter(A=>{const _=v.find(C=>C.id===A.id);return _&&new Date(_.modifiedTime)<new Date(A.modifiedTime)}),P=v.filter(A=>{const _=f.find(C=>C.id===A.id);return _&&new Date(_.modifiedTime)>new Date(A.modifiedTime)}),L=S.filter(A=>{const _=P.find(C=>C.id===A.id);return _&&_.modifiedTime===void 0?!0:_&&new Date(A.modifiedTime)>new Date(_.modifiedTime)});return L.length>0&&(await((c=this.plugin.fileOperation)==null?void 0:c.synchronizeToVault(L,!0))&&(await new Promise(_=>setTimeout(_,1e3)),g=!0),await this.plugin.saveSettings(),O().debugMode&&b.debug(g?"File System Modified.":"No synchronization changes.")),g}catch(d){b.error("An error occurred while synchronizing:",d)}return!1}dumpArray(e,t){b.debug(e,t)}async backupTickTickAllResources(){var e;try{let t=O().bkupFolder;t[t.length-1]!="/"&&(t+="/");const i=new Date,n=`${i.getFullYear()}${i.getMonth()+1}${i.getDate()}${i.getHours()}${i.getMinutes()}${i.getSeconds()}`,r=t+"ticktick-backup-"+n+".csv";b.debug("Creating Backup: ",r);const a=await((e=this.plugin.tickTickRestAPI)==null?void 0:e.exportData());a&&(await this.app.vault.create(r,a),new F.Notice(`TickTick backup data is saved in the path ${r}`))}catch(t){b.error("An error occurred while creating TickTick backup",t),new F.Notice("An error occurred while creating TickTick backup"+t,5e3)}}async updateTaskContent(e){var n,r,a,o,l,c;const t=await((n=this.plugin.cacheOperation)==null?void 0:n.getFileMetadata(e));if(!t||!t.TickTickTasks)return;const i=(r=this.plugin.taskParser)==null?void 0:r.getObsidianUrlFromFilepath(e);try{for(const d of t.TickTickTasks){const g=await((a=this.plugin.cacheOperation)==null?void 0:a.loadTaskFromCacheID(d.taskId));if(g){g.title=g.title+" "+i;const h=await((o=this.plugin.tickTickRestAPI)==null?void 0:o.UpdateTask(g));h.title=await((l=this.plugin.taskParser)==null?void 0:l.stripOBSUrl(h.title)),await((c=this.plugin.cacheOperation)==null?void 0:c.updateTaskToCache(h))}else{const h="Task: "+d+"from file: "+e+"not found.";throw new Error(h)}}}catch(d){b.error("An error occurred in updateTaskDescription:",d)}}async forceUpdates(e){var r,a,o,l,c,d,g;let t;if(e){if(t=this.app.vault.getAbstractFileByPath(e),t&&t instanceof F.TFolder)return!1;if(!t)return b.error(`File: ${e} not found. Removing from Meta Data`),await((r=this.plugin.cacheOperation)==null?void 0:r.deleteFilepathFromMetadata(e)),!1}else throw new Error("No file path provided");const i=new ni(this.app,this.plugin,t);await i.init();const n=i.getFileLines().split(`
`);for(let h=0;h<n.length;h++){const u=n[h];if((a=this.plugin.taskParser)!=null&&a.hasTickTickId(u)&&((o=this.plugin.taskParser)!=null&&o.hasTickTickTag(u))){const f=this.plugin.taskParser.getTickTickId(u),p=this.plugin.cacheOperation.loadTaskFromCacheID(f);if(f&&p){p.modifiedTime=(l=this.plugin.dateMan)==null?void 0:l.formatDateToISO(new Date);const m=i.getTaskRecord(f),v=await((c=this.plugin.taskParser)==null?void 0:c.convertLineToTask(u,0,i.getFilePath(),i,m)),w={...p,...v};Object.assign(v,w);const y=await((d=this.plugin.tickTickRestAPI)==null?void 0:d.UpdateTask(v));await((g=this.plugin.cacheOperation)==null?void 0:g.updateTaskToCache(y,null))}}}}async checkForMoves(e,t){let i=!1;const n=this.plugin.cacheOperation.getFilepathForTask(e);return n&&n!==t&&(i=!0),{projectMoved:i,oldFilePath:n}}async updateTaskLine(e,t,i,n,r,a){var d;let o={...e};o.items=[];const l=this.plugin.taskParser.getNumTabs(t);let c=await((d=this.plugin.taskParser)==null?void 0:d.convertTaskToLine(o,l));if(i&&n){const g={line:n.line,ch:0},h={line:n.line,ch:t.length};return i==null||i.replaceRange(c,g,h),c}else try{a.modifyTask(c,r);const g=this.app.vault.getAbstractFileByPath(a.getFilePath());await this.app.vault.modify(g,a.getFileLines())}catch(g){b.error(g)}}async confirmDeletion(e,t){var a;const i=await((a=this.plugin.cacheOperation)==null?void 0:a.getTaskTitles(e));return await new nc(this.app,i,t,o=>{this.ret=o}).showModal()}async handleTaskItem(e,t,i){var h,u,f,p,m;let n=!1,r=!1;if(!((h=this.plugin.taskParser)!=null&&h.isMarkdownTask(e)))return!1;let a;const o=this.plugin.taskParser.getLineItemId(e);if(o?a=t.getTaskItemRecord(o):i&&(a=t.getTaskItemRecordByLine(i)),!a)return b.warn("Item not found in file map: ",e),!1;if(!a.parentId||a.parentId===""||a.parentId.length<1)return!1;const l=a.parentId,c=a.ID,d=(u=this.plugin.taskParser)==null?void 0:u.taskFromLine(e),g=(f=this.plugin.cacheOperation)==null?void 0:f.loadTaskFromCacheID(l);if(g&&g.items)if(c){const v=g.items.find(w=>w.id==c);v?v.title.trim()!=d.description.trim()&&(v.title=d==null?void 0:d.description.trim(),v.status=d!=null&&d.status?2:0,n=!0):(b.warn("",d,"not found in parent items. Forcibly adding..."),g.items.push({id:c,title:d==null?void 0:d.description,status:d!=null&&d.status?2:0}))}else{const w=nn().toHexString();g.items.push({id:w,title:d==null?void 0:d.description,status:d!=null&&d.status?2:0});const y=`${e} %%${w}%%`;try{const k=this.app.workspace.getActiveViewOfType(F.MarkdownView),E=(p=k==null?void 0:k.app.workspace.activeEditor)==null?void 0:p.editor,T={line:i,ch:0},S={line:i,ch:y.length};E==null||E.setLine(i,y)}catch(k){b.error(`Error updating item: ${k}`)}r=!0}else O().debugMode;if((n||r)&&g){const v=t.getFilePath();n=await this.updateTask(g,v),n&&await((m=this.plugin.cacheOperation)==null?void 0:m.updateTaskToCache(g,v))}return n}async updateTask(e,t){var r,a,o,l;if(e.modifiedTime=(r=this.plugin.dateMan)==null?void 0:r.formatDateToISO(new Date),await((a=this.plugin.cacheOperation)==null?void 0:a.updateTaskToCache(e)),O().fileLinksInTickTick!=="noLink"){let c=(o=this.plugin.taskParser)==null?void 0:o.getObsidianUrlFromFilepath(t);O().fileLinksInTickTick==="taskLink"&&c&&(e.title=e.title+" "+c)}const n=!await((l=this.plugin.tickTickRestAPI)==null?void 0:l.UpdateTask(e));return new F.Notice(`Task ${e.title} modified.`),!n}findTaskOrItemByLineNumber(e,t){for(let i of e)if(t>=i.startLine&&t<=i.endLine)return i;return null}}class _f extends F.Modal{constructor(e,t,i,n){super(e),this.title="Duplicate Projects/Lists found",this.cancelLabel="Cancel",this.confirmLabel="Abort Sync",this.projects=[],this.plugin=t,this.projects=i,this.message=`The following duplicate Projects/Lists were found. On ${O().baseURL},please either choose one of those to contain the tasks from both lists, or rename one of the lists.`,this.onSubmit=n}onOpen(){const{titleEl:e,contentEl:t}=this;e.setText(this.title),t.createEl("p",{text:`${this.message}`});const i=t.createEl("table","projects-table"),r=i.createEl("thead").createEl("tr"),a=r.createEl("th"),o=r.createEl("th");a.setText("Project Name"),o.setText("Project ID");const l=i.createEl("tbody");this.projects.forEach(c=>{const d=l.createEl("tr"),g=d.createEl("td","project-table-border"),h=d.createEl("td","project-table-border");g.setText(c.name),h.setText(c.id)}),new F.Setting(t).addButton(c=>{c.setClass("ts_button"),c.setWarning(),c.setButtonText(this.confirmLabel),c.onClick(()=>{this.result=!0,this.onSubmit(this.result),this.close()})})}onClose(){this.titleEl.empty(),this.contentEl.empty(),super.onClose(),this.resolvePromise(this.result)}showModal(){return this.open(),new Promise(e=>this.resolvePromise=e)}}const If="[TickTickSync]",Sf=b.methodFactory,Pf={toString(){return`[${window.moment().format("YYYY-MM-DD-HH:mm:ss")}]`}};b.methodFactory=function(s,e,t){const i=s;return Sf(s,e,t).bind(console,`${If}[${i}]%s:`,Pf)};b.rebuild();const sa=".md";class rc{constructor(e,t){this.app=e,this.plugin=t}async addTaskToMetadata(e,t){const i=await this.getFileMetadata(e,t.projectId);if(!i)return;const n={taskId:t.id,taskItems:[]};t.items&&t.items.length>0&&t.items.forEach(r=>{n.taskItems.push(r.id)}),i.TickTickTasks.push(n),i.TickTickCount=i.TickTickTasks.length}async addTaskItemToMetadata(e,t,i,n){const r=await this.getFileMetadata(e,n),a=r.TickTickTasks.find(o=>o.taskId===t);a==null||a.taskItems.push(i),r.TickTickCount=r.TickTickTasks.length}async removeTaskItem(e,t,i){if(!e)return;if(e.TickTickTasks.findIndex(r=>r.taskId===t)!==-1){const r=this.loadTaskFromCacheID(t);if(!r||!r.items)return;let a=r.items;return i.forEach(o=>{a=a.filter(l=>l.id!==o)}),r.items=a,await this.updateTaskToCache(r)}else b.warn(`Task '${t}' not found in metadata`)}async getFileMetadata(e,t){const i=O().fileMetadata[e];return i||await this.newEmptyFileMetadata(e,t)}getFileMetadatas(){return O().fileMetadata??null}async updateFileMetadata(e,t){const i=O().fileMetadata;i[e]||(i[e]={}),i[e].TickTickTasks=t.TickTickTasks,i[e].TickTickCount=t.TickTickCount,i[e].defaultProjectId=t.defaultProjectId,He({fileMetadata:i}),await this.plugin.saveSettings()}async deleteTaskIdFromMetadata(e,t){const i=await this.getFileMetadata(e),r=i.TickTickTasks.filter(o=>o.taskId!==t),a=r.length;i.TickTickTasks=r,i.TickTickCount=a,await this.updateFileMetadata(e,i)}async updateTaskMetadata(e,t){await this.deleteTaskIdFromMetadataByTaskId(e.id),await this.addTaskToMetadata(t,e)}async deleteTaskIdFromMetadataByTaskId(e){const t=this.getFileMetadatas();for(const i in t){const n=t[i].TickTickTasks;if(n&&n.find(r=>r.taskId===e)){await this.deleteTaskIdFromMetadata(i,e);break}}}async deleteFilepathFromMetadata(e){const t=O().fileMetadata,i={};for(const n in t)n!==e&&(i[n]=t[n]);return He({fileMetadata:i}),await this.plugin.saveSettings(),O().fileMetadata}checkForDuplicates(e){var n;if(!e)return;const t={},i={};for(const r in e)(n=e[r].TickTickTasks)==null||n.forEach(a=>{if(!t.hasOwnProperty(a.taskId)){t[a.taskId]=r;return}i.hasOwnProperty(a.taskId)||(i[a.taskId]=[]),i[a.taskId].push(r)});return{taskIds:t,duplicates:i}}async checkFileMetadata(){var t,i;const e=this.getFileMetadatas();for(const n in e){const r=e[n],a=this.app.vault.getAbstractFileByPath(n);if(!a&&(((t=r.TickTickTasks)==null?void 0:t.length)===0||!r.TickTickTasks)){b.error(`${n} does not exist and metadata is empty.`),await this.deleteFilepathFromMetadata(n);continue}if(!(((i=r.TickTickTasks)==null?void 0:i.length)===0||!r.TickTickTasks)&&!a){const o=r.TickTickTasks[0],l=await this.plugin.fileOperation.searchFilepathsByTaskidInVault(o.taskId);await this.updateRenamedFilePath(n,l),await this.plugin.saveSettings()}}return Object.keys(e).length}async getDefaultProjectNameForFilepath(e){const t=O().fileMetadata;if(!t[e]||t[e].defaultProjectId===void 0)return O().defaultProjectName;const i=t[e].defaultProjectId;return await this.getProjectNameByIdFromCache(i)}async getDefaultProjectIdForFilepath(e){const t=O().fileMetadata;if(!t[e]||!t[e].defaultProjectId){let i=O().defaultProjectId;return i||(i=O().inboxID),i}else{let i=t[e].defaultProjectId;return i||(i=O().inboxID),i}}filepathHasDefaultProjectID(e){const t=O().fileMetadata;return!!(!t[e]||t[e].defaultProjectId)}async getFilepathForProjectId(e){if(e||e!==""){const t=O().fileMetadata;for(const n in t)if(t[n].defaultProjectId===e)return n;if((e===O().inboxID||e===O().defaultProjectId)&&O().defaultProjectName)return ct()+"/"+O().defaultProjectName+".md";const i=await this.getProjectNameByIdFromCache(e);if(i)return ct()+"/"+i+sa;{const n=`File path not found for ${e}, returning ${i} instead.`;throw b.warn(n),new Error(n)}}else return O().defaultProjectName?ct()+"/"+O().defaultProjectName+sa:ct()+"/Inbox"+sa}async setDefaultProjectIdForFilepath(e,t){const i=await this.getFileMetadata(e,t);i.defaultProjectId=t,(!i.TickTickTasks||!i.TickTickCount)&&(i.TickTickTasks=[],i.TickTickCount=0),await this.updateFileMetadata(e,i)}async loadTasksFromCache(){try{return Ct()}catch(e){return b.error(`Error loading tasks from Cache: ${e}`),[]}}async saveTasksToCache(e){try{Bi(e)}catch(t){return b.error(`Error saving tasks to Cache: ${t}`),!1}}async appendTaskToCache(e,t){try{if(e===null)return;const i=Ct();e.title=this.plugin.taskParser.stripOBSUrl(e.title),i.push(e),Bi(i),await this.addTaskToMetadata(t,e),await this.plugin.saveSettings()}catch(i){b.error(`Error appending task to Cache: ${i}`)}}loadTaskFromCacheID(e){if(e)try{return Ct().find(i=>i.id===e)}catch(t){b.error("Error finding task from Cache:",t)}}async getTaskTitles(e){let i=Ct().filter(n=>e.includes(n.id)).map(n=>n.title);return i=i.map(n=>this.plugin.taskParser.stripOBSUrl(n)),i}async updateTaskToCache(e,t=null){try{let i="";if(t)i=t;else if(i=this.getFilepathForTask(e.id),i||(i=await this.getFilepathForProjectId(e.projectId)),!i)throw new Error(`File not found for ${e.id} - ${e.title}`);return await this.deleteTaskFromCache(e.id),await this.appendTaskToCache(e,i),e}catch(i){return b.error(`Error updating task to Cache: ${i}`),[]}}getFilepathForTask(e){const t=this.getFileMetadatas();for(const i in t){const n=t[i];if(n.TickTickTasks&&n.TickTickTasks.find(r=>r.taskId===e))return i}return null}async getProjectIdForTask(e){const t=Ct(),i=t.findIndex(n=>n.id===e);if(i!==-1)return t[i].projectId}async reopenTaskToCacheByID(e){let t=null;try{const i=Ct(),n=i.findIndex(r=>r.id===e);return n>-1&&(i[n].status=0,t=i[n].projectId),Bi(i),t}catch(i){throw b.error(`Error open task to Cache file: ${i}`),i}}async closeTaskToCacheByID(e){let t=null;try{const i=Ct(),n=i.findIndex(r=>r.id===e);return n>-1&&(i[n].status=2,t=i[n].projectId),Bi(i),t}catch(i){throw b.error(`Error close task to Cache file: ${i}`),i}}async deleteTaskFromCache(e){try{const i=Ct().filter(n=>n.id!==e);Bi(i),await this.deleteTaskIdFromMetadataByTaskId(e)}catch(t){b.error(`Error deleting task from Cache file: ${t}`)}}async deleteTaskFromCacheByIDs(e){try{const i=Ct().filter(n=>!e.includes(n.id));Bi(i),e.forEach(async n=>{await this.deleteTaskIdFromMetadataByTaskId(n)})}catch(t){b.error(`Error deleting task from Cache : ${t}`)}}async getProjectIdByNameFromCache(e){try{const i=Zi().find(r=>r.name.toLowerCase()===e.toLowerCase());return i?i.id:null}catch(t){return b.error(`Error finding project from Cache file: ${t}`),!1}}async getProjectNameByIdFromCache(e){try{const i=Zi().find(n=>n.id===e);return i?i.name:void 0}catch(t){b.error(`Error finding project from Cache file: ${t}`)}}async saveProjectsToCache(e){try{const t={id:O().inboxID,name:O().inboxName};e.push(t);const n=e.reduce((r,a,o,l)=>(l.findIndex(d=>d.name===a.name&&d.id!==a.id)!==-1&&!r.includes(a)&&r.push(a),r),[]).sort((r,a)=>r.name.localeCompare(a.name));if(n.length>0){const r=n.map(a=>`${a.id} ${a.name}`);return b.debug("Found duplicate lists: ",r),await this.showFoundDuplicatesModal(this.app,this.plugin,n),!1}for(const r of e)await this.checkProjectRename(r.id,r.name);return tc(e),await this.plugin.saveSettings(),!0}catch(t){b.error("Error on save projects: ",t),new F.Notice(`error on save projects: ${t}`)}return!1}async updateRenamedFilePath(e,t){try{const n=(await this.loadTasksFromCache()).map(a=>a.path===e?{...a,path:t}:a);await this.saveTasksToCache(n);const r=O().fileMetadata;r[t]=r[e],delete r[e],He({fileMetadata:r})}catch(i){b.error(`Error updating renamed file path to cache: ${i}`)}}async newEmptyFileMetadata(e,t){if(e instanceof F.TAbstractFile&&e instanceof F.TFile&&(e=e.name),!e){b.error("Attempt to create undefined FileMetaData Entry: ",e);return}if(this.app.vault.getAbstractFileByPath(e)instanceof F.TFolder){b.error("Not adding ",e," to Metadata because it's a folder.");return}const n=O().fileMetadata;return n[e]?n[e]:(n[e]={TickTickTasks:[],TickTickCount:0,defaultProjectId:t},He({fileMetadata:n}),await this.plugin.saveSettings(),O().fileMetadata[e])}async findInFile(e,t){const n=(await this.app.vault.cachedRead(e)).split(`
`);return t.map(a=>a.position.start.line).map(a=>n[a]).map(a=>this.plugin.taskParser.getTickTickId(a)).filter(a=>a!==null)}async showFoundDuplicatesModal(e,t,i){return await new _f(e,t,i,r=>{}).showModal()}async checkProjectRename(e,t){const i=this.getFileMetadatas();if(!i)return;const n=Zi();if(!n||Object.keys(n).length==0)return;const r=n.find(a=>a.id===e);if(r&&(r==null?void 0:r.name)!==t){b.debug(`Project Name Changed from ${r==null?void 0:r.name} to ${t}`);const a=await this.getFilepathForProjectId(e),o=`${ct()}/${t}.md`;if(b.debug(`Checking project rename for ${t}, which could be ${o}`),a!==o){b.debug(`Current project path is ${a}, which is not ${o}`);const l=this.app.vault.getAbstractFileByPath(a);l&&l instanceof F.TFile&&(b.debug(`Renaming ${a} to ${o}`),await this.app.vault.rename(l,o),b.debug(`Updating metadata key for ${a} to ${o}  === \\n ${i[a]}`),await this.updateFileMetadata(o,i[a]),b.debug(`Deleting ${a} from metadata`),await this.deleteFilepathFromMetadata(a))}}}}class ac{constructor(e,t){this.app=e,this.plugin=t}async completeTaskInTheFile(e){var o,l,c;await((o=this.plugin.cacheOperation)==null?void 0:o.loadTaskFromCacheID(e));const t=(l=this.plugin.cacheOperation)==null?void 0:l.getFilepathForTask(e),i=this.app.vault.getAbstractFileByPath(t),r=(await this.app.vault.read(i)).split(`
`);let a=!1;for(let d=0;d<r.length;d++){const g=r[d];if(g.includes(e)&&((c=this.plugin.taskParser)!=null&&c.hasTickTickTag(g))){r[d]=g.replace("[ ]","[x]"),a=!0;break}}if(a){const d=r.join(`
`);await this.app.vault.modify(i,d)}}async uncompleteTaskInTheFile(e){var o,l,c;await((o=this.plugin.cacheOperation)==null?void 0:o.loadTaskFromCacheID(e));const t=(l=this.plugin.cacheOperation)==null?void 0:l.getFilepathForTask(e),i=this.app.vault.getAbstractFileByPath(t),r=(await this.app.vault.read(i)).split(`
`);let a=!1;for(let d=0;d<r.length;d++){const g=r[d];if(g.includes(e)&&((c=this.plugin.taskParser)!=null&&c.hasTickTickTag(g))){r[d]=g.replace(/- \[(x|X)\]/g,"- [ ]"),a=!0;break}}if(a){const d=r.join(`
`);await this.app.vault.modify(i,d)}}async addTickTickTagToFile(e){if(e.markAllTasks()){const t=e.getFileLines();await this.app.vault.modify(e.file,t),new F.Notice("New Tasks will be added to TickTick on next Sync.")}}async addTickTickLinkToFile(e){var a,o,l,c,d,g;const t=this.app.vault.getAbstractFileByPath(e);if(t&&t instanceof F.TFolder)return;const n=(await this.app.vault.read(t)).split(`
`);let r=!1;for(let h=0;h<n.length;h++){const u=n[h];if((a=this.plugin.taskParser)!=null&&a.hasTickTickId(u)&&((o=this.plugin.taskParser)!=null&&o.hasTickTickTag(u))){if((l=this.plugin.taskParser)!=null&&l.hasTickTickLink(u))return;const f=(c=this.plugin.taskParser)==null?void 0:c.getTickTickId(u),p=await((d=this.plugin.cacheOperation)==null?void 0:d.loadTaskFromCacheID(f)),m=(g=this.plugin.taskParser)==null?void 0:g.addTickTickLink(u,p.id,p.projectId);n[h]=m,r=!0}else continue}if(r){const h=n.join(`
`);await this.app.vault.modify(t,h)}}async synchronizeToVault(e,t){var n,r;if(!e)return b.error("No tasks to add."),!1;e.sort((a,o)=>a.projectId.localeCompare(o.projectId)||a.id.localeCompare(o.id));const i=[...new Set(e.map(a=>a.projectId))];for(const a of i){let o,l=null,c=e.filter(h=>h.projectId===a);const d=[],g=await((n=this.plugin.cacheOperation)==null?void 0:n.getFilepathForProjectId(O().defaultProjectId));for(const h of c)h.parentId&&h.parentId.length>0?l=this.plugin.cacheOperation.getFilepathForTask(h.parentId):l=this.plugin.cacheOperation.getFilepathForTask(h.id),l?this.addTaskToTFF(d,l,h):(l=await((r=this.plugin.cacheOperation)==null?void 0:r.getFilepathForProjectId(h.projectId)),l?this.addTaskToTFF(d,l,h):this.addTaskToTFF(d,g,h));for(const{file:h,tasks:u}of d)this.doTheSortMambo(u),o=await this.synchronizeToFile(h,u,t);if(o&&await new Promise(h=>setTimeout(h,1e3)),O().debugMode){let h="";t?h="updating":h="adding",b.debug("===",l,c,o?"Completed "+h+" task(s).":" Failed "+h+" task(s).")}}return!0}async getOrCreateDefaultFile(e){let t;try{let i=ct();(!i||i==="")&&(i="/");let n=this.app.vault.getAbstractFileByPath(i);n instanceof F.TFolder||(b.warn(`Folder ${i} does not exit. It will be created`),n=await this.app.vault.createFolder(i)),new F.Notice(`Creating new file: ${e}`),b.warn(`Creating new file: ${e}`);const r=`${this.plugin.manifest.name} -- ${this.plugin.manifest.version}`;try{t=await this.app.vault.create(e,`== Added by ${r} == `)}catch(a){if(a.message.includes("File already exists")){if(b.info("Attempting to find existing file",e),t=this.app.vault.getAbstractFileByPath(e),!t){const o=e.split("/").pop();if(o){const l=this.app.vault.getMarkdownFiles();for(const c of l)if(b.debug("Checking file",c.path),c.path.toLowerCase()===o.toLowerCase()){b.debug("Found existing file",c.path),t=c;break}}}}else throw a}return t}catch(i){throw b.error("Error on create file: ",i),new Error(i)}}async checkForDuplicates(e,t){let i={},n={};if(!e)return;let r;try{for(const a in e){r=a;const o=this.app.vault.getAbstractFileByPath(a);if(!o){b.debug("Duplicate check Skipping ",a," because it's not found.");continue}if(o&&o instanceof F.TFolder){b.debug("Duplicate check Skipping ",a," because it's a folder.");continue}try{const l=await this.app.vault.read(o);for(let c in t)new RegExp(`%%\\[ticktick_id::\\s*${c}\\]%%`,"i").test(l)&&(i[c]?(n[c]||(n[c]=[i[c]]),n[c].push(a)):i[c]=a)}catch{b.error("Duplicate check Skipping ",a," because it's not readable.");continue}}return n}catch(a){const o=`File [${r}] not found, or is locked. If file exists, Please try again later.`;throw b.error(a,o),new Error(o)}}async deleteTaskFromSpecificFile(e,t,i){if(i&&!await this.confirmDeletion(t.title+"in File: "+e))return new F.Notice("Tasks will not be deleted. Please rectify the issue before the next sync.",5e3),[];b.info("Task being deleted from file: ",t.id,e);const n=new ni(this.app,this.plugin,e);await n.init(),n.deleteTask(t.id);const r=n.getFileLines();await this.app.vault.modify(e,r),this.plugin.lastLines.set(e.path,r.length)}async deleteTaskFromFile(e){var r;const t=e.id,i=(r=this.plugin.cacheOperation)==null?void 0:r.getFilepathForTask(t),n=this.app.vault.getAbstractFileByPath(i);if(i)await this.deleteTaskFromSpecificFile(n,e,!1);else throw new Error(`File not found for ${e.title}. File path found is ${i}`)}async searchTickTickIdFromFilePath(e,t){const i=this.app.vault.getAbstractFileByPath(e),r=(await this.app.vault.read(i)).split(`
`);let a=null;for(let o=0;o<r.length;o++){const l=r[o];if(l.includes(t)){const c=/\[ticktick_id::\s*(\w+)\]/.exec(l);c&&(a=c[1]);break}}return a}async getAllFilesInTheVault(){return this.app.vault.getFiles()}async searchFilepathsByTaskidInVault(e){const i=(await this.getAllFilesInTheVault()).map(async a=>{if(!this.isMarkdownFile(a.path))return;if((await this.app.vault.cachedRead(a)).includes(e))return a.path});return(await Promise.all(i)).filter(a=>a!==void 0)[0]||null}isMarkdownFile(e){let t=e.split(".").pop();return t=t.toLowerCase(),t==="md"}async synchronizeToFile(e,t,i){let n,r;return e&&(n=this.app.vault.getAbstractFileByPath(e),n instanceof F.TFile||(n=await this.getOrCreateDefaultFile(e),b.debug("Creating new file: ",n.path))),t=this.doTheSortMambo(t),r=await this.syncTasks(n,t,i),r}async syncTasks(e,t,i){try{const n=await this.persistToFile(t,e,i);return await this.app.vault.process(e,r=>(r=n,r)),!0}catch(n){return b.error(`Could not ${i?"update":"add"} Tasks to file ${e.path} 
 Error: ${n}`),!1}}async persistToFile(e,t,i){var l,c,d,g,h,u,f,p,m,v,w,y,k,E,T;b.debug("Processing File: ",t.path);const n=new ni(this.app,this.plugin,t);await n.init();let r=!1;const a=[];for(const S of e){let P=0;const L=S.parentId;L&&(P=n.getNumParentTabs(L)+1);let A="",_="";if(i){const D=(d=this.plugin.cacheOperation)==null?void 0:d.loadTaskFromCacheID(S.id);if((g=this.plugin.dateMan)==null||g.addDateHolderToTask(S,D),A=await((h=this.plugin.taskParser)==null?void 0:h.convertTaskToLine(S,P)),D)if((u=this.plugin.taskParser)!=null&&u.isProjectIdChanged(D,S))b.debug("Moving Task: ",S.id,S.title," from Project: ",D.projectId," to Project: ",S.projectId),_=await this.handleTickTickStructureMove(S,D,A,n),r=!0;else{const q=(f=this.plugin.taskParser)==null?void 0:f.isParentIdChanged(D,S);n.updateTask(S,A,q)}else b.warn("No Old Task found for: ",S.id)}else if(A=await((l=this.plugin.taskParser)==null?void 0:l.convertTaskToLine(S,P)),n.getTaskIndex(S.id)!=-1){b.warn("A Task was being added but was already in file: ",S.id,S.title),n.updateTask(S,A),await((c=this.plugin.cacheOperation)==null?void 0:c.updateTaskToCache(S,t.path)),a.push(S.id);continue}else n.addTask(S,A);let C=(p=this.plugin.taskParser)==null?void 0:p.getAllTagsFromLineText(A);if(C&&(S.tags=C),O().fileLinksInTickTick!=="noLink"){let D="";r?D=(v=this.plugin.taskParser)==null?void 0:v.getObsidianUrlFromFilepath(_):D=(m=this.plugin.taskParser)==null?void 0:m.getObsidianUrlFromFilepath(t.path),D&&(S.title=S.title+" "+D)}if(i)if(!r)await((k=this.plugin.cacheOperation)==null?void 0:k.updateTaskToCache(S,t.path));else{let D=await((E=this.plugin.tickTickRestAPI)==null?void 0:E.UpdateTask(S));await((T=this.plugin.cacheOperation)==null?void 0:T.updateTaskToCache(D,_))}else{let D=await((w=this.plugin.tickTickRestAPI)==null?void 0:w.UpdateTask(S));await((y=this.plugin.cacheOperation)==null?void 0:y.appendTaskToCache(D,t.path))}}const o=n.getFileLines();return this.plugin.lastLines.set(t.path,o.length),o}hasChildren(e){var t;return e.childIds?((t=e.childIds)==null?void 0:t.length)>0:!1}async confirmDeletion(e){const t=[];t.push(e);const i="task not found in local cache.";return await new nc(this.app,t,i,a=>{this.ret=a}).showModal()}async handleTickTickStructureMove(e,t,i,n){var g,h,u,f,p,m,v;b.debug("deleting old task: ",t.id,t.title," from file");let r=await((g=this.plugin.cacheOperation)==null?void 0:g.getFilepathForProjectId(e.projectId));if(!r){let w=`File not found for moved newTask:  ${e.id}, ${e.title}`;throw new Error(w)}const a=await this.plugin.fileOperation.getOrCreateDefaultFile(r);if(!a||!(a instanceof F.TFile)){let w=`File not found for moved newTask:  ${e.id}, ${e.title}, ${r}`;throw new Error(w)}if(b.debug("oldFilePath: ",n.getFilePath()),!n||!n.getFilePath()){let w=`File not found for moved newTask:  ${e.id}, ${e.title}`;throw new Error(w)}n.deleteTask(t.id),b.debug("deleted from: ",n.getFilePath()),await((h=this.plugin.cacheOperation)==null?void 0:h.deleteTaskFromCache(t.id));const o=new ni(this.app,this.plugin,a);await o.init(),b.debug("Adding Task: ",e.id,e.title," to new file: ",o.getFilePath()),o.addTask(e,i);const l=o.getFileLines();await this.app.vault.process(a,w=>(w=l,w));const c=(u=this.plugin.taskParser)==null?void 0:u.stripOBSUrl(e.title);let d="";if(e.projectId!=t.projectId){const w=await((f=this.plugin.cacheOperation)==null?void 0:f.getProjectNameByIdFromCache(e.projectId)),y=await((p=this.plugin.cacheOperation)==null?void 0:p.getProjectNameByIdFromCache(t.projectId));d=`Task Moved.
Task: `+c+`
was moved from
 `+y+`
to
`+w}else if(e.parentId){const w=await((m=this.plugin.cacheOperation)==null?void 0:m.loadTaskFromCacheID(e.parentId)),y=(v=this.plugin.taskParser)==null?void 0:v.stripOBSUrl(w.title);d=`Task has new Parent.
Task: `+c+`
is now a child of
 `+y}else d=`Task is now a top level task.
Task: `+c;return new F.Notice(d,5e3),r}async deleteTaskFromOldFile(e,t,i){var r;const n=(r=this.plugin.cacheOperation)==null?void 0:r.getFilepathForTask(e.id);if(b.debug("oldFilePath: ",n),!n){let a=`File not found for moved newTask:  ${t.id}, ${t.title}`;throw new Error(a)}return i.deleteTask(e.id),b.debug("deleted from: ",i.getFilePath()),n}async moveChildTasks(e,t,i){var n,r,a;for(const o of e.childIds){if(t.includes(o))continue;const l=await((n=this.plugin.cacheOperation)==null?void 0:n.loadTaskFromCacheID(o));if(l){l.parentId=e.id,l.projectId=e.projectId;const c=(r=l.items)==null?void 0:r.length;if(await this.moveTask(i,l,c,l.id,l.projectId),this.hasChildren(l)){const g=await((a=this.plugin.cacheOperation)==null?void 0:a.loadTaskFromCacheID(o));await this.moveChildTasks(g,t,i)}}else b.warn("Child not found: ",o)}}async moveTask(e,t,i,n,r){var c,d,g,h,u,f;const a=this.app.vault.getAbstractFileByPath(e);await this.deleteTaskFromSpecificFile(a,t,!1),await((c=this.plugin.cacheOperation)==null?void 0:c.deleteTaskFromCache(n)),await this.synchronizeToVault([t]);const o=(d=this.plugin.taskParser)==null?void 0:d.stripOBSUrl(t.title);let l="";if(t.projectId!=r){const p=await((g=this.plugin.cacheOperation)==null?void 0:g.getProjectNameByIdFromCache(t.projectId)),m=await((h=this.plugin.cacheOperation)==null?void 0:h.getProjectNameByIdFromCache(r));l=`Task Moved.
Task: `+o+`
was moved from
 `+m+`
to
`+p}else if(t.parentId){const p=await((u=this.plugin.cacheOperation)==null?void 0:u.loadTaskFromCacheID(t.parentId)),m=(f=this.plugin.taskParser)==null?void 0:f.stripOBSUrl(p.title);l=`Task has new Parent.
Task: `+o+`
is now a child of
 `+m}else l=`Task is now a top level task.
Task: `+o;new F.Notice(l,5e3)}compareTasks(e,t){return!e.parentId&&t.parentId?-1:e.parentId&&!t.parentId?1:e.parentId&&t.parentId?t.parentId.localeCompare(e.parentId):e.sortOrder-t.sortOrder}getParent(e,t){return t.find(i=>i.id===e)}sortChildrenfirst(e){const t=[],i=new Map;e.forEach(r=>i.set(r.id,r));const n=r=>{t.includes(r)||(r.childIds&&r.childIds.forEach(a=>{const o=i.get(a);o&&n(o)}),t.push(r))};return e.forEach(r=>{n(r)}),t}sortTasks(e){const t=new Map;e.forEach(r=>t.set(r.id,{...r,children:[]}));let i=[];e.forEach(r=>{r.parentId&&t.has(r.parentId)?t.get(r.parentId).children.push(t.get(r.id)):i.push(t.get(r.id))});function n(r,a=[]){for(const o of r)a.push(o),o.children.length&&n(o.children,a);return a}return n(i).map(({children:r,...a})=>a)}doTheSortMambo(e){const t=JSON.parse(JSON.stringify(e)),i=this.sortTasksByLevel(t);return i.map(n=>`${"  ".repeat(n.level-1)}${n.title} (Level: ${n.level})`).join(`
`),i}sortTasksByLevel(e){const t={};e.forEach(n=>{t[n.id]={...n,level:0}}),e.forEach(n=>{if(!("parentId"in n)||!n.parentId)t[n.id].level=1;else{let r=n.id,a=1;for(;t[r]&&"parentId"in t[r]&&t[r].parentId;){if(a++,a>6)throw b.debug("this is the issue: ",r," ",t[r].parentId,""),new F.Notice("A circular Parent-Child dependency was found. Please fix in TickTick by checking parent-child relationships."),new Error("Circular Parent-Child dependency was found.");r=t[r].parentId}t[n.id].level=a}});const i=Object.values(t);return i.sort((n,r)=>n.level!==r.level?n.level-r.level:n.sortOrder-r.sortOrder),i}addTaskToTFF(e,t,i){let n=e.find(r=>r.file===t);n||(n={file:t,tasks:[]},e.push(n)),n.tasks.push(i)}}let We=null;function Is(s={}){if(!We)return We=new wf({baseUrl:s.baseUrl,token:s.token??"",checkPoint:s.checkPoint??0,username:s.username,password:s.password}),We;if(typeof s.token=="string"&&(We.token=s.token),typeof s.checkPoint=="number"&&(We.checkpoint=s.checkPoint),typeof s.username=="string"&&(We.username=s.username),typeof s.password=="string"&&(We.password=s.password),typeof s.baseUrl=="string"&&s.baseUrl.length>0){const e=s.baseUrl;We.apiUrl=`${We.apiProtocol}${e}${We.apiVersion}`,We.loginUrl=`${We.protocol}${e}${We.apiVersion}`,We.originUrl=`${We.protocol}${e}`}return We}const St="LOCK_TASKS";class Ef{constructor(e){this.initialized=!1,this.plugin=e}initialize(){try{const e=O().token;return e?(O().inboxID.length===0&&b.warn("Something is wrong with your inbox ID."),this.api=Is({baseUrl:O().baseURL,token:e,checkPoint:O().checkPoint}),this.cacheOperation=new rc(this.plugin.app,this.plugin),this.fileOperation=new ac(this.plugin.app,this.plugin),this.tickTickSync=new Tf(this.plugin.app,this.plugin),this.initialized=!0,!0):(b.debug("Please login from settings."),!1)}catch(e){b.error("Error on initialization: ",e)}return!1}backup(){var e;(e=this.tickTickSync)==null||e.backupTickTickAllResources()}async login(e,t,i){try{const n=Is({username:t,password:i,baseUrl:e,token:"",checkPoint:0}),r=await n.login();let a;if(!r){a=n.lastError;const c="Login Failed. "+JSON.stringify(a.errorMessage,null,4);throw new F.Notice(c,5e3),b.error("Login Fail!: ",c),new Error(a.errorMessage)}const o=O().defaultProjectId,l=O().defaultProjectName;return(!o||o==""||l=="Inbox"&&o!=r.inboxId)&&He({defaultProjectId:r.inboxId}),He({checkPoint:0}),await this.plugin.saveSettings(),r}catch(n){b.error("Error on login: ",n)}return null}async synchronization(){try{if(await It(St,async()=>await this.syncTickTickToObsidian()))return;await this.syncFiles(!1)}catch(e){b.error("Error on synchronization: ",e)}}async saveProjectsToCache(){var t;const e=await((t=this.api)==null?void 0:t.getProjects());return e?this.cacheOperation.saveProjectsToCache(e):!1}async getProjects(){return Zi()}async getTasks(e){return b.debug("getTasks",e),Ct()}async deletedTaskCheck(e){return await It(St,async()=>{var t;return(t=this.tickTickSync)==null?void 0:t.deletedTaskCheck(e)})}async deletedFileCheck(e){var i;const t=await((i=this.cacheOperation)==null?void 0:i.getFileMetadata(e,null));return!t||!t.TickTickTasks?!1:(await It(St,async()=>{await this.tickTickSync.deletedTaskCheck(e),await this.cacheOperation.deleteFilepathFromMetadata(e)}),!0)}async renamedFileCheck(e,t){var n;const i=await((n=this.cacheOperation)==null?void 0:n.getFileMetadata(t,null));return!i||!i.TickTickTasks?!1:(await It(St,async()=>{await this.tickTickSync.updateTaskContent(e),await this.cacheOperation.updateRenamedFilePath(t,e)}),!0)}async fullTextNewTaskCheck(e){await It(St,async()=>{var t;await((t=this.tickTickSync)==null?void 0:t.fullTextNewTaskCheck(e))})}async lineNewContentTaskCheck(e,t){return await It(St,async()=>{var i;await((i=this.tickTickSync)==null?void 0:i.lineNewContentTaskCheck(e,t))})}async lineModifiedTaskCheck(e,t,i){return await It(St,async()=>{var a;const n=this.plugin.app.vault.getAbstractFileByPath(e),r=new ni(this.plugin.app,this.plugin,n);return await r.init(),(a=this.tickTickSync)==null?void 0:a.lineModifiedTaskCheck(e,t,i,r)})}async checkDataBase(){var n,r;const e=this.plugin.app.vault,t=await((n=this.plugin.cacheOperation)==null?void 0:n.checkFileMetadata());b.debug(`checking metadata for ${t} files`),(!t||t<1)&&(b.debug("File Metadata rebuild."),e.getMarkdownFiles().forEach(o=>{var l;(l=this.tickTickSync)==null||l.fullTextModifiedTaskCheck(o.path)})),await this.plugin.saveSettings();const i=await((r=this.cacheOperation)==null?void 0:r.getFileMetadatas());b.debug("checking deleted tasks"),await It(St,async()=>{var a,o,l,c,d,g,h,u;for(const f in i){const p=i[f];for(const m of p.TickTickTasks){let v;try{v=(a=this.plugin.cacheOperation)==null?void 0:a.loadTaskFromCacheID(m.taskId)}catch(w){b.error("An error occurred while loading task cache: ",w)}if(!v)try{v=await((o=this.plugin.tickTickRestAPI)==null?void 0:o.getTaskById(m.taskId)),v&&v.deleted===1&&await((l=this.plugin.cacheOperation)==null?void 0:l.deleteTaskIdFromMetadata(f,m.taskId))}catch(w){if(w.message.includes("404")){await((c=this.plugin.cacheOperation)==null?void 0:c.deleteTaskIdFromMetadata(f,m.taskId));continue}else{b.error("An error occurred while loading task from api: ",w);continue}}}}await this.plugin.saveSettings(),b.debug("checking renamed files -- This operation takes a while, please be patient.");try{for(const f in i){b.debug("Checking Renamed: ",f);const p=i[f],m=this.plugin.taskParser.getObsidianUrlFromFilepath(f);for(const v of p.TickTickTasks){let w;try{w=(d=this.plugin.cacheOperation)==null?void 0:d.loadTaskFromCacheID(v.taskId)}catch(k){b.warn(`An error occurred while loading task ${v.taskId} from cache:`,k)}if(!w){b.warn(`Task ${v.id}: ${v.title} is not found.`);continue}if(!((w==null?void 0:w.title)??"").includes(m))try{await((g=this.tickTickSync)==null?void 0:g.updateTaskContent(f))}catch(k){b.warn("An error occurred while updating task description:",k)}}}b.debug("Done File Rename check.");try{b.debug("checking unsynced tasks");const f=e.getFiles();for(const p of f)if(p.extension=="md")try{if(b.debug(`Scanning file ${p.path}`),O().taskLinksInObsidian==="taskLink"&&await((h=this.plugin.fileOperation)==null?void 0:h.addTickTickLinkToFile(p.path)),O().enableFullVaultSync){const m=new ni(this.plugin.app,this.plugin,p);await m.init(),await((u=this.plugin.fileOperation)==null?void 0:u.addTickTickTagToFile(m))}}catch(m){b.error(`An error occurred while check new tasks in the file: ${p.path}`,m)}}catch(f){b.error("An error occurred while checking for unsynced tasks.:",f);return}new F.Notice("All files have been scanned.")}catch(f){b.warn("An error occurred while scanning the vault.:",f)}}),b.debug("Done checking data.")}async closeTask(e){await this.tickTickSync.closeTask(e)}async openTask(e){await this.tickTickSync.reopenTask(e)}async syncTickTickToObsidian(){return this.tickTickSync.syncTickTickToObsidian()}async syncFiles(e){var n,r,a;const t=O().fileMetadata;if(!t){b.warn("No sync files found.");return}let i=t;O().SyncProject&&(i=Object.fromEntries(Object.entries(t).filter(([o,l])=>l.defaultProjectId===O().SyncProject)));try{const o=(n=this.cacheOperation)==null?void 0:n.checkForDuplicates(i);if(o!=null&&o.duplicates&&JSON.stringify(o.duplicates)!="{}"){let c="";for(const g in o.duplicates)c+="Task: "+g+`
in files: 
`,o.duplicates[g].forEach(h=>{c+=h+`
`});const d=`Found duplicates in MetaData.

${c}
Please fix manually. This causes unpredictable results
Please open an issue in the TickTickSync repository if you continue to see this issue.

To prevent data corruption. Sync is aborted.`;b.error("Metadata Duplicates: ",o.duplicates),new F.Notice(d,5e3);return}const l=await((r=this.fileOperation)==null?void 0:r.checkForDuplicates(t,o==null?void 0:o.taskIds));if(l&&JSON.stringify(l)!="{}"){let c="";for(let g in l)c+="Task: "+g+`
Found in Files: 
`,l[g].forEach(h=>{c+=h+`
`});const d=document.createDocumentFragment();d.appendChild(document.createTextNode("Found duplicates in Files.                                                             ")),d.appendChild(document.createElement("br")),d.appendChild(document.createTextNode(`${c}`)),d.appendChild(document.createElement("br")),d.appendChild(document.createTextNode("Please fix manually to avoid unpredictable results.")),d.appendChild(document.createElement("br")),d.appendChild(document.createElement("br")),d.appendChild(document.createTextNode("Please open an issue in the TickTickSync repository if you continue to see this issue.")),d.appendChild(document.createElement("br")),d.appendChild(document.createElement("br")),d.appendChild(document.createTextNode("Sync is aborted to prevent data corruption.")),new F.Notice(d,0),b.error("Duplicates in file: ",c);return}}catch(o){b.error(o),new F.Notice(`Duplicate check failed:  ${Error}`,5e3);return}b.debug("New Files: ",i);for(const o in i)if(!this.plugin.app.vault.getAbstractFileByPath(o)){b.debug("File ",o," was deleted before last sync."),await((a=this.cacheOperation)==null?void 0:a.deleteFilepathFromMetadata(o));const c=i.findIndex(o);i.splice(c,1)}for(const o in i)O().debugMode&&b.debug(o),e&&await It(St,async()=>{var l;try{await((l=this.tickTickSync)==null?void 0:l.forceUpdates(o))}catch(c){b.error("An error occurred in fullTextNewTaskCheck:",c)}}),await It(St,async()=>{var l;try{await((l=this.tickTickSync)==null?void 0:l.fullTextNewTaskCheck(o))}catch(c){b.error("An error occurred in fullTextNewTaskCheck:",c)}}),await It(St,async()=>{var l;try{await((l=this.tickTickSync)==null?void 0:l.fullTextModifiedTaskCheck(o))}catch(c){b.error("An error occurred in fullTextModifiedTaskCheck:",c)}}),await It(St,async()=>{var l;try{await((l=this.tickTickSync)==null?void 0:l.deletedTaskCheck(o))}catch(c){b.error("An error occurred in deletedTaskCheck:",c)}})}}class Cf{constructor(e,t,i){if(this.app=e,this.plugin=t,this.token=O().token,this.baseURL=O().baseURL,!this.token||this.token==="")throw new F.Notice("Please login from Settings.",5e3),this.api=null,b.error("No Token"),new Error("API Not Initialized.");O().debugMode&&b.debug(JSON.stringify({baseUrl:this.baseURL,token:"["+this.token.substring(0,10)+"...] len: "+this.token.length})),i?this.api=i:(this.api=Is({baseUrl:O().baseURL,token:this.token,checkPoint:O().checkPoint}),this.api.inboxProperties={id:O().inboxID,sortOrder:0})}async initializeAPI(){var t,i,n,r,a;if(this.api===null||this.api===void 0)throw new Error("API Not Initialized. Please restart Obsidian.");let e=O().token;if(!e)try{if(await((t=this.api)==null?void 0:t.getUserSettings())){e=!0,await((i=this.api)==null?void 0:i.getInboxProperties());let l=!1;O().inboxID!=((n=this.api)==null?void 0:n.inboxId)&&(l=!0),O().defaultProjectId||He({defaultProjectId:(r=this.api)==null?void 0:r.inboxId,defaultProjectName:"Inbox"}),l&&await this.plugin.saveSettings()}else b.error((a=this.api)==null?void 0:a.lastError);e?O().debugMode&&b.debug(`Logged In: ${e}`):(new F.Notice("Login failed, please login through settings."),b.error("Login failed! "))}catch(o){b.error("Login failed! ",o),new F.Notice(`Login failed: ${o}
Please login again`)}finally{await this.plugin.saveSettings()}}async AddTask(e){var t;await this.initializeAPI();try{return await((t=this.api)==null?void 0:t.addTask(e))}catch(i){throw new Error(`Error adding task: ${i.message}`)}}async deleteTask(e,t){var i;await this.initializeAPI();try{return await((i=this.api)==null?void 0:i.deleteTask(e,t))}catch(n){throw new Error(`Error deleting task: ${n.message}`)}}async getProjectSections(e){var t;await this.initializeAPI();try{return await((t=this.api)==null?void 0:t.getProjectSections(e))}catch(i){throw new Error(`Error getting Sections: ${i.message}`)}}async GetActiveTasks(){var e;await this.initializeAPI();try{return await((e=this.api)==null?void 0:e.getTasks())}catch(t){throw new Error(`Error get active tasks: ${t.message}`)}}async UpdateTask(e){var t,i,n;await this.initializeAPI();try{let r={};const a=e.dateHolder,o=await((t=this.api)==null?void 0:t.updateTask(e));if(!o){b.error("Error","Update Failed.",(i=this.api)==null?void 0:i.lastError,e);const l="Error updating task: "+((n=this.api)==null?void 0:n.lastError);throw new Error(l)}return JSON.stringify(o.id2error)==="{}"&&(r=await this.getTaskById(e.id,e.projectId),r?r.dateHolder=a:b.error("Didn't get back the updated Task")),r}catch(r){throw new Error(`Error updating task: ${r.message}`)}}async modifyTaskStatus(e,t,i){var n,r;await this.initializeAPI();try{let a=await((n=this.api)==null?void 0:n.getTask(e,t));return a?(a.status=i,await((r=this.api)==null?void 0:r.updateTask(a))):!1}catch(a){b.error("Error modifying task:",a);return}}async OpenTask(e,t){await this.initializeAPI();try{this.modifyTaskStatus(e,t,0)}catch(i){b.error("Error open a task:",i);return}}async CloseTask(e,t){await this.initializeAPI();try{return this.modifyTaskStatus(e,t,2)}catch(i){throw b.error("Error closing task:",i),i}}async getTaskById(e,t){var i;if(await this.initializeAPI(),!e)throw new Error("taskId is required");try{return await((i=this.api)==null?void 0:i.getTask(e,t))}catch(n){if(n.response&&n.response.status){const r=n.response.status;throw new Error(`Error retrieving task. Status code: ${r}`)}else throw new Error(`Error retrieving task: ${n.message}`)}}async getTaskDueById(e){var t;if(await this.initializeAPI(),!e)throw new Error("taskId is required");try{const i=await((t=this.api)==null?void 0:t.getTask(e,null));return(i==null?void 0:i.dueDate)??null}catch(i){throw new Error(`Error get Task Due By ID: ${i.message}`)}}async GetAllProjects(){var e;await this.initializeAPI();try{return await((e=this.api)==null?void 0:e.getProjects())??[]}catch(t){return b.error("Error get all projects",t),[]}}async GetProjectGroups(){var e,t,i,n;await this.initializeAPI();try{const r=await((e=this.api)==null?void 0:e.getProjectGroups());if((r==null?void 0:r.length)==0&&((t=this.api)!=null&&t.lastError)&&((i=this.api)==null?void 0:i.lastError.statusCode)!=200){let a=(n=this.api)==null?void 0:n.lastError;throw b.error("Error: ",a.operation,a.statusCode,a.errorMessage),new Error(a.errorMessage)}return r}catch(r){return b.error("Error get project groups",r),new F.Notice("Unable to get project groups: "+r,5e3),!1}}async getUserResources(){var e;await this.initializeAPI();try{return await((e=this.api)==null?void 0:e.getUserSettings())}catch(t){return b.error("Error get user resources",t),[]}}async getAllCompletedItems(){var e;await this.initializeAPI();try{return await((e=this.api)==null?void 0:e.getAllCompletedItems())}catch(t){return b.error("Error get all completed items",t),[]}}async getAllResources(){var e;if(await this.initializeAPI(),!this.api)return b.error("getAllResources No API."),null;try{const t=await this.api.getAllResources();if(!t||this.api.lastError&&this.api.lastError.statusCode!=200)throw new Error("getAllResources No Results.");return O().checkPoint!=t.checkPoint&&(this.api.checkpoint=t.checkPoint,O().checkPoint=(e=this.api)==null?void 0:e.checkpoint,await this.plugin.saveSettings()),t}catch(t){b.error("Error get all resources",t)}return null}async getAllTasks(){var e,t;await this.initializeAPI();try{const i=await((e=this.api)==null?void 0:e.getTaskDetails());if(!i||i.length===0&&((t=this.api)==null?void 0:t.lastError.statusCode)!=200)throw new Error("No Results.");return i}catch(i){return b.error("Error get all Tasks",i),[]}}async exportData(){var t,i;await this.initializeAPI();const e=await((t=this.api)==null?void 0:t.exportData());if(!e){let n=JSON.stringify((i=this.api)==null?void 0:i.lastError);throw n=n.replace(/{/g,`
`).replace(/,/g,`
`),new Error(`Back up failed ${n}`)}return e}async moveTaskProject(e,t,i){var r,a,o;await this.initializeAPI(),await((r=this.api)==null?void 0:r.projectMove(e.id,t,i))||b.error("Project Moved Failed: ",(a=this.api)==null?void 0:a.lastError),await((o=this.api)==null?void 0:o.updateTask(e))}async moveTaskParent(e,t,i,n){var r,a;if(t){const o=this.plugin.cacheOperation.loadTaskFromCacheID(t);o!=null&&o.childIds&&o.childIds.length>0&&(o.childIds=o.childIds.filter(l=>l!==e)),await((r=this.api)==null?void 0:r.updateTask(o))}await((a=this.api)==null?void 0:a.parentMove(e,i,n))}}const Of=s=>{const e=new DataView(s);let t="";for(let i=0;i<e.byteLength;i+=4)t+=e.getUint32(i).toString(16).padStart(8,"0");return t},Af=s=>async(e,{outputFormat:t="hex"}={})=>{typeof e=="string"&&(e=new globalThis.TextEncoder().encode(e));const i=await globalThis.crypto.subtle.digest(s,e);return t==="hex"?Of(i):i},Nf=Af("SHA-256"),Qs={Highest:"",High:"",Medium:"",Low:"",Lowest:""},rn={TickTick_TAG:"#ticktick"},xo=[{ticktick:0,obsidian:null},{ticktick:0,obsidian:""},{ticktick:1,obsidian:""},{ticktick:3,obsidian:""},{ticktick:5,obsidian:""},{ticktick:5,obsidian:""}],$o=new RegExp("(?<=^|\\s)(#(?=[^\\s#.',;!?:]*[^\\d\\s#.',;!?:])[^\\s#.',;!?:]+)(?=[.,;!?:'\\s]|$)|(?<!`)```(?!`)","g"),Lf="^\\s*(-|\\*)\\s+\\[(x| )\\]\\s",Df=/^([\s\t>]*)/,Ff=/([-*+]|[0-9]+\.)/,xf=/\[(.)\]/u,$f=/ *(.*)/u,Mf=/ %%(.*)%%/u,Mo=new RegExp(Df.source+Ff.source+" +"+xf.source+$f.source,"u"),$e={TickTick_TAG:new RegExp(`^[\\s]*[-] \\[[x ]\\] [\\s\\S]*${rn.TickTick_TAG}[\\s\\S]*$`,"i"),TickTick_ID:/\[ticktick_id::\s*[\d\S]+\]/,TickTick_ID_NUM:/\[ticktick_id::\s*(.*?)\]/,TickTick_ID_DV_NUM:/ticktick_id(.*?)%/,TickTick_LINK:/\[link\]\(.*?\)/,PROJECT_NAME:/\[project::\s*(.*?)\]/,TASK_CONTENT:{REMOVE_PRIORITY:/[]/ug,REMOVE_TAGS:$o,REMOVE_SPACE:/^\s+|\s+$/g,REMOVE_INLINE_METADATA:/%%\[\w+::\s*\w+\]%%/,REMOVE_CHECKBOX:/^(-|\*)\s+\[(x|X| )\]\s/,REMOVE_CHECKBOX_WITH_INDENTATION:/^([ \t]*)?(-|\*)\s+\[(x|X| )\]\s/,REMOVE_TickTick_LINK:/\[link\]\(.*?\)/},ALL_TAGS:$o,TASK_CHECKBOX_CHECKED:/- \[(x|X)\] /,TASK_INDENTATION:/^(\s{2,}|\t)(-|\*)\s+\[(x|X| )\]/,TAB_INDENTATION:/^(\t+)/,priorityRegex:/^.*([]).*$/u,BLANK_LINE:/^\s*$/,ITEM_LINE:/\[(.*?)\]\s*(.*?)\s*%%(.*?)%%/,LINE_ITEM_ID:/%%(?!\[ticktick_id::\s)[a-f0-9]{24}%%/g};class jf{constructor(e,t){this.app=e,this.plugin=t}async convertTaskToLine(e,t){var r,a;let n="	".repeat(t);return e.title=this.stripOBSUrl(e.title),n+=`- [${e.status>0?"x":" "}] ${e.title}`,e.tags&&(n=this.addTagsToLine(n,e.tags)),n=this.addTickTickTag(n),O().taskLinksInObsidian==="taskLink"&&(n=this.addTickTickLink(n,e.id,e.projectId)),n=this.addTickTickId(n,e.id),n=this.addPriorityToLine(n,e),n=(r=this.plugin.dateMan)==null?void 0:r.addDatesToLine(n,e),(O().syncNotes||O().taskLinksInObsidian==="noteLink")&&((a=this.plugin.cacheOperation)==null||a.getFilepathForTask(e.id),this.plugin.taskParser.hasDescription(e)?n=this.addNote(n,e.desc,t,"Description",e.id,e.projectId):this.plugin.taskParser.hasNote(e)?n=this.addNote(n,e.content,t,"Note",e.id,e.projectId):O().taskLinksInObsidian==="noteLink"&&(n=this.addNote(n,e.content,t,"Note",e.id,e.projectId))),this.plugin.taskParser.hasItems(e)&&(n=this.addItems(n,e.items,t)),n}stripOBSUrl(e){let t=e;if(t){let i=e.lastIndexOf(".md)"),n=0;if(i>0){for(let r=i;r>0;r--)if(e[r]==="["){n=r;break}n>0&&(t=e.substring(0,n),t=t+e.substring(i+4))}}return t.trim()}getTaskContentFromLineText(e){var i;let t=e.replace($e.TASK_CONTENT.REMOVE_INLINE_METADATA,"").replace($e.TASK_CONTENT.REMOVE_TickTick_LINK,"").replace($e.TASK_CONTENT.REMOVE_PRIORITY,"").replace($e.TASK_CONTENT.REMOVE_TAGS,"").replace($e.TASK_CONTENT.REMOVE_CHECKBOX,"").replace($e.TASK_CONTENT.REMOVE_CHECKBOX_WITH_INDENTATION,"").replace($e.TASK_CONTENT.REMOVE_SPACE,"");return t=this.stripOBSUrl(t),t=(i=this.plugin.dateMan)==null?void 0:i.stripDatesFromLine(t),t}stripLineItemId(e){return e.replace($e.LINE_ITEM_ID,"")}addTagsToLine(e,t){const i=new RegExp(rn.TickTick_TAG.substring(1),"i");return t.forEach(n=>{n.match(i)||(n.includes("-")&&(n=n.replace(/-/g,"/")),e=e+" #"+n)}),e}async convertLineToTask(e,t,i,n,r){var D,q,W,R,Q,oe,ge;let a=!1,o=null,l=null,c=[];const d=this.getNumTabs(e);let g=this.removeTaskIndentation(e);const h=this.getTickTickId(g),u=(D=this.plugin.dateMan)==null?void 0:D.parseDates(g);let f;r?f=r:h?f=n.getTaskRecord(h):f=await n.getTaskRecordByLine(t);let p=null,m=null,v="",w="",y="";O().fileLinksInTickTick!=="noLink"&&i&&(y=this.plugin.taskParser.getObsidianUrlFromFilepath(i)),O().fileLinksInTickTick==="taskLink"&&(v=y),O().fileLinksInTickTick==="noteLink"&&(w=y+`
`),d>0&&(o=f.parentId,a=!0,l=(q=this.plugin.cacheOperation)==null?void 0:q.loadTaskFromCacheID(o));const k=n.getTaskItems(h);if(k&&k.length>0)for(const me in k)c.push(this.getItemFromLine(k[me]));if(f)if(f.taskLines.length>0){const me=this.getNoteString(f,h);let le=w+me;k&&k.length>0?p=le:m=le}else w&&(c.length>0?p=w:m=w);let E=Intl.DateTimeFormat().resolvedOptions().timeZone;const T=this.getAllTagsFromLineText(g);let S=await((W=this.plugin.cacheOperation)==null?void 0:W.getDefaultProjectIdForFilepath(i));if(a)l&&(S=l.projectId);else if(T)for(const me of T){let le=me.replace(/#/g,"");le=le.replace(/_/g," ");let Te=await((R=this.plugin.cacheOperation)==null?void 0:R.getProjectIdByNameFromCache(le));if(Te){S=Te;break}}const P=this.getTaskContentFromLineText(g);O().debugMode&&!S&&b.error("Converting line to Object, could not find project Id: ",P);const L=this.isTaskCheckboxChecked(g),A=this.getTaskPriority(g);let _=u!=null&&u.startDate?u==null?void 0:u.startDate.isoDate:u!=null&&u.scheduled_date?u==null?void 0:u.scheduled_date.isoDate:u!=null&&u.dueDate?u==null?void 0:u.dueDate.isoDate:"";return{id:h||"",projectId:S,title:P.trim()+" "+v,content:m||"",desc:p||"",items:c||[],parentId:o||"",dueDate:((Q=u==null?void 0:u.dueDate)==null?void 0:Q.isoDate)||"",startDate:_||"",completedTime:((oe=u==null?void 0:u.completedTime)==null?void 0:oe.isoDate)||"",isAllDay:(u==null?void 0:u.isAllDay)||!1,tags:T||[],priority:Number(A),modifiedTime:((ge=this.plugin.dateMan)==null?void 0:ge.formatDateToISO(new Date))||"",status:L?2:0,timeZone:E,dateHolder:u}}escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}getNoteString(e,t){let i="";if(e.taskLines){let n=[...e.taskLines];if(n.length>=2){const a=n[0],o=n[n.length-1],l=a.replace(/^\t*\s{2}/,"").trim(),c=o.replace(/^\t*\s{2}/,"").trim();l.length>0&&l===c&&(n=n.slice(1,-1))}let r;if(t){const a=new RegExp(`\\[link\\]\\(.*${this.escapeRegExp(t)}.*\\)`,"i");r=n.filter(o=>!a.test(o))}r?(r=r.map(a=>a.replace(/^\t*\s{2}|^\s{2}/g,"")),i=r.length>0?r.join(`
`):""):(n=n.map(a=>a.replace(/^\t*\s{2}|^\s{2}/g,"")),i=n.length>0?n.join(`
`):"")}return i}hasTickTickTag(e){return this.isMarkdownTask(e)?$e.TickTick_TAG.test(e):!1}hasTickTickId(e){let t=$e.TickTick_ID.test(e);return t||(t=$e.TickTick_ID_DV_NUM.test(e)),t}getLineItemId(e){if(!e){b.error("No Text passed to getLineItemId");return}let t=e.match($e.LINE_ITEM_ID),i;return t&&(i=t[0].slice(2,-2)),i}isTickTickTask(e){return this.hasTickTickId(e)}addTickTickId(e,t){return e=`${e} %%[ticktick_id:: ${t}]%%`,e}addChildToParent(e,t){return e.childIds||(e.childIds=[]),e.childIds.push(t),e}getProjectNameFromLineText(e){const t=$e.PROJECT_NAME.exec(e);return t?t[1]:null}getTickTickId(e){let t=$e.TickTick_ID_NUM.exec(e);return t||(t=$e.TickTick_ID_DV_NUM.exec(e)),t?t[1]:void 0}isTaskOpen(e){let t=new RegExp(Lf,"gmi").exec(e);if(t)return t[2].search(/[xX]/)<0;throw new Error(`Status not found in line: ${e}`)}getAllTagsFromLineText(e){let i=[...e.matchAll($e.ALL_TAGS)].map(n=>n[0].replace("#",""));return i=i.map(n=>n.replace(/\//g,"-")),i}isTaskCheckboxChecked(e){return $e.TASK_CHECKBOX_CHECKED.test(e)}isTitleChanged(e,t){const i=this.stripOBSUrl(e.title),n=this.stripOBSUrl(t.title);return!(i.trim()===n.trim())}isTagsChanged(e,t){const i=e.tags?e.tags:[],n=t.tags?t.tags:[];return!i&&!n?!1:i&&!n||!i&&n?!0:!(i.length===n.length&&i.sort().every((a,o)=>a===n.sort()[o]))}isStatusChanged(e,t){return!(e.status===t.status)}isParentIdChanged(e,t){let i=e.parentId?e.parentId:"",n=t.parentId?t.parentId:"";return i!=n}isChildrenChanged(e,t){return!e.childIds&&!t.childIds?!1:!e.childIds&&t.childIds||e.childIds&&!t.childIds?!0:(e==null?void 0:e.childIds.length)!=(t==null?void 0:t.childIds.length)}isProjectIdChanged(e,t){if(e.projectId!==t.projectId){b.debug("Project ID changed: ",e.projectId,t.projectId);const i=this.plugin.cacheOperation.getFilepathForTask(t.id);if(i)return this.plugin.cacheOperation.filepathHasDefaultProjectID(i)?!0:(b.debug("Task file does not have a default project: ",i),new F.Notice(`Task ${t.title} was moved in TickTick, but is in ${i}. Assuming that this is intentional and not moving it.`,1e4),!1)}else return!1}isIndentedTask(e){return $e.TASK_INDENTATION.test(e)}getNumTabs(e){const t=$e.TAB_INDENTATION.exec(e);return t?t[1].length:0}getTabs(e){const t=this.getNumTabs(e);let i="";for(let n=0;n<t;n++)i=i+"	";return i}getTaskPriority(e){let t="0";const i=e.match($e.priorityRegex);return i!==null&&(t=this.parsePriority(i[1])),t}removeTaskIndentation(e){const t=/^([ \t]*)?- \[(x| )\] /;return e.replace(t,"- [$2] ")}isLineBlank(e){return $e.BLANK_LINE.test(e)}isMarkdownTask(e){return e?Mo.test(e):!1}addTickTickTag(e){return e.charAt(e.length-1)===" "?e=e+`${rn.TickTick_TAG}`:e=e+` ${rn.TickTick_TAG} `,e}getObsidianUrlFromFilepath(e){const t=encodeURI(`obsidian://open?vault=${this.app.vault.getName()}&file=${e}`);return`[${e}](${t})`}addTickTickLink(e,t,i){let n=this.createURL(t,i);const r=new RegExp(`${rn.TickTick_TAG}`,"gi"),a=` [link](${n})`;return e.replace(r,a+" $&")}hasTickTickLink(e){return $e.TickTick_LINK.test(e)}createURL(e,t){let i="";return t?i=`https://${O().baseURL}/webapp/#p/${t}/tasks/${e}`:i=`https://${O().baseURL}/webapp/#q/all/tasks/${e}`,i}translateTickTickToObsidian(e){const t=xo.find(i=>i.ticktick===e);return t?t.obsidian:null}translateObsidianToTickTick(e){const t=xo.find(i=>i.obsidian===e);return t?t.ticktick:null}taskFromLine(e){let t=Mo.exec(e);if(!t)return null;const n=(t[3]||"")=="x";let r=t[4]||"";r=r.replace(Mf,"");let a=t[1]?t[1].length:0;return{line:e,status:n,description:r,indent:a}}getAllTags(){}async getLineHash(e){try{return await Nf(e)}catch(t){b.error("Hashing error.",t)}}hasNote(e){return e.content&&e.content.length>0}hasDescription(e){return e.desc&&e.desc.length>0}hasItems(e){return e.items&&e.items.length>0}areNotesChanged(e,t){if(e.length!==t.length)return!0;const i=e.split(`
`),n=t.split(`
`);for(let r=0;r<i.length;r++)if(i[r]!==n[r])return!0;return!1}areItemsChanged(e,t){if((e==null?void 0:e.length)!=(t==null?void 0:t.length))return!0;e.sort((i,n)=>i.id.localeCompare(n.id)),t.sort((i,n)=>i.id.localeCompare(n.id));for(let i=0;i<e.length;i++)if(e[i].id!==e[i].id||e[i].status!==e[i].status||e[i].title!==e[i].title)return!0}parsePriority(e){switch(e){case Qs.Lowest:return"0";case Qs.Low:return"1";case Qs.Medium:return"3";case Qs.High:return"5";case Qs.Highest:return"5";default:return"0"}}addItems(e,t,i){return t.forEach(n=>{let r=n.status>0?"- [x]":"- [ ]";const a="	".repeat(i+1);e=`${e} 
${a}${r} ${n.title} `,e=`${e} %%${n.id}%%`}),e}addNote(e,t,i,n,r,a){const o=`
`+"	".repeat(i)+"  ",l=O().noteDelimiter;if(l.length>0&&(e=`${e}${o}${l}`),O().taskLinksInObsidian==="noteLink"){const g=`[link](${this.createURL(r,a)})`;e=`${e}${o}${g}`}let c;t.length>0?(c=t.split(`
`),c.length>0&&c[c.length-1].length===0&&c.pop()):c=[];const d=new RegExp("\\[.*\\]\\(obsidian://open\\?vault=.*&file=.*\\)","giu");return c.forEach(g=>{g.search(d)<0&&(e=`${e}${o}${g}`)}),l.length>0&&(e=`${e}${o}${l}`),e}getItemFromLine(e){const t=$e.ITEM_LINE.exec(e);let i={};if(t){const n=t[1],r=t[2];i={id:t[3],title:r,status:n?0:2}}return i}addPriorityToLine(e,t){let i=this.translateTickTickToObsidian(t.priority);return i!=null&&(e=`${e} ${i}`),e}}class Rf extends F.Modal{constructor(e,t,i){super(e),this.filepath=i,this.plugin=t,this.open()}async onOpen(){const{contentEl:e}=this;e.empty(),e.createEl("h5",{text:"Set default project for TickTick tasks in the current file"}),this.defaultProjectId=await this.plugin.cacheOperation.getDefaultProjectIdForFilepath(this.filepath),this.defaultProjectName=await this.plugin.cacheOperation.getProjectNameByIdFromCache(this.defaultProjectId);const t=O().fileMetadata,i=Object.values(t).map(a=>a.defaultProjectId),r=Zi().filter(a=>!i.includes(a.id)).reduce((a,o)=>(a[o.id]=o.name,a),{});new F.Setting(e).setName("Default project").addDropdown(a=>a.addOption(this.defaultProjectId,this.defaultProjectName).addOption("","").addOptions(r).onChange(async o=>{var l;await((l=this.plugin.cacheOperation)==null?void 0:l.setDefaultProjectIdForFilepath(this.filepath,o)),await this.plugin.setStatusBarText(),this.close()}))}onClose(){const{contentEl:e}=this;e.empty()}}class Bf extends F.Modal{constructor(e,t,i){super(e),this.title="TicTickSync -- Latest Changes.",this.cancelLabel="Cancel",this.confirmLabel="Got it.",this.message="",this.intro="<p>The following are user experience affecting changes from prior versions of TickTickSync.</p><p><strong>Strongly</strong> recommend that you take a backup ASAP.</p>",this.notableChanges=t,this.onSubmit=i}onOpen(){const e="https://github.com/thesamim/TickTickSync/wiki/Notable-Changes#";let{titleEl:t,contentEl:i}=this;t.setText(this.title);let n=i.createEl("p");n.innerHTML=`${this.intro}`,n=i.createEl("ol"),this.notableChanges.forEach(r=>{let a=n.createEl("li");a.createEl("a",{href:`${e}${r[2]}`,text:`${r[0]}`});let o=a.createEl("ol");r[1].split(`
`).forEach(c=>{o.createEl("div",{text:`${c}`})})}),new F.Setting(i).addButton(r=>{r.setClass("ts_button"),r.setWarning(),r.setButtonText(this.confirmLabel),r.onClick(()=>{this.result=!0,this.onSubmit(this.result),this.close()})})}onClose(){this.titleEl.empty(),this.contentEl.empty(),super.onClose(),this.resolvePromise(this.result)}showModal(){return this.open(),new Promise(e=>this.resolvePromise=e)}}function Zt(s,e){const t=s.split("."),i=e.split(".");for(let n=0;n<Math.max(t.length,i.length);n++){const r=parseInt(t[n]||"0"),a=parseInt(i[n]||"0");if(r<a)return!0;if(r>a)return!1}return!1}const Uf="5";var ul;typeof window<"u"&&((ul=window.__svelte??(window.__svelte={})).v??(ul.v=new Set)).add(Uf);Mu();var qf=G('<div class="login-status-banner-actions"><br/> <br/> <br/></div>'),Hf=G('<div class="login-status-banner-actions"><br/>Mobile only allows Regular Login.<br/> <br/></div>'),Kf=G("<option> </option>"),Vf=G('<div class="card-section"><div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">SSO/2FA Login</div> <div class="setting-item-description"></div></div> <div class="setting-item-control"><button class="mod-cta ts_login_button"> </button></div></div></div>'),zf=G('<div class="access-control"><div class="login-status-banner"> <div class="login-status-banner-actions"><br/>Regardless of login option, TickTickSync will not save your User ID or your Password anywhere.<br/></div> <!></div> <div class="setting-item"><div class="setting-item-info"><div class="setting-item-name"> </div> <div class="setting-item-description">Select home server</div></div> <div class="setting-item-control"><select></select></div></div> <!> <div class="card-section"><div class="setting-item-info"><div class="setting-item-name">Regular Login</div> <div class="setting-item-description"></div></div> <div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Username</div> <div class="setting-item-description"> </div></div> <div class="setting-item-control"><input type="text" placeholder="Username"/></div></div> <div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Password</div> <div class="setting-item-description"> </div></div> <div class="setting-item-control"><input type="password" placeholder="Password"/></div></div> <div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Login</div> <div class="setting-item-description"> </div></div> <div class="setting-item-control"><button class="mod-cta ts_login_button">Login</button></div></div></div></div>');function Gf(s,e){gt(e,!1);const t=()=>Fn(Ke,"$settingsStore",i),[i,n]=xn();let r=Le(e,"plugin",12),a=!1;const o={"ticktick.com":"TickTick","dida365.com":"Dida365"};let l=z(),c=z(),d=z(),g=z(!1),h=z(!1),u=z(!1),f=z("");async function p(B){const te=t().inboxID;te&&te.length>0&&te!=B.inboxId&&new F.Notice("You are logged in with a different user ID."),Ke.update(Ce=>({...Ce,token:B.token,inboxID:B.inboxId,checkPoint:0})),He({token:B.token,inboxID:B.inboxId,inboxName:"Inbox",checkPoint:0}),x(h,!!t().token);const he=Is({baseUrl:t().baseURL,token:B.token,checkPoint:0});r().tickTickRestAPI&&r().tickTickRestAPI.api&&r(r().tickTickRestAPI.api=he,!0),r().service&&r(r().service.api=he,!0),await r().saveProjectsToCache(),await r().saveSettings(!0)}async function m(){if(x(g,!0),!t().baseURL||!I(l)||!I(c)){new F.Notice("Please fill in both Username and Password"),x(g,!1);return}try{const B=await r().service.login(I(d),I(l),I(c));if(!B){new F.Notice("Login Failed. "),await p({inboxId:null,token:null}),x(g,!1);return}await p(B)}catch(B){await p({inboxId:null,token:null}),b.error("Authentication error:",B)}x(g,!1)}async function v(){if(!a){a=!0,x(g,!0);try{new F.Notice("Opening login...");const B=F.Platform.isAndroidApp||F.Platform.isIosApp;let te=null;if(F.Platform.isDesktopApp){const{DesktopAuth:V}=await Promise.resolve().then(()=>Fm);te=await new V(r(),I(d)).authenticate()}else B&&new F.Notice("Mobile only allows for Regular Login.",5e3);if(!(te!=null&&te.value))throw new Error("No cookie received.");const he=Is({username:"",password:"",baseUrl:t().baseURL,token:te.value,checkPoint:0});r().tickTickRestAPI&&r(r().tickTickRestAPI.api=he,!0),r(r().service.api=he,!0);const Ce=await he.getUserStatus();if(!Ce)throw new Error("Failed to verify login with API.");await p(Ce),new F.Notice("Login successful.")}catch(B){new F.Notice("Login failed: "+((B==null?void 0:B.message)||B),5e3),await p({inboxId:null,token:null}),b.error("Authentication error:",B)}finally{x(g,!1),a=!1}}}Ks(async()=>{x(h,!!t().token),x(d,t().baseURL),x(u,F.Platform.isDesktopApp),x(f,o[I(d)]||"Not Selected")}),wt();var w=zf(),y=N(w),k=N(y),E=$(k,3);{var T=B=>{var te=qf(),he=$(N(te)),Ce=$(he,2);ae(()=>{ne(he,`If your ${I(f)??""} account is set up with SSO/2FA, login using SSO/2FA.`),ne(Ce,`If
				your ${I(f)??""} account set up with a username and password, login using Regular Login.`)}),U(B,te)},S=B=>{var te=Hf(),he=$(N(te),3);ae(()=>ne(he,` If your ${I(f)??""} account is set up with SSO/2FA, please login from desktop first,
				synchronize your vault to this device and you will be logged in.`)),U(B,te)};Oe(E,B=>{I(u)?B(T):B(S,!1)})}var P=$(y,2),L=N(P),A=N(L),_=N(A),C=$(L,2),D=N(C);Rt(D,5,()=>ee(()=>Object.entries(o)),jt,(B,te)=>{var he=$i(()=>Fi(I(te),2));let Ce=()=>I(he)[0],V=()=>I(he)[1];var ye=Kf(),Ae=N(ye),Ne={};ae(()=>{ne(Ae,V()),Ne!==(Ne=Ce())&&(ye.value=(ye.__value=Ce())??"")}),U(B,ye)});var q;qa(D);var W=$(P,2);{var R=B=>{var te=Vf(),he=N(te),Ce=$(N(he),2),V=N(Ce),ye=N(V);ae(()=>{V.disabled=I(g),ne(ye,`Login with ${I(f)??""}`)}),pe("click",V,v),U(B,te)};Oe(W,B=>{I(u)&&B(R)})}var Q=$(W,2),oe=$(N(Q),2),ge=N(oe),me=$(N(ge),2),le=N(me),Te=$(ge,2),se=N(Te),ve=$(oe,2),K=N(ve),ke=$(N(K),2),H=N(ke),ue=$(K,2),qe=N(ue),j=$(ve,2),Ee=N(j),Be=$(N(Ee),2),Qe=N(Be),Tt=$(Ee,2),fe=N(Tt);ae(B=>{ne(k,`${I(h)?"You are logged in. You can re-login here.":"Please login here."} `),ne(_,I(f)),D.disabled=I(g),q!==(q=B)&&(D.value=(D.__value=B)??"",Ar(D,B)),ne(le,`Your ${I(f)??""} account username`),ne(H,`Your ${I(f)??""} account password`),ne(Qe,I(h)?"You are logged in. You can re-login here.":"Please login here."),fe.disabled=I(g)},[()=>(Yt(O),ee(()=>O().baseURL))]),pe("change",D,async B=>{if(x(d,B.target.value),x(f,o[I(d)]),Gd(Ke,ee(t).baseURL=I(d),ee(t)),He({baseURL:I(d)}),t().token){const te=Is({baseUrl:I(d),token:t().token,checkPoint:t().checkPoint??0});r().tickTickRestAPI&&r(r().tickTickRestAPI.api=te,!0),r(r().service.api=te,!0)}await r().saveSettings()}),Ls(se,()=>I(l),B=>x(l,B)),Ls(qe,()=>I(c),B=>x(c,B)),pe("click",fe,m),U(s,w),mt(),n()}var ft="top",Bt="bottom",Ut="right",ht="left",Ka="auto",Mn=[ft,Bt,Ut,ht],Ds="start",mn="end",Wf="clippingParents",oc="viewport",Zs="popper",Yf="reference",jo=Mn.reduce(function(s,e){return s.concat([e+"-"+Ds,e+"-"+mn])},[]),lc=[].concat(Mn,[Ka]).reduce(function(s,e){return s.concat([e,e+"-"+Ds,e+"-"+mn])},[]),Jf="beforeRead",Xf="read",Qf="afterRead",Zf="beforeMain",eh="main",th="afterMain",ih="beforeWrite",sh="write",nh="afterWrite",rh=[Jf,Xf,Qf,Zf,eh,th,ih,sh,nh];function ci(s){return s?(s.nodeName||"").toLowerCase():null}function bt(s){if(s==null)return window;if(s.toString()!=="[object Window]"){var e=s.ownerDocument;return e&&e.defaultView||window}return s}function is(s){var e=bt(s).Element;return s instanceof e||s instanceof Element}function Ft(s){var e=bt(s).HTMLElement;return s instanceof e||s instanceof HTMLElement}function Va(s){if(typeof ShadowRoot>"u")return!1;var e=bt(s).ShadowRoot;return s instanceof e||s instanceof ShadowRoot}function ah(s){var e=s.state;Object.keys(e.elements).forEach(function(t){var i=e.styles[t]||{},n=e.attributes[t]||{},r=e.elements[t];!Ft(r)||!ci(r)||(Object.assign(r.style,i),Object.keys(n).forEach(function(a){var o=n[a];o===!1?r.removeAttribute(a):r.setAttribute(a,o===!0?"":o)}))})}function oh(s){var e=s.state,t={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,t.popper),e.styles=t,e.elements.arrow&&Object.assign(e.elements.arrow.style,t.arrow),function(){Object.keys(e.elements).forEach(function(i){var n=e.elements[i],r=e.attributes[i]||{},a=Object.keys(e.styles.hasOwnProperty(i)?e.styles[i]:t[i]),o=a.reduce(function(l,c){return l[c]="",l},{});!Ft(n)||!ci(n)||(Object.assign(n.style,o),Object.keys(r).forEach(function(l){n.removeAttribute(l)}))})}}const lh={name:"applyStyles",enabled:!0,phase:"write",fn:ah,effect:oh,requires:["computeStyles"]};function oi(s){return s.split("-")[0]}var es=Math.max,gr=Math.min,Fs=Math.round;function wa(){var s=navigator.userAgentData;return s!=null&&s.brands&&Array.isArray(s.brands)?s.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function cc(){return!/^((?!chrome|android).)*safari/i.test(wa())}function xs(s,e,t){e===void 0&&(e=!1),t===void 0&&(t=!1);var i=s.getBoundingClientRect(),n=1,r=1;e&&Ft(s)&&(n=s.offsetWidth>0&&Fs(i.width)/s.offsetWidth||1,r=s.offsetHeight>0&&Fs(i.height)/s.offsetHeight||1);var a=is(s)?bt(s):window,o=a.visualViewport,l=!cc()&&t,c=(i.left+(l&&o?o.offsetLeft:0))/n,d=(i.top+(l&&o?o.offsetTop:0))/r,g=i.width/n,h=i.height/r;return{width:g,height:h,top:d,right:c+g,bottom:d+h,left:c,x:c,y:d}}function za(s){var e=xs(s),t=s.offsetWidth,i=s.offsetHeight;return Math.abs(e.width-t)<=1&&(t=e.width),Math.abs(e.height-i)<=1&&(i=e.height),{x:s.offsetLeft,y:s.offsetTop,width:t,height:i}}function uc(s,e){var t=e.getRootNode&&e.getRootNode();if(s.contains(e))return!0;if(t&&Va(t)){var i=e;do{if(i&&s.isSameNode(i))return!0;i=i.parentNode||i.host}while(i)}return!1}function vi(s){return bt(s).getComputedStyle(s)}function ch(s){return["table","td","th"].indexOf(ci(s))>=0}function ji(s){return((is(s)?s.ownerDocument:s.document)||window.document).documentElement}function Nr(s){return ci(s)==="html"?s:s.assignedSlot||s.parentNode||(Va(s)?s.host:null)||ji(s)}function Ro(s){return!Ft(s)||vi(s).position==="fixed"?null:s.offsetParent}function uh(s){var e=/firefox/i.test(wa()),t=/Trident/i.test(wa());if(t&&Ft(s)){var i=vi(s);if(i.position==="fixed")return null}var n=Nr(s);for(Va(n)&&(n=n.host);Ft(n)&&["html","body"].indexOf(ci(n))<0;){var r=vi(n);if(r.transform!=="none"||r.perspective!=="none"||r.contain==="paint"||["transform","perspective"].indexOf(r.willChange)!==-1||e&&r.willChange==="filter"||e&&r.filter&&r.filter!=="none")return n;n=n.parentNode}return null}function jn(s){for(var e=bt(s),t=Ro(s);t&&ch(t)&&vi(t).position==="static";)t=Ro(t);return t&&(ci(t)==="html"||ci(t)==="body"&&vi(t).position==="static")?e:t||uh(s)||e}function Ga(s){return["top","bottom"].indexOf(s)>=0?"x":"y"}function un(s,e,t){return es(s,gr(e,t))}function dh(s,e,t){var i=un(s,e,t);return i>t?t:i}function dc(){return{top:0,right:0,bottom:0,left:0}}function fc(s){return Object.assign({},dc(),s)}function hc(s,e){return e.reduce(function(t,i){return t[i]=s,t},{})}var fh=function(e,t){return e=typeof e=="function"?e(Object.assign({},t.rects,{placement:t.placement})):e,fc(typeof e!="number"?e:hc(e,Mn))};function hh(s){var e,t=s.state,i=s.name,n=s.options,r=t.elements.arrow,a=t.modifiersData.popperOffsets,o=oi(t.placement),l=Ga(o),c=[ht,Ut].indexOf(o)>=0,d=c?"height":"width";if(!(!r||!a)){var g=fh(n.padding,t),h=za(r),u=l==="y"?ft:ht,f=l==="y"?Bt:Ut,p=t.rects.reference[d]+t.rects.reference[l]-a[l]-t.rects.popper[d],m=a[l]-t.rects.reference[l],v=jn(r),w=v?l==="y"?v.clientHeight||0:v.clientWidth||0:0,y=p/2-m/2,k=g[u],E=w-h[d]-g[f],T=w/2-h[d]/2+y,S=un(k,T,E),P=l;t.modifiersData[i]=(e={},e[P]=S,e.centerOffset=S-T,e)}}function ph(s){var e=s.state,t=s.options,i=t.element,n=i===void 0?"[data-popper-arrow]":i;n!=null&&(typeof n=="string"&&(n=e.elements.popper.querySelector(n),!n)||uc(e.elements.popper,n)&&(e.elements.arrow=n))}const gh={name:"arrow",enabled:!0,phase:"main",fn:hh,effect:ph,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function $s(s){return s.split("-")[1]}var mh={top:"auto",right:"auto",bottom:"auto",left:"auto"};function vh(s,e){var t=s.x,i=s.y,n=e.devicePixelRatio||1;return{x:Fs(t*n)/n||0,y:Fs(i*n)/n||0}}function Bo(s){var e,t=s.popper,i=s.popperRect,n=s.placement,r=s.variation,a=s.offsets,o=s.position,l=s.gpuAcceleration,c=s.adaptive,d=s.roundOffsets,g=s.isFixed,h=a.x,u=h===void 0?0:h,f=a.y,p=f===void 0?0:f,m=typeof d=="function"?d({x:u,y:p}):{x:u,y:p};u=m.x,p=m.y;var v=a.hasOwnProperty("x"),w=a.hasOwnProperty("y"),y=ht,k=ft,E=window;if(c){var T=jn(t),S="clientHeight",P="clientWidth";if(T===bt(t)&&(T=ji(t),vi(T).position!=="static"&&o==="absolute"&&(S="scrollHeight",P="scrollWidth")),T=T,n===ft||(n===ht||n===Ut)&&r===mn){k=Bt;var L=g&&T===E&&E.visualViewport?E.visualViewport.height:T[S];p-=L-i.height,p*=l?1:-1}if(n===ht||(n===ft||n===Bt)&&r===mn){y=Ut;var A=g&&T===E&&E.visualViewport?E.visualViewport.width:T[P];u-=A-i.width,u*=l?1:-1}}var _=Object.assign({position:o},c&&mh),C=d===!0?vh({x:u,y:p},bt(t)):{x:u,y:p};if(u=C.x,p=C.y,l){var D;return Object.assign({},_,(D={},D[k]=w?"0":"",D[y]=v?"0":"",D.transform=(E.devicePixelRatio||1)<=1?"translate("+u+"px, "+p+"px)":"translate3d("+u+"px, "+p+"px, 0)",D))}return Object.assign({},_,(e={},e[k]=w?p+"px":"",e[y]=v?u+"px":"",e.transform="",e))}function kh(s){var e=s.state,t=s.options,i=t.gpuAcceleration,n=i===void 0?!0:i,r=t.adaptive,a=r===void 0?!0:r,o=t.roundOffsets,l=o===void 0?!0:o,c={placement:oi(e.placement),variation:$s(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:n,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,Bo(Object.assign({},c,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:a,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,Bo(Object.assign({},c,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const yh={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:kh,data:{}};var Vn={passive:!0};function bh(s){var e=s.state,t=s.instance,i=s.options,n=i.scroll,r=n===void 0?!0:n,a=i.resize,o=a===void 0?!0:a,l=bt(e.elements.popper),c=[].concat(e.scrollParents.reference,e.scrollParents.popper);return r&&c.forEach(function(d){d.addEventListener("scroll",t.update,Vn)}),o&&l.addEventListener("resize",t.update,Vn),function(){r&&c.forEach(function(d){d.removeEventListener("scroll",t.update,Vn)}),o&&l.removeEventListener("resize",t.update,Vn)}}const wh={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:bh,data:{}};var Th={left:"right",right:"left",bottom:"top",top:"bottom"};function sr(s){return s.replace(/left|right|bottom|top/g,function(e){return Th[e]})}var _h={start:"end",end:"start"};function Uo(s){return s.replace(/start|end/g,function(e){return _h[e]})}function Wa(s){var e=bt(s),t=e.pageXOffset,i=e.pageYOffset;return{scrollLeft:t,scrollTop:i}}function Ya(s){return xs(ji(s)).left+Wa(s).scrollLeft}function Ih(s,e){var t=bt(s),i=ji(s),n=t.visualViewport,r=i.clientWidth,a=i.clientHeight,o=0,l=0;if(n){r=n.width,a=n.height;var c=cc();(c||!c&&e==="fixed")&&(o=n.offsetLeft,l=n.offsetTop)}return{width:r,height:a,x:o+Ya(s),y:l}}function Sh(s){var e,t=ji(s),i=Wa(s),n=(e=s.ownerDocument)==null?void 0:e.body,r=es(t.scrollWidth,t.clientWidth,n?n.scrollWidth:0,n?n.clientWidth:0),a=es(t.scrollHeight,t.clientHeight,n?n.scrollHeight:0,n?n.clientHeight:0),o=-i.scrollLeft+Ya(s),l=-i.scrollTop;return vi(n||t).direction==="rtl"&&(o+=es(t.clientWidth,n?n.clientWidth:0)-r),{width:r,height:a,x:o,y:l}}function Ja(s){var e=vi(s),t=e.overflow,i=e.overflowX,n=e.overflowY;return/auto|scroll|overlay|hidden/.test(t+n+i)}function pc(s){return["html","body","#document"].indexOf(ci(s))>=0?s.ownerDocument.body:Ft(s)&&Ja(s)?s:pc(Nr(s))}function dn(s,e){var t;e===void 0&&(e=[]);var i=pc(s),n=i===((t=s.ownerDocument)==null?void 0:t.body),r=bt(i),a=n?[r].concat(r.visualViewport||[],Ja(i)?i:[]):i,o=e.concat(a);return n?o:o.concat(dn(Nr(a)))}function Ta(s){return Object.assign({},s,{left:s.x,top:s.y,right:s.x+s.width,bottom:s.y+s.height})}function Ph(s,e){var t=xs(s,!1,e==="fixed");return t.top=t.top+s.clientTop,t.left=t.left+s.clientLeft,t.bottom=t.top+s.clientHeight,t.right=t.left+s.clientWidth,t.width=s.clientWidth,t.height=s.clientHeight,t.x=t.left,t.y=t.top,t}function qo(s,e,t){return e===oc?Ta(Ih(s,t)):is(e)?Ph(e,t):Ta(Sh(ji(s)))}function Eh(s){var e=dn(Nr(s)),t=["absolute","fixed"].indexOf(vi(s).position)>=0,i=t&&Ft(s)?jn(s):s;return is(i)?e.filter(function(n){return is(n)&&uc(n,i)&&ci(n)!=="body"}):[]}function Ch(s,e,t,i){var n=e==="clippingParents"?Eh(s):[].concat(e),r=[].concat(n,[t]),a=r[0],o=r.reduce(function(l,c){var d=qo(s,c,i);return l.top=es(d.top,l.top),l.right=gr(d.right,l.right),l.bottom=gr(d.bottom,l.bottom),l.left=es(d.left,l.left),l},qo(s,a,i));return o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}function gc(s){var e=s.reference,t=s.element,i=s.placement,n=i?oi(i):null,r=i?$s(i):null,a=e.x+e.width/2-t.width/2,o=e.y+e.height/2-t.height/2,l;switch(n){case ft:l={x:a,y:e.y-t.height};break;case Bt:l={x:a,y:e.y+e.height};break;case Ut:l={x:e.x+e.width,y:o};break;case ht:l={x:e.x-t.width,y:o};break;default:l={x:e.x,y:e.y}}var c=n?Ga(n):null;if(c!=null){var d=c==="y"?"height":"width";switch(r){case Ds:l[c]=l[c]-(e[d]/2-t[d]/2);break;case mn:l[c]=l[c]+(e[d]/2-t[d]/2);break}}return l}function vn(s,e){e===void 0&&(e={});var t=e,i=t.placement,n=i===void 0?s.placement:i,r=t.strategy,a=r===void 0?s.strategy:r,o=t.boundary,l=o===void 0?Wf:o,c=t.rootBoundary,d=c===void 0?oc:c,g=t.elementContext,h=g===void 0?Zs:g,u=t.altBoundary,f=u===void 0?!1:u,p=t.padding,m=p===void 0?0:p,v=fc(typeof m!="number"?m:hc(m,Mn)),w=h===Zs?Yf:Zs,y=s.rects.popper,k=s.elements[f?w:h],E=Ch(is(k)?k:k.contextElement||ji(s.elements.popper),l,d,a),T=xs(s.elements.reference),S=gc({reference:T,element:y,placement:n}),P=Ta(Object.assign({},y,S)),L=h===Zs?P:T,A={top:E.top-L.top+v.top,bottom:L.bottom-E.bottom+v.bottom,left:E.left-L.left+v.left,right:L.right-E.right+v.right},_=s.modifiersData.offset;if(h===Zs&&_){var C=_[n];Object.keys(A).forEach(function(D){var q=[Ut,Bt].indexOf(D)>=0?1:-1,W=[ft,Bt].indexOf(D)>=0?"y":"x";A[D]+=C[W]*q})}return A}function Oh(s,e){e===void 0&&(e={});var t=e,i=t.placement,n=t.boundary,r=t.rootBoundary,a=t.padding,o=t.flipVariations,l=t.allowedAutoPlacements,c=l===void 0?lc:l,d=$s(i),g=d?o?jo:jo.filter(function(f){return $s(f)===d}):Mn,h=g.filter(function(f){return c.indexOf(f)>=0});h.length===0&&(h=g);var u=h.reduce(function(f,p){return f[p]=vn(s,{placement:p,boundary:n,rootBoundary:r,padding:a})[oi(p)],f},{});return Object.keys(u).sort(function(f,p){return u[f]-u[p]})}function Ah(s){if(oi(s)===Ka)return[];var e=sr(s);return[Uo(s),e,Uo(e)]}function Nh(s){var e=s.state,t=s.options,i=s.name;if(!e.modifiersData[i]._skip){for(var n=t.mainAxis,r=n===void 0?!0:n,a=t.altAxis,o=a===void 0?!0:a,l=t.fallbackPlacements,c=t.padding,d=t.boundary,g=t.rootBoundary,h=t.altBoundary,u=t.flipVariations,f=u===void 0?!0:u,p=t.allowedAutoPlacements,m=e.options.placement,v=oi(m),w=v===m,y=l||(w||!f?[sr(m)]:Ah(m)),k=[m].concat(y).reduce(function(ve,K){return ve.concat(oi(K)===Ka?Oh(e,{placement:K,boundary:d,rootBoundary:g,padding:c,flipVariations:f,allowedAutoPlacements:p}):K)},[]),E=e.rects.reference,T=e.rects.popper,S=new Map,P=!0,L=k[0],A=0;A<k.length;A++){var _=k[A],C=oi(_),D=$s(_)===Ds,q=[ft,Bt].indexOf(C)>=0,W=q?"width":"height",R=vn(e,{placement:_,boundary:d,rootBoundary:g,altBoundary:h,padding:c}),Q=q?D?Ut:ht:D?Bt:ft;E[W]>T[W]&&(Q=sr(Q));var oe=sr(Q),ge=[];if(r&&ge.push(R[C]<=0),o&&ge.push(R[Q]<=0,R[oe]<=0),ge.every(function(ve){return ve})){L=_,P=!1;break}S.set(_,ge)}if(P)for(var me=f?3:1,le=function(K){var ke=k.find(function(H){var ue=S.get(H);if(ue)return ue.slice(0,K).every(function(qe){return qe})});if(ke)return L=ke,"break"},Te=me;Te>0;Te--){var se=le(Te);if(se==="break")break}e.placement!==L&&(e.modifiersData[i]._skip=!0,e.placement=L,e.reset=!0)}}const Lh={name:"flip",enabled:!0,phase:"main",fn:Nh,requiresIfExists:["offset"],data:{_skip:!1}};function Ho(s,e,t){return t===void 0&&(t={x:0,y:0}),{top:s.top-e.height-t.y,right:s.right-e.width+t.x,bottom:s.bottom-e.height+t.y,left:s.left-e.width-t.x}}function Ko(s){return[ft,Ut,Bt,ht].some(function(e){return s[e]>=0})}function Dh(s){var e=s.state,t=s.name,i=e.rects.reference,n=e.rects.popper,r=e.modifiersData.preventOverflow,a=vn(e,{elementContext:"reference"}),o=vn(e,{altBoundary:!0}),l=Ho(a,i),c=Ho(o,n,r),d=Ko(l),g=Ko(c);e.modifiersData[t]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:d,hasPopperEscaped:g},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":d,"data-popper-escaped":g})}const Fh={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:Dh};function xh(s,e,t){var i=oi(s),n=[ht,ft].indexOf(i)>=0?-1:1,r=typeof t=="function"?t(Object.assign({},e,{placement:s})):t,a=r[0],o=r[1];return a=a||0,o=(o||0)*n,[ht,Ut].indexOf(i)>=0?{x:o,y:a}:{x:a,y:o}}function $h(s){var e=s.state,t=s.options,i=s.name,n=t.offset,r=n===void 0?[0,0]:n,a=lc.reduce(function(d,g){return d[g]=xh(g,e.rects,r),d},{}),o=a[e.placement],l=o.x,c=o.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=c),e.modifiersData[i]=a}const Mh={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:$h};function jh(s){var e=s.state,t=s.name;e.modifiersData[t]=gc({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const Rh={name:"popperOffsets",enabled:!0,phase:"read",fn:jh,data:{}};function Bh(s){return s==="x"?"y":"x"}function Uh(s){var e=s.state,t=s.options,i=s.name,n=t.mainAxis,r=n===void 0?!0:n,a=t.altAxis,o=a===void 0?!1:a,l=t.boundary,c=t.rootBoundary,d=t.altBoundary,g=t.padding,h=t.tether,u=h===void 0?!0:h,f=t.tetherOffset,p=f===void 0?0:f,m=vn(e,{boundary:l,rootBoundary:c,padding:g,altBoundary:d}),v=oi(e.placement),w=$s(e.placement),y=!w,k=Ga(v),E=Bh(k),T=e.modifiersData.popperOffsets,S=e.rects.reference,P=e.rects.popper,L=typeof p=="function"?p(Object.assign({},e.rects,{placement:e.placement})):p,A=typeof L=="number"?{mainAxis:L,altAxis:L}:Object.assign({mainAxis:0,altAxis:0},L),_=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,C={x:0,y:0};if(T){if(r){var D,q=k==="y"?ft:ht,W=k==="y"?Bt:Ut,R=k==="y"?"height":"width",Q=T[k],oe=Q+m[q],ge=Q-m[W],me=u?-P[R]/2:0,le=w===Ds?S[R]:P[R],Te=w===Ds?-P[R]:-S[R],se=e.elements.arrow,ve=u&&se?za(se):{width:0,height:0},K=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:dc(),ke=K[q],H=K[W],ue=un(0,S[R],ve[R]),qe=y?S[R]/2-me-ue-ke-A.mainAxis:le-ue-ke-A.mainAxis,j=y?-S[R]/2+me+ue+H+A.mainAxis:Te+ue+H+A.mainAxis,Ee=e.elements.arrow&&jn(e.elements.arrow),Be=Ee?k==="y"?Ee.clientTop||0:Ee.clientLeft||0:0,Qe=(D=_==null?void 0:_[k])!=null?D:0,Tt=Q+qe-Qe-Be,fe=Q+j-Qe,B=un(u?gr(oe,Tt):oe,Q,u?es(ge,fe):ge);T[k]=B,C[k]=B-Q}if(o){var te,he=k==="x"?ft:ht,Ce=k==="x"?Bt:Ut,V=T[E],ye=E==="y"?"height":"width",Ae=V+m[he],Ne=V-m[Ce],Fe=[ft,ht].indexOf(v)!==-1,Ve=(te=_==null?void 0:_[E])!=null?te:0,ot=Fe?Ae:V-S[ye]-P[ye]-Ve+A.altAxis,_t=Fe?V+S[ye]+P[ye]-Ve-A.altAxis:Ne,Ue=u&&Fe?dh(ot,V,_t):un(u?ot:Ae,V,u?_t:Ne);T[E]=Ue,C[E]=Ue-V}e.modifiersData[i]=C}}const qh={name:"preventOverflow",enabled:!0,phase:"main",fn:Uh,requiresIfExists:["offset"]};function Hh(s){return{scrollLeft:s.scrollLeft,scrollTop:s.scrollTop}}function Kh(s){return s===bt(s)||!Ft(s)?Wa(s):Hh(s)}function Vh(s){var e=s.getBoundingClientRect(),t=Fs(e.width)/s.offsetWidth||1,i=Fs(e.height)/s.offsetHeight||1;return t!==1||i!==1}function zh(s,e,t){t===void 0&&(t=!1);var i=Ft(e),n=Ft(e)&&Vh(e),r=ji(e),a=xs(s,n,t),o={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(i||!i&&!t)&&((ci(e)!=="body"||Ja(r))&&(o=Kh(e)),Ft(e)?(l=xs(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):r&&(l.x=Ya(r))),{x:a.left+o.scrollLeft-l.x,y:a.top+o.scrollTop-l.y,width:a.width,height:a.height}}function Gh(s){var e=new Map,t=new Set,i=[];s.forEach(function(r){e.set(r.name,r)});function n(r){t.add(r.name);var a=[].concat(r.requires||[],r.requiresIfExists||[]);a.forEach(function(o){if(!t.has(o)){var l=e.get(o);l&&n(l)}}),i.push(r)}return s.forEach(function(r){t.has(r.name)||n(r)}),i}function Wh(s){var e=Gh(s);return rh.reduce(function(t,i){return t.concat(e.filter(function(n){return n.phase===i}))},[])}function Yh(s){var e;return function(){return e||(e=new Promise(function(t){Promise.resolve().then(function(){e=void 0,t(s())})})),e}}function Jh(s){var e=s.reduce(function(t,i){var n=t[i.name];return t[i.name]=n?Object.assign({},n,i,{options:Object.assign({},n.options,i.options),data:Object.assign({},n.data,i.data)}):i,t},{});return Object.keys(e).map(function(t){return e[t]})}var Vo={placement:"bottom",modifiers:[],strategy:"absolute"};function zo(){for(var s=arguments.length,e=new Array(s),t=0;t<s;t++)e[t]=arguments[t];return!e.some(function(i){return!(i&&typeof i.getBoundingClientRect=="function")})}function Xh(s){s===void 0&&(s={});var e=s,t=e.defaultModifiers,i=t===void 0?[]:t,n=e.defaultOptions,r=n===void 0?Vo:n;return function(o,l,c){c===void 0&&(c=r);var d={placement:"bottom",orderedModifiers:[],options:Object.assign({},Vo,r),modifiersData:{},elements:{reference:o,popper:l},attributes:{},styles:{}},g=[],h=!1,u={state:d,setOptions:function(v){var w=typeof v=="function"?v(d.options):v;p(),d.options=Object.assign({},r,d.options,w),d.scrollParents={reference:is(o)?dn(o):o.contextElement?dn(o.contextElement):[],popper:dn(l)};var y=Wh(Jh([].concat(i,d.options.modifiers)));return d.orderedModifiers=y.filter(function(k){return k.enabled}),f(),u.update()},forceUpdate:function(){if(!h){var v=d.elements,w=v.reference,y=v.popper;if(zo(w,y)){d.rects={reference:zh(w,jn(y),d.options.strategy==="fixed"),popper:za(y)},d.reset=!1,d.placement=d.options.placement,d.orderedModifiers.forEach(function(A){return d.modifiersData[A.name]=Object.assign({},A.data)});for(var k=0;k<d.orderedModifiers.length;k++){if(d.reset===!0){d.reset=!1,k=-1;continue}var E=d.orderedModifiers[k],T=E.fn,S=E.options,P=S===void 0?{}:S,L=E.name;typeof T=="function"&&(d=T({state:d,options:P,name:L,instance:u})||d)}}}},update:Yh(function(){return new Promise(function(m){u.forceUpdate(),m(d)})}),destroy:function(){p(),h=!0}};if(!zo(o,l))return u;u.setOptions(c).then(function(m){!h&&c.onFirstUpdate&&c.onFirstUpdate(m)});function f(){d.orderedModifiers.forEach(function(m){var v=m.name,w=m.options,y=w===void 0?{}:w,k=m.effect;if(typeof k=="function"){var E=k({state:d,name:v,instance:u,options:y}),T=function(){};g.push(E||T)}})}function p(){g.forEach(function(m){return m()}),g=[]}return u}}var Qh=[wh,Rh,yh,lh,Mh,Lh,qh,gh,Fh],Zh=Xh({defaultModifiers:Qh});const ep=(s,e)=>(s%e+e)%e;class tp{constructor(e,t,i){this.owner=e,this.containerEl=t,t.on("click",".suggestion-item",this.onSuggestionClick.bind(this)),t.on("mousemove",".suggestion-item",this.onSuggestionMouseover.bind(this)),i.register([],"ArrowUp",n=>{if(!n.isComposing)return this.setSelectedItem(this.selectedItem-1,!0),!1}),i.register([],"ArrowDown",n=>{if(!n.isComposing)return this.setSelectedItem(this.selectedItem+1,!0),!1}),i.register([],"Enter",n=>{if(!n.isComposing)return this.useSelectedItem(n),!1})}onSuggestionClick(e,t){e.preventDefault();const i=this.suggestions.indexOf(t);this.setSelectedItem(i,!1),this.useSelectedItem(e)}onSuggestionMouseover(e,t){const i=this.suggestions.indexOf(t);this.setSelectedItem(i,!1)}setSuggestions(e){this.containerEl.empty();const t=[];e.forEach(i=>{const n=this.containerEl.createDiv("suggestion-item");this.owner.renderSuggestion(i,n),t.push(n)}),this.values=e,this.suggestions=t,this.setSelectedItem(0,!1)}useSelectedItem(e){const t=this.values[this.selectedItem];t&&this.owner.selectSuggestion(t,e)}setSelectedItem(e,t){const i=ep(e,this.suggestions.length),n=this.suggestions[this.selectedItem],r=this.suggestions[i];n==null||n.removeClass("is-selected"),r==null||r.addClass("is-selected"),this.selectedItem=i,t&&r.scrollIntoView(!1)}}class ip{constructor(e){this.inputEl=e,this.scope=new F.Scope,this.suggestEl=createDiv("suggestion-container");const t=this.suggestEl.createDiv("suggestion");this.suggest=new tp(this,t,this.scope),this.scope.register([],"Escape",this.close.bind(this)),this.inputEl.addEventListener("input",this.onInputChanged.bind(this)),this.inputEl.addEventListener("focus",this.onInputChanged.bind(this)),this.inputEl.addEventListener("blur",this.close.bind(this)),this.suggestEl.on("mousedown",".suggestion-container",i=>{i.preventDefault()})}onInputChanged(){const e=this.inputEl.value,t=this.getSuggestions(e);if(!t){this.close();return}t.length>0?(this.suggest.setSuggestions(t),this.open(app.dom.appContainerEl,this.inputEl)):this.close()}open(e,t){app.keymap.pushScope(this.scope),e.appendChild(this.suggestEl),this.popper=Zh(t,this.suggestEl,{placement:"bottom-start",modifiers:[{name:"sameWidth",enabled:!0,fn:({state:i,instance:n})=>{const r=`${i.rects.reference.width}px`;i.styles.popper.width!==r&&(i.styles.popper.width=r,n.update())},phase:"beforeWrite",requires:["computeStyles"]}]})}close(){app.keymap.popScope(this.scope),this.suggest.setSuggestions([]),this.popper&&this.popper.destroy(),this.suggestEl.detach()}}class mc extends ip{constructor(e,t){super(e),this.inputEl=e,this.app=t}getSuggestions(e){const t=this.app.vault.getAllLoadedFiles(),i=[],n=e.toLowerCase();return t.forEach(r=>{r instanceof F.TFolder&&r.path.toLowerCase().contains(n)&&i.push(r)}),i}renderSuggestion(e,t){t.setText(e.path)}selectSuggestion(e){this.inputEl.value=e.path,this.inputEl.trigger("input"),this.close()}}async function vc(s,e){if(!s)return null;s.length>1&&/^[/\\]/.test(s)&&(s=s.substring(1));let t=app.vault.getAbstractFileByPath(s);if(!t)try{t=await app.vault.createFolder(s),new F.Notice(`New folder ${t.path} created.`)}catch(i){return new F.Notice(`Folder ${s} creation failed: ${i}. Please correct and try again.`,5e3),null}return t instanceof F.TFolder?(new F.Notice(`${e} folder is now ${t.path}.`),t.path):null}var sp=G(`<div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Manual sync</div> <div class="setting-item-description">Manually perform a synchronization task</div></div> <div class="setting-item-control"><button class="mod-cta">Sync</button></div></div> <div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Check database</div> <div class="setting-item-description">Check for possible issues: sync error, file renaming not updated, or missed tasks not synchronized</div></div> <div class="setting-item-control"><button class="mod-cta">Check Database</button></div></div> <div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Backup TickTick data</div> <div class="setting-item-description">Click to backup TickTick data. The backed-up files will be stored in the selected directory of the
					Obsidian vault</div></div> <div class="setting-item-control"><button class="mod-cta">Backup</button></div></div> <div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Skip backup</div> <div class="setting-item-description">Skip backup on startup</div></div> <div class="setting-item-control"><label class="toggle-switch"><input type="checkbox"/> <span class="slider"></span></label></div></div> <div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Backup folder</div> <div class="setting-item-description">Choose the folder to store the backup files.</div></div> <div class="setting-item-control flex-container"><div class="modal-form remove-padding remove-border fix-suggest"></div></div></div>`,1),np=G('<div class="manual-operations"><!></div>');function rp(s,e){gt(e,!1);let t=Le(e,"plugin",8),i={};async function n(){if(!O().token){new F.Notice("Please log in from settings first");return}try{await t().scheduledSynchronization(),new F.Notice("Sync completed.")}catch(g){new F.Notice(`An error occurred while syncing: ${g}`)}}let r;function a(g){new F.Setting(g).addSearch(h=>{h.setPlaceholder("Select or Create folder").setValue(O().bkupFolder),h.setValue(i[O().bkupFolder]),new mc(h.inputEl,app),h.onChange(u=>{r&&clearTimeout(r),r=setTimeout(async()=>{const f=await vc(u,"Backup");f&&(He({bkupFolder:f}),await t().saveSettings())},700)})})}function o(){const g=app.vault.getAllFolders(!0),h={};for(const u of g)h[u.path]=u.name;return h}Ks(async()=>{i=o()}),wt();var l=np(),c=N(l);{var d=g=>{var h=sp(),u=Me(h),f=$(N(u),2),p=N(f),m=$(u,2),v=$(N(m),2),w=N(v),y=$(m,2),k=$(N(y),2),E=N(k),T=$(y,2),S=$(N(T),2),P=N(S),L=N(P),A=$(T,2),_=$(N(A),2),C=N(_);Jl(C,D=>a==null?void 0:a(D)),ae(D=>ya(L,D),[()=>(Yt(O),ee(()=>O().skipBackup))]),pe("click",p,n),pe("click",w,()=>t().service.checkDataBase()),pe("click",E,()=>t().service.backup()),pe("change",L,async D=>{He({skipBackup:D.target.checked}),await t().saveSettings()}),U(g,h)};Oe(c,g=>{Yt(O),ee(()=>O().token)&&g(d)})}U(s,l),mt()}const Go={1:"AND",2:"OR"},Wo={trace:"trace",debug:"debug",info:"info",warn:"warn",error:"error"},zn={noLink:"No Link",taskLink:"Link in Task",noteLink:"Link in Description"};var ap=G("<option> </option>"),op=G('<div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Log Level</div> <div class="setting-item-description">Determine log level</div></div> <div class="TTS-setting-item-control"><select></select></div></div>'),lp=G("<span> </span>"),cp=G('<div style="margin-top: 1em;"><textarea readonly="" rows="10" style="width:100%;"></textarea> <div style="display:flex; align-items:center; gap: 1em; margin-top: 0.5em;"><button>Copy to clipboard</button> <!></div></div>'),up=G('<div class="debug-options"><div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Debug mode</div> <div class="setting-item-description">Allow access to developer settings</div></div> <div class="setting-item-control"><label class="toggle-switch"><input type="checkbox"/> <span class="slider"></span></label></div></div> <!> <div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Generate Debug Info.</div> <div class="setting-item-description">Click to report settings for a bug.</div></div> <div class="setting-item-control"><button class="mod-cta">Generate</button></div></div> <!></div>');function dp(s,e){gt(e,!1);let t=Le(e,"plugin",8),i=z(!1),n=z(!1),r=z(""),a=z("");Ks(async()=>{x(i,O().debugMode)});function o(){const T=O(),S=O().fileMetadata,P=[];for(const A in S){const _=S[A].TickTickTasks?S[A].TickTickTasks.length:"TickTickTasks not found";P.push(`${A}, ${_}`)}return{general:{version:T.version,baseURL:T.baseURL,enableFullVaultSync:T.enableFullVaultSync,debugMode:T.debugMode,logLevel:T.logLevel,fileLinksInTickTick:T.fileLinksInTickTick,taskLinksInObsidian:T.taskLinksInObsidian,bkupFolder:T.bkupFolder,skipBackup:T.skipBackup,numProjects:T.TickTickTasksData.projects.length,fileTasks:P},defaults:{defaultProjectName:T.defaultProjectName,defaultProjectId:T.defaultProjectId,TickTickTasksFilePath:T.TickTickTasksFilePath},syncControl:{SyncProject:T.SyncProject,tagAndOr:T.tagAndOr,SyncTag:T.SyncTag},noteSetting:{syncNotes:T.syncNotes,noteDelimiter:T.noteDelimiter}}}async function l(){let T=o();x(r,"```\n"+JSON.stringify(T,null,2)+"\n```"),x(n,!0),b.debug(I(r))}async function c(){try{await navigator.clipboard.writeText(I(r)),x(a,"Copied!"),setTimeout(()=>x(a,""),1500)}catch{x(a,"Copy failed"),setTimeout(()=>x(a,""),1500)}}wt();var d=up(),g=N(d),h=$(N(g),2),u=N(h),f=N(u),p=$(g,2);{var m=T=>{var S=op(),P=$(N(S),2),L=N(P);Rt(L,5,()=>(Yt(Wo),ee(()=>Object.entries(Wo))),jt,(_,C)=>{var D=$i(()=>Fi(I(C),2));let q=()=>I(D)[0],W=()=>I(D)[1];var R=ap(),Q=N(R),oe={};ae(()=>{ne(Q,W()),oe!==(oe=q())&&(R.value=(R.__value=q())??"")}),U(_,R)});var A;qa(L),ae(_=>{A!==(A=_)&&(L.value=(L.__value=_)??"",Ar(L,_))},[()=>(Yt(O),ee(()=>O().logLevel))]),pe("change",L,async _=>{He({logLevel:_.target.value}),await t().saveSettings(!0),b.setLevel(_.target.value)}),U(T,S)};Oe(p,T=>{I(i)&&T(m)})}var v=$(p,2),w=$(N(v),2),y=N(w),k=$(v,2);{var E=T=>{var S=cp(),P=N(S),L=$(P,2),A=N(L),_=$(A,2);{var C=D=>{var q=lp(),W=N(q);ae(()=>ne(W,I(a))),U(D,q)};Oe(_,D=>{I(a)&&D(C)})}Ls(P,()=>I(r),D=>x(r,D)),pe("click",A,c),U(T,S)};Oe(k,T=>{I(n)&&T(E)})}Ha(f,()=>I(i),T=>x(i,T)),pe("change",f,async T=>{const S=T.target.checked;x(i,S),He({debugMode:S}),await t().saveSettings()}),pe("click",y,l),U(s,d),mt()}function fp(s,e){const t=O().TickTickTasksData.tasks;for(const i of t)i.modifiedTime=e;He({TickTickTasksData:{...O().TickTickTasksData,tasks:t}}),s.tickTickRestAPI&&s.tickTickRestAPI.api&&(s.tickTickRestAPI.api.checkpoint=0)}async function hp(s){await s.service.syncFiles(!0)}async function pp(s,e){e==null||e(!0),He({checkPoint:0}),b.debug("## reset from OBS to TT"),await hp(s),await s.saveSettings(),await s.scheduledSynchronization(),b.debug("## reset from TT to OBS"),fp(s,"1970-01-01T00:00:00.000Z"),await s.saveSettings(),await s.scheduledSynchronization(),e==null||e(!1)}var gp=G('<div class="local-modal-backdrop"></div> <div class="local-modal-dialog" role="dialog" aria-modal="true"><div class="local-modal-content"><h2>Confirm Reset</h2> <p>Do you <strong>REALLY</strong> </p> <p style="color:var(--text-warning);"><em>This will sync everything and can take a while.</em></p> <div class="local-modal-actions"><button class="mod-cta"> </button> <button style="margin-left:1em;">No, cancel</button></div></div></div>',1),mp=G('<div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Reset Tasks</div> <div class="setting-item-description"> <br/> <em>Caution: This will take some time and update Tasks from TickTick to Obsidian and Obsidian to TickTick.</em></div></div> <div class="setting-item-control"><button class="mod-cta">Reset Tasks.</button></div></div> <!>',1);function kc(s,e){gt(e,!1);let t=Le(e,"isWorking",8),i=Le(e,"resetTasksText",8),n=Le(e,"plugin",8),r=Le(e,"setIsWorking",8),a=z(!1),o=z(!1);async function l(){x(a,!0),x(o,!1)}function c(){I(o)||x(a,!1)}async function d(){x(o,!0);try{await pp(n(),r())}finally{x(a,!1),x(o,!1)}}wt();var g=mp(),h=Me(g),u=N(h),f=$(N(u),2),p=N(f),m=$(u,2),v=N(m),w=$(h,2);{var y=k=>{var E=gp(),T=Me(E),S=$(T,2),P=N(S),L=$(N(P),2),A=$(N(L),2),_=$(L,4),C=N(_),D=N(C),q=$(C,2);ae(()=>{Eo(T,I(o)?"cursor: wait;":""),Eo(S,I(o)?"cursor: wait;":""),ne(A,` want to ${i()??""}?`),C.disabled=I(o),ne(D,I(o)?"Resetting...":"Yes, reset"),q.disabled=I(o)}),pe("click",T,function(...W){var R;(R=I(o)?void 0:c)==null||R.apply(this,W)}),pe("click",C,d),pe("click",q,c),U(k,E)};Oe(w,k=>{I(a)&&k(y)})}ae(()=>{ne(p,`Do you want to ${i()??""} `),v.disabled=t()}),pe("click",v,l),U(s,g),mt()}var vp=G('<input type="text" placeholder="Enter delimiter (e.g., ---)" style="margin-left:0.5em; width:10em"/>'),kp=G(`<div>Notes will be synchronized.</div> <br/> <div class="setting-item delimiter-settings"><div class="setting-item-info"><div class="setting-item-name">Note Delimiter</div> <div class="setting-item-description">Choose how Notes are separated from a Task. <br/>Changes will be applied on next update from
						TickTick.</div></div> <div class="setting-item-control"><div class="note-delimiter-row"><div class="delimiter-radio-group"><label><input type="radio" name="delimiterOption" value="none"/> No delimiter</label> <label><input type="radio" name="delimiterOption" value="custom"/> Custom</label></div> <!> <div class="delimiter-preview"><p>Preview:</p> <span><pre> </pre></span></div></div></div></div>`,1),yp=G("<div>Notes will be not synchronized.</div> <br/>",1),bp=G('<div><div class="notes-settings "><div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Sync Notes</div> <div class="setting-item-description">Synchronize Notes</div></div> <div class="setting-item-control"><label class="toggle-switch"><input type="checkbox"/> <span class="slider"></span></label></div></div> <!> <br/> <!></div></div>');function wp(s,e){gt(e,!1);const t=()=>Fn(Ke,"$settingsStore",i),[i,n]=xn();let r=Le(e,"plugin",8),a=z(!1),o=z(!1),l=z("");function c(_){x(a,_)}let d=z("none"),g=z(""),h=z("");t().defaultFolderPath,Ks(()=>{x(o,t().syncNotes),t().noteDelimiter===""||t().noteDelimiter==null?(x(d,"none"),x(g,"")):(x(d,"custom"),x(g,t().noteDelimiter)),m()});function u(_){x(d,_),_==="none"?(x(g,""),f("")):I(g)||(x(g,"---"),f(I(g))),m()}async function f(_){Ke.update(C=>({...C,noteDelimiter:_})),await r().saveSettings()}function p(_){const C=_.target;x(g,C.value),f(I(g)),m()}function m(){x(h,I(d)==="none"?` Task Title 
   Note 1
   Note 2`:` Task Title 
   ${I(g)}
   Note 1
   Note 2
   ${I(g)}`)}ut(()=>I(o),()=>{x(l,I(o)?"Get all Notes from TickTick?":"Remove all Notes from Obsidian? (This will not delete Notes in TickTick)")}),Nn(),wt();var v=bp(),w=N(v),y=N(w),k=$(N(y),2),E=N(k),T=N(E),S=$(y,2);{var P=_=>{var C=kp(),D=$(Me(C),4),q=$(N(D),2),W=N(q),R=N(W),Q=N(R),oe=N(Q),ge=$(Q,2),me=N(ge),le=$(R,2);{var Te=H=>{var ue=vp();Kd(ue,"maxlength",61),Ls(ue,()=>I(g),qe=>x(g,qe)),pe("input",ue,p),U(H,ue)};Oe(le,H=>{I(d)==="custom"&&H(Te)})}var se=$(le,2),ve=$(N(se),2),K=N(ve),ke=N(K);ae(()=>{ya(oe,I(d)==="none"),ya(me,I(d)==="custom"),ne(ke,I(h))}),pe("change",oe,()=>u("none")),pe("change",me,()=>u("custom")),U(_,C)},L=_=>{var C=yp();U(_,C)};Oe(S,_=>{I(o)?_(P):_(L,!1)})}var A=$(S,4);kc(A,{get isWorking(){return I(a)},get resetTasksText(){return I(l)},get plugin(){return r()},setIsWorking:c}),ae(()=>Ua(v,1,I(a)?"wait-cursor":"default-cursor")),Ha(T,()=>I(o),_=>x(o,_)),pe("change",T,async _=>{const C=_.target.checked;x(o,C),Ke.update(D=>({...D,syncNotes:C})),await r().saveSettings()}),U(s,v),mt(),n()}var Tp=G('<div class="collapsible-body"><!></div>'),_p=G('<div class="short-desc"> </div>'),Ip=G('<div class="collapsible-section"><div class="collapsible-header"><span> </span> </div> <!></div>');function Lr(s,e){gt(e,!1);let t=Le(e,"title",8),i=Le(e,"open",8,!1),n=Le(e,"shortDesc",8,"");const r=$n();function a(){r("headerClick")}wt();var o=Ip(),l=N(o),c=N(l),d=N(c),g=$(c,1,!0),h=$(l,2);{var u=p=>{var m=Tp(),v=N(m);jd(v,e,"default",{}),U(p,m)},f=p=>{var m=Nt(),v=Me(m);{var w=y=>{var k=_p(),E=N(k);ae(()=>ne(E,n())),U(y,k)};Oe(v,y=>{n()&&y(w)},!0)}U(p,m)};Oe(h,p=>{i()?p(u):p(f,!1)})}ae(()=>{ne(d,i()?"":""),ne(g,t())}),pe("click",l,a),U(s,o),mt()}var Sp=G("<option> </option>"),Pp=G('will be created <strong><span class="setting-item-name">after you hit  ENTER</span></strong>',1),Ep=G("<li> </li>"),Cp=G('<p>The following files contain tasks and will be moved to <strong> </strong>:</p> <ul class="file-list"></ul> <div class="local-modal-actions"><button class="mod-cta">Yes, move them!</button> <button style="margin-left:1em;">No, cancel</button></div>',1),Op=G('<p>No files found containing relevant tasks to move.</p> <div class="local-modal-actions"><button>Close</button></div>',1),Ap=G('<div class="local-modal-backdrop"></div> <div class="local-modal-dialog"><div class="local-modal-content"><h2>Update the World</h2> <!></div></div>',1),Np=G(`<div class="sync-control"><div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Default Project</div> <div class="setting-item-description"><div>Tasks are added to the default project associated with a file.</div> <div>If tasks are added to a file with no default project association</div> <div>they will be added to the <span class="setting-item-name"> </span> project.</div></div></div> <div class="setting-item-control"><select class="dropdown" id="sync-project"><option>(none)</option><!></select></div></div> <div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Default folder location</div> <div class="setting-item-description"><div>Folder where TickTick tasks are stored.</div> Default Project File <span class="setting-item-name"> </span> <!></div></div> <div class="setting-item-control flex-container"><div class="local-modal-form remove-padding remove-border fix-suggest"></div></div></div></div> <div style="margin-top: 2em; text-align: right;"><button class="mod-cta">Move Existing Files.</button></div> <!> <style>/* Modal basic styles */
		.local-modal-backdrop {
			position: fixed;
			top: 0;
			left: 0;
			width: 100vw;
			height: 100vh;
			background: rgba(0, 0, 0, 0.4);
			z-index: 99;
		}

		.local-modal-dialog {
			position: fixed;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			z-index: 100;
			background: var(--background-secondary); /* matches settings panel */
			border: 1.5px solid var(--background-modifier-border); /* matches panel border */
			border-radius: 8px;
			box-shadow: 0 2px 24px #0003;
			min-width: 300px;
			max-width: 95vw;
			color: var(--text-normal); /* make text readable in all themes */
			display: inline-flex;
			flex-direction: column;
		}

		.local-modal-content {
			padding: 2em;
			display: inline-flex;
			flex-direction: column;
		}

		.local-modal-content h2 {
			margin: 0 0 1.2em 0;
		}

		.local-modal-content p {
			margin: 0 0 2em 0;
		}

		.file-list {
			max-height: 300px;
			overflow-y: auto;
			margin: 0 0 2em 0;
			padding-left: 1.2em;
			text-align: left;
			background: var(--background-primary);
			border: 1px solid var(--background-modifier-border);
			border-radius: 4px;
			padding: 10px;
		}

		.local-modal-actions {
			margin-top: 2.2em;
			display: flex;
			justify-content: flex-end;
		}</style>`,1);function Lp(s,e){gt(e,!1);let t=Le(e,"open",8,!1),i=Le(e,"plugin",8),n=z(""),r=z(),a=z(!1),o=z(!1),l=z(!1),c=z([]);const d=$n();function g(){d("toggle")}let h=[],u=z({});async function f(){const P=ct(),L=O().defaultProjectName;if(b.debug(`Changing default Project or Project Folder 
New default project folder: `,P,"New default project",L),L){const A=L+".md",_=app.vault.getMarkdownFiles();for(const C of _){if(T(C.path))if(C.path!==P+"/"+A)try{await app.vault.rename(C,P+"/"+A)}catch(D){b.error(`File rename failed. ${D}`),alert(`File rename failed. ${D}`)}else b.debug("default project file NOT renamed",await app.vault.getAbstractFileByPath(P+"/"+A));break}}x(r,ct()+"/"+O().defaultProjectName)}function p(P){new F.Setting(P).addSearch(L=>{L.setPlaceholder("Select or Create folder").setValue(ct()),L.setValue(I(u)),new mc(L.inputEl,i().app),L.onChange(A=>{x(r,A+"/"+O().defaultProjectName),x(l,!0)}),L.inputEl.addEventListener("keydown",async A=>{if(A.key==="Enter"){const _=L.inputEl.value,C=await vc(_,"Default");C&&(He({TickTickTasksFilePath:C}),await f(),await i().saveSettings(),x(o,!0),x(l,!1))}})})}function m(){return h.reduce((P,L)=>(P[L.id]=L.name,P),{})}async function v(P){var L;(!P||P=="")&&(P=O().inboxID),P&&P!==""&&(He({defaultProjectName:await((L=i().cacheOperation)==null?void 0:L.getProjectNameByIdFromCache(P))}),He({defaultProjectId:P}),await f(),await i().saveSettings())}Ks(async()=>{var P,L;h=await((L=(P=i().service).getProjects)==null?void 0:L.call(P))??[],x(u,m()),x(n,O().defaultProjectId??""),x(r,ct()+"/"+O().defaultProjectName)});async function w(){x(c,await E()),x(a,!0),x(o,!1)}function y(){x(a,!1),x(o,!1),x(c,[])}async function k(){x(a,!1);const P=ct();for(const L of I(c))try{const A=P+"/"+L.name;L.path!==A&&await i().app.vault.rename(L,A)}catch(A){b.error(`File rename failed. ${A}`),alert(`File rename failed. ${A}`)}x(c,[])}async function E(){const P=i().app.vault.getMarkdownFiles(),L=[],A=O();let _=0;for(const C of P)if(!T(C.path))try{_++;const D=new ni(i().app,i(),C);await D.init(),D.hasTasks(A.enableFullVaultSync,_)&&L.push(C)}catch(D){b.error(`Failed to process file ${C.path}`,D)}return L}const T=P=>{const L=ct(),A=`${O().defaultProjectName}.md`,_=L?`${L}/${A}`:A;return P===_};var S={isDefaultProjectFile:T};return wt(),Lr(s,{title:"Defaults",shortDesc:"Default Folder and Project settings",get open(){return t()},$$events:{headerClick:g},children:(P,L)=>{var A=Np(),_=Me(A),C=N(_),D=N(C),q=$(N(D),2),W=$(N(q),4),R=$(N(W)),Q=N(R),oe=$(D,2),ge=N(oe);ae(()=>{I(n),hn(()=>{I(u)})});var me=N(ge);me.value=me.__value="";var le=$(me);Rt(le,1,()=>(I(u),ee(()=>Object.entries(I(u)))),jt,(fe,B)=>{var te=$i(()=>Fi(I(B),2));let he=()=>I(te)[0],Ce=()=>I(te)[1];var V=Sp(),ye=N(V),Ae={};ae(()=>{ne(ye,Ce()),Ae!==(Ae=he())&&(V.value=(V.__value=he())??"")}),U(fe,V)});var Te=$(C,2),se=N(Te),ve=$(N(se),2),K=$(N(ve),2),ke=N(K),H=$(K,2);{var ue=fe=>{var B=Pp();U(fe,B)};Oe(H,fe=>{I(l)&&fe(ue)})}var qe=$(se,2),j=N(qe);Jl(j,fe=>p==null?void 0:p(fe));var Ee=$(_,2),Be=N(Ee),Qe=$(Ee,2);{var Tt=fe=>{var B=Ap(),te=Me(B),he=$(te,2),Ce=N(he),V=$(N(Ce),2);{var ye=Ne=>{var Fe=Cp(),Ve=Me(Fe),ot=$(N(Ve)),_t=N(ot),Ue=$(Ve,2);Rt(Ue,5,()=>I(c),jt,(de,J)=>{var Ie=Ep(),Ht=N(Ie);ae(()=>ne(Ht,(I(J),ee(()=>I(J).path)))),U(de,Ie)});var _e=$(Ue,2),Ze=N(_e),ie=$(Ze,2);ae(de=>ne(_t,`/${de??""}`),[()=>(Yt(ct),ee(ct))]),pe("click",Ze,k),pe("click",ie,y),U(Ne,Fe)},Ae=Ne=>{var Fe=Op(),Ve=$(Me(Fe),2),ot=N(Ve);pe("click",ot,y),U(Ne,Fe)};Oe(V,Ne=>{I(c),ee(()=>I(c).length>0)?Ne(ye):Ne(Ae,!1)})}pe("click",te,y),U(fe,B)};Oe(Qe,fe=>{I(a)&&fe(Tt)})}ae(fe=>{ne(Q,fe),ne(ke,`${I(r)??""}.md`),Be.disabled=!I(o)},[()=>(Yt(O),ee(()=>O().defaultProjectName))]),gn(ge,()=>I(n),fe=>x(n,fe)),pe("change",ge,fe=>v(fe.target.value)),pe("click",Be,w),U(P,A)},$$slots:{default:!0}}),zd(e,"isDefaultProjectFile",T),mt(S)}var Dp=G("<option> </option>"),Fp=G("<option> </option>"),xp=G("<p>No limitation.</p>"),$p=G("<p>Only Tasks in <b> </b> will be synchronized</p>"),Mp=G("<p>Only Tasks tagged with <b> </b> tag will be synchronized</p>"),jp=G(`<p>Only tasks in <b> </b> AND tagged with <b> </b> tag
				will be synchronized</p>`),Rp=G("<p>All tasks in <b> </b> will be synchronized. All tasks tagged with <b> </b> tag will be synchronized</p>"),Bp=G(`<div class="setting-item-description">To limit the tasks TickTickSync will synchronize from TickTick to
		Obsidian select a tag and/or project(list) below. If a tag is entered, only tasks with that tag will be
		synchronized. If a project(list) is selected, only tasks in that project will be synchronized. If
		both are chosen the behavior will be determined by your settings. See result below.</div> <div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Project</div> <div class="setting-item-description">Only tasks in this project will be synchronized.</div></div> <div class="setting-item-control"><select class="dropdown" id="sync-project"><option>(none)</option><!></select></div></div> <div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Tag Behavior</div> <div class="setting-item-description">Determine how Tags will be handled.</div></div> <div class="setting-item-control"><select class="dropdown" id="tag-and-or"></select></div></div> <div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Tag</div> <div class="setting-item-description">Tag value, no "#".</div></div> <div class="setting-item-control"><input id="sync-tag" type="text" placeholder="Only tasks with this tag will be synced"/></div></div> <div class="sync-explanation"><!></div>`,1);function Up(s,e){gt(e,!1);const t=()=>Fn(Ke,"$settingsStore",i),[i,n]=xn(),r=z();let a=Le(e,"open",8,!1),o=Le(e,"plugin",8),l=[],c=z({}),d=z(""),g=z(""),h=z(1),u=z(""),f;const p=$n();function m(){p("toggle")}async function v(S){var A;Ke.update(_=>({..._,SyncProject:S})),x(d,S);const P=t().fileMetadata;if(!Object.values(P).find(_=>_.defaultProjectId===S)){const _=`Did not find a default Project File for Project ${(A=I(c))==null?void 0:A[S]}. Please create a file and set its default to this project, or select a file to be the default for this project.`;new F.Notice(_,5e3)}await o().saveSettings()}async function w(S){const P=parseInt(S);Ke.update(L=>({...L,tagAndOr:P})),x(h,P),await o().saveSettings()}let y=z({});function k(S){const P=S[t().SyncProject],L=t().SyncTag,A=P&&L?t().tagAndOr==1:void 0;x(y,{project:P,tag:L,andOr:A})}function E(){return l.reduce((S,P)=>(S[P.id]=P.name,S),{})}function T(S){x(u,S),Ke.update(P=>({...P,SyncTag:S})),f&&clearTimeout(f),f=setTimeout(async()=>{await o().saveSettings()},800)}Ks(async()=>{var S,P;l=await((P=(S=o().service).getProjects)==null?void 0:P.call(S))??[],x(c,E()),x(d,t().SyncProject??""),x(g,t().defaultProjectId??""),x(h,t().tagAndOr??1),x(u,t().SyncTag??""),k(I(c))}),ut(()=>t(),()=>{x(h,t().tagAndOr??1)}),ut(()=>I(h),()=>{x(r,I(h).toString())}),ut(()=>t(),()=>{x(d,t().SyncProject??"")}),ut(()=>t(),()=>{x(g,t().defaultProjectId??"")}),ut(()=>t(),()=>{x(u,t().SyncTag??"")}),ut(()=>I(c),()=>{k(I(c))}),Nn(),wt(),Lr(s,{title:"Limit synchronization",shortDesc:"Synchronization settings added for effect",get open(){return a()},$$events:{headerClick:m},children:(S,P)=>{var L=Bp(),A=$(Me(L),2),_=$(N(A),2),C=N(_);ae(()=>{I(d),hn(()=>{I(c)})});var D=N(C);D.value=D.__value="";var q=$(D);Rt(q,1,()=>(I(c),ee(()=>Object.entries(I(c)))),jt,(K,ke)=>{var H=$i(()=>Fi(I(ke),2));let ue=()=>I(H)[0],qe=()=>I(H)[1];var j=Dp(),Ee=N(j),Be={};ae(()=>{ne(Ee,qe()),Be!==(Be=ue())&&(j.value=(j.__value=ue())??"")}),U(K,j)});var W=$(A,2),R=$(N(W),2),Q=N(R);ae(()=>{I(r),hn(()=>{I(c)})}),Rt(Q,5,()=>(Yt(Go),ee(()=>Object.entries(Go))),jt,(K,ke)=>{var H=$i(()=>Fi(I(ke),2));let ue=()=>I(H)[0],qe=()=>I(H)[1];var j=Fp(),Ee=N(j),Be={};ae(()=>{ne(Ee,qe()),Be!==(Be=ue())&&(j.value=(j.__value=ue())??"")}),U(K,j)});var oe=$(W,2),ge=$(N(oe),2),me=N(ge),le=$(oe,2),Te=N(le);{var se=K=>{var ke=xp();U(K,ke)},ve=K=>{var ke=Nt(),H=Me(ke);{var ue=j=>{var Ee=$p(),Be=$(N(Ee)),Qe=N(Be);ae(()=>ne(Qe,(I(y),ee(()=>I(y).project)))),U(j,Ee)},qe=j=>{var Ee=Nt(),Be=Me(Ee);{var Qe=fe=>{var B=Mp(),te=$(N(B)),he=N(te);ae(()=>ne(he,`#${I(y),ee(()=>I(y).tag)??""}`)),U(fe,B)},Tt=fe=>{var B=Nt(),te=Me(B);{var he=V=>{var ye=jp(),Ae=$(N(ye)),Ne=N(Ae),Fe=$(Ae,2),Ve=N(Fe);ae(()=>{ne(Ne,(I(y),ee(()=>I(y).project))),ne(Ve,`#${I(y),ee(()=>I(y).tag)??""}`)}),U(V,ye)},Ce=V=>{var ye=Rp(),Ae=$(N(ye)),Ne=N(Ae),Fe=$(Ae,2),Ve=N(Fe);ae(()=>{ne(Ne,(I(y),ee(()=>I(y).project))),ne(Ve,`#${I(y),ee(()=>I(y).tag)??""}`)}),U(V,ye)};Oe(te,V=>{I(y),ee(()=>I(y).andOr)?V(he):V(Ce,!1)},!0)}U(fe,B)};Oe(Be,fe=>{I(y),ee(()=>!I(y).project&&I(y).tag)?fe(Qe):fe(Tt,!1)},!0)}U(j,Ee)};Oe(H,j=>{I(y),ee(()=>I(y).project&&!I(y).tag)?j(ue):j(qe,!1)},!0)}U(K,ke)};Oe(Te,K=>{I(y),ee(()=>!I(y).project&&!I(y).tag)?K(se):K(ve,!1)})}gn(C,()=>I(d),K=>x(d,K)),pe("change",C,K=>{v(K.target.value),k(I(c))}),gn(Q,()=>I(r),K=>x(r,K)),pe("change",Q,K=>{w(K.target.value),k(I(c))}),Ls(me,()=>I(u),K=>x(u,K)),pe("input",me,K=>{T(K.target.value),k(I(c))}),U(S,L)},$$slots:{default:!0}}),mt(),n()}var qp=G(`<div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Automatic sync interval time</div> <div class="setting-item-description">Please specify the desired interval time, with seconds as the default
				unit. 0 for manual sync. The default setting is 300 seconds, which corresponds to syncing once every 5
				minutes. You can customize it, but it cannot be lower than 20 seconds.</div></div> <div class="setting-item-control"><input id="sync-tag" type="text" Placeholder="Sync interval"/></div></div>`);function Hp(s,e){gt(e,!1);const t=z();let i=Le(e,"open",8,!1),n=Le(e,"plugin",8),r=z(O().automaticSynchronizationInterval),a=z();const o=$n();function l(){o("toggle")}async function c(d){const g=Number(d);if(isNaN(g)||!Number.isInteger(g)){new F.Notice("Wrong type, please enter a integer.");return}if(g!==0&&g<20){new F.Notice("The synchronization interval time cannot be less than 20 seconds.");return}He({automaticSynchronizationInterval:g}),await n().saveSettings(),n().reloadInterval(),new F.Notice("Settings have been updated.")}ut(()=>I(r),()=>{x(t,I(r).toString())}),Nn(),wt(),Lr(s,{title:"Automatic sync interval time",shortDesc:"Sync interval setting",get open(){return i()},$$events:{headerClick:l},children:(d,g)=>{var h=qp(),u=$(N(h),2),f=N(u);Ls(f,()=>I(r),p=>x(r,p)),pe("input",f,p=>{I(a)&&clearTimeout(I(a)),x(a,setTimeout(async()=>{const m=p.target;await c(m.value)},900))}),U(d,h)},$$slots:{default:!0}}),mt()}let Kp=class extends F.Modal{constructor(e,t){super(e),this.title="Full Vault Task Sync Confirmation",this.message=`Are you sure you want to Sync ALL tasks? 
Indented Tasks created in Obsidian will be created as subtasks in TickTick
 Task Items created in TickTick will still be Task Items. This is the only way to create Task Items when Full Vault Sync is enabled.
Tasks that are currently "Items" of tasks MAY be converted to "Sub Tasks" of the containing Tasks.
The "Items" will not be deleted.
Please proceed with Caution.`,this.cancelLabel="Cancel",this.confirmLabel="Confirm Full Vault Task Sync",this.onSubmit=t}onOpen(){const{titleEl:e,contentEl:t}=this;e.setText(this.title),this.message.split(`
`).forEach(n=>{t.createEl("p",{text:n})}),new F.Setting(t).addButton(n=>{n.setClass("ts_button"),n.setButtonText(this.cancelLabel),n.onClick(()=>{this.result=!1,this.onSubmit(this.result),this.close()})}).addButton(n=>{n.setClass("ts_button"),n.setWarning(),n.setButtonText(this.confirmLabel),n.onClick(()=>{this.result=!0,this.onSubmit(this.result),this.close()})})}onClose(){this.titleEl.empty(),this.contentEl.empty(),super.onClose(),this.resolvePromise(this.result)}showModal(){return this.open(),new Promise(e=>this.resolvePromise=e)}};var Vp=G(`<div class="Full vault sync"><div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Full vault sync</div> <div class="setting-item-description">By default, only tasks marked with #TickTick are synchronized. If this option is turned on, all
					tasks in
					the vault will be synchronized. <p><b>NOTE: This includes all tasks that are currently Items of a task.</b></p></div></div> <div class="setting-item-control"><label class="toggle-switch"><input type="checkbox"/> <span class="slider"></span></label></div></div></div>`);function zp(s,e){gt(e,!1);const t=()=>Fn(Ke,"$settingsStore",i),[i,n]=xn();let r=Le(e,"open",8,!1),a=Le(e,"plugin",8),o=z(!1);const l=$n();function c(){l("toggle")}async function d(){return await new Kp(app,()=>{}).showModal()}async function g(h){let u;t().enableFullVaultSync?(Ke.update(f=>({...f,enableFullVaultSync:!1})),u="Full vault sync is disabled."):await d()?(Ke.update(p=>({...p,enableFullVaultSync:!0})),u="Full vault sync is enabled."):(Ke.update(p=>({...p,enableFullVaultSync:!1})),u="Full vault sync not enabled."),new Notice(u),await a().saveSettings()}ut(()=>t(),()=>{x(o,t().enableFullVaultSync)}),Nn(),wt(),Lr(s,{title:"Full vault sync",shortDesc:"Full vault settings",get open(){return r()},$$events:{headerClick:c},children:(h,u)=>{var f=Vp(),p=N(f),m=$(N(p),2),v=N(m),w=N(v);Ha(w,()=>I(o),y=>x(o,y)),pe("change",w,async y=>{y.target.checked,await g()}),U(h,f)},$$slots:{default:!0}}),mt(),n()}function Gp(s,e){let t=Le(e,"plugin",8);const i=[{key:"defaults",component:Lp},{key:"limit",component:Up},{key:"auto",component:Hp},{key:"full",component:zp}];let n=z("defaults");function r(l){x(n,I(n)===l?"":l)}var a=Nt(),o=Me(a);Rt(o,1,()=>i,jt,(l,c)=>{var d=Nt(),g=Me(d);{let h=Er(()=>(I(n),I(c),ee(()=>I(n)===I(c).key)));Rd(g,()=>I(c).component,(u,f)=>{f(u,{get plugin(){return t()},get open(){return I(h)},$$events:{toggle:()=>r(I(c).key)}})})}U(l,d)}),U(s,a)}var Wp=G('<div class="setting-item-info"><hr/> <div class="setting-item-name">Notice:</div> <p>Note syncing is disabled. Links can only be added to the Task text or not added at all.</p> <hr/></div>'),Yp=G("<option> </option>"),Jp=G("<option> </option>"),Xp=G('<div><!> <div class="task-settings "><div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Task link handling in Obsidian</div> <div class="setting-item-description">Add TickTick task link to Tasks in Obsidian</div></div> <div class="setting-item-control"><select class="dropdown" id="sync-project"></select></div></div></div> <div class="task-settings "><div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Task link handling in TickTick</div> <div class="setting-item-description">Add Obsidian file link to Tasks in TickTick</div></div> <div class="setting-item-control"><select class="dropdown" id="sync-project"></select></div></div> <br/> <!></div></div>');function Qp(s,e){gt(e,!1);const t=()=>Fn(Ke,"$settingsStore",i),[i,n]=xn();let r=Le(e,"plugin",8),a=z(!1),o=z(),l=z(),c=z(),d=z(zn);function g(_){x(a,_)}let h=z("");async function u(_){Ke.update(C=>({...C,taskLinksInObsidian:_})),await r().saveSettings()}async function f(_){Ke.update(C=>({...C,fileLinksInTickTick:_})),await r().saveSettings()}ut(()=>{},()=>{x(h,"Update Tasks in TickTick and Obsidian?")}),ut(()=>t(),()=>{x(o,t().fileLinksInTickTick)}),ut(()=>t(),()=>{x(l,t().taskLinksInObsidian)}),ut(()=>t(),()=>{x(c,t().syncNotes)}),ut(()=>(I(c),zn),()=>{if(I(c))x(d,zn);else{const _={...zn};delete _.noteLink,x(d,_)}}),Nn(),wt();var p=Xp(),m=N(p);{var v=_=>{var C=Wp();U(_,C)};Oe(m,_=>{I(c)||_(v)})}var w=$(m,2),y=N(w),k=$(N(y),2),E=N(k);ae(()=>{I(l),hn(()=>{I(d)})}),Rt(E,5,()=>(I(d),ee(()=>Object.entries(I(d)))),jt,(_,C)=>{var D=$i(()=>Fi(I(C),2));let q=()=>I(D)[0],W=()=>I(D)[1];var R=Yp(),Q=N(R),oe={};ae(()=>{ne(Q,W()),oe!==(oe=q())&&(R.value=(R.__value=q())??"")}),U(_,R)});var T=$(w,2),S=N(T),P=$(N(S),2),L=N(P);ae(()=>{I(o),hn(()=>{I(d)})}),Rt(L,5,()=>(I(d),ee(()=>Object.entries(I(d)))),jt,(_,C)=>{var D=$i(()=>Fi(I(C),2));let q=()=>I(D)[0],W=()=>I(D)[1];var R=Jp(),Q=N(R),oe={};ae(()=>{ne(Q,W()),oe!==(oe=q())&&(R.value=(R.__value=q())??"")}),U(_,R)});var A=$(S,4);kc(A,{get isWorking(){return I(a)},get resetTasksText(){return I(h)},get plugin(){return r()},setIsWorking:g}),ae(()=>Ua(p,1,I(a)?"wait-cursor":"default-cursor")),gn(E,()=>I(l),_=>x(l,_)),pe("change",E,_=>u(_.target.value)),gn(L,()=>I(o),_=>x(o,_)),pe("change",L,_=>f(_.target.value)),U(s,p),mt(),n()}var Zp=G("<button> </button>"),eg=G('<div class="ticktick-settings"> </div> <div class="ticktick-settings"><nav class="settings-tabs"></nav> <div class="TTS-tab-content"><!></div></div>',1);function tg(s,e){gt(e,!1);let t=Le(e,"app",8),i=Le(e,"plugin",8);const n=t().vault.getName(),r=O().version;let a=z("access");const o={access:"Access Control",sync:"Sync Control",manual:"Manual Operations",debug:"Debug Options",tasks:"Task Links",notes:"Notes"};wt();var l=eg(),c=Me(l),d=N(c),g=$(c,2),h=N(g);Rt(h,5,()=>ee(()=>Object.entries(o)),jt,(v,w)=>{var y=$i(()=>Fi(I(w),2));let k=()=>I(y)[0],E=()=>I(y)[1];var T=Zp(),S=N(T);ae(()=>{Ua(T,1,`tab-button ${I(a)===k()?"active":""}`),ne(S,E())}),pe("click",T,()=>x(a,k())),U(v,T)});var u=$(h,2),f=N(u);{var p=v=>{Gf(v,{get plugin(){return i()}})},m=v=>{var w=Nt(),y=Me(w);{var k=T=>{Gp(T,{get plugin(){return i()},get app(){return t()}})},E=T=>{var S=Nt(),P=Me(S);{var L=_=>{rp(_,{get plugin(){return i()}})},A=_=>{var C=Nt(),D=Me(C);{var q=R=>{dp(R,{get plugin(){return i()}})},W=R=>{var Q=Nt(),oe=Me(Q);{var ge=le=>{wp(le,{get plugin(){return i()}})},me=le=>{var Te=Nt(),se=Me(Te);{var ve=K=>{Qp(K,{get plugin(){return i()}})};Oe(se,K=>{I(a)==="tasks"&&K(ve)},!0)}U(le,Te)};Oe(oe,le=>{I(a)==="notes"?le(ge):le(me,!1)},!0)}U(R,Q)};Oe(D,R=>{I(a)==="debug"?R(q):R(W,!1)},!0)}U(_,C)};Oe(P,_=>{I(a)==="manual"?_(L):_(A,!1)},!0)}U(T,S)};Oe(y,T=>{I(a)==="sync"?T(k):T(E,!1)},!0)}U(v,w)};Oe(f,v=>{I(a)==="access"?v(p):v(m,!1)})}ae(()=>ne(d,`${n??""} -- ${r??""}`)),U(s,l),mt()}class ig extends F.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t,Qd(t)}async display(){const{containerEl:e}=this;e.empty(),this.settingsComponent=zl(tg,{target:e,props:{app:this.app,plugin:this.plugin}})}async hide(){super.hide(),await Gl(this.settingsComponent)}getProjectTagText(e){const t=e[O().SyncProject],i=O().SyncTag,n=O().tagAndOr;return!t&&!i?"No limitation.":t&&!i?`Only Tasks in <b>${t}</b> will be synchronized`:!t&&i?`Only Tasks tagged with <b>#${i}</b> tag will be synchronized`:n==1?`Only tasks in <b>${t}</b> AND tagged with <b>#${i}</b> tag will be synchronized`:`All tasks in <b>${t}</b> will be synchronized. All tasks tagged with <b>#${i}</b> tag will be synchronized`}async confirmFullSync(){return await new ConfirmFullSyncModal(this.app,()=>{}).showModal()}}var sg=G('<div class="break-words number svelte-n4w9i4"><h1>Error in Query</h1> <p></p></div>');function ng(s){var e=sg();$(N(e),2),U(s,e)}const rg=Zl(),yc={service:rg};var ag=G(" <br/>",1),og=G("<p> </p>"),lg=G('<div class="warning"><h2>Warnings</h2> <!></div>'),cg=G('<div class="break-words"><h1>Tasks</h1> <p><!></p> <!></div>');function ug(s,e){gt(e,!1);let t=Le(e,"query",8),i=Le(e,"warnings",8),n;yc.service.subscribe(h=>n=h);let r=a(t());async function a(h){return n.getTasks(h.filter)}wt();var o=cg(),l=$(N(o),2),c=N(l);xd(c,()=>r,h=>{var u=Po("Loading tasks...");U(h,u)},(h,u)=>{var f=Nt(),p=Me(f);Rt(p,1,()=>I(u),jt,(m,v)=>{var w=ag(),y=Me(w,!0);ae(()=>ne(y,(I(v),ee(()=>I(v).title)))),U(m,w)}),U(h,f)},(h,u)=>{var f=Po();ae(()=>ne(f,`System error: ${Yt(I(u)),ee(()=>I(u).message)??""}.`)),U(h,f)});var d=$(l,2);{var g=h=>{var u=lg(),f=$(N(u),2);Rt(f,1,i,jt,(p,m)=>{var v=og(),w=N(v);ae(()=>ne(w,I(m))),U(p,v)}),U(h,u)};Oe(d,h=>{Yt(i()),ee(()=>i().length>0)&&h(g)})}U(s,o),mt()}var Pt=(s=>(s[s.Priority=0]="Priority",s[s.PriorityAscending=1]="PriorityAscending",s[s.Date=2]="Date",s[s.DateDescending=3]="DateDescending",s[s.Order=4]="Order",s[s.DateAdded=5]="DateAdded",s[s.DateAddedDescending=6]="DateAddedDescending",s))(Pt||{}),gs=(s=>(s[s.Due=0]="Due",s[s.Project=1]="Project",s[s.Labels=2]="Labels",s[s.Description=3]="Description",s))(gs||{}),hi=(s=>(s[s.None=0]="None",s[s.Project=1]="Project",s[s.Section=2]="Section",s[s.Priority=3]="Priority",s[s.Date=4]="Date",s[s.Label=5]="Label",s))(hi||{});const Xa=Symbol.for("yaml.alias"),_a=Symbol.for("yaml.document"),Di=Symbol.for("yaml.map"),bc=Symbol.for("yaml.pair"),ui=Symbol.for("yaml.scalar"),Vs=Symbol.for("yaml.seq"),qt=Symbol.for("yaml.node.type"),Ri=s=>!!s&&typeof s=="object"&&s[qt]===Xa,ls=s=>!!s&&typeof s=="object"&&s[qt]===_a,zs=s=>!!s&&typeof s=="object"&&s[qt]===Di,xe=s=>!!s&&typeof s=="object"&&s[qt]===bc,Pe=s=>!!s&&typeof s=="object"&&s[qt]===ui,Gs=s=>!!s&&typeof s=="object"&&s[qt]===Vs;function je(s){if(s&&typeof s=="object")switch(s[qt]){case Di:case Vs:return!0}return!1}function Re(s){if(s&&typeof s=="object")switch(s[qt]){case Xa:case Di:case ui:case Vs:return!0}return!1}const wc=s=>(Pe(s)||je(s))&&!!s.anchor,dt=Symbol("break visit"),Tc=Symbol("skip children"),li=Symbol("remove node");function cs(s,e){const t=_c(e);ls(s)?vs(null,s.contents,t,Object.freeze([s]))===li&&(s.contents=null):vs(null,s,t,Object.freeze([]))}cs.BREAK=dt;cs.SKIP=Tc;cs.REMOVE=li;function vs(s,e,t,i){const n=Ic(s,e,t,i);if(Re(n)||xe(n))return Sc(s,i,n),vs(s,n,t,i);if(typeof n!="symbol"){if(je(e)){i=Object.freeze(i.concat(e));for(let r=0;r<e.items.length;++r){const a=vs(r,e.items[r],t,i);if(typeof a=="number")r=a-1;else{if(a===dt)return dt;a===li&&(e.items.splice(r,1),r-=1)}}}else if(xe(e)){i=Object.freeze(i.concat(e));const r=vs("key",e.key,t,i);if(r===dt)return dt;r===li&&(e.key=null);const a=vs("value",e.value,t,i);if(a===dt)return dt;a===li&&(e.value=null)}}return n}async function Dr(s,e){const t=_c(e);ls(s)?await ks(null,s.contents,t,Object.freeze([s]))===li&&(s.contents=null):await ks(null,s,t,Object.freeze([]))}Dr.BREAK=dt;Dr.SKIP=Tc;Dr.REMOVE=li;async function ks(s,e,t,i){const n=await Ic(s,e,t,i);if(Re(n)||xe(n))return Sc(s,i,n),ks(s,n,t,i);if(typeof n!="symbol"){if(je(e)){i=Object.freeze(i.concat(e));for(let r=0;r<e.items.length;++r){const a=await ks(r,e.items[r],t,i);if(typeof a=="number")r=a-1;else{if(a===dt)return dt;a===li&&(e.items.splice(r,1),r-=1)}}}else if(xe(e)){i=Object.freeze(i.concat(e));const r=await ks("key",e.key,t,i);if(r===dt)return dt;r===li&&(e.key=null);const a=await ks("value",e.value,t,i);if(a===dt)return dt;a===li&&(e.value=null)}}return n}function _c(s){return typeof s=="object"&&(s.Collection||s.Node||s.Value)?Object.assign({Alias:s.Node,Map:s.Node,Scalar:s.Node,Seq:s.Node},s.Value&&{Map:s.Value,Scalar:s.Value,Seq:s.Value},s.Collection&&{Map:s.Collection,Seq:s.Collection},s):s}function Ic(s,e,t,i){var n,r,a,o,l;if(typeof t=="function")return t(s,e,i);if(zs(e))return(n=t.Map)==null?void 0:n.call(t,s,e,i);if(Gs(e))return(r=t.Seq)==null?void 0:r.call(t,s,e,i);if(xe(e))return(a=t.Pair)==null?void 0:a.call(t,s,e,i);if(Pe(e))return(o=t.Scalar)==null?void 0:o.call(t,s,e,i);if(Ri(e))return(l=t.Alias)==null?void 0:l.call(t,s,e,i)}function Sc(s,e,t){const i=e[e.length-1];if(je(i))i.items[s]=t;else if(xe(i))s==="key"?i.key=t:i.value=t;else if(ls(i))i.contents=t;else{const n=Ri(i)?"alias":"scalar";throw new Error(`Cannot replace node with ${n} parent`)}}const dg={"!":"%21",",":"%2C","[":"%5B","]":"%5D","{":"%7B","}":"%7D"},fg=s=>s.replace(/[!,[\]{}]/g,e=>dg[e]);class it{constructor(e,t){this.docStart=null,this.docEnd=!1,this.yaml=Object.assign({},it.defaultYaml,e),this.tags=Object.assign({},it.defaultTags,t)}clone(){const e=new it(this.yaml,this.tags);return e.docStart=this.docStart,e}atDocument(){const e=new it(this.yaml,this.tags);switch(this.yaml.version){case"1.1":this.atNextDocument=!0;break;case"1.2":this.atNextDocument=!1,this.yaml={explicit:it.defaultYaml.explicit,version:"1.2"},this.tags=Object.assign({},it.defaultTags);break}return e}add(e,t){this.atNextDocument&&(this.yaml={explicit:it.defaultYaml.explicit,version:"1.1"},this.tags=Object.assign({},it.defaultTags),this.atNextDocument=!1);const i=e.trim().split(/[ \t]+/),n=i.shift();switch(n){case"%TAG":{if(i.length!==2&&(t(0,"%TAG directive should contain exactly two parts"),i.length<2))return!1;const[r,a]=i;return this.tags[r]=a,!0}case"%YAML":{if(this.yaml.explicit=!0,i.length!==1)return t(0,"%YAML directive should contain exactly one part"),!1;const[r]=i;if(r==="1.1"||r==="1.2")return this.yaml.version=r,!0;{const a=/^\d+\.\d+$/.test(r);return t(6,`Unsupported YAML version ${r}`,a),!1}}default:return t(0,`Unknown directive ${n}`,!0),!1}}tagName(e,t){if(e==="!")return"!";if(e[0]!=="!")return t(`Not a valid tag: ${e}`),null;if(e[1]==="<"){const a=e.slice(2,-1);return a==="!"||a==="!!"?(t(`Verbatim tags aren't resolved, so ${e} is invalid.`),null):(e[e.length-1]!==">"&&t("Verbatim tags must end with a >"),a)}const[,i,n]=e.match(/^(.*!)([^!]*)$/s);n||t(`The ${e} tag has no suffix`);const r=this.tags[i];if(r)try{return r+decodeURIComponent(n)}catch(a){return t(String(a)),null}return i==="!"?e:(t(`Could not resolve tag: ${e}`),null)}tagString(e){for(const[t,i]of Object.entries(this.tags))if(e.startsWith(i))return t+fg(e.substring(i.length));return e[0]==="!"?e:`!<${e}>`}toString(e){const t=this.yaml.explicit?[`%YAML ${this.yaml.version||"1.2"}`]:[],i=Object.entries(this.tags);let n;if(e&&i.length>0&&Re(e.contents)){const r={};cs(e.contents,(a,o)=>{Re(o)&&o.tag&&(r[o.tag]=!0)}),n=Object.keys(r)}else n=[];for(const[r,a]of i)r==="!!"&&a==="tag:yaml.org,2002:"||(!e||n.some(o=>o.startsWith(a)))&&t.push(`%TAG ${r} ${a}`);return t.join(`
`)}}it.defaultYaml={explicit:!1,version:"1.2"};it.defaultTags={"!!":"tag:yaml.org,2002:"};function Pc(s){if(/[\x00-\x19\s,[\]{}]/.test(s)){const t=`Anchor must not contain whitespace or control characters: ${JSON.stringify(s)}`;throw new Error(t)}return!0}function Ec(s){const e=new Set;return cs(s,{Value(t,i){i.anchor&&e.add(i.anchor)}}),e}function Cc(s,e){for(let t=1;;++t){const i=`${s}${t}`;if(!e.has(i))return i}}function hg(s,e){const t=[],i=new Map;let n=null;return{onAnchor:r=>{t.push(r),n??(n=Ec(s));const a=Cc(e,n);return n.add(a),a},setAnchors:()=>{for(const r of t){const a=i.get(r);if(typeof a=="object"&&a.anchor&&(Pe(a.node)||je(a.node)))a.node.anchor=a.anchor;else{const o=new Error("Failed to resolve repeated object (this should not happen)");throw o.source=r,o}}},sourceObjects:i}}function ys(s,e,t,i){if(i&&typeof i=="object")if(Array.isArray(i))for(let n=0,r=i.length;n<r;++n){const a=i[n],o=ys(s,i,String(n),a);o===void 0?delete i[n]:o!==a&&(i[n]=o)}else if(i instanceof Map)for(const n of Array.from(i.keys())){const r=i.get(n),a=ys(s,i,n,r);a===void 0?i.delete(n):a!==r&&i.set(n,a)}else if(i instanceof Set)for(const n of Array.from(i)){const r=ys(s,i,n,n);r===void 0?i.delete(n):r!==n&&(i.delete(n),i.add(r))}else for(const[n,r]of Object.entries(i)){const a=ys(s,i,n,r);a===void 0?delete i[n]:a!==r&&(i[n]=a)}return s.call(e,t,i)}function xt(s,e,t){if(Array.isArray(s))return s.map((i,n)=>xt(i,String(n),t));if(s&&typeof s.toJSON=="function"){if(!t||!wc(s))return s.toJSON(e,t);const i={aliasCount:0,count:1,res:void 0};t.anchors.set(s,i),t.onCreate=r=>{i.res=r,delete t.onCreate};const n=s.toJSON(e,t);return t.onCreate&&t.onCreate(n),n}return typeof s=="bigint"&&!(t!=null&&t.keep)?Number(s):s}class Qa{constructor(e){Object.defineProperty(this,qt,{value:e})}clone(){const e=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return this.range&&(e.range=this.range.slice()),e}toJS(e,{mapAsMap:t,maxAliasCount:i,onAnchor:n,reviver:r}={}){if(!ls(e))throw new TypeError("A document argument is required");const a={anchors:new Map,doc:e,keep:!0,mapAsMap:t===!0,mapKeyWarned:!1,maxAliasCount:typeof i=="number"?i:100},o=xt(this,"",a);if(typeof n=="function")for(const{count:l,res:c}of a.anchors.values())n(c,l);return typeof r=="function"?ys(r,{"":o},"",o):o}}class Fr extends Qa{constructor(e){super(Xa),this.source=e,Object.defineProperty(this,"tag",{set(){throw new Error("Alias nodes cannot have tags")}})}resolve(e,t){let i;t!=null&&t.aliasResolveCache?i=t.aliasResolveCache:(i=[],cs(e,{Node:(r,a)=>{(Ri(a)||wc(a))&&i.push(a)}}),t&&(t.aliasResolveCache=i));let n;for(const r of i){if(r===this)break;r.anchor===this.source&&(n=r)}return n}toJSON(e,t){if(!t)return{source:this.source};const{anchors:i,doc:n,maxAliasCount:r}=t,a=this.resolve(n,t);if(!a){const l=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new ReferenceError(l)}let o=i.get(a);if(o||(xt(a,null,t),o=i.get(a)),!o||o.res===void 0){const l="This should not happen: Alias anchor was not resolved?";throw new ReferenceError(l)}if(r>=0&&(o.count+=1,o.aliasCount===0&&(o.aliasCount=nr(n,a,i)),o.count*o.aliasCount>r)){const l="Excessive alias count indicates a resource exhaustion attack";throw new ReferenceError(l)}return o.res}toString(e,t,i){const n=`*${this.source}`;if(e){if(Pc(this.source),e.options.verifyAliasOrder&&!e.anchors.has(this.source)){const r=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new Error(r)}if(e.implicitKey)return`${n} `}return n}}function nr(s,e,t){if(Ri(e)){const i=e.resolve(s),n=t&&i&&t.get(i);return n?n.count*n.aliasCount:0}else if(je(e)){let i=0;for(const n of e.items){const r=nr(s,n,t);r>i&&(i=r)}return i}else if(xe(e)){const i=nr(s,e.key,t),n=nr(s,e.value,t);return Math.max(i,n)}return 1}const Oc=s=>!s||typeof s!="function"&&typeof s!="object";class Z extends Qa{constructor(e){super(ui),this.value=e}toJSON(e,t){return t!=null&&t.keep?this.value:xt(this.value,e,t)}toString(){return String(this.value)}}Z.BLOCK_FOLDED="BLOCK_FOLDED";Z.BLOCK_LITERAL="BLOCK_LITERAL";Z.PLAIN="PLAIN";Z.QUOTE_DOUBLE="QUOTE_DOUBLE";Z.QUOTE_SINGLE="QUOTE_SINGLE";const pg="tag:yaml.org,2002:";function gg(s,e,t){if(e){const i=t.filter(r=>r.tag===e),n=i.find(r=>!r.format)??i[0];if(!n)throw new Error(`Tag ${e} not found`);return n}return t.find(i=>{var n;return((n=i.identify)==null?void 0:n.call(i,s))&&!i.format})}function kn(s,e,t){var g,h,u;if(ls(s)&&(s=s.contents),Re(s))return s;if(xe(s)){const f=(h=(g=t.schema[Di]).createNode)==null?void 0:h.call(g,t.schema,null,t);return f.items.push(s),f}(s instanceof String||s instanceof Number||s instanceof Boolean||typeof BigInt<"u"&&s instanceof BigInt)&&(s=s.valueOf());const{aliasDuplicateObjects:i,onAnchor:n,onTagObj:r,schema:a,sourceObjects:o}=t;let l;if(i&&s&&typeof s=="object"){if(l=o.get(s),l)return l.anchor??(l.anchor=n(s)),new Fr(l.anchor);l={anchor:null,node:null},o.set(s,l)}e!=null&&e.startsWith("!!")&&(e=pg+e.slice(2));let c=gg(s,e,a.tags);if(!c){if(s&&typeof s.toJSON=="function"&&(s=s.toJSON()),!s||typeof s!="object"){const f=new Z(s);return l&&(l.node=f),f}c=s instanceof Map?a[Di]:Symbol.iterator in Object(s)?a[Vs]:a[Di]}r&&(r(c),delete t.onTagObj);const d=c!=null&&c.createNode?c.createNode(t.schema,s,t):typeof((u=c==null?void 0:c.nodeClass)==null?void 0:u.from)=="function"?c.nodeClass.from(t.schema,s,t):new Z(s);return e?d.tag=e:c.default||(d.tag=c.tag),l&&(l.node=d),d}function mr(s,e,t){let i=t;for(let n=e.length-1;n>=0;--n){const r=e[n];if(typeof r=="number"&&Number.isInteger(r)&&r>=0){const a=[];a[r]=i,i=a}else i=new Map([[r,i]])}return kn(i,void 0,{aliasDuplicateObjects:!1,keepUndefined:!1,onAnchor:()=>{throw new Error("This should not happen, please report a bug.")},schema:s,sourceObjects:new Map})}const an=s=>s==null||typeof s=="object"&&!!s[Symbol.iterator]().next().done;class Ac extends Qa{constructor(e,t){super(e),Object.defineProperty(this,"schema",{value:t,configurable:!0,enumerable:!1,writable:!0})}clone(e){const t=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return e&&(t.schema=e),t.items=t.items.map(i=>Re(i)||xe(i)?i.clone(e):i),this.range&&(t.range=this.range.slice()),t}addIn(e,t){if(an(e))this.add(t);else{const[i,...n]=e,r=this.get(i,!0);if(je(r))r.addIn(n,t);else if(r===void 0&&this.schema)this.set(i,mr(this.schema,n,t));else throw new Error(`Expected YAML collection at ${i}. Remaining path: ${n}`)}}deleteIn(e){const[t,...i]=e;if(i.length===0)return this.delete(t);const n=this.get(t,!0);if(je(n))return n.deleteIn(i);throw new Error(`Expected YAML collection at ${t}. Remaining path: ${i}`)}getIn(e,t){const[i,...n]=e,r=this.get(i,!0);return n.length===0?!t&&Pe(r)?r.value:r:je(r)?r.getIn(n,t):void 0}hasAllNullValues(e){return this.items.every(t=>{if(!xe(t))return!1;const i=t.value;return i==null||e&&Pe(i)&&i.value==null&&!i.commentBefore&&!i.comment&&!i.tag})}hasIn(e){const[t,...i]=e;if(i.length===0)return this.has(t);const n=this.get(t,!0);return je(n)?n.hasIn(i):!1}setIn(e,t){const[i,...n]=e;if(n.length===0)this.set(i,t);else{const r=this.get(i,!0);if(je(r))r.setIn(n,t);else if(r===void 0&&this.schema)this.set(i,mr(this.schema,n,t));else throw new Error(`Expected YAML collection at ${i}. Remaining path: ${n}`)}}}const mg=s=>s.replace(/^(?!$)(?: $)?/gm,"#");function pi(s,e){return/^\n+$/.test(s)?s.substring(1):e?s.replace(/^(?! *$)/gm,e):s}const Ui=(s,e,t)=>s.endsWith(`
`)?pi(t,e):t.includes(`
`)?`
`+pi(t,e):(s.endsWith(" ")?"":" ")+t,Nc="flow",Ia="block",rr="quoted";function xr(s,e,t="flow",{indentAtStart:i,lineWidth:n=80,minContentWidth:r=20,onFold:a,onOverflow:o}={}){if(!n||n<0)return s;n<r&&(r=0);const l=Math.max(1+r,1+n-e.length);if(s.length<=l)return s;const c=[],d={};let g=n-e.length;typeof i=="number"&&(i>n-Math.max(2,r)?c.push(0):g=n-i);let h,u,f=!1,p=-1,m=-1,v=-1;t===Ia&&(p=Yo(s,p,e.length),p!==-1&&(g=p+l));for(let y;y=s[p+=1];){if(t===rr&&y==="\\"){switch(m=p,s[p+1]){case"x":p+=3;break;case"u":p+=5;break;case"U":p+=9;break;default:p+=1}v=p}if(y===`
`)t===Ia&&(p=Yo(s,p,e.length)),g=p+e.length+l,h=void 0;else{if(y===" "&&u&&u!==" "&&u!==`
`&&u!=="	"){const k=s[p+1];k&&k!==" "&&k!==`
`&&k!=="	"&&(h=p)}if(p>=g)if(h)c.push(h),g=h+l,h=void 0;else if(t===rr){for(;u===" "||u==="	";)u=y,y=s[p+=1],f=!0;const k=p>v+1?p-2:m-1;if(d[k])return s;c.push(k),d[k]=!0,g=k+l,h=void 0}else f=!0}u=y}if(f&&o&&o(),c.length===0)return s;a&&a();let w=s.slice(0,c[0]);for(let y=0;y<c.length;++y){const k=c[y],E=c[y+1]||s.length;k===0?w=`
${e}${s.slice(0,E)}`:(t===rr&&d[k]&&(w+=`${s[k]}\\`),w+=`
${e}${s.slice(k+1,E)}`)}return w}function Yo(s,e,t){let i=e,n=e+1,r=s[n];for(;r===" "||r==="	";)if(e<n+t)r=s[++e];else{do r=s[++e];while(r&&r!==`
`);i=e,n=e+1,r=s[n]}return i}const $r=(s,e)=>({indentAtStart:e?s.indent.length:s.indentAtStart,lineWidth:s.options.lineWidth,minContentWidth:s.options.minContentWidth}),Mr=s=>/^(%|---|\.\.\.)/m.test(s);function vg(s,e,t){if(!e||e<0)return!1;const i=e-t,n=s.length;if(n<=i)return!1;for(let r=0,a=0;r<n;++r)if(s[r]===`
`){if(r-a>i)return!0;if(a=r+1,n-a<=i)return!1}return!0}function fn(s,e){const t=JSON.stringify(s);if(e.options.doubleQuotedAsJSON)return t;const{implicitKey:i}=e,n=e.options.doubleQuotedMinMultiLineLength,r=e.indent||(Mr(s)?"  ":"");let a="",o=0;for(let l=0,c=t[l];c;c=t[++l])if(c===" "&&t[l+1]==="\\"&&t[l+2]==="n"&&(a+=t.slice(o,l)+"\\ ",l+=1,o=l,c="\\"),c==="\\")switch(t[l+1]){case"u":{a+=t.slice(o,l);const d=t.substr(l+2,4);switch(d){case"0000":a+="\\0";break;case"0007":a+="\\a";break;case"000b":a+="\\v";break;case"001b":a+="\\e";break;case"0085":a+="\\N";break;case"00a0":a+="\\_";break;case"2028":a+="\\L";break;case"2029":a+="\\P";break;default:d.substr(0,2)==="00"?a+="\\x"+d.substr(2):a+=t.substr(l,6)}l+=5,o=l+1}break;case"n":if(i||t[l+2]==='"'||t.length<n)l+=1;else{for(a+=t.slice(o,l)+`

`;t[l+2]==="\\"&&t[l+3]==="n"&&t[l+4]!=='"';)a+=`
`,l+=2;a+=r,t[l+2]===" "&&(a+="\\"),l+=1,o=l+1}break;default:l+=1}return a=o?a+t.slice(o):t,i?a:xr(a,r,rr,$r(e,!1))}function Sa(s,e){if(e.options.singleQuote===!1||e.implicitKey&&s.includes(`
`)||/[ \t]\n|\n[ \t]/.test(s))return fn(s,e);const t=e.indent||(Mr(s)?"  ":""),i="'"+s.replace(/'/g,"''").replace(/\n+/g,`$&
${t}`)+"'";return e.implicitKey?i:xr(i,t,Nc,$r(e,!1))}function bs(s,e){const{singleQuote:t}=e.options;let i;if(t===!1)i=fn;else{const n=s.includes('"'),r=s.includes("'");n&&!r?i=Sa:r&&!n?i=fn:i=t?Sa:fn}return i(s,e)}let Pa;try{Pa=new RegExp(`(^|(?<!
))
+(?!
|$)`,"g")}catch{Pa=/\n+(?!\n|$)/g}function ar({comment:s,type:e,value:t},i,n,r){const{blockQuote:a,commentString:o,lineWidth:l}=i.options;if(!a||/\n[\t ]+$/.test(t))return bs(t,i);const c=i.indent||(i.forceBlockIndent||Mr(t)?"  ":""),d=a==="literal"?!0:a==="folded"||e===Z.BLOCK_FOLDED?!1:e===Z.BLOCK_LITERAL?!0:!vg(t,l,c.length);if(!t)return d?`|
`:`>
`;let g,h;for(h=t.length;h>0;--h){const E=t[h-1];if(E!==`
`&&E!=="	"&&E!==" ")break}let u=t.substring(h);const f=u.indexOf(`
`);f===-1?g="-":t===u||f!==u.length-1?(g="+",r&&r()):g="",u&&(t=t.slice(0,-u.length),u[u.length-1]===`
`&&(u=u.slice(0,-1)),u=u.replace(Pa,`$&${c}`));let p=!1,m,v=-1;for(m=0;m<t.length;++m){const E=t[m];if(E===" ")p=!0;else if(E===`
`)v=m;else break}let w=t.substring(0,v<m?v+1:m);w&&(t=t.substring(w.length),w=w.replace(/\n+/g,`$&${c}`));let k=(p?c?"2":"1":"")+g;if(s&&(k+=" "+o(s.replace(/ ?[\r\n]+/g," ")),n&&n()),!d){const E=t.replace(/\n+/g,`
$&`).replace(/(?:^|\n)([\t ].*)(?:([\n\t ]*)\n(?![\n\t ]))?/g,"$1$2").replace(/\n+/g,`$&${c}`);let T=!1;const S=$r(i,!0);a!=="folded"&&e!==Z.BLOCK_FOLDED&&(S.onOverflow=()=>{T=!0});const P=xr(`${w}${E}${u}`,c,Ia,S);if(!T)return`>${k}
${c}${P}`}return t=t.replace(/\n+/g,`$&${c}`),`|${k}
${c}${w}${t}${u}`}function kg(s,e,t,i){const{type:n,value:r}=s,{actualString:a,implicitKey:o,indent:l,indentStep:c,inFlow:d}=e;if(o&&r.includes(`
`)||d&&/[[\]{},]/.test(r))return bs(r,e);if(/^[\n\t ,[\]{}#&*!|>'"%@`]|^[?-]$|^[?-][ \t]|[\n:][ \t]|[ \t]\n|[\n\t ]#|[\n\t :]$/.test(r))return o||d||!r.includes(`
`)?bs(r,e):ar(s,e,t,i);if(!o&&!d&&n!==Z.PLAIN&&r.includes(`
`))return ar(s,e,t,i);if(Mr(r)){if(l==="")return e.forceBlockIndent=!0,ar(s,e,t,i);if(o&&l===c)return bs(r,e)}const g=r.replace(/\n+/g,`$&
${l}`);if(a){const h=p=>{var m;return p.default&&p.tag!=="tag:yaml.org,2002:str"&&((m=p.test)==null?void 0:m.test(g))},{compat:u,tags:f}=e.doc.schema;if(f.some(h)||u!=null&&u.some(h))return bs(r,e)}return o?g:xr(g,l,Nc,$r(e,!1))}function Rn(s,e,t,i){const{implicitKey:n,inFlow:r}=e,a=typeof s.value=="string"?s:Object.assign({},s,{value:String(s.value)});let{type:o}=s;o!==Z.QUOTE_DOUBLE&&/[\x00-\x08\x0b-\x1f\x7f-\x9f\u{D800}-\u{DFFF}]/u.test(a.value)&&(o=Z.QUOTE_DOUBLE);const l=d=>{switch(d){case Z.BLOCK_FOLDED:case Z.BLOCK_LITERAL:return n||r?bs(a.value,e):ar(a,e,t,i);case Z.QUOTE_DOUBLE:return fn(a.value,e);case Z.QUOTE_SINGLE:return Sa(a.value,e);case Z.PLAIN:return kg(a,e,t,i);default:return null}};let c=l(o);if(c===null){const{defaultKeyType:d,defaultStringType:g}=e.options,h=n&&d||g;if(c=l(h),c===null)throw new Error(`Unsupported default string type ${h}`)}return c}function Lc(s,e){const t=Object.assign({blockQuote:!0,commentString:mg,defaultKeyType:null,defaultStringType:"PLAIN",directives:null,doubleQuotedAsJSON:!1,doubleQuotedMinMultiLineLength:40,falseStr:"false",flowCollectionPadding:!0,indentSeq:!0,lineWidth:80,minContentWidth:20,nullStr:"null",simpleKeys:!1,singleQuote:null,trueStr:"true",verifyAliasOrder:!0},s.schema.toStringOptions,e);let i;switch(t.collectionStyle){case"block":i=!1;break;case"flow":i=!0;break;default:i=null}return{anchors:new Set,doc:s,flowCollectionPadding:t.flowCollectionPadding?" ":"",indent:"",indentStep:typeof t.indent=="number"?" ".repeat(t.indent):"  ",inFlow:i,options:t}}function yg(s,e){var n;if(e.tag){const r=s.filter(a=>a.tag===e.tag);if(r.length>0)return r.find(a=>a.format===e.format)??r[0]}let t,i;if(Pe(e)){i=e.value;let r=s.filter(a=>{var o;return(o=a.identify)==null?void 0:o.call(a,i)});if(r.length>1){const a=r.filter(o=>o.test);a.length>0&&(r=a)}t=r.find(a=>a.format===e.format)??r.find(a=>!a.format)}else i=e,t=s.find(r=>r.nodeClass&&i instanceof r.nodeClass);if(!t){const r=((n=i==null?void 0:i.constructor)==null?void 0:n.name)??(i===null?"null":typeof i);throw new Error(`Tag not resolved for ${r} value`)}return t}function bg(s,e,{anchors:t,doc:i}){if(!i.directives)return"";const n=[],r=(Pe(s)||je(s))&&s.anchor;r&&Pc(r)&&(t.add(r),n.push(`&${r}`));const a=s.tag??(e.default?null:e.tag);return a&&n.push(i.directives.tagString(a)),n.join(" ")}function Ms(s,e,t,i){var l;if(xe(s))return s.toString(e,t,i);if(Ri(s)){if(e.doc.directives)return s.toString(e);if((l=e.resolvedAliases)!=null&&l.has(s))throw new TypeError("Cannot stringify circular structure without alias nodes");e.resolvedAliases?e.resolvedAliases.add(s):e.resolvedAliases=new Set([s]),s=s.resolve(e.doc)}let n;const r=Re(s)?s:e.doc.createNode(s,{onTagObj:c=>n=c});n??(n=yg(e.doc.schema.tags,r));const a=bg(r,n,e);a.length>0&&(e.indentAtStart=(e.indentAtStart??0)+a.length+1);const o=typeof n.stringify=="function"?n.stringify(r,e,t,i):Pe(r)?Rn(r,e,t,i):r.toString(e,t,i);return a?Pe(r)||o[0]==="{"||o[0]==="["?`${a} ${o}`:`${a}
${e.indent}${o}`:o}function wg({key:s,value:e},t,i,n){const{allNullValues:r,doc:a,indent:o,indentStep:l,options:{commentString:c,indentSeq:d,simpleKeys:g}}=t;let h=Re(s)&&s.comment||null;if(g){if(h)throw new Error("With simple keys, key nodes cannot have comments");if(je(s)||!Re(s)&&typeof s=="object"){const S="With simple keys, collection cannot be used as a key value";throw new Error(S)}}let u=!g&&(!s||h&&e==null&&!t.inFlow||je(s)||(Pe(s)?s.type===Z.BLOCK_FOLDED||s.type===Z.BLOCK_LITERAL:typeof s=="object"));t=Object.assign({},t,{allNullValues:!1,implicitKey:!u&&(g||!r),indent:o+l});let f=!1,p=!1,m=Ms(s,t,()=>f=!0,()=>p=!0);if(!u&&!t.inFlow&&m.length>1024){if(g)throw new Error("With simple keys, single line scalar must not span more than 1024 characters");u=!0}if(t.inFlow){if(r||e==null)return f&&i&&i(),m===""?"?":u?`? ${m}`:m}else if(r&&!g||e==null&&u)return m=`? ${m}`,h&&!f?m+=Ui(m,t.indent,c(h)):p&&n&&n(),m;f&&(h=null),u?(h&&(m+=Ui(m,t.indent,c(h))),m=`? ${m}
${o}:`):(m=`${m}:`,h&&(m+=Ui(m,t.indent,c(h))));let v,w,y;Re(e)?(v=!!e.spaceBefore,w=e.commentBefore,y=e.comment):(v=!1,w=null,y=null,e&&typeof e=="object"&&(e=a.createNode(e))),t.implicitKey=!1,!u&&!h&&Pe(e)&&(t.indentAtStart=m.length+1),p=!1,!d&&l.length>=2&&!t.inFlow&&!u&&Gs(e)&&!e.flow&&!e.tag&&!e.anchor&&(t.indent=t.indent.substring(2));let k=!1;const E=Ms(e,t,()=>k=!0,()=>p=!0);let T=" ";if(h||v||w){if(T=v?`
`:"",w){const S=c(w);T+=`
${pi(S,t.indent)}`}E===""&&!t.inFlow?T===`
`&&(T=`

`):T+=`
${t.indent}`}else if(!u&&je(e)){const S=E[0],P=E.indexOf(`
`),L=P!==-1,A=t.inFlow??e.flow??e.items.length===0;if(L||!A){let _=!1;if(L&&(S==="&"||S==="!")){let C=E.indexOf(" ");S==="&"&&C!==-1&&C<P&&E[C+1]==="!"&&(C=E.indexOf(" ",C+1)),(C===-1||P<C)&&(_=!0)}_||(T=`
${t.indent}`)}}else(E===""||E[0]===`
`)&&(T="");return m+=T+E,t.inFlow?k&&i&&i():y&&!k?m+=Ui(m,t.indent,c(y)):p&&n&&n(),m}function Dc(s,e){(s==="debug"||s==="warn")&&console.warn(e)}const Gn="<<",gi={identify:s=>s===Gn||typeof s=="symbol"&&s.description===Gn,default:"key",tag:"tag:yaml.org,2002:merge",test:/^<<$/,resolve:()=>Object.assign(new Z(Symbol(Gn)),{addToJSMap:Fc}),stringify:()=>Gn},Tg=(s,e)=>(gi.identify(e)||Pe(e)&&(!e.type||e.type===Z.PLAIN)&&gi.identify(e.value))&&(s==null?void 0:s.doc.schema.tags.some(t=>t.tag===gi.tag&&t.default));function Fc(s,e,t){if(t=s&&Ri(t)?t.resolve(s.doc):t,Gs(t))for(const i of t.items)na(s,e,i);else if(Array.isArray(t))for(const i of t)na(s,e,i);else na(s,e,t)}function na(s,e,t){const i=s&&Ri(t)?t.resolve(s.doc):t;if(!zs(i))throw new Error("Merge sources must be maps or map aliases");const n=i.toJSON(null,s,Map);for(const[r,a]of n)e instanceof Map?e.has(r)||e.set(r,a):e instanceof Set?e.add(r):Object.prototype.hasOwnProperty.call(e,r)||Object.defineProperty(e,r,{value:a,writable:!0,enumerable:!0,configurable:!0});return e}function xc(s,e,{key:t,value:i}){if(Re(t)&&t.addToJSMap)t.addToJSMap(s,e,i);else if(Tg(s,t))Fc(s,e,i);else{const n=xt(t,"",s);if(e instanceof Map)e.set(n,xt(i,n,s));else if(e instanceof Set)e.add(n);else{const r=_g(t,n,s),a=xt(i,r,s);r in e?Object.defineProperty(e,r,{value:a,writable:!0,enumerable:!0,configurable:!0}):e[r]=a}}return e}function _g(s,e,t){if(e===null)return"";if(typeof e!="object")return String(e);if(Re(s)&&(t!=null&&t.doc)){const i=Lc(t.doc,{});i.anchors=new Set;for(const r of t.anchors.keys())i.anchors.add(r.anchor);i.inFlow=!0,i.inStringifyKey=!0;const n=s.toString(i);if(!t.mapKeyWarned){let r=JSON.stringify(n);r.length>40&&(r=r.substring(0,36)+'..."'),Dc(t.doc.options.logLevel,`Keys with collection values will be stringified due to JS Object restrictions: ${r}. Set mapAsMap: true to use object keys.`),t.mapKeyWarned=!0}return n}return JSON.stringify(e)}function Za(s,e,t){const i=kn(s,void 0,t),n=kn(e,void 0,t);return new Xe(i,n)}class Xe{constructor(e,t=null){Object.defineProperty(this,qt,{value:bc}),this.key=e,this.value=t}clone(e){let{key:t,value:i}=this;return Re(t)&&(t=t.clone(e)),Re(i)&&(i=i.clone(e)),new Xe(t,i)}toJSON(e,t){const i=t!=null&&t.mapAsMap?new Map:{};return xc(t,i,this)}toString(e,t,i){return e!=null&&e.doc?wg(this,e,t,i):JSON.stringify(this)}}function $c(s,e,t){return(e.inFlow??s.flow?Sg:Ig)(s,e,t)}function Ig({comment:s,items:e},t,{blockItemPrefix:i,flowChars:n,itemIndent:r,onChompKeep:a,onComment:o}){const{indent:l,options:{commentString:c}}=t,d=Object.assign({},t,{indent:r,type:null});let g=!1;const h=[];for(let f=0;f<e.length;++f){const p=e[f];let m=null;if(Re(p))!g&&p.spaceBefore&&h.push(""),vr(t,h,p.commentBefore,g),p.comment&&(m=p.comment);else if(xe(p)){const w=Re(p.key)?p.key:null;w&&(!g&&w.spaceBefore&&h.push(""),vr(t,h,w.commentBefore,g))}g=!1;let v=Ms(p,d,()=>m=null,()=>g=!0);m&&(v+=Ui(v,r,c(m))),g&&m&&(g=!1),h.push(i+v)}let u;if(h.length===0)u=n.start+n.end;else{u=h[0];for(let f=1;f<h.length;++f){const p=h[f];u+=p?`
${l}${p}`:`
`}}return s?(u+=`
`+pi(c(s),l),o&&o()):g&&a&&a(),u}function Sg({items:s},e,{flowChars:t,itemIndent:i}){const{indent:n,indentStep:r,flowCollectionPadding:a,options:{commentString:o}}=e;i+=r;const l=Object.assign({},e,{indent:i,inFlow:!0,type:null});let c=!1,d=0;const g=[];for(let f=0;f<s.length;++f){const p=s[f];let m=null;if(Re(p))p.spaceBefore&&g.push(""),vr(e,g,p.commentBefore,!1),p.comment&&(m=p.comment);else if(xe(p)){const w=Re(p.key)?p.key:null;w&&(w.spaceBefore&&g.push(""),vr(e,g,w.commentBefore,!1),w.comment&&(c=!0));const y=Re(p.value)?p.value:null;y?(y.comment&&(m=y.comment),y.commentBefore&&(c=!0)):p.value==null&&(w!=null&&w.comment)&&(m=w.comment)}m&&(c=!0);let v=Ms(p,l,()=>m=null);f<s.length-1&&(v+=","),m&&(v+=Ui(v,i,o(m))),!c&&(g.length>d||v.includes(`
`))&&(c=!0),g.push(v),d=g.length}const{start:h,end:u}=t;if(g.length===0)return h+u;if(!c){const f=g.reduce((p,m)=>p+m.length+2,2);c=e.options.lineWidth>0&&f>e.options.lineWidth}if(c){let f=h;for(const p of g)f+=p?`
${r}${n}${p}`:`
`;return`${f}
${n}${u}`}else return`${h}${a}${g.join(" ")}${a}${u}`}function vr({indent:s,options:{commentString:e}},t,i,n){if(i&&n&&(i=i.replace(/^\n+/,"")),i){const r=pi(e(i),s);t.push(r.trimStart())}}function qi(s,e){const t=Pe(e)?e.value:e;for(const i of s)if(xe(i)&&(i.key===e||i.key===t||Pe(i.key)&&i.key.value===t))return i}class kt extends Ac{static get tagName(){return"tag:yaml.org,2002:map"}constructor(e){super(Di,e),this.items=[]}static from(e,t,i){const{keepUndefined:n,replacer:r}=i,a=new this(e),o=(l,c)=>{if(typeof r=="function")c=r.call(t,l,c);else if(Array.isArray(r)&&!r.includes(l))return;(c!==void 0||n)&&a.items.push(Za(l,c,i))};if(t instanceof Map)for(const[l,c]of t)o(l,c);else if(t&&typeof t=="object")for(const l of Object.keys(t))o(l,t[l]);return typeof e.sortMapEntries=="function"&&a.items.sort(e.sortMapEntries),a}add(e,t){var a;let i;xe(e)?i=e:!e||typeof e!="object"||!("key"in e)?i=new Xe(e,e==null?void 0:e.value):i=new Xe(e.key,e.value);const n=qi(this.items,i.key),r=(a=this.schema)==null?void 0:a.sortMapEntries;if(n){if(!t)throw new Error(`Key ${i.key} already set`);Pe(n.value)&&Oc(i.value)?n.value.value=i.value:n.value=i.value}else if(r){const o=this.items.findIndex(l=>r(i,l)<0);o===-1?this.items.push(i):this.items.splice(o,0,i)}else this.items.push(i)}delete(e){const t=qi(this.items,e);return t?this.items.splice(this.items.indexOf(t),1).length>0:!1}get(e,t){const i=qi(this.items,e),n=i==null?void 0:i.value;return(!t&&Pe(n)?n.value:n)??void 0}has(e){return!!qi(this.items,e)}set(e,t){this.add(new Xe(e,t),!0)}toJSON(e,t,i){const n=i?new i:t!=null&&t.mapAsMap?new Map:{};t!=null&&t.onCreate&&t.onCreate(n);for(const r of this.items)xc(t,n,r);return n}toString(e,t,i){if(!e)return JSON.stringify(this);for(const n of this.items)if(!xe(n))throw new Error(`Map items must all be pairs; found ${JSON.stringify(n)} instead`);return!e.allNullValues&&this.hasAllNullValues(!1)&&(e=Object.assign({},e,{allNullValues:!0})),$c(this,e,{blockItemPrefix:"",flowChars:{start:"{",end:"}"},itemIndent:e.indent||"",onChompKeep:i,onComment:t})}}const Ws={collection:"map",default:!0,nodeClass:kt,tag:"tag:yaml.org,2002:map",resolve(s,e){return zs(s)||e("Expected a mapping for this tag"),s},createNode:(s,e,t)=>kt.from(s,e,t)};class Mi extends Ac{static get tagName(){return"tag:yaml.org,2002:seq"}constructor(e){super(Vs,e),this.items=[]}add(e){this.items.push(e)}delete(e){const t=Wn(e);return typeof t!="number"?!1:this.items.splice(t,1).length>0}get(e,t){const i=Wn(e);if(typeof i!="number")return;const n=this.items[i];return!t&&Pe(n)?n.value:n}has(e){const t=Wn(e);return typeof t=="number"&&t<this.items.length}set(e,t){const i=Wn(e);if(typeof i!="number")throw new Error(`Expected a valid index, not ${e}.`);const n=this.items[i];Pe(n)&&Oc(t)?n.value=t:this.items[i]=t}toJSON(e,t){const i=[];t!=null&&t.onCreate&&t.onCreate(i);let n=0;for(const r of this.items)i.push(xt(r,String(n++),t));return i}toString(e,t,i){return e?$c(this,e,{blockItemPrefix:"- ",flowChars:{start:"[",end:"]"},itemIndent:(e.indent||"")+"  ",onChompKeep:i,onComment:t}):JSON.stringify(this)}static from(e,t,i){const{replacer:n}=i,r=new this(e);if(t&&Symbol.iterator in Object(t)){let a=0;for(let o of t){if(typeof n=="function"){const l=t instanceof Set?o:String(a++);o=n.call(t,l,o)}r.items.push(kn(o,void 0,i))}}return r}}function Wn(s){let e=Pe(s)?s.value:s;return e&&typeof e=="string"&&(e=Number(e)),typeof e=="number"&&Number.isInteger(e)&&e>=0?e:null}const Ys={collection:"seq",default:!0,nodeClass:Mi,tag:"tag:yaml.org,2002:seq",resolve(s,e){return Gs(s)||e("Expected a sequence for this tag"),s},createNode:(s,e,t)=>Mi.from(s,e,t)},jr={identify:s=>typeof s=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:s=>s,stringify(s,e,t,i){return e=Object.assign({actualString:!0},e),Rn(s,e,t,i)}},Rr={identify:s=>s==null,createNode:()=>new Z(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^(?:~|[Nn]ull|NULL)?$/,resolve:()=>new Z(null),stringify:({source:s},e)=>typeof s=="string"&&Rr.test.test(s)?s:e.options.nullStr},eo={identify:s=>typeof s=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:[Tt]rue|TRUE|[Ff]alse|FALSE)$/,resolve:s=>new Z(s[0]==="t"||s[0]==="T"),stringify({source:s,value:e},t){if(s&&eo.test.test(s)){const i=s[0]==="t"||s[0]==="T";if(e===i)return s}return e?t.options.trueStr:t.options.falseStr}};function Jt({format:s,minFractionDigits:e,tag:t,value:i}){if(typeof i=="bigint")return String(i);const n=typeof i=="number"?i:Number(i);if(!isFinite(n))return isNaN(n)?".nan":n<0?"-.inf":".inf";let r=JSON.stringify(i);if(!s&&e&&(!t||t==="tag:yaml.org,2002:float")&&/^\d/.test(r)){let a=r.indexOf(".");a<0&&(a=r.length,r+=".");let o=e-(r.length-a-1);for(;o-- >0;)r+="0"}return r}const Mc={identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:s=>s.slice(-3).toLowerCase()==="nan"?NaN:s[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:Jt},jc={identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:\.[0-9]+|[0-9]+(?:\.[0-9]*)?)[eE][-+]?[0-9]+$/,resolve:s=>parseFloat(s),stringify(s){const e=Number(s.value);return isFinite(e)?e.toExponential():Jt(s)}},Rc={identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:\.[0-9]+|[0-9]+\.[0-9]*)$/,resolve(s){const e=new Z(parseFloat(s)),t=s.indexOf(".");return t!==-1&&s[s.length-1]==="0"&&(e.minFractionDigits=s.length-t-1),e},stringify:Jt},Br=s=>typeof s=="bigint"||Number.isInteger(s),to=(s,e,t,{intAsBigInt:i})=>i?BigInt(s):parseInt(s.substring(e),t);function Bc(s,e,t){const{value:i}=s;return Br(i)&&i>=0?t+i.toString(e):Jt(s)}const Uc={identify:s=>Br(s)&&s>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^0o[0-7]+$/,resolve:(s,e,t)=>to(s,2,8,t),stringify:s=>Bc(s,8,"0o")},qc={identify:Br,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9]+$/,resolve:(s,e,t)=>to(s,0,10,t),stringify:Jt},Hc={identify:s=>Br(s)&&s>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^0x[0-9a-fA-F]+$/,resolve:(s,e,t)=>to(s,2,16,t),stringify:s=>Bc(s,16,"0x")},Pg=[Ws,Ys,jr,Rr,eo,Uc,qc,Hc,Mc,jc,Rc];function Jo(s){return typeof s=="bigint"||Number.isInteger(s)}const Yn=({value:s})=>JSON.stringify(s),Eg=[{identify:s=>typeof s=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:s=>s,stringify:Yn},{identify:s=>s==null,createNode:()=>new Z(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^null$/,resolve:()=>null,stringify:Yn},{identify:s=>typeof s=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^true$|^false$/,resolve:s=>s==="true",stringify:Yn},{identify:Jo,default:!0,tag:"tag:yaml.org,2002:int",test:/^-?(?:0|[1-9][0-9]*)$/,resolve:(s,e,{intAsBigInt:t})=>t?BigInt(s):parseInt(s,10),stringify:({value:s})=>Jo(s)?s.toString():JSON.stringify(s)},{identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^-?(?:0|[1-9][0-9]*)(?:\.[0-9]*)?(?:[eE][-+]?[0-9]+)?$/,resolve:s=>parseFloat(s),stringify:Yn}],Cg={default:!0,tag:"",test:/^/,resolve(s,e){return e(`Unresolved plain scalar ${JSON.stringify(s)}`),s}},Og=[Ws,Ys].concat(Eg,Cg),io={identify:s=>s instanceof Uint8Array,default:!1,tag:"tag:yaml.org,2002:binary",resolve(s,e){if(typeof atob=="function"){const t=atob(s.replace(/[\n\r]/g,"")),i=new Uint8Array(t.length);for(let n=0;n<t.length;++n)i[n]=t.charCodeAt(n);return i}else return e("This environment does not support reading binary tags; either Buffer or atob is required"),s},stringify({comment:s,type:e,value:t},i,n,r){if(!t)return"";const a=t;let o;if(typeof btoa=="function"){let l="";for(let c=0;c<a.length;++c)l+=String.fromCharCode(a[c]);o=btoa(l)}else throw new Error("This environment does not support writing binary tags; either Buffer or btoa is required");if(e??(e=Z.BLOCK_LITERAL),e!==Z.QUOTE_DOUBLE){const l=Math.max(i.options.lineWidth-i.indent.length,i.options.minContentWidth),c=Math.ceil(o.length/l),d=new Array(c);for(let g=0,h=0;g<c;++g,h+=l)d[g]=o.substr(h,l);o=d.join(e===Z.BLOCK_LITERAL?`
`:" ")}return Rn({comment:s,type:e,value:o},i,n,r)}};function Kc(s,e){if(Gs(s))for(let t=0;t<s.items.length;++t){let i=s.items[t];if(!xe(i)){if(zs(i)){i.items.length>1&&e("Each pair must have its own sequence indicator");const n=i.items[0]||new Xe(new Z(null));if(i.commentBefore&&(n.key.commentBefore=n.key.commentBefore?`${i.commentBefore}
${n.key.commentBefore}`:i.commentBefore),i.comment){const r=n.value??n.key;r.comment=r.comment?`${i.comment}
${r.comment}`:i.comment}i=n}s.items[t]=xe(i)?i:new Xe(i)}}else e("Expected a sequence for this tag");return s}function Vc(s,e,t){const{replacer:i}=t,n=new Mi(s);n.tag="tag:yaml.org,2002:pairs";let r=0;if(e&&Symbol.iterator in Object(e))for(let a of e){typeof i=="function"&&(a=i.call(e,String(r++),a));let o,l;if(Array.isArray(a))if(a.length===2)o=a[0],l=a[1];else throw new TypeError(`Expected [key, value] tuple: ${a}`);else if(a&&a instanceof Object){const c=Object.keys(a);if(c.length===1)o=c[0],l=a[o];else throw new TypeError(`Expected tuple with one key, not ${c.length} keys`)}else o=a;n.items.push(Za(o,l,t))}return n}const so={collection:"seq",default:!1,tag:"tag:yaml.org,2002:pairs",resolve:Kc,createNode:Vc};class Ss extends Mi{constructor(){super(),this.add=kt.prototype.add.bind(this),this.delete=kt.prototype.delete.bind(this),this.get=kt.prototype.get.bind(this),this.has=kt.prototype.has.bind(this),this.set=kt.prototype.set.bind(this),this.tag=Ss.tag}toJSON(e,t){if(!t)return super.toJSON(e);const i=new Map;t!=null&&t.onCreate&&t.onCreate(i);for(const n of this.items){let r,a;if(xe(n)?(r=xt(n.key,"",t),a=xt(n.value,r,t)):r=xt(n,"",t),i.has(r))throw new Error("Ordered maps must not include duplicate keys");i.set(r,a)}return i}static from(e,t,i){const n=Vc(e,t,i),r=new this;return r.items=n.items,r}}Ss.tag="tag:yaml.org,2002:omap";const no={collection:"seq",identify:s=>s instanceof Map,nodeClass:Ss,default:!1,tag:"tag:yaml.org,2002:omap",resolve(s,e){const t=Kc(s,e),i=[];for(const{key:n}of t.items)Pe(n)&&(i.includes(n.value)?e(`Ordered maps must not include duplicate keys: ${n.value}`):i.push(n.value));return Object.assign(new Ss,t)},createNode:(s,e,t)=>Ss.from(s,e,t)};function zc({value:s,source:e},t){return e&&(s?Gc:Wc).test.test(e)?e:s?t.options.trueStr:t.options.falseStr}const Gc={identify:s=>s===!0,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:Y|y|[Yy]es|YES|[Tt]rue|TRUE|[Oo]n|ON)$/,resolve:()=>new Z(!0),stringify:zc},Wc={identify:s=>s===!1,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:N|n|[Nn]o|NO|[Ff]alse|FALSE|[Oo]ff|OFF)$/,resolve:()=>new Z(!1),stringify:zc},Ag={identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:s=>s.slice(-3).toLowerCase()==="nan"?NaN:s[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:Jt},Ng={identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:[0-9][0-9_]*)?(?:\.[0-9_]*)?[eE][-+]?[0-9]+$/,resolve:s=>parseFloat(s.replace(/_/g,"")),stringify(s){const e=Number(s.value);return isFinite(e)?e.toExponential():Jt(s)}},Lg={identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:[0-9][0-9_]*)?\.[0-9_]*$/,resolve(s){const e=new Z(parseFloat(s.replace(/_/g,""))),t=s.indexOf(".");if(t!==-1){const i=s.substring(t+1).replace(/_/g,"");i[i.length-1]==="0"&&(e.minFractionDigits=i.length)}return e},stringify:Jt},Bn=s=>typeof s=="bigint"||Number.isInteger(s);function Ur(s,e,t,{intAsBigInt:i}){const n=s[0];if((n==="-"||n==="+")&&(e+=1),s=s.substring(e).replace(/_/g,""),i){switch(t){case 2:s=`0b${s}`;break;case 8:s=`0o${s}`;break;case 16:s=`0x${s}`;break}const a=BigInt(s);return n==="-"?BigInt(-1)*a:a}const r=parseInt(s,t);return n==="-"?-1*r:r}function ro(s,e,t){const{value:i}=s;if(Bn(i)){const n=i.toString(e);return i<0?"-"+t+n.substr(1):t+n}return Jt(s)}const Dg={identify:Bn,default:!0,tag:"tag:yaml.org,2002:int",format:"BIN",test:/^[-+]?0b[0-1_]+$/,resolve:(s,e,t)=>Ur(s,2,2,t),stringify:s=>ro(s,2,"0b")},Fg={identify:Bn,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^[-+]?0[0-7_]+$/,resolve:(s,e,t)=>Ur(s,1,8,t),stringify:s=>ro(s,8,"0")},xg={identify:Bn,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9][0-9_]*$/,resolve:(s,e,t)=>Ur(s,0,10,t),stringify:Jt},$g={identify:Bn,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^[-+]?0x[0-9a-fA-F_]+$/,resolve:(s,e,t)=>Ur(s,2,16,t),stringify:s=>ro(s,16,"0x")};class Ps extends kt{constructor(e){super(e),this.tag=Ps.tag}add(e){let t;xe(e)?t=e:e&&typeof e=="object"&&"key"in e&&"value"in e&&e.value===null?t=new Xe(e.key,null):t=new Xe(e,null),qi(this.items,t.key)||this.items.push(t)}get(e,t){const i=qi(this.items,e);return!t&&xe(i)?Pe(i.key)?i.key.value:i.key:i}set(e,t){if(typeof t!="boolean")throw new Error(`Expected boolean value for set(key, value) in a YAML set, not ${typeof t}`);const i=qi(this.items,e);i&&!t?this.items.splice(this.items.indexOf(i),1):!i&&t&&this.items.push(new Xe(e))}toJSON(e,t){return super.toJSON(e,t,Set)}toString(e,t,i){if(!e)return JSON.stringify(this);if(this.hasAllNullValues(!0))return super.toString(Object.assign({},e,{allNullValues:!0}),t,i);throw new Error("Set items must all have null values")}static from(e,t,i){const{replacer:n}=i,r=new this(e);if(t&&Symbol.iterator in Object(t))for(let a of t)typeof n=="function"&&(a=n.call(t,a,a)),r.items.push(Za(a,null,i));return r}}Ps.tag="tag:yaml.org,2002:set";const ao={collection:"map",identify:s=>s instanceof Set,nodeClass:Ps,default:!1,tag:"tag:yaml.org,2002:set",createNode:(s,e,t)=>Ps.from(s,e,t),resolve(s,e){if(zs(s)){if(s.hasAllNullValues(!0))return Object.assign(new Ps,s);e("Set items must all have null values")}else e("Expected a mapping for this tag");return s}};function oo(s,e){const t=s[0],i=t==="-"||t==="+"?s.substring(1):s,n=a=>e?BigInt(a):Number(a),r=i.replace(/_/g,"").split(":").reduce((a,o)=>a*n(60)+n(o),n(0));return t==="-"?n(-1)*r:r}function Yc(s){let{value:e}=s,t=a=>a;if(typeof e=="bigint")t=a=>BigInt(a);else if(isNaN(e)||!isFinite(e))return Jt(s);let i="";e<0&&(i="-",e*=t(-1));const n=t(60),r=[e%n];return e<60?r.unshift(0):(e=(e-r[0])/n,r.unshift(e%n),e>=60&&(e=(e-r[0])/n,r.unshift(e))),i+r.map(a=>String(a).padStart(2,"0")).join(":").replace(/000000\d*$/,"")}const Jc={identify:s=>typeof s=="bigint"||Number.isInteger(s),default:!0,tag:"tag:yaml.org,2002:int",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+$/,resolve:(s,e,{intAsBigInt:t})=>oo(s,t),stringify:Yc},Xc={identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\.[0-9_]*$/,resolve:s=>oo(s,!1),stringify:Yc},qr={identify:s=>s instanceof Date,default:!0,tag:"tag:yaml.org,2002:timestamp",test:RegExp("^([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})(?:(?:t|T|[ \\t]+)([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2}(\\.[0-9]+)?)(?:[ \\t]*(Z|[-+][012]?[0-9](?::[0-9]{2})?))?)?$"),resolve(s){const e=s.match(qr.test);if(!e)throw new Error("!!timestamp expects a date, starting with yyyy-mm-dd");const[,t,i,n,r,a,o]=e.map(Number),l=e[7]?Number((e[7]+"00").substr(1,3)):0;let c=Date.UTC(t,i-1,n,r||0,a||0,o||0,l);const d=e[8];if(d&&d!=="Z"){let g=oo(d,!1);Math.abs(g)<30&&(g*=60),c-=6e4*g}return new Date(c)},stringify:({value:s})=>(s==null?void 0:s.toISOString().replace(/(T00:00:00)?\.000Z$/,""))??""},Xo=[Ws,Ys,jr,Rr,Gc,Wc,Dg,Fg,xg,$g,Ag,Ng,Lg,io,gi,no,so,ao,Jc,Xc,qr],Qo=new Map([["core",Pg],["failsafe",[Ws,Ys,jr]],["json",Og],["yaml11",Xo],["yaml-1.1",Xo]]),Zo={binary:io,bool:eo,float:Rc,floatExp:jc,floatNaN:Mc,floatTime:Xc,int:qc,intHex:Hc,intOct:Uc,intTime:Jc,map:Ws,merge:gi,null:Rr,omap:no,pairs:so,seq:Ys,set:ao,timestamp:qr},Mg={"tag:yaml.org,2002:binary":io,"tag:yaml.org,2002:merge":gi,"tag:yaml.org,2002:omap":no,"tag:yaml.org,2002:pairs":so,"tag:yaml.org,2002:set":ao,"tag:yaml.org,2002:timestamp":qr};function ra(s,e,t){const i=Qo.get(e);if(i&&!s)return t&&!i.includes(gi)?i.concat(gi):i.slice();let n=i;if(!n)if(Array.isArray(s))n=[];else{const r=Array.from(Qo.keys()).filter(a=>a!=="yaml11").map(a=>JSON.stringify(a)).join(", ");throw new Error(`Unknown schema "${e}"; use one of ${r} or define customTags array`)}if(Array.isArray(s))for(const r of s)n=n.concat(r);else typeof s=="function"&&(n=s(n.slice()));return t&&(n=n.concat(gi)),n.reduce((r,a)=>{const o=typeof a=="string"?Zo[a]:a;if(!o){const l=JSON.stringify(a),c=Object.keys(Zo).map(d=>JSON.stringify(d)).join(", ");throw new Error(`Unknown custom tag ${l}; use one of ${c}`)}return r.includes(o)||r.push(o),r},[])}const jg=(s,e)=>s.key<e.key?-1:s.key>e.key?1:0;class Hr{constructor({compat:e,customTags:t,merge:i,resolveKnownTags:n,schema:r,sortMapEntries:a,toStringDefaults:o}){this.compat=Array.isArray(e)?ra(e,"compat"):e?ra(null,e):null,this.name=typeof r=="string"&&r||"core",this.knownTags=n?Mg:{},this.tags=ra(t,this.name,i),this.toStringOptions=o??null,Object.defineProperty(this,Di,{value:Ws}),Object.defineProperty(this,ui,{value:jr}),Object.defineProperty(this,Vs,{value:Ys}),this.sortMapEntries=typeof a=="function"?a:a===!0?jg:null}clone(){const e=Object.create(Hr.prototype,Object.getOwnPropertyDescriptors(this));return e.tags=this.tags.slice(),e}}function Rg(s,e){var l;const t=[];let i=e.directives===!0;if(e.directives!==!1&&s.directives){const c=s.directives.toString(s);c?(t.push(c),i=!0):s.directives.docStart&&(i=!0)}i&&t.push("---");const n=Lc(s,e),{commentString:r}=n.options;if(s.commentBefore){t.length!==1&&t.unshift("");const c=r(s.commentBefore);t.unshift(pi(c,""))}let a=!1,o=null;if(s.contents){if(Re(s.contents)){if(s.contents.spaceBefore&&i&&t.push(""),s.contents.commentBefore){const g=r(s.contents.commentBefore);t.push(pi(g,""))}n.forceBlockIndent=!!s.comment,o=s.contents.comment}const c=o?void 0:()=>a=!0;let d=Ms(s.contents,n,()=>o=null,c);o&&(d+=Ui(d,"",r(o))),(d[0]==="|"||d[0]===">")&&t[t.length-1]==="---"?t[t.length-1]=`--- ${d}`:t.push(d)}else t.push(Ms(s.contents,n));if((l=s.directives)!=null&&l.docEnd)if(s.comment){const c=r(s.comment);c.includes(`
`)?(t.push("..."),t.push(pi(c,""))):t.push(`... ${c}`)}else t.push("...");else{let c=s.comment;c&&a&&(c=c.replace(/^\n+/,"")),c&&((!a||o)&&t[t.length-1]!==""&&t.push(""),t.push(pi(r(c),"")))}return t.join(`
`)+`
`}class Js{constructor(e,t,i){this.commentBefore=null,this.comment=null,this.errors=[],this.warnings=[],Object.defineProperty(this,qt,{value:_a});let n=null;typeof t=="function"||Array.isArray(t)?n=t:i===void 0&&t&&(i=t,t=void 0);const r=Object.assign({intAsBigInt:!1,keepSourceTokens:!1,logLevel:"warn",prettyErrors:!0,strict:!0,stringKeys:!1,uniqueKeys:!0,version:"1.2"},i);this.options=r;let{version:a}=r;i!=null&&i._directives?(this.directives=i._directives.atDocument(),this.directives.yaml.explicit&&(a=this.directives.yaml.version)):this.directives=new it({version:a}),this.setSchema(a,i),this.contents=e===void 0?null:this.createNode(e,n,i)}clone(){const e=Object.create(Js.prototype,{[qt]:{value:_a}});return e.commentBefore=this.commentBefore,e.comment=this.comment,e.errors=this.errors.slice(),e.warnings=this.warnings.slice(),e.options=Object.assign({},this.options),this.directives&&(e.directives=this.directives.clone()),e.schema=this.schema.clone(),e.contents=Re(this.contents)?this.contents.clone(e.schema):this.contents,this.range&&(e.range=this.range.slice()),e}add(e){hs(this.contents)&&this.contents.add(e)}addIn(e,t){hs(this.contents)&&this.contents.addIn(e,t)}createAlias(e,t){if(!e.anchor){const i=Ec(this);e.anchor=!t||i.has(t)?Cc(t||"a",i):t}return new Fr(e.anchor)}createNode(e,t,i){let n;if(typeof t=="function")e=t.call({"":e},"",e),n=t;else if(Array.isArray(t)){const m=w=>typeof w=="number"||w instanceof String||w instanceof Number,v=t.filter(m).map(String);v.length>0&&(t=t.concat(v)),n=t}else i===void 0&&t&&(i=t,t=void 0);const{aliasDuplicateObjects:r,anchorPrefix:a,flow:o,keepUndefined:l,onTagObj:c,tag:d}=i??{},{onAnchor:g,setAnchors:h,sourceObjects:u}=hg(this,a||"a"),f={aliasDuplicateObjects:r??!0,keepUndefined:l??!1,onAnchor:g,onTagObj:c,replacer:n,schema:this.schema,sourceObjects:u},p=kn(e,d,f);return o&&je(p)&&(p.flow=!0),h(),p}createPair(e,t,i={}){const n=this.createNode(e,null,i),r=this.createNode(t,null,i);return new Xe(n,r)}delete(e){return hs(this.contents)?this.contents.delete(e):!1}deleteIn(e){return an(e)?this.contents==null?!1:(this.contents=null,!0):hs(this.contents)?this.contents.deleteIn(e):!1}get(e,t){return je(this.contents)?this.contents.get(e,t):void 0}getIn(e,t){return an(e)?!t&&Pe(this.contents)?this.contents.value:this.contents:je(this.contents)?this.contents.getIn(e,t):void 0}has(e){return je(this.contents)?this.contents.has(e):!1}hasIn(e){return an(e)?this.contents!==void 0:je(this.contents)?this.contents.hasIn(e):!1}set(e,t){this.contents==null?this.contents=mr(this.schema,[e],t):hs(this.contents)&&this.contents.set(e,t)}setIn(e,t){an(e)?this.contents=t:this.contents==null?this.contents=mr(this.schema,Array.from(e),t):hs(this.contents)&&this.contents.setIn(e,t)}setSchema(e,t={}){typeof e=="number"&&(e=String(e));let i;switch(e){case"1.1":this.directives?this.directives.yaml.version="1.1":this.directives=new it({version:"1.1"}),i={resolveKnownTags:!1,schema:"yaml-1.1"};break;case"1.2":case"next":this.directives?this.directives.yaml.version=e:this.directives=new it({version:e}),i={resolveKnownTags:!0,schema:"core"};break;case null:this.directives&&delete this.directives,i=null;break;default:{const n=JSON.stringify(e);throw new Error(`Expected '1.1', '1.2' or null as first argument, but found: ${n}`)}}if(t.schema instanceof Object)this.schema=t.schema;else if(i)this.schema=new Hr(Object.assign(i,t));else throw new Error("With a null YAML version, the { schema: Schema } option is required")}toJS({json:e,jsonArg:t,mapAsMap:i,maxAliasCount:n,onAnchor:r,reviver:a}={}){const o={anchors:new Map,doc:this,keep:!e,mapAsMap:i===!0,mapKeyWarned:!1,maxAliasCount:typeof n=="number"?n:100},l=xt(this.contents,t??"",o);if(typeof r=="function")for(const{count:c,res:d}of o.anchors.values())r(d,c);return typeof a=="function"?ys(a,{"":l},"",l):l}toJSON(e,t){return this.toJS({json:!0,jsonArg:e,mapAsMap:!1,onAnchor:t})}toString(e={}){if(this.errors.length>0)throw new Error("Document with errors cannot be stringified");if("indent"in e&&(!Number.isInteger(e.indent)||Number(e.indent)<=0)){const t=JSON.stringify(e.indent);throw new Error(`"indent" option must be a positive integer, not ${t}`)}return Rg(this,e)}}function hs(s){if(je(s))return!0;throw new Error("Expected a YAML collection as document contents")}class lo extends Error{constructor(e,t,i,n){super(),this.name=e,this.code=i,this.message=n,this.pos=t}}class Hi extends lo{constructor(e,t,i){super("YAMLParseError",e,t,i)}}class Qc extends lo{constructor(e,t,i){super("YAMLWarning",e,t,i)}}const kr=(s,e)=>t=>{if(t.pos[0]===-1)return;t.linePos=t.pos.map(o=>e.linePos(o));const{line:i,col:n}=t.linePos[0];t.message+=` at line ${i}, column ${n}`;let r=n-1,a=s.substring(e.lineStarts[i-1],e.lineStarts[i]).replace(/[\n\r]+$/,"");if(r>=60&&a.length>80){const o=Math.min(r-39,a.length-79);a=""+a.substring(o),r-=o-1}if(a.length>80&&(a=a.substring(0,79)+""),i>1&&/^ *$/.test(a.substring(0,r))){let o=s.substring(e.lineStarts[i-2],e.lineStarts[i-1]);o.length>80&&(o=o.substring(0,79)+`
`),a=o+a}if(/[^ ]/.test(a)){let o=1;const l=t.linePos[1];l&&l.line===i&&l.col>n&&(o=Math.max(1,Math.min(l.col-n,80-r)));const c=" ".repeat(r)+"^".repeat(o);t.message+=`:

${a}
${c}
`}};function js(s,{flow:e,indicator:t,next:i,offset:n,onError:r,parentIndent:a,startOnNewline:o}){let l=!1,c=o,d=o,g="",h="",u=!1,f=!1,p=null,m=null,v=null,w=null,y=null,k=null,E=null;for(const P of s)switch(f&&(P.type!=="space"&&P.type!=="newline"&&P.type!=="comma"&&r(P.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),f=!1),p&&(c&&P.type!=="comment"&&P.type!=="newline"&&r(p,"TAB_AS_INDENT","Tabs are not allowed as indentation"),p=null),P.type){case"space":!e&&(t!=="doc-start"||(i==null?void 0:i.type)!=="flow-collection")&&P.source.includes("	")&&(p=P),d=!0;break;case"comment":{d||r(P,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const L=P.source.substring(1)||" ";g?g+=h+L:g=L,h="",c=!1;break}case"newline":c?g?g+=P.source:(!k||t!=="seq-item-ind")&&(l=!0):h+=P.source,c=!0,u=!0,(m||v)&&(w=P),d=!0;break;case"anchor":m&&r(P,"MULTIPLE_ANCHORS","A node can have at most one anchor"),P.source.endsWith(":")&&r(P.offset+P.source.length-1,"BAD_ALIAS","Anchor ending in : is ambiguous",!0),m=P,E??(E=P.offset),c=!1,d=!1,f=!0;break;case"tag":{v&&r(P,"MULTIPLE_TAGS","A node can have at most one tag"),v=P,E??(E=P.offset),c=!1,d=!1,f=!0;break}case t:(m||v)&&r(P,"BAD_PROP_ORDER",`Anchors and tags must be after the ${P.source} indicator`),k&&r(P,"UNEXPECTED_TOKEN",`Unexpected ${P.source} in ${e??"collection"}`),k=P,c=t==="seq-item-ind"||t==="explicit-key-ind",d=!1;break;case"comma":if(e){y&&r(P,"UNEXPECTED_TOKEN",`Unexpected , in ${e}`),y=P,c=!1,d=!1;break}default:r(P,"UNEXPECTED_TOKEN",`Unexpected ${P.type} token`),c=!1,d=!1}const T=s[s.length-1],S=T?T.offset+T.source.length:n;return f&&i&&i.type!=="space"&&i.type!=="newline"&&i.type!=="comma"&&(i.type!=="scalar"||i.source!=="")&&r(i.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),p&&(c&&p.indent<=a||(i==null?void 0:i.type)==="block-map"||(i==null?void 0:i.type)==="block-seq")&&r(p,"TAB_AS_INDENT","Tabs are not allowed as indentation"),{comma:y,found:k,spaceBefore:l,comment:g,hasNewline:u,anchor:m,tag:v,newlineAfterProp:w,end:S,start:E??S}}function yn(s){if(!s)return null;switch(s.type){case"alias":case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":if(s.source.includes(`
`))return!0;if(s.end){for(const e of s.end)if(e.type==="newline")return!0}return!1;case"flow-collection":for(const e of s.items){for(const t of e.start)if(t.type==="newline")return!0;if(e.sep){for(const t of e.sep)if(t.type==="newline")return!0}if(yn(e.key)||yn(e.value))return!0}return!1;default:return!0}}function Ea(s,e,t){if((e==null?void 0:e.type)==="flow-collection"){const i=e.end[0];i.indent===s&&(i.source==="]"||i.source==="}")&&yn(e)&&t(i,"BAD_INDENT","Flow end indicator should be more indented than parent",!0)}}function Zc(s,e,t){const{uniqueKeys:i}=s.options;if(i===!1)return!1;const n=typeof i=="function"?i:(r,a)=>r===a||Pe(r)&&Pe(a)&&r.value===a.value;return e.some(r=>n(r.key,t))}const el="All mapping items must start at the same column";function Bg({composeNode:s,composeEmptyNode:e},t,i,n,r){var d;const a=(r==null?void 0:r.nodeClass)??kt,o=new a(t.schema);t.atRoot&&(t.atRoot=!1);let l=i.offset,c=null;for(const g of i.items){const{start:h,key:u,sep:f,value:p}=g,m=js(h,{indicator:"explicit-key-ind",next:u??(f==null?void 0:f[0]),offset:l,onError:n,parentIndent:i.indent,startOnNewline:!0}),v=!m.found;if(v){if(u&&(u.type==="block-seq"?n(l,"BLOCK_AS_IMPLICIT_KEY","A block sequence may not be used as an implicit map key"):"indent"in u&&u.indent!==i.indent&&n(l,"BAD_INDENT",el)),!m.anchor&&!m.tag&&!f){c=m.end,m.comment&&(o.comment?o.comment+=`
`+m.comment:o.comment=m.comment);continue}(m.newlineAfterProp||yn(u))&&n(u??h[h.length-1],"MULTILINE_IMPLICIT_KEY","Implicit keys need to be on a single line")}else((d=m.found)==null?void 0:d.indent)!==i.indent&&n(l,"BAD_INDENT",el);t.atKey=!0;const w=m.end,y=u?s(t,u,m,n):e(t,w,h,null,m,n);t.schema.compat&&Ea(i.indent,u,n),t.atKey=!1,Zc(t,o.items,y)&&n(w,"DUPLICATE_KEY","Map keys must be unique");const k=js(f??[],{indicator:"map-value-ind",next:p,offset:y.range[2],onError:n,parentIndent:i.indent,startOnNewline:!u||u.type==="block-scalar"});if(l=k.end,k.found){v&&((p==null?void 0:p.type)==="block-map"&&!k.hasNewline&&n(l,"BLOCK_AS_IMPLICIT_KEY","Nested mappings are not allowed in compact mappings"),t.options.strict&&m.start<k.found.offset-1024&&n(y.range,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit block mapping key"));const E=p?s(t,p,k,n):e(t,l,f,null,k,n);t.schema.compat&&Ea(i.indent,p,n),l=E.range[2];const T=new Xe(y,E);t.options.keepSourceTokens&&(T.srcToken=g),o.items.push(T)}else{v&&n(y.range,"MISSING_CHAR","Implicit map keys need to be followed by map values"),k.comment&&(y.comment?y.comment+=`
`+k.comment:y.comment=k.comment);const E=new Xe(y);t.options.keepSourceTokens&&(E.srcToken=g),o.items.push(E)}}return c&&c<l&&n(c,"IMPOSSIBLE","Map comment with trailing content"),o.range=[i.offset,l,c??l],o}function Ug({composeNode:s,composeEmptyNode:e},t,i,n,r){const a=(r==null?void 0:r.nodeClass)??Mi,o=new a(t.schema);t.atRoot&&(t.atRoot=!1),t.atKey&&(t.atKey=!1);let l=i.offset,c=null;for(const{start:d,value:g}of i.items){const h=js(d,{indicator:"seq-item-ind",next:g,offset:l,onError:n,parentIndent:i.indent,startOnNewline:!0});if(!h.found)if(h.anchor||h.tag||g)g&&g.type==="block-seq"?n(h.end,"BAD_INDENT","All sequence items must start at the same column"):n(l,"MISSING_CHAR","Sequence item without - indicator");else{c=h.end,h.comment&&(o.comment=h.comment);continue}const u=g?s(t,g,h,n):e(t,h.end,d,null,h,n);t.schema.compat&&Ea(i.indent,g,n),l=u.range[2],o.items.push(u)}return o.range=[i.offset,l,c??l],o}function Un(s,e,t,i){let n="";if(s){let r=!1,a="";for(const o of s){const{source:l,type:c}=o;switch(c){case"space":r=!0;break;case"comment":{t&&!r&&i(o,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const d=l.substring(1)||" ";n?n+=a+d:n=d,a="";break}case"newline":n&&(a+=l),r=!0;break;default:i(o,"UNEXPECTED_TOKEN",`Unexpected ${c} at node end`)}e+=l.length}}return{comment:n,offset:e}}const aa="Block collections are not allowed within flow collections",oa=s=>s&&(s.type==="block-map"||s.type==="block-seq");function qg({composeNode:s,composeEmptyNode:e},t,i,n,r){const a=i.start.source==="{",o=a?"flow map":"flow sequence",l=(r==null?void 0:r.nodeClass)??(a?kt:Mi),c=new l(t.schema);c.flow=!0;const d=t.atRoot;d&&(t.atRoot=!1),t.atKey&&(t.atKey=!1);let g=i.offset+i.start.source.length;for(let m=0;m<i.items.length;++m){const v=i.items[m],{start:w,key:y,sep:k,value:E}=v,T=js(w,{flow:o,indicator:"explicit-key-ind",next:y??(k==null?void 0:k[0]),offset:g,onError:n,parentIndent:i.indent,startOnNewline:!1});if(!T.found){if(!T.anchor&&!T.tag&&!k&&!E){m===0&&T.comma?n(T.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${o}`):m<i.items.length-1&&n(T.start,"UNEXPECTED_TOKEN",`Unexpected empty item in ${o}`),T.comment&&(c.comment?c.comment+=`
`+T.comment:c.comment=T.comment),g=T.end;continue}!a&&t.options.strict&&yn(y)&&n(y,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line")}if(m===0)T.comma&&n(T.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${o}`);else if(T.comma||n(T.start,"MISSING_CHAR",`Missing , between ${o} items`),T.comment){let S="";e:for(const P of w)switch(P.type){case"comma":case"space":break;case"comment":S=P.source.substring(1);break e;default:break e}if(S){let P=c.items[c.items.length-1];xe(P)&&(P=P.value??P.key),P.comment?P.comment+=`
`+S:P.comment=S,T.comment=T.comment.substring(S.length+1)}}if(!a&&!k&&!T.found){const S=E?s(t,E,T,n):e(t,T.end,k,null,T,n);c.items.push(S),g=S.range[2],oa(E)&&n(S.range,"BLOCK_IN_FLOW",aa)}else{t.atKey=!0;const S=T.end,P=y?s(t,y,T,n):e(t,S,w,null,T,n);oa(y)&&n(P.range,"BLOCK_IN_FLOW",aa),t.atKey=!1;const L=js(k??[],{flow:o,indicator:"map-value-ind",next:E,offset:P.range[2],onError:n,parentIndent:i.indent,startOnNewline:!1});if(L.found){if(!a&&!T.found&&t.options.strict){if(k)for(const C of k){if(C===L.found)break;if(C.type==="newline"){n(C,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line");break}}T.start<L.found.offset-1024&&n(L.found,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit flow sequence key")}}else E&&("source"in E&&E.source&&E.source[0]===":"?n(E,"MISSING_CHAR",`Missing space after : in ${o}`):n(L.start,"MISSING_CHAR",`Missing , or : between ${o} items`));const A=E?s(t,E,L,n):L.found?e(t,L.end,k,null,L,n):null;A?oa(E)&&n(A.range,"BLOCK_IN_FLOW",aa):L.comment&&(P.comment?P.comment+=`
`+L.comment:P.comment=L.comment);const _=new Xe(P,A);if(t.options.keepSourceTokens&&(_.srcToken=v),a){const C=c;Zc(t,C.items,P)&&n(S,"DUPLICATE_KEY","Map keys must be unique"),C.items.push(_)}else{const C=new kt(t.schema);C.flow=!0,C.items.push(_);const D=(A??P).range;C.range=[P.range[0],D[1],D[2]],c.items.push(C)}g=A?A.range[2]:L.end}}const h=a?"}":"]",[u,...f]=i.end;let p=g;if(u&&u.source===h)p=u.offset+u.source.length;else{const m=o[0].toUpperCase()+o.substring(1),v=d?`${m} must end with a ${h}`:`${m} in block collection must be sufficiently indented and end with a ${h}`;n(g,d?"MISSING_CHAR":"BAD_INDENT",v),u&&u.source.length!==1&&f.unshift(u)}if(f.length>0){const m=Un(f,p,t.options.strict,n);m.comment&&(c.comment?c.comment+=`
`+m.comment:c.comment=m.comment),c.range=[i.offset,p,m.offset]}else c.range=[i.offset,p,p];return c}function la(s,e,t,i,n,r){const a=t.type==="block-map"?Bg(s,e,t,i,r):t.type==="block-seq"?Ug(s,e,t,i,r):qg(s,e,t,i,r),o=a.constructor;return n==="!"||n===o.tagName?(a.tag=o.tagName,a):(n&&(a.tag=n),a)}function Hg(s,e,t,i,n){var h;const r=i.tag,a=r?e.directives.tagName(r.source,u=>n(r,"TAG_RESOLVE_FAILED",u)):null;if(t.type==="block-seq"){const{anchor:u,newlineAfterProp:f}=i,p=u&&r?u.offset>r.offset?u:r:u??r;p&&(!f||f.offset<p.offset)&&n(p,"MISSING_CHAR","Missing newline after block sequence props")}const o=t.type==="block-map"?"map":t.type==="block-seq"?"seq":t.start.source==="{"?"map":"seq";if(!r||!a||a==="!"||a===kt.tagName&&o==="map"||a===Mi.tagName&&o==="seq")return la(s,e,t,n,a);let l=e.schema.tags.find(u=>u.tag===a&&u.collection===o);if(!l){const u=e.schema.knownTags[a];if(u&&u.collection===o)e.schema.tags.push(Object.assign({},u,{default:!1})),l=u;else return u?n(r,"BAD_COLLECTION_TYPE",`${u.tag} used for ${o} collection, but expects ${u.collection??"scalar"}`,!0):n(r,"TAG_RESOLVE_FAILED",`Unresolved tag: ${a}`,!0),la(s,e,t,n,a)}const c=la(s,e,t,n,a,l),d=((h=l.resolve)==null?void 0:h.call(l,c,u=>n(r,"TAG_RESOLVE_FAILED",u),e.options))??c,g=Re(d)?d:new Z(d);return g.range=c.range,g.tag=a,l!=null&&l.format&&(g.format=l.format),g}function eu(s,e,t){const i=e.offset,n=Kg(e,s.options.strict,t);if(!n)return{value:"",type:null,comment:"",range:[i,i,i]};const r=n.mode===">"?Z.BLOCK_FOLDED:Z.BLOCK_LITERAL,a=e.source?Vg(e.source):[];let o=a.length;for(let p=a.length-1;p>=0;--p){const m=a[p][1];if(m===""||m==="\r")o=p;else break}if(o===0){const p=n.chomp==="+"&&a.length>0?`
`.repeat(Math.max(1,a.length-1)):"";let m=i+n.length;return e.source&&(m+=e.source.length),{value:p,type:r,comment:n.comment,range:[i,m,m]}}let l=e.indent+n.indent,c=e.offset+n.length,d=0;for(let p=0;p<o;++p){const[m,v]=a[p];if(v===""||v==="\r")n.indent===0&&m.length>l&&(l=m.length);else{m.length<l&&t(c+m.length,"MISSING_CHAR","Block scalars with more-indented leading empty lines must use an explicit indentation indicator"),n.indent===0&&(l=m.length),d=p,l===0&&!s.atRoot&&t(c,"BAD_INDENT","Block scalar values in collections must be indented");break}c+=m.length+v.length+1}for(let p=a.length-1;p>=o;--p)a[p][0].length>l&&(o=p+1);let g="",h="",u=!1;for(let p=0;p<d;++p)g+=a[p][0].slice(l)+`
`;for(let p=d;p<o;++p){let[m,v]=a[p];c+=m.length+v.length+1;const w=v[v.length-1]==="\r";if(w&&(v=v.slice(0,-1)),v&&m.length<l){const k=`Block scalar lines must not be less indented than their ${n.indent?"explicit indentation indicator":"first line"}`;t(c-v.length-(w?2:1),"BAD_INDENT",k),m=""}r===Z.BLOCK_LITERAL?(g+=h+m.slice(l)+v,h=`
`):m.length>l||v[0]==="	"?(h===" "?h=`
`:!u&&h===`
`&&(h=`

`),g+=h+m.slice(l)+v,h=`
`,u=!0):v===""?h===`
`?g+=`
`:h=`
`:(g+=h+v,h=" ",u=!1)}switch(n.chomp){case"-":break;case"+":for(let p=o;p<a.length;++p)g+=`
`+a[p][0].slice(l);g[g.length-1]!==`
`&&(g+=`
`);break;default:g+=`
`}const f=i+n.length+e.source.length;return{value:g,type:r,comment:n.comment,range:[i,f,f]}}function Kg({offset:s,props:e},t,i){if(e[0].type!=="block-scalar-header")return i(e[0],"IMPOSSIBLE","Block scalar header not found"),null;const{source:n}=e[0],r=n[0];let a=0,o="",l=-1;for(let h=1;h<n.length;++h){const u=n[h];if(!o&&(u==="-"||u==="+"))o=u;else{const f=Number(u);!a&&f?a=f:l===-1&&(l=s+h)}}l!==-1&&i(l,"UNEXPECTED_TOKEN",`Block scalar header includes extra characters: ${n}`);let c=!1,d="",g=n.length;for(let h=1;h<e.length;++h){const u=e[h];switch(u.type){case"space":c=!0;case"newline":g+=u.source.length;break;case"comment":t&&!c&&i(u,"MISSING_CHAR","Comments must be separated from other tokens by white space characters"),g+=u.source.length,d=u.source.substring(1);break;case"error":i(u,"UNEXPECTED_TOKEN",u.message),g+=u.source.length;break;default:{const f=`Unexpected token in block scalar header: ${u.type}`;i(u,"UNEXPECTED_TOKEN",f);const p=u.source;p&&typeof p=="string"&&(g+=p.length)}}}return{mode:r,indent:a,chomp:o,comment:d,length:g}}function Vg(s){const e=s.split(/\n( *)/),t=e[0],i=t.match(/^( *)/),r=[i!=null&&i[1]?[i[1],t.slice(i[1].length)]:["",t]];for(let a=1;a<e.length;a+=2)r.push([e[a],e[a+1]]);return r}function tu(s,e,t){const{offset:i,type:n,source:r,end:a}=s;let o,l;const c=(h,u,f)=>t(i+h,u,f);switch(n){case"scalar":o=Z.PLAIN,l=zg(r,c);break;case"single-quoted-scalar":o=Z.QUOTE_SINGLE,l=Gg(r,c);break;case"double-quoted-scalar":o=Z.QUOTE_DOUBLE,l=Wg(r,c);break;default:return t(s,"UNEXPECTED_TOKEN",`Expected a flow scalar value, but found: ${n}`),{value:"",type:null,comment:"",range:[i,i+r.length,i+r.length]}}const d=i+r.length,g=Un(a,d,e,t);return{value:l,type:o,comment:g.comment,range:[i,d,g.offset]}}function zg(s,e){let t="";switch(s[0]){case"	":t="a tab character";break;case",":t="flow indicator character ,";break;case"%":t="directive indicator character %";break;case"|":case">":{t=`block scalar indicator ${s[0]}`;break}case"@":case"`":{t=`reserved character ${s[0]}`;break}}return t&&e(0,"BAD_SCALAR_START",`Plain value cannot start with ${t}`),iu(s)}function Gg(s,e){return(s[s.length-1]!=="'"||s.length===1)&&e(s.length,"MISSING_CHAR","Missing closing 'quote"),iu(s.slice(1,-1)).replace(/''/g,"'")}function iu(s){let e,t;try{e=new RegExp(`(.*?)(?<![ 	])[ 	]*\r?
`,"sy"),t=new RegExp(`[ 	]*(.*?)(?:(?<![ 	])[ 	]*)?\r?
`,"sy")}catch{e=/(.*?)[ \t]*\r?\n/sy,t=/[ \t]*(.*?)[ \t]*\r?\n/sy}let i=e.exec(s);if(!i)return s;let n=i[1],r=" ",a=e.lastIndex;for(t.lastIndex=a;i=t.exec(s);)i[1]===""?r===`
`?n+=r:r=`
`:(n+=r+i[1],r=" "),a=t.lastIndex;const o=/[ \t]*(.*)/sy;return o.lastIndex=a,i=o.exec(s),n+r+((i==null?void 0:i[1])??"")}function Wg(s,e){let t="";for(let i=1;i<s.length-1;++i){const n=s[i];if(!(n==="\r"&&s[i+1]===`
`))if(n===`
`){const{fold:r,offset:a}=Yg(s,i);t+=r,i=a}else if(n==="\\"){let r=s[++i];const a=Jg[r];if(a)t+=a;else if(r===`
`)for(r=s[i+1];r===" "||r==="	";)r=s[++i+1];else if(r==="\r"&&s[i+1]===`
`)for(r=s[++i+1];r===" "||r==="	";)r=s[++i+1];else if(r==="x"||r==="u"||r==="U"){const o={x:2,u:4,U:8}[r];t+=Xg(s,i+1,o,e),i+=o}else{const o=s.substr(i-1,2);e(i-1,"BAD_DQ_ESCAPE",`Invalid escape sequence ${o}`),t+=o}}else if(n===" "||n==="	"){const r=i;let a=s[i+1];for(;a===" "||a==="	";)a=s[++i+1];a!==`
`&&!(a==="\r"&&s[i+2]===`
`)&&(t+=i>r?s.slice(r,i+1):n)}else t+=n}return(s[s.length-1]!=='"'||s.length===1)&&e(s.length,"MISSING_CHAR",'Missing closing "quote'),t}function Yg(s,e){let t="",i=s[e+1];for(;(i===" "||i==="	"||i===`
`||i==="\r")&&!(i==="\r"&&s[e+2]!==`
`);)i===`
`&&(t+=`
`),e+=1,i=s[e+1];return t||(t=" "),{fold:t,offset:e}}const Jg={0:"\0",a:"\x07",b:"\b",e:"\x1B",f:"\f",n:`
`,r:"\r",t:"	",v:"\v",N:"",_:"",L:"\u2028",P:"\u2029"," ":" ",'"':'"',"/":"/","\\":"\\","	":"	"};function Xg(s,e,t,i){const n=s.substr(e,t),a=n.length===t&&/^[0-9a-fA-F]+$/.test(n)?parseInt(n,16):NaN;if(isNaN(a)){const o=s.substr(e-2,t+2);return i(e-2,"BAD_DQ_ESCAPE",`Invalid escape sequence ${o}`),o}return String.fromCodePoint(a)}function su(s,e,t,i){const{value:n,type:r,comment:a,range:o}=e.type==="block-scalar"?eu(s,e,i):tu(e,s.options.strict,i),l=t?s.directives.tagName(t.source,g=>i(t,"TAG_RESOLVE_FAILED",g)):null;let c;s.options.stringKeys&&s.atKey?c=s.schema[ui]:l?c=Qg(s.schema,n,l,t,i):e.type==="scalar"?c=Zg(s,n,e,i):c=s.schema[ui];let d;try{const g=c.resolve(n,h=>i(t??e,"TAG_RESOLVE_FAILED",h),s.options);d=Pe(g)?g:new Z(g)}catch(g){const h=g instanceof Error?g.message:String(g);i(t??e,"TAG_RESOLVE_FAILED",h),d=new Z(n)}return d.range=o,d.source=n,r&&(d.type=r),l&&(d.tag=l),c.format&&(d.format=c.format),a&&(d.comment=a),d}function Qg(s,e,t,i,n){var o;if(t==="!")return s[ui];const r=[];for(const l of s.tags)if(!l.collection&&l.tag===t)if(l.default&&l.test)r.push(l);else return l;for(const l of r)if((o=l.test)!=null&&o.test(e))return l;const a=s.knownTags[t];return a&&!a.collection?(s.tags.push(Object.assign({},a,{default:!1,test:void 0})),a):(n(i,"TAG_RESOLVE_FAILED",`Unresolved tag: ${t}`,t!=="tag:yaml.org,2002:str"),s[ui])}function Zg({atKey:s,directives:e,schema:t},i,n,r){const a=t.tags.find(o=>{var l;return(o.default===!0||s&&o.default==="key")&&((l=o.test)==null?void 0:l.test(i))})||t[ui];if(t.compat){const o=t.compat.find(l=>{var c;return l.default&&((c=l.test)==null?void 0:c.test(i))})??t[ui];if(a.tag!==o.tag){const l=e.tagString(a.tag),c=e.tagString(o.tag),d=`Value may be parsed as either ${l} or ${c}`;r(n,"TAG_RESOLVE_FAILED",d,!0)}}return a}function em(s,e,t){if(e){t??(t=e.length);for(let i=t-1;i>=0;--i){let n=e[i];switch(n.type){case"space":case"comment":case"newline":s-=n.source.length;continue}for(n=e[++i];(n==null?void 0:n.type)==="space";)s+=n.source.length,n=e[++i];break}}return s}const tm={composeNode:nu,composeEmptyNode:co};function nu(s,e,t,i){const n=s.atKey,{spaceBefore:r,comment:a,anchor:o,tag:l}=t;let c,d=!0;switch(e.type){case"alias":c=im(s,e,i),(o||l)&&i(e,"ALIAS_PROPS","An alias node must not specify any properties");break;case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"block-scalar":c=su(s,e,l,i),o&&(c.anchor=o.source.substring(1));break;case"block-map":case"block-seq":case"flow-collection":c=Hg(tm,s,e,t,i),o&&(c.anchor=o.source.substring(1));break;default:{const g=e.type==="error"?e.message:`Unsupported token (type: ${e.type})`;i(e,"UNEXPECTED_TOKEN",g),c=co(s,e.offset,void 0,null,t,i),d=!1}}return o&&c.anchor===""&&i(o,"BAD_ALIAS","Anchor cannot be an empty string"),n&&s.options.stringKeys&&(!Pe(c)||typeof c.value!="string"||c.tag&&c.tag!=="tag:yaml.org,2002:str")&&i(l??e,"NON_STRING_KEY","With stringKeys, all keys must be strings"),r&&(c.spaceBefore=!0),a&&(e.type==="scalar"&&e.source===""?c.comment=a:c.commentBefore=a),s.options.keepSourceTokens&&d&&(c.srcToken=e),c}function co(s,e,t,i,{spaceBefore:n,comment:r,anchor:a,tag:o,end:l},c){const d={type:"scalar",offset:em(e,t,i),indent:-1,source:""},g=su(s,d,o,c);return a&&(g.anchor=a.source.substring(1),g.anchor===""&&c(a,"BAD_ALIAS","Anchor cannot be an empty string")),n&&(g.spaceBefore=!0),r&&(g.comment=r,g.range[2]=l),g}function im({options:s},{offset:e,source:t,end:i},n){const r=new Fr(t.substring(1));r.source===""&&n(e,"BAD_ALIAS","Alias cannot be an empty string"),r.source.endsWith(":")&&n(e+t.length-1,"BAD_ALIAS","Alias ending in : is ambiguous",!0);const a=e+t.length,o=Un(i,a,s.strict,n);return r.range=[e,a,o.offset],o.comment&&(r.comment=o.comment),r}function sm(s,e,{offset:t,start:i,value:n,end:r},a){const o=Object.assign({_directives:e},s),l=new Js(void 0,o),c={atKey:!1,atRoot:!0,directives:l.directives,options:l.options,schema:l.schema},d=js(i,{indicator:"doc-start",next:n??(r==null?void 0:r[0]),offset:t,onError:a,parentIndent:0,startOnNewline:!0});d.found&&(l.directives.docStart=!0,n&&(n.type==="block-map"||n.type==="block-seq")&&!d.hasNewline&&a(d.end,"MISSING_CHAR","Block collection cannot start on same line with directives-end marker")),l.contents=n?nu(c,n,d,a):co(c,d.end,i,null,d,a);const g=l.contents.range[2],h=Un(r,g,!1,a);return h.comment&&(l.comment=h.comment),l.range=[t,g,h.offset],l}function en(s){if(typeof s=="number")return[s,s+1];if(Array.isArray(s))return s.length===2?s:[s[0],s[1]];const{offset:e,source:t}=s;return[e,e+(typeof t=="string"?t.length:1)]}function tl(s){var n;let e="",t=!1,i=!1;for(let r=0;r<s.length;++r){const a=s[r];switch(a[0]){case"#":e+=(e===""?"":i?`

`:`
`)+(a.substring(1)||" "),t=!0,i=!1;break;case"%":((n=s[r+1])==null?void 0:n[0])!=="#"&&(r+=1),t=!1;break;default:t||(i=!0),t=!1}}return{comment:e,afterEmptyLine:i}}class uo{constructor(e={}){this.doc=null,this.atDirectives=!1,this.prelude=[],this.errors=[],this.warnings=[],this.onError=(t,i,n,r)=>{const a=en(t);r?this.warnings.push(new Qc(a,i,n)):this.errors.push(new Hi(a,i,n))},this.directives=new it({version:e.version||"1.2"}),this.options=e}decorate(e,t){const{comment:i,afterEmptyLine:n}=tl(this.prelude);if(i){const r=e.contents;if(t)e.comment=e.comment?`${e.comment}
${i}`:i;else if(n||e.directives.docStart||!r)e.commentBefore=i;else if(je(r)&&!r.flow&&r.items.length>0){let a=r.items[0];xe(a)&&(a=a.key);const o=a.commentBefore;a.commentBefore=o?`${i}
${o}`:i}else{const a=r.commentBefore;r.commentBefore=a?`${i}
${a}`:i}}t?(Array.prototype.push.apply(e.errors,this.errors),Array.prototype.push.apply(e.warnings,this.warnings)):(e.errors=this.errors,e.warnings=this.warnings),this.prelude=[],this.errors=[],this.warnings=[]}streamInfo(){return{comment:tl(this.prelude).comment,directives:this.directives,errors:this.errors,warnings:this.warnings}}*compose(e,t=!1,i=-1){for(const n of e)yield*this.next(n);yield*this.end(t,i)}*next(e){switch(e.type){case"directive":this.directives.add(e.source,(t,i,n)=>{const r=en(e);r[0]+=t,this.onError(r,"BAD_DIRECTIVE",i,n)}),this.prelude.push(e.source),this.atDirectives=!0;break;case"document":{const t=sm(this.options,this.directives,e,this.onError);this.atDirectives&&!t.directives.docStart&&this.onError(e,"MISSING_CHAR","Missing directives-end/doc-start indicator line"),this.decorate(t,!1),this.doc&&(yield this.doc),this.doc=t,this.atDirectives=!1;break}case"byte-order-mark":case"space":break;case"comment":case"newline":this.prelude.push(e.source);break;case"error":{const t=e.source?`${e.message}: ${JSON.stringify(e.source)}`:e.message,i=new Hi(en(e),"UNEXPECTED_TOKEN",t);this.atDirectives||!this.doc?this.errors.push(i):this.doc.errors.push(i);break}case"doc-end":{if(!this.doc){const i="Unexpected doc-end without preceding document";this.errors.push(new Hi(en(e),"UNEXPECTED_TOKEN",i));break}this.doc.directives.docEnd=!0;const t=Un(e.end,e.offset+e.source.length,this.doc.options.strict,this.onError);if(this.decorate(this.doc,!0),t.comment){const i=this.doc.comment;this.doc.comment=i?`${i}
${t.comment}`:t.comment}this.doc.range[2]=t.offset;break}default:this.errors.push(new Hi(en(e),"UNEXPECTED_TOKEN",`Unsupported token ${e.type}`))}}*end(e=!1,t=-1){if(this.doc)this.decorate(this.doc,!0),yield this.doc,this.doc=null;else if(e){const i=Object.assign({_directives:this.directives},this.options),n=new Js(void 0,i);this.atDirectives&&this.onError(t,"MISSING_CHAR","Missing directives-end indicator line"),n.range=[0,t,t],this.decorate(n,!1),yield n}}}function nm(s,e=!0,t){if(s){const i=(n,r,a)=>{const o=typeof n=="number"?n:Array.isArray(n)?n[0]:n.offset;if(t)t(o,r,a);else throw new Hi([o,o+1],r,a)};switch(s.type){case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return tu(s,e,i);case"block-scalar":return eu({options:{strict:e}},s,i)}}return null}function rm(s,e){const{implicitKey:t=!1,indent:i,inFlow:n=!1,offset:r=-1,type:a="PLAIN"}=e,o=Rn({type:a,value:s},{implicitKey:t,indent:i>0?" ".repeat(i):"",inFlow:n,options:{blockQuote:!0,lineWidth:-1}}),l=e.end??[{type:"newline",offset:-1,indent:i,source:`
`}];switch(o[0]){case"|":case">":{const c=o.indexOf(`
`),d=o.substring(0,c),g=o.substring(c+1)+`
`,h=[{type:"block-scalar-header",offset:r,indent:i,source:d}];return ru(h,l)||h.push({type:"newline",offset:-1,indent:i,source:`
`}),{type:"block-scalar",offset:r,indent:i,props:h,source:g}}case'"':return{type:"double-quoted-scalar",offset:r,indent:i,source:o,end:l};case"'":return{type:"single-quoted-scalar",offset:r,indent:i,source:o,end:l};default:return{type:"scalar",offset:r,indent:i,source:o,end:l}}}function am(s,e,t={}){let{afterKey:i=!1,implicitKey:n=!1,inFlow:r=!1,type:a}=t,o="indent"in s?s.indent:null;if(i&&typeof o=="number"&&(o+=2),!a)switch(s.type){case"single-quoted-scalar":a="QUOTE_SINGLE";break;case"double-quoted-scalar":a="QUOTE_DOUBLE";break;case"block-scalar":{const c=s.props[0];if(c.type!=="block-scalar-header")throw new Error("Invalid block scalar header");a=c.source[0]===">"?"BLOCK_FOLDED":"BLOCK_LITERAL";break}default:a="PLAIN"}const l=Rn({type:a,value:e},{implicitKey:n||o===null,indent:o!==null&&o>0?" ".repeat(o):"",inFlow:r,options:{blockQuote:!0,lineWidth:-1}});switch(l[0]){case"|":case">":om(s,l);break;case'"':ca(s,l,"double-quoted-scalar");break;case"'":ca(s,l,"single-quoted-scalar");break;default:ca(s,l,"scalar")}}function om(s,e){const t=e.indexOf(`
`),i=e.substring(0,t),n=e.substring(t+1)+`
`;if(s.type==="block-scalar"){const r=s.props[0];if(r.type!=="block-scalar-header")throw new Error("Invalid block scalar header");r.source=i,s.source=n}else{const{offset:r}=s,a="indent"in s?s.indent:-1,o=[{type:"block-scalar-header",offset:r,indent:a,source:i}];ru(o,"end"in s?s.end:void 0)||o.push({type:"newline",offset:-1,indent:a,source:`
`});for(const l of Object.keys(s))l!=="type"&&l!=="offset"&&delete s[l];Object.assign(s,{type:"block-scalar",indent:a,props:o,source:n})}}function ru(s,e){if(e)for(const t of e)switch(t.type){case"space":case"comment":s.push(t);break;case"newline":return s.push(t),!0}return!1}function ca(s,e,t){switch(s.type){case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":s.type=t,s.source=e;break;case"block-scalar":{const i=s.props.slice(1);let n=e.length;s.props[0].type==="block-scalar-header"&&(n-=s.props[0].source.length);for(const r of i)r.offset+=n;delete s.props,Object.assign(s,{type:t,source:e,end:i});break}case"block-map":case"block-seq":{const n={type:"newline",offset:s.offset+e.length,indent:s.indent,source:`
`};delete s.items,Object.assign(s,{type:t,source:e,end:[n]});break}default:{const i="indent"in s?s.indent:-1,n="end"in s&&Array.isArray(s.end)?s.end.filter(r=>r.type==="space"||r.type==="comment"||r.type==="newline"):[];for(const r of Object.keys(s))r!=="type"&&r!=="offset"&&delete s[r];Object.assign(s,{type:t,indent:i,source:e,end:n})}}}const lm=s=>"type"in s?yr(s):or(s);function yr(s){switch(s.type){case"block-scalar":{let e="";for(const t of s.props)e+=yr(t);return e+s.source}case"block-map":case"block-seq":{let e="";for(const t of s.items)e+=or(t);return e}case"flow-collection":{let e=s.start.source;for(const t of s.items)e+=or(t);for(const t of s.end)e+=t.source;return e}case"document":{let e=or(s);if(s.end)for(const t of s.end)e+=t.source;return e}default:{let e=s.source;if("end"in s&&s.end)for(const t of s.end)e+=t.source;return e}}}function or({start:s,key:e,sep:t,value:i}){let n="";for(const r of s)n+=r.source;if(e&&(n+=yr(e)),t)for(const r of t)n+=r.source;return i&&(n+=yr(i)),n}const Ca=Symbol("break visit"),cm=Symbol("skip children"),au=Symbol("remove item");function ss(s,e){"type"in s&&s.type==="document"&&(s={start:s.start,value:s.value}),ou(Object.freeze([]),s,e)}ss.BREAK=Ca;ss.SKIP=cm;ss.REMOVE=au;ss.itemAtPath=(s,e)=>{let t=s;for(const[i,n]of e){const r=t==null?void 0:t[i];if(r&&"items"in r)t=r.items[n];else return}return t};ss.parentCollection=(s,e)=>{const t=ss.itemAtPath(s,e.slice(0,-1)),i=e[e.length-1][0],n=t==null?void 0:t[i];if(n&&"items"in n)return n;throw new Error("Parent collection not found")};function ou(s,e,t){let i=t(e,s);if(typeof i=="symbol")return i;for(const n of["key","value"]){const r=e[n];if(r&&"items"in r){for(let a=0;a<r.items.length;++a){const o=ou(Object.freeze(s.concat([[n,a]])),r.items[a],t);if(typeof o=="number")a=o-1;else{if(o===Ca)return Ca;o===au&&(r.items.splice(a,1),a-=1)}}typeof i=="function"&&n==="key"&&(i=i(e,s))}}return typeof i=="function"?i(e,s):i}const Kr="\uFEFF",Vr="",zr="",bn="",um=s=>!!s&&"items"in s,dm=s=>!!s&&(s.type==="scalar"||s.type==="single-quoted-scalar"||s.type==="double-quoted-scalar"||s.type==="block-scalar");function fm(s){switch(s){case Kr:return"<BOM>";case Vr:return"<DOC>";case zr:return"<FLOW_END>";case bn:return"<SCALAR>";default:return JSON.stringify(s)}}function lu(s){switch(s){case Kr:return"byte-order-mark";case Vr:return"doc-mode";case zr:return"flow-error-end";case bn:return"scalar";case"---":return"doc-start";case"...":return"doc-end";case"":case`
`:case`\r
`:return"newline";case"-":return"seq-item-ind";case"?":return"explicit-key-ind";case":":return"map-value-ind";case"{":return"flow-map-start";case"}":return"flow-map-end";case"[":return"flow-seq-start";case"]":return"flow-seq-end";case",":return"comma"}switch(s[0]){case" ":case"	":return"space";case"#":return"comment";case"%":return"directive-line";case"*":return"alias";case"&":return"anchor";case"!":return"tag";case"'":return"single-quoted-scalar";case'"':return"double-quoted-scalar";case"|":case">":return"block-scalar-header"}return null}const hm=Object.freeze(Object.defineProperty({__proto__:null,BOM:Kr,DOCUMENT:Vr,FLOW_END:zr,SCALAR:bn,createScalarToken:rm,isCollection:um,isScalar:dm,prettyToken:fm,resolveAsScalar:nm,setScalarValue:am,stringify:lm,tokenType:lu,visit:ss},Symbol.toStringTag,{value:"Module"}));function Kt(s){switch(s){case void 0:case" ":case`
`:case"\r":case"	":return!0;default:return!1}}const il=new Set("0123456789ABCDEFabcdef"),pm=new Set("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-#;/?:@&=+$_.!~*'()"),Jn=new Set(",[]{}"),gm=new Set(` ,[]{}
\r	`),ua=s=>!s||gm.has(s);class cu{constructor(){this.atEnd=!1,this.blockScalarIndent=-1,this.blockScalarKeep=!1,this.buffer="",this.flowKey=!1,this.flowLevel=0,this.indentNext=0,this.indentValue=0,this.lineEndPos=null,this.next=null,this.pos=0}*lex(e,t=!1){if(e){if(typeof e!="string")throw TypeError("source is not a string");this.buffer=this.buffer?this.buffer+e:e,this.lineEndPos=null}this.atEnd=!t;let i=this.next??"stream";for(;i&&(t||this.hasChars(1));)i=yield*this.parseNext(i)}atLineEnd(){let e=this.pos,t=this.buffer[e];for(;t===" "||t==="	";)t=this.buffer[++e];return!t||t==="#"||t===`
`?!0:t==="\r"?this.buffer[e+1]===`
`:!1}charAt(e){return this.buffer[this.pos+e]}continueScalar(e){let t=this.buffer[e];if(this.indentNext>0){let i=0;for(;t===" ";)t=this.buffer[++i+e];if(t==="\r"){const n=this.buffer[i+e+1];if(n===`
`||!n&&!this.atEnd)return e+i+1}return t===`
`||i>=this.indentNext||!t&&!this.atEnd?e+i:-1}if(t==="-"||t==="."){const i=this.buffer.substr(e,3);if((i==="---"||i==="...")&&Kt(this.buffer[e+3]))return-1}return e}getLine(){let e=this.lineEndPos;return(typeof e!="number"||e!==-1&&e<this.pos)&&(e=this.buffer.indexOf(`
`,this.pos),this.lineEndPos=e),e===-1?this.atEnd?this.buffer.substring(this.pos):null:(this.buffer[e-1]==="\r"&&(e-=1),this.buffer.substring(this.pos,e))}hasChars(e){return this.pos+e<=this.buffer.length}setNext(e){return this.buffer=this.buffer.substring(this.pos),this.pos=0,this.lineEndPos=null,this.next=e,null}peek(e){return this.buffer.substr(this.pos,e)}*parseNext(e){switch(e){case"stream":return yield*this.parseStream();case"line-start":return yield*this.parseLineStart();case"block-start":return yield*this.parseBlockStart();case"doc":return yield*this.parseDocument();case"flow":return yield*this.parseFlowCollection();case"quoted-scalar":return yield*this.parseQuotedScalar();case"block-scalar":return yield*this.parseBlockScalar();case"plain-scalar":return yield*this.parsePlainScalar()}}*parseStream(){let e=this.getLine();if(e===null)return this.setNext("stream");if(e[0]===Kr&&(yield*this.pushCount(1),e=e.substring(1)),e[0]==="%"){let t=e.length,i=e.indexOf("#");for(;i!==-1;){const r=e[i-1];if(r===" "||r==="	"){t=i-1;break}else i=e.indexOf("#",i+1)}for(;;){const r=e[t-1];if(r===" "||r==="	")t-=1;else break}const n=(yield*this.pushCount(t))+(yield*this.pushSpaces(!0));return yield*this.pushCount(e.length-n),this.pushNewline(),"stream"}if(this.atLineEnd()){const t=yield*this.pushSpaces(!0);return yield*this.pushCount(e.length-t),yield*this.pushNewline(),"stream"}return yield Vr,yield*this.parseLineStart()}*parseLineStart(){const e=this.charAt(0);if(!e&&!this.atEnd)return this.setNext("line-start");if(e==="-"||e==="."){if(!this.atEnd&&!this.hasChars(4))return this.setNext("line-start");const t=this.peek(3);if((t==="---"||t==="...")&&Kt(this.charAt(3)))return yield*this.pushCount(3),this.indentValue=0,this.indentNext=0,t==="---"?"doc":"stream"}return this.indentValue=yield*this.pushSpaces(!1),this.indentNext>this.indentValue&&!Kt(this.charAt(1))&&(this.indentNext=this.indentValue),yield*this.parseBlockStart()}*parseBlockStart(){const[e,t]=this.peek(2);if(!t&&!this.atEnd)return this.setNext("block-start");if((e==="-"||e==="?"||e===":")&&Kt(t)){const i=(yield*this.pushCount(1))+(yield*this.pushSpaces(!0));return this.indentNext=this.indentValue+1,this.indentValue+=i,yield*this.parseBlockStart()}return"doc"}*parseDocument(){yield*this.pushSpaces(!0);const e=this.getLine();if(e===null)return this.setNext("doc");let t=yield*this.pushIndicators();switch(e[t]){case"#":yield*this.pushCount(e.length-t);case void 0:return yield*this.pushNewline(),yield*this.parseLineStart();case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel=1,"flow";case"}":case"]":return yield*this.pushCount(1),"doc";case"*":return yield*this.pushUntil(ua),"doc";case'"':case"'":return yield*this.parseQuotedScalar();case"|":case">":return t+=yield*this.parseBlockScalarHeader(),t+=yield*this.pushSpaces(!0),yield*this.pushCount(e.length-t),yield*this.pushNewline(),yield*this.parseBlockScalar();default:return yield*this.parsePlainScalar()}}*parseFlowCollection(){let e,t,i=-1;do e=yield*this.pushNewline(),e>0?(t=yield*this.pushSpaces(!1),this.indentValue=i=t):t=0,t+=yield*this.pushSpaces(!0);while(e+t>0);const n=this.getLine();if(n===null)return this.setNext("flow");if((i!==-1&&i<this.indentNext&&n[0]!=="#"||i===0&&(n.startsWith("---")||n.startsWith("..."))&&Kt(n[3]))&&!(i===this.indentNext-1&&this.flowLevel===1&&(n[0]==="]"||n[0]==="}")))return this.flowLevel=0,yield zr,yield*this.parseLineStart();let r=0;for(;n[r]===",";)r+=yield*this.pushCount(1),r+=yield*this.pushSpaces(!0),this.flowKey=!1;switch(r+=yield*this.pushIndicators(),n[r]){case void 0:return"flow";case"#":return yield*this.pushCount(n.length-r),"flow";case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel+=1,"flow";case"}":case"]":return yield*this.pushCount(1),this.flowKey=!0,this.flowLevel-=1,this.flowLevel?"flow":"doc";case"*":return yield*this.pushUntil(ua),"flow";case'"':case"'":return this.flowKey=!0,yield*this.parseQuotedScalar();case":":{const a=this.charAt(1);if(this.flowKey||Kt(a)||a===",")return this.flowKey=!1,yield*this.pushCount(1),yield*this.pushSpaces(!0),"flow"}default:return this.flowKey=!1,yield*this.parsePlainScalar()}}*parseQuotedScalar(){const e=this.charAt(0);let t=this.buffer.indexOf(e,this.pos+1);if(e==="'")for(;t!==-1&&this.buffer[t+1]==="'";)t=this.buffer.indexOf("'",t+2);else for(;t!==-1;){let r=0;for(;this.buffer[t-1-r]==="\\";)r+=1;if(r%2===0)break;t=this.buffer.indexOf('"',t+1)}const i=this.buffer.substring(0,t);let n=i.indexOf(`
`,this.pos);if(n!==-1){for(;n!==-1;){const r=this.continueScalar(n+1);if(r===-1)break;n=i.indexOf(`
`,r)}n!==-1&&(t=n-(i[n-1]==="\r"?2:1))}if(t===-1){if(!this.atEnd)return this.setNext("quoted-scalar");t=this.buffer.length}return yield*this.pushToIndex(t+1,!1),this.flowLevel?"flow":"doc"}*parseBlockScalarHeader(){this.blockScalarIndent=-1,this.blockScalarKeep=!1;let e=this.pos;for(;;){const t=this.buffer[++e];if(t==="+")this.blockScalarKeep=!0;else if(t>"0"&&t<="9")this.blockScalarIndent=Number(t)-1;else if(t!=="-")break}return yield*this.pushUntil(t=>Kt(t)||t==="#")}*parseBlockScalar(){let e=this.pos-1,t=0,i;e:for(let r=this.pos;i=this.buffer[r];++r)switch(i){case" ":t+=1;break;case`
`:e=r,t=0;break;case"\r":{const a=this.buffer[r+1];if(!a&&!this.atEnd)return this.setNext("block-scalar");if(a===`
`)break}default:break e}if(!i&&!this.atEnd)return this.setNext("block-scalar");if(t>=this.indentNext){this.blockScalarIndent===-1?this.indentNext=t:this.indentNext=this.blockScalarIndent+(this.indentNext===0?1:this.indentNext);do{const r=this.continueScalar(e+1);if(r===-1)break;e=this.buffer.indexOf(`
`,r)}while(e!==-1);if(e===-1){if(!this.atEnd)return this.setNext("block-scalar");e=this.buffer.length}}let n=e+1;for(i=this.buffer[n];i===" ";)i=this.buffer[++n];if(i==="	"){for(;i==="	"||i===" "||i==="\r"||i===`
`;)i=this.buffer[++n];e=n-1}else if(!this.blockScalarKeep)do{let r=e-1,a=this.buffer[r];a==="\r"&&(a=this.buffer[--r]);const o=r;for(;a===" ";)a=this.buffer[--r];if(a===`
`&&r>=this.pos&&r+1+t>o)e=r;else break}while(!0);return yield bn,yield*this.pushToIndex(e+1,!0),yield*this.parseLineStart()}*parsePlainScalar(){const e=this.flowLevel>0;let t=this.pos-1,i=this.pos-1,n;for(;n=this.buffer[++i];)if(n===":"){const r=this.buffer[i+1];if(Kt(r)||e&&Jn.has(r))break;t=i}else if(Kt(n)){let r=this.buffer[i+1];if(n==="\r"&&(r===`
`?(i+=1,n=`
`,r=this.buffer[i+1]):t=i),r==="#"||e&&Jn.has(r))break;if(n===`
`){const a=this.continueScalar(i+1);if(a===-1)break;i=Math.max(i,a-2)}}else{if(e&&Jn.has(n))break;t=i}return!n&&!this.atEnd?this.setNext("plain-scalar"):(yield bn,yield*this.pushToIndex(t+1,!0),e?"flow":"doc")}*pushCount(e){return e>0?(yield this.buffer.substr(this.pos,e),this.pos+=e,e):0}*pushToIndex(e,t){const i=this.buffer.slice(this.pos,e);return i?(yield i,this.pos+=i.length,i.length):(t&&(yield""),0)}*pushIndicators(){switch(this.charAt(0)){case"!":return(yield*this.pushTag())+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"&":return(yield*this.pushUntil(ua))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"-":case"?":case":":{const e=this.flowLevel>0,t=this.charAt(1);if(Kt(t)||e&&Jn.has(t))return e?this.flowKey&&(this.flowKey=!1):this.indentNext=this.indentValue+1,(yield*this.pushCount(1))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators())}}return 0}*pushTag(){if(this.charAt(1)==="<"){let e=this.pos+2,t=this.buffer[e];for(;!Kt(t)&&t!==">";)t=this.buffer[++e];return yield*this.pushToIndex(t===">"?e+1:e,!1)}else{let e=this.pos+1,t=this.buffer[e];for(;t;)if(pm.has(t))t=this.buffer[++e];else if(t==="%"&&il.has(this.buffer[e+1])&&il.has(this.buffer[e+2]))t=this.buffer[e+=3];else break;return yield*this.pushToIndex(e,!1)}}*pushNewline(){const e=this.buffer[this.pos];return e===`
`?yield*this.pushCount(1):e==="\r"&&this.charAt(1)===`
`?yield*this.pushCount(2):0}*pushSpaces(e){let t=this.pos-1,i;do i=this.buffer[++t];while(i===" "||e&&i==="	");const n=t-this.pos;return n>0&&(yield this.buffer.substr(this.pos,n),this.pos=t),n}*pushUntil(e){let t=this.pos,i=this.buffer[t];for(;!e(i);)i=this.buffer[++t];return yield*this.pushToIndex(t,!1)}}class uu{constructor(){this.lineStarts=[],this.addNewLine=e=>this.lineStarts.push(e),this.linePos=e=>{let t=0,i=this.lineStarts.length;for(;t<i;){const r=t+i>>1;this.lineStarts[r]<e?t=r+1:i=r}if(this.lineStarts[t]===e)return{line:t+1,col:1};if(t===0)return{line:0,col:e};const n=this.lineStarts[t-1];return{line:t,col:e-n+1}}}}function wi(s,e){for(let t=0;t<s.length;++t)if(s[t].type===e)return!0;return!1}function sl(s){for(let e=0;e<s.length;++e)switch(s[e].type){case"space":case"comment":case"newline":break;default:return e}return-1}function du(s){switch(s==null?void 0:s.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"flow-collection":return!0;default:return!1}}function Xn(s){switch(s.type){case"document":return s.start;case"block-map":{const e=s.items[s.items.length-1];return e.sep??e.start}case"block-seq":return s.items[s.items.length-1].start;default:return[]}}function ps(s){var t;if(s.length===0)return[];let e=s.length;e:for(;--e>=0;)switch(s[e].type){case"doc-start":case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":case"newline":break e}for(;((t=s[++e])==null?void 0:t.type)==="space";);return s.splice(e,s.length)}function nl(s){if(s.start.type==="flow-seq-start")for(const e of s.items)e.sep&&!e.value&&!wi(e.start,"explicit-key-ind")&&!wi(e.sep,"map-value-ind")&&(e.key&&(e.value=e.key),delete e.key,du(e.value)?e.value.end?Array.prototype.push.apply(e.value.end,e.sep):e.value.end=e.sep:Array.prototype.push.apply(e.start,e.sep),delete e.sep)}class fo{constructor(e){this.atNewLine=!0,this.atScalar=!1,this.indent=0,this.offset=0,this.onKeyLine=!1,this.stack=[],this.source="",this.type="",this.lexer=new cu,this.onNewLine=e}*parse(e,t=!1){this.onNewLine&&this.offset===0&&this.onNewLine(0);for(const i of this.lexer.lex(e,t))yield*this.next(i);t||(yield*this.end())}*next(e){if(this.source=e,this.atScalar){this.atScalar=!1,yield*this.step(),this.offset+=e.length;return}const t=lu(e);if(t)if(t==="scalar")this.atNewLine=!1,this.atScalar=!0,this.type="scalar";else{switch(this.type=t,yield*this.step(),t){case"newline":this.atNewLine=!0,this.indent=0,this.onNewLine&&this.onNewLine(this.offset+e.length);break;case"space":this.atNewLine&&e[0]===" "&&(this.indent+=e.length);break;case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":this.atNewLine&&(this.indent+=e.length);break;case"doc-mode":case"flow-error-end":return;default:this.atNewLine=!1}this.offset+=e.length}else{const i=`Not a YAML token: ${e}`;yield*this.pop({type:"error",offset:this.offset,message:i,source:e}),this.offset+=e.length}}*end(){for(;this.stack.length>0;)yield*this.pop()}get sourceToken(){return{type:this.type,offset:this.offset,indent:this.indent,source:this.source}}*step(){const e=this.peek(1);if(this.type==="doc-end"&&(!e||e.type!=="doc-end")){for(;this.stack.length>0;)yield*this.pop();this.stack.push({type:"doc-end",offset:this.offset,source:this.source});return}if(!e)return yield*this.stream();switch(e.type){case"document":return yield*this.document(e);case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return yield*this.scalar(e);case"block-scalar":return yield*this.blockScalar(e);case"block-map":return yield*this.blockMap(e);case"block-seq":return yield*this.blockSequence(e);case"flow-collection":return yield*this.flowCollection(e);case"doc-end":return yield*this.documentEnd(e)}yield*this.pop()}peek(e){return this.stack[this.stack.length-e]}*pop(e){const t=e??this.stack.pop();if(!t)yield{type:"error",offset:this.offset,source:"",message:"Tried to pop an empty stack"};else if(this.stack.length===0)yield t;else{const i=this.peek(1);switch(t.type==="block-scalar"?t.indent="indent"in i?i.indent:0:t.type==="flow-collection"&&i.type==="document"&&(t.indent=0),t.type==="flow-collection"&&nl(t),i.type){case"document":i.value=t;break;case"block-scalar":i.props.push(t);break;case"block-map":{const n=i.items[i.items.length-1];if(n.value){i.items.push({start:[],key:t,sep:[]}),this.onKeyLine=!0;return}else if(n.sep)n.value=t;else{Object.assign(n,{key:t,sep:[]}),this.onKeyLine=!n.explicitKey;return}break}case"block-seq":{const n=i.items[i.items.length-1];n.value?i.items.push({start:[],value:t}):n.value=t;break}case"flow-collection":{const n=i.items[i.items.length-1];!n||n.value?i.items.push({start:[],key:t,sep:[]}):n.sep?n.value=t:Object.assign(n,{key:t,sep:[]});return}default:yield*this.pop(),yield*this.pop(t)}if((i.type==="document"||i.type==="block-map"||i.type==="block-seq")&&(t.type==="block-map"||t.type==="block-seq")){const n=t.items[t.items.length-1];n&&!n.sep&&!n.value&&n.start.length>0&&sl(n.start)===-1&&(t.indent===0||n.start.every(r=>r.type!=="comment"||r.indent<t.indent))&&(i.type==="document"?i.end=n.start:i.items.push({start:n.start}),t.items.splice(-1,1))}}}*stream(){switch(this.type){case"directive-line":yield{type:"directive",offset:this.offset,source:this.source};return;case"byte-order-mark":case"space":case"comment":case"newline":yield this.sourceToken;return;case"doc-mode":case"doc-start":{const e={type:"document",offset:this.offset,start:[]};this.type==="doc-start"&&e.start.push(this.sourceToken),this.stack.push(e);return}}yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML stream`,source:this.source}}*document(e){if(e.value)return yield*this.lineEnd(e);switch(this.type){case"doc-start":{sl(e.start)!==-1?(yield*this.pop(),yield*this.step()):e.start.push(this.sourceToken);return}case"anchor":case"tag":case"space":case"comment":case"newline":e.start.push(this.sourceToken);return}const t=this.startBlockValue(e);t?this.stack.push(t):yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML document`,source:this.source}}*scalar(e){if(this.type==="map-value-ind"){const t=Xn(this.peek(2)),i=ps(t);let n;e.end?(n=e.end,n.push(this.sourceToken),delete e.end):n=[this.sourceToken];const r={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:i,key:e,sep:n}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=r}else yield*this.lineEnd(e)}*blockScalar(e){switch(this.type){case"space":case"comment":case"newline":e.props.push(this.sourceToken);return;case"scalar":if(e.source=this.source,this.atNewLine=!0,this.indent=0,this.onNewLine){let t=this.source.indexOf(`
`)+1;for(;t!==0;)this.onNewLine(this.offset+t),t=this.source.indexOf(`
`,t)+1}yield*this.pop();break;default:yield*this.pop(),yield*this.step()}}*blockMap(e){var i;const t=e.items[e.items.length-1];switch(this.type){case"newline":if(this.onKeyLine=!1,t.value){const n="end"in t.value?t.value.end:void 0,r=Array.isArray(n)?n[n.length-1]:void 0;(r==null?void 0:r.type)==="comment"?n==null||n.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"space":case"comment":if(t.value)e.items.push({start:[this.sourceToken]});else if(t.sep)t.sep.push(this.sourceToken);else{if(this.atIndentedComment(t.start,e.indent)){const n=e.items[e.items.length-2],r=(i=n==null?void 0:n.value)==null?void 0:i.end;if(Array.isArray(r)){Array.prototype.push.apply(r,t.start),r.push(this.sourceToken),e.items.pop();return}}t.start.push(this.sourceToken)}return}if(this.indent>=e.indent){const n=!this.onKeyLine&&this.indent===e.indent,r=n&&(t.sep||t.explicitKey)&&this.type!=="seq-item-ind";let a=[];if(r&&t.sep&&!t.value){const o=[];for(let l=0;l<t.sep.length;++l){const c=t.sep[l];switch(c.type){case"newline":o.push(l);break;case"space":break;case"comment":c.indent>e.indent&&(o.length=0);break;default:o.length=0}}o.length>=2&&(a=t.sep.splice(o[1]))}switch(this.type){case"anchor":case"tag":r||t.value?(a.push(this.sourceToken),e.items.push({start:a}),this.onKeyLine=!0):t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"explicit-key-ind":!t.sep&&!t.explicitKey?(t.start.push(this.sourceToken),t.explicitKey=!0):r||t.value?(a.push(this.sourceToken),e.items.push({start:a,explicitKey:!0})):this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken],explicitKey:!0}]}),this.onKeyLine=!0;return;case"map-value-ind":if(t.explicitKey)if(t.sep)if(t.value)e.items.push({start:[],key:null,sep:[this.sourceToken]});else if(wi(t.sep,"map-value-ind"))this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:a,key:null,sep:[this.sourceToken]}]});else if(du(t.key)&&!wi(t.sep,"newline")){const o=ps(t.start),l=t.key,c=t.sep;c.push(this.sourceToken),delete t.key,delete t.sep,this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:o,key:l,sep:c}]})}else a.length>0?t.sep=t.sep.concat(a,this.sourceToken):t.sep.push(this.sourceToken);else if(wi(t.start,"newline"))Object.assign(t,{key:null,sep:[this.sourceToken]});else{const o=ps(t.start);this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:o,key:null,sep:[this.sourceToken]}]})}else t.sep?t.value||r?e.items.push({start:a,key:null,sep:[this.sourceToken]}):wi(t.sep,"map-value-ind")?this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[],key:null,sep:[this.sourceToken]}]}):t.sep.push(this.sourceToken):Object.assign(t,{key:null,sep:[this.sourceToken]});this.onKeyLine=!0;return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const o=this.flowScalar(this.type);r||t.value?(e.items.push({start:a,key:o,sep:[]}),this.onKeyLine=!0):t.sep?this.stack.push(o):(Object.assign(t,{key:o,sep:[]}),this.onKeyLine=!0);return}default:{const o=this.startBlockValue(e);if(o){if(o.type==="block-seq"){if(!t.explicitKey&&t.sep&&!wi(t.sep,"newline")){yield*this.pop({type:"error",offset:this.offset,message:"Unexpected block-seq-ind on same line with key",source:this.source});return}}else n&&e.items.push({start:a});this.stack.push(o);return}}}}yield*this.pop(),yield*this.step()}*blockSequence(e){var i;const t=e.items[e.items.length-1];switch(this.type){case"newline":if(t.value){const n="end"in t.value?t.value.end:void 0,r=Array.isArray(n)?n[n.length-1]:void 0;(r==null?void 0:r.type)==="comment"?n==null||n.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else t.start.push(this.sourceToken);return;case"space":case"comment":if(t.value)e.items.push({start:[this.sourceToken]});else{if(this.atIndentedComment(t.start,e.indent)){const n=e.items[e.items.length-2],r=(i=n==null?void 0:n.value)==null?void 0:i.end;if(Array.isArray(r)){Array.prototype.push.apply(r,t.start),r.push(this.sourceToken),e.items.pop();return}}t.start.push(this.sourceToken)}return;case"anchor":case"tag":if(t.value||this.indent<=e.indent)break;t.start.push(this.sourceToken);return;case"seq-item-ind":if(this.indent!==e.indent)break;t.value||wi(t.start,"seq-item-ind")?e.items.push({start:[this.sourceToken]}):t.start.push(this.sourceToken);return}if(this.indent>e.indent){const n=this.startBlockValue(e);if(n){this.stack.push(n);return}}yield*this.pop(),yield*this.step()}*flowCollection(e){const t=e.items[e.items.length-1];if(this.type==="flow-error-end"){let i;do yield*this.pop(),i=this.peek(1);while(i&&i.type==="flow-collection")}else if(e.end.length===0){switch(this.type){case"comma":case"explicit-key-ind":!t||t.sep?e.items.push({start:[this.sourceToken]}):t.start.push(this.sourceToken);return;case"map-value-ind":!t||t.value?e.items.push({start:[],key:null,sep:[this.sourceToken]}):t.sep?t.sep.push(this.sourceToken):Object.assign(t,{key:null,sep:[this.sourceToken]});return;case"space":case"comment":case"newline":case"anchor":case"tag":!t||t.value?e.items.push({start:[this.sourceToken]}):t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const n=this.flowScalar(this.type);!t||t.value?e.items.push({start:[],key:n,sep:[]}):t.sep?this.stack.push(n):Object.assign(t,{key:n,sep:[]});return}case"flow-map-end":case"flow-seq-end":e.end.push(this.sourceToken);return}const i=this.startBlockValue(e);i?this.stack.push(i):(yield*this.pop(),yield*this.step())}else{const i=this.peek(2);if(i.type==="block-map"&&(this.type==="map-value-ind"&&i.indent===e.indent||this.type==="newline"&&!i.items[i.items.length-1].sep))yield*this.pop(),yield*this.step();else if(this.type==="map-value-ind"&&i.type!=="flow-collection"){const n=Xn(i),r=ps(n);nl(e);const a=e.end.splice(1,e.end.length);a.push(this.sourceToken);const o={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:r,key:e,sep:a}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=o}else yield*this.lineEnd(e)}}flowScalar(e){if(this.onNewLine){let t=this.source.indexOf(`
`)+1;for(;t!==0;)this.onNewLine(this.offset+t),t=this.source.indexOf(`
`,t)+1}return{type:e,offset:this.offset,indent:this.indent,source:this.source}}startBlockValue(e){switch(this.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return this.flowScalar(this.type);case"block-scalar-header":return{type:"block-scalar",offset:this.offset,indent:this.indent,props:[this.sourceToken],source:""};case"flow-map-start":case"flow-seq-start":return{type:"flow-collection",offset:this.offset,indent:this.indent,start:this.sourceToken,items:[],end:[]};case"seq-item-ind":return{type:"block-seq",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]};case"explicit-key-ind":{this.onKeyLine=!0;const t=Xn(e),i=ps(t);return i.push(this.sourceToken),{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:i,explicitKey:!0}]}}case"map-value-ind":{this.onKeyLine=!0;const t=Xn(e),i=ps(t);return{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:i,key:null,sep:[this.sourceToken]}]}}}return null}atIndentedComment(e,t){return this.type!=="comment"||this.indent<=t?!1:e.every(i=>i.type==="newline"||i.type==="space")}*documentEnd(e){this.type!=="doc-mode"&&(e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop()))}*lineEnd(e){switch(this.type){case"comma":case"doc-start":case"doc-end":case"flow-seq-end":case"flow-map-end":case"map-value-ind":yield*this.pop(),yield*this.step();break;case"newline":this.onKeyLine=!1;case"space":case"comment":default:e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop())}}}function fu(s){const e=s.prettyErrors!==!1;return{lineCounter:s.lineCounter||e&&new uu||null,prettyErrors:e}}function mm(s,e={}){const{lineCounter:t,prettyErrors:i}=fu(e),n=new fo(t==null?void 0:t.addNewLine),r=new uo(e),a=Array.from(r.compose(n.parse(s)));if(i&&t)for(const o of a)o.errors.forEach(kr(s,t)),o.warnings.forEach(kr(s,t));return a.length>0?a:Object.assign([],{empty:!0},r.streamInfo())}function hu(s,e={}){const{lineCounter:t,prettyErrors:i}=fu(e),n=new fo(t==null?void 0:t.addNewLine),r=new uo(e);let a=null;for(const o of r.compose(n.parse(s),!0,s.length))if(!a)a=o;else if(a.options.logLevel!=="silent"){a.errors.push(new Hi(o.range.slice(0,2),"MULTIPLE_DOCS","Source contains multiple documents; please use YAML.parseAllDocuments()"));break}return i&&t&&(a.errors.forEach(kr(s,t)),a.warnings.forEach(kr(s,t))),a}function vm(s,e,t){let i;typeof e=="function"?i=e:t===void 0&&e&&typeof e=="object"&&(t=e);const n=hu(s,t);if(!n)return null;if(n.warnings.forEach(r=>Dc(n.options.logLevel,r)),n.errors.length>0){if(n.options.logLevel!=="silent")throw n.errors[0];n.errors=[]}return n.toJS(Object.assign({reviver:i},t))}function km(s,e,t){let i=null;if(typeof e=="function"||Array.isArray(e)?i=e:t===void 0&&e&&(t=e),typeof t=="string"&&(t=t.length),typeof t=="number"){const n=Math.round(t);t=n<1?void 0:n>8?{indent:8}:{indent:n}}if(s===void 0){const{keepUndefined:n}=t??e??{};if(!n)return}return ls(s)&&!i?s.toString(t):new Js(s,i,t).toString(t)}const ym=Object.freeze(Object.defineProperty({__proto__:null,Alias:Fr,CST:hm,Composer:uo,Document:Js,Lexer:cu,LineCounter:uu,Pair:Xe,Parser:fo,Scalar:Z,Schema:Hr,YAMLError:lo,YAMLMap:kt,YAMLParseError:Hi,YAMLSeq:Mi,YAMLWarning:Qc,isAlias:Ri,isCollection:je,isDocument:ls,isMap:zs,isNode:Re,isPair:xe,isScalar:Pe,isSeq:Gs,parse:vm,parseAllDocuments:mm,parseDocument:hu,stringify:km,visit:cs,visitAsync:Dr},Symbol.toStringTag,{value:"Module"})),pu={JsonQuery:"This query is written using JSON. This is deprecated and will be removed in a future version. Please use YAML instead.",GroupParameter:"The 'group' field is deprecated and will be removed in a future version. Please use 'groupBy' instead."};class pt extends Error{constructor(e,t=void 0){super(e),this.inner=t}toString(){return this.inner?`${this.message}: '${this.inner}'`:super.toString()}}function bm(s){let e;const t=[];try{e=wm(s),t.push(pu.JsonQuery)}catch(r){try{e=Tm(s)}catch(a){throw new pt("Unable to parse as YAML or JSON",{eJson:r,eYaml:a})}}const[i,n]=_m(e);return t.push(...n),[i,t]}function wm(s){try{return JSON.parse(s)}catch(e){throw new pt("Invalid JSON",e)}}function Tm(s){try{return ym.parse(s)}catch(e){throw new pt("Invalid YAML",e)}}function _m(s){const e=Pm(s,"group")??!1,t=e?hi.Project:Em(s,"groupBy",Om)??hi.None,i=[];return e&&i.push(pu.GroupParameter),[{name:rl(s,"name")??"",filter:Im("filter",rl(s,"filter")),autorefresh:Sm(s,"autorefresh")??0,sorting:al(s,"sorting",Cm)??[Pt.Order],show:new Set(al(s,"show",ol)??Object.values(ol)),groupBy:t},i]}function Im(s,e){if(e===void 0)throw new pt(`Field ${s} must be text`);return e}function rl(s,e){const t=s[e];if(t!==void 0){if(typeof t!="string")throw new pt(`Field ${e} must be text`);return t}}function Sm(s,e,t){const i=s[e];if(i===void 0)return;if(typeof i!="number")throw new pt(`Field ${e} must be a number`);const n=i;if(Number.isNaN(n))throw new pt(`Field ${e} must be a number`);if(n<0)throw new pt(`Field ${e} must be a positive number`);return n}function Pm(s,e){const t=s[e];if(t!==void 0){if(typeof t!="boolean")throw new pt(`Field ${e} must be a boolean.`);return t}}function al(s,e,t){const i=s[e];if(i===void 0)return;const n=Object.keys(t).join(", ");if(!Array.isArray(i))throw new pt(`Field ${e} must be an array from values: ${n}`);const r=i,a=[];for(const o of r){if(typeof o!="string")throw new pt(`Field ${e} must be an array from values: ${n}`);const l=t[o];if(l===void 0)throw new pt(`Field ${e} must be an array from values: ${n}`);a.push(l)}return a}function Em(s,e,t){const i=s[e];if(i===void 0)return;const n=Object.keys(t).join(", ");if(typeof i!="string")throw new pt(`Field ${e} must be one of: ${n}`);const r=t[i];if(r===void 0)throw new pt(`Field ${e} must be one of: ${n}`);return r}const Cm={priority:Pt.Priority,priorityAscending:Pt.PriorityAscending,priorityDescending:Pt.Priority,date:Pt.Date,dateAscending:Pt.Date,dateDescending:Pt.DateDescending,order:Pt.Order,dateAdded:Pt.DateAdded,dateAddedAscending:Pt.DateAdded,dateAddedDescending:Pt.DateAddedDescending},ol={due:gs.Due,date:gs.Due,description:gs.Description,labels:gs.Labels,project:gs.Project},Om={project:hi.Project,section:hi.Section,priority:hi.Priority,due:hi.Date,date:hi.Date,labels:hi.Label};class Am{constructor(e){this.plugin=e}onNewBlock(e,t,i){let n;try{const[r,a]=bm(e);n=new ll(t,this.plugin,ug,{query:r,warnings:a},!0)}catch(r){log.error(r),n=new ll(t,this.plugin,ng,{error:r},!1)}i.addChild(n)}}class ll extends F.MarkdownRenderChild{constructor(e,t,i,n,r){super(e),this.plugin=t,this.component=i,this.props=n}onload(){const e=this.component;this.root=zl(e,{target:this.containerEl,props:this.props})}onunload(){this.root&&Gl(this.root)}}var gu=(s=>(s.createdTime="",s.scheduled_date="",s.startDate="",s.dueDate="",s.completedTime="",s.cancelled_date="",s))(gu||{});class Nm{parseDates(e){let t=this.getEmptydateHolder();const i="\\[\\s*(\\d{1,2}:\\d{2})(?:\\s*-\\s*(\\d{1,2}:\\d{2}))?\\s*\\]",n=new RegExp(i,"i"),r=e.match(n);let a,o;r&&(a=r[1],o=r[2]);for(const[l,c]of Object.entries(gu)){let d=this.extractDates(l,e,c);if(d){if((l=="scheduled_date"||l=="startDate")&&a&&!d.hasATime){d.hasATime=!0,d.time=a;const g=`${d.date}T${a}`;d.isoDate=this.formatDateToISO(new Date(g))}if(l=="dueDate"&&!d.hasATime){let g="";if(a&&o?(g=o,d.hasATime=!0):a&&(g=a,d.hasATime=!0),g){d.time=g;const h=`${d.date}T${g}`;d.isoDate=this.formatDateToISO(new Date(h))}}d.hasATime&&(t.isAllDay=!d.hasATime),t[l]=d}}return t}addDatesToLine(e,t){let i=[],n="",r="",a=null;if(t.dateHolder?a=Object.keys(t.dateHolder):(b.warn("No DateHolder found: ",t.dateHolder),t.dateHolder=this.getEmptydateHolder()),a)for(let o=0;o<a.length;o++){const l=a[o];if(l=="isAllDay")continue;const c=t.dateHolder[l];if(c&&c.isoDate){const d=this.buildDateLineComponent(c.isoDate,c.emoji,i);switch(l){case"scheduled_date":case"startDate":n=d;break;case"dueDate":r=d;break}}}else b.error("Date Holder Keys Not found.");if(!t.isAllDay){let o=e.indexOf("]",0);o=o+1,n!=""&&r!=""?e=e.substring(0,o)+" ["+n+" - "+r+"] "+e.substring(o):n!=""?e=e.substring(0,o)+" ["+n+"]"+e.substring(o):r!=""&&(e=e.substring(0,o)+" ["+r+"]"+e.substring(o))}return i&&i.forEach(o=>{e+=" "+o}),e}stripDatesFromLine(e){let t,i=/[]\s(\d{4}-\d{2}-\d{2})(\s\d{1,}:\d{2})?/gus;t=e.replace(i,"");const n=/\[\s*(\d{1,2}:\d{2})(?:\s*-\s*(\d{1,2}:\d{2}))?\s*\]/gus;return t=t.replace(n,""),t}addDateHolderToTask(e,t){let i=this.getEmptydateHolder();"isAllDay"in e?"dueDate"in e&&(i.dueDate=this.getDateAndTime(e.dueDate,e.isAllDay,""),e.dueDate!==e.startDate&&(t?t.dateHolder.scheduled_date?i.scheduled_date=this.getDateAndTime(e.startDate,e.isAllDay,""):i.startDate=this.getDateAndTime(e.startDate,e.isAllDay,""):i.startDate=this.getDateAndTime(e.startDate,e.isAllDay,""))):e.dateHolder=i,e.completedTime&&(i.completedTime=this.getDateAndTime(e.completedTime,!1,"")),t&&t.dateHolder&&(t.dateHolder.cancelled_date&&(i.cancelled_date=t.dateHolder.cancelled_date),t.dateHolder.createdTime&&(i.createdTime=t.dateHolder.createdTime)),e.dateHolder=i}areDatesChanged(e,t){var a,o;const i=e.dateHolder,n=t.dateHolder;if(!i){if(b.error("Edited Task has no dateholder"),n){const l=Object.keys(n);if(l)for(let c=0;c<l.length;c++){const d=l[c];if(d!="isAllDay"&&n[d])return!0}}return!1}if(!n)return b.error("Cached Task has no dateholder"),!0;const r=Object.keys(i);if(r)for(let l=0;l<r.length;l++){const c=r[l];if(c!="isAllDay"){if(i[c]&&!n[c])return!0;if(i[c]){let d=!1;if(i[c].hasATime?d=this.areDatesDifferent(i[c].isoDate,n[c].isoDate):d=((a=i[c])==null?void 0:a.date)!=((o=n[c])==null?void 0:o.date),d)return b.debug("dateChanged",{key:c,newDate:i[c].isoDate,oldDate:n[c].isoDate}),!0}if(!i[c]&&n[c])return!0}}return!1}formatDateToISO(e){return isNaN(e.getTime())?"Invalid Date":new Date(e.getTime()).toISOString().replace(/Z$/,"+0000")}utcToLocal(e){const t=new Date(e),i="en-US",n=Intl.DateTimeFormat().resolvedOptions().timeZone,r=t.toLocaleString(i,{timeZone:n}),[a,o]=r.split(", ");let[l,c,d]=a.split("/");if(l=String(l).padStart(2,"0"),c=String(c).padStart(2,"0"),o){let[g,h]=o.split(":");return r.includes("PM")&&g!=="12"?g=(Number(g)+12).toString():r.includes("AM")&&g==="12"&&(g="00"),g=String(g).padStart(2,"0"),h=String(h).padStart(2,"0"),`${d}-${l}-${c} ${g}:${h}`}return`${d}-${l}-${c}`}cleanDate(e){if(e.includes("+-")){e=e.replace("+-","-");let t=/(.*)([+-])(\d*)/;const i=e.match(t);i&&i[3].length<4&&(e=i[1]+"-0"+i[3])}return new Date(e)}getEmptydateHolder(){return{cancelled_date:null,createdTime:null,completedTime:null,dueDate:null,scheduled_date:null,startDate:null,isAllDay:!0}}getEmptyDate(){return{hasATime:!1,date:null,time:null,isoDate:null,emoji:null}}getDateAndTime(e,t,i){let n=this.getEmptyDate();n.isoDate=this.formatDateToISO(new Date(e));const a=this.utcToLocal(e).split(" ");return n.date=a[0],a[1]?n.time=a[1]:n.time="",n.hasATime=!t,n.emoji=i,n}buildDateLineComponent(e,t,i){let n=this.utcToLocal(e),r="",a=n.split(" "),o=t+" "+a[0];return i.push(o),a[1]&&(r=a[1]),r}extractDates(e,t,i){let n={};const r=`(${i})\\s(\\d{4}-\\d{2}-\\d{2})\\s*(\\d{1,}:\\d{2})*`;let a=t.match(r);if(a){let o=null,l=!1;if(!a[3])o=`${a[2]}T00:00:00.000`,l=!1;else{a[3].includes("24:")&&(a[3]=a[3].replace("24:","00:"));let[c,d]=a[3].split(":");c=String(c).padStart(2,"0"),d=String(d).padStart(2,"0"),o=`${a[2]}T${c}:${d}`,l=!0}o=this.formatDateToISO(new Date(o)),n={hasATime:l,date:a[2],time:a[3],isoDate:o,emoji:a[1]}}else n=null;return n}areDatesDifferent(e,t){const i=this.cleanDate(e),n=this.cleanDate(t);return i.getTime()!==n.getTime()}}class Lm extends F.Plugin{constructor(){super(...arguments),this.service=new Ef(this),this.taskParser=new jf(this.app,this),this.fileOperation=new ac(this.app,this),this.cacheOperation=new rc(this.app,this),this.dateMan=new Nm,this.lastLines=new Map}async onload(){this.app.workspace.onLayoutReady(async()=>{await this.pluginLoad()})}reloadInterval(){this.syncIntervalId&&(window.clearInterval(this.syncIntervalId),this.syncIntervalId=void 0);const e=O().automaticSynchronizationInterval*1e3;e!==0&&(this.syncIntervalId=window.setInterval(this.scheduledSynchronization.bind(this),e))}async onunload(){this.syncIntervalId&&window.clearInterval(this.syncIntervalId),b.debug("TickTickSync unloaded!")}async loadSettings(){try{let e=await this.loadData();try{e=await this.migrateData(e)}catch(i){return b.error("Failed to migrate data:",i),!1}e!=null&&e.TickTickTasksData&&(tc(e.TickTickTasksData.projects),Bi(e.TickTickTasksData.tasks),ic(e.TickTickTasksData.projectGroups),delete e.TickTickTasksData);const t=Object.assign({},ec,e);He(t)}catch(e){return b.error(`Failed to load data:( ${e})`),!1}return!0}async saveSettings(){try{const e=O();e&&Object.keys(e).length>0?await this.saveData({...e,TickTickTasksData:{projects:Zi(),tasks:Ct()}}):b.warn("Settings are empty or invalid, not saving to avoid data loss.")}catch(e){b.error("Error saving settings:",e)}}async initializePlugin(){if(!O().token)return!1;if(!await this.saveProjectsToCache())return this.tickTickRestAPI=void 0,new F.Notice("TickTickSync plugin initialization failed, please check userID and password in settings."),!1;this.initializeModuleClass();try{O().skipBackup||this.service.backup()}catch(t){return b.error("error creating user data folder: ",t),new F.Notice("error creating user data folder"),!1}return new F.Notice("TickTickSync loaded successfully."+O().skipBackup?" Skipping backup.":"TickTick data has been backed up."),!0}initializeModuleClass(){this.tickTickRestAPI||(this.tickTickRestAPI=new Cf(this.app,this,null))}async lineNumberCheck(){var o;const e=this.app.workspace.getActiveViewOfType(F.MarkdownView);if(!e)return!1;const t=e==null?void 0:e.editor.getCursor(),i=t==null?void 0:t.line;e.data;const n=(o=e==null?void 0:e.app.workspace.activeEditor)==null?void 0:o.file,r=n==null?void 0:n.name,a=n==null?void 0:n.path;if(typeof this.lastLines>"u"||typeof this.lastLines.get(r)>"u")return this.lastLines.set(r,i),!1;if(this.lastLines.has(r)&&i!==this.lastLines.get(r)){const l=this.lastLines.get(r),c=e.editor.getLine(l);return this.checkModuleClass()?(this.lastLines.set(r,i),await this.service.lineModifiedTaskCheck(a,c,l)):!1}return!1}async checkboxEventhandler(e,t){const i=e.target,n=i.checked;if(i.className==="task-list-item-checkbox"&&t){t.getCursor("from");const a=t.posAtMouse(e).line,o=t.getLine(a);if(this.taskParser.isMarkdownTask(o)){const l=this.taskParser.getTickTickId(o);l?n?await this.service.closeTask(l):await this.service.openTask(l):this.taskParser.getLineItemId(o)&&new F.Notice("Item will be updated on next sync")}}}checkModuleClass(){return O().token?(this.service.initialized||this.service.initialize(),this.tickTickRestAPI===void 0&&this.initializeModuleClass(),!0):(new F.Notice("Please login from settings."),!1)}async setStatusBarText(){var n,r;const e=this.app.workspace.getActiveViewOfType(F.MarkdownView);if(!e||!e.file){(n=this.statusBar)==null||n.setText("");return}const t=e.file.path;let i=await this.cacheOperation.getDefaultProjectNameForFilepath(t);i||(t.startsWith("Inbox")?i="Inbox":i="No default Project"),(r=this.statusBar)==null||r.setText(i)}async scheduledSynchronization(){if(!this.checkModuleClass())return;const e=performance.now();b.debug(`TickTick scheduled synchronization task started at ${new Date().toLocaleString()}`);try{await this.service.synchronization()}catch(i){b.error("An error occurred: ",i),new F.Notice(`An error occurred: ${i}`)}const t=performance.now();b.debug(`TickTick scheduled synchronization task completed at ${new Date().toLocaleString()}, took ${(t-e).toFixed(2)} ms`)}async saveProjectsToCache(){if(!this.checkModuleClass())return!1;let e=!1;const t=performance.now();b.debug(`TickTick saveProjectsToCache started at ${new Date().toLocaleString()}`);try{e=await this.service.saveProjectsToCache()}catch(n){b.error(`An error in saveProjectsToCache occurred:( ${n}`),new F.Notice(`An error in saveProjectsToCache occurred: ${n}`)}const i=performance.now();return b.debug(`TickTick saveProjectsToCache completed at ${new Date().toLocaleString()}, took ${(i-t).toFixed(2)} ms`),e}async pluginLoad(){if(this.addSettingTab(new ig(this.app,this)),!await this.loadSettings()){new F.Notice("Settings failed to load. Please reload the TickTickSync plugin.");return}b.setLevel(O().logLevel),b.info(`loading plugin "${this.manifest.name}" v${this.manifest.version}`);try{await this.initializePlugin()}catch(i){b.error(`API Initialization Failed.( ${i})`)}yc.service.set(this.service);const t=new Am(this);this.registerMarkdownCodeBlockProcessor("ticktick",t.onNewBlock.bind(t)),this.addRibbonIcon("sync","TickTickSync",async i=>{await this.synchronizeNow()}),this.registerEvents(),this.reloadInterval(),this.addCommand({id:"set-default-project-for-TickTick-task-in-the-current-file",name:"Set default TickTick project for current file",editorCallback:(i,n)=>{if(!n||!n.file){new F.Notice("No active file.");return}const r=n.file.path;new Rf(this.app,this,r)}}),this.addCommand({id:"tts-sync",name:"Synchronize",callback:async()=>{await this.synchronizeNow()}}),this.statusBar=this.addStatusBarItem()}async synchronizeNow(){await this.scheduledSynchronization(),new F.Notice("Sync completed..")}registerEvents(){this.registerDomEvent(document,"keyup",async t=>{var n;if(!O().token)return;const i=(n=this.app.workspace.activeEditor)==null?void 0:n.editor;if(!(!i||!i.hasFocus())){if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","PageUp","PageDown"].includes(t.key)){if(!this.checkModuleClass())return;await this.lineNumberCheck()}if(["Delete","Backspace"].includes(t.key))try{if(!this.checkModuleClass())return;await this.service.deletedTaskCheck(null),await this.saveSettings()}catch(r){b.warn(`An error occurred while deleting tasks: ${r}`)}}}),this.registerDomEvent(document,"click",async t=>{var r;const{target:i}=t;if(!O().token)return;const n=(r=this.app.workspace.activeEditor)==null?void 0:r.editor;this.checkModuleClass()&&(await this.lineNumberCheck(),i&&i.type==="checkbox"&&await this.checkboxEventhandler(t,n))});let e;this.registerEvent(this.app.workspace.on("editor-change",async(t,i)=>{e=setTimeout(async()=>{clearTimeout(e);try{if(!O().token||O().enableFullVaultSync||(await this.lineNumberCheck(),!this.checkModuleClass()))return;await this.service.lineNewContentTaskCheck(t,i),await this.saveSettings()}catch(n){b.error("An error occurred while check new task in line: ",n)}},1e3)})),this.registerEvent(this.app.vault.on("delete",async t=>{if(t instanceof F.TFolder||!O().token)return;await this.service.deletedFileCheck(t.path)&&await this.saveSettings()})),this.registerEvent(this.app.vault.on("rename",async(t,i)=>{if(t instanceof F.TFolder||!O().token)return;await this.service.renamedFileCheck(t.path,i)&&await this.saveSettings()})),this.registerEvent(this.app.vault.on("modify",async t=>{try{if(!O().token)return;const i=t.path,n=this.app.workspace.getActiveFile();if((n==null?void 0:n.path)==i)return;await this.service.fullTextNewTaskCheck(i)}catch(i){b.error("An error occurred while modifying the file: ",i)}})),this.registerEvent(this.app.workspace.on("active-leaf-change",async t=>{await this.setStatusBarText()}))}async migrateData(e){if(!e)return e;const t=[];if(!e.version){const i=e.fileMetadata;if(Array.isArray(i))for(const n in i){const r=i[n];let a={};a={TickTickTasks:r.TickTickTasks.map(o=>({taskId:o,taskItems:[]})),TickTickCount:r.TickTickCount,defaultProjectId:r.defaultProjectId},i[n]=a}O().token&&await this.scheduledSynchronization()}return(!e.version||Zt(e.version,"1.0.10"))&&(delete e.username,delete e.password),(!e.version||Zt(e.version,"1.0.36"))&&(e.tagAndOr=1,t.push(["New Task Limiting rules","Please update your preferences in settings as needed.","priorTo1.0.36"])),(!e.version||Zt(e.version,"1.0.40"))&&t.push(["New Date/Time Handling","Old date formats will be converted on the next synchronization operation.","priorTo1.0.40"]),(!e.version||Zt(e.version,"1.1.1"))&&t.push(["Note Synchronization","TickTickSync will now synchronize Notes.","priorTo1.1.1"]),(!e.version||Zt(e.version,"1.1.7"))&&t.push(["Note and Default Project Settings","Note and Default Project settings improvements.","priorTo1.1.7"]),(!e.version||Zt(e.version,"1.1.8"))&&t.push(["Link to Tasks now Configurable","Link to Tasks are now Configurable.","priorTo1.1.8"]),(!e.version||Zt(e.version,"1.1.10"))&&t.push(["Several Changes",`Tasks stay where they are created.
Backups now configurable.
Note delimiter now configurable.`,"priorTo1.1.9"]),(!e.version||Zt(e.version,"1.1.15"))&&t.push(["Can now login with SSO/2FA enabled account on Desktop","Desktop SSO/2FA login enabled.","priorTo1.1.14"]),(!e.version||Zt(e.version,"1.1.16"))&&t.push(["Note handling improvements","Can now have checklist items and TickTick Task links in notes.","priorTo1.1.15"]),t.length>0&&await this.LatestChangesModal(t),(!e.version||Zt(e.version,this.manifest.version))&&(b.debug("Updating version number to ",this.manifest.version),e.version=this.manifest.version,await this.saveSettings()),e}async LatestChangesModal(e){return await new Bf(this.app,e,i=>{this.ret=i}).showModal()}getDefaultDeviceName(){return F.Platform.isDesktopApp?require("os").hostname()||(F.Platform.isMacOS?"Mac":F.Platform.isWin?"Windows":F.Platform.isLinux?"Linux":"Desktop"):F.Platform.isIosApp?F.Platform.isPhone?"iPhone":F.Platform.isTablet?"iPad":"iOS Device":F.Platform.isAndroidApp?F.Platform.isPhone?"Android Phone":F.Platform.isTablet?"Android Tablet":"Android Device":"Unknown Device"}}class cl{static serializeCookies(e){return e.map(t=>`${t.name}=${t.value}`).join("; ")}static findSessionCookie(e){const t=["t","session","sessionid","auth","jwt"];return e.find(i=>t.includes(i.name.toLowerCase())||i.name.toLowerCase().includes("session")||i.name.toLowerCase().includes("auth"))}static async testCookies(e){try{const t=this.findSessionCookie(e);return t?(await fetch("https://api.ticktick.com/api/v2/user/status",{headers:{Cookie:`${t.name}=${t.value}`,"User-Agent":"Obsidian Plugin"}})).ok:!1}catch{return!1}}}class Dm{constructor(e,t){this.app=e,this.host=t}async authenticate(){return new Promise(async e=>{var d,g;let t=!1;const i=h=>{if(!t){t=!0;try{l()}catch{}e(h)}};let n,r;try{n=(d=window.require)==null?void 0:d.call(window,"electron"),r=((g=n==null?void 0:n.remote)==null?void 0:g.BrowserWindow)||(n==null?void 0:n.BrowserWindow)}catch{}if(!r){new F.Notice("Desktop login is not available in this environment.",5e3),i(null);return}let a,o=null;const l=()=>{var h,u,f,p,m,v,w,y,k;try{o&&(clearInterval(o),o=null)}catch{}try{if(a){try{(h=a.removeAllListeners)==null||h.call(a,"closed")}catch{}try{(u=a.removeAllListeners)==null||u.call(a,"close")}catch{}try{(p=(f=a.webContents)==null?void 0:f.removeAllListeners)==null||p.call(f,"did-finish-load")}catch{}try{(v=(m=a.webContents)==null?void 0:m.removeAllListeners)==null||v.call(m,"did-navigate")}catch{}try{(y=(w=a.webContents)==null?void 0:w.removeAllListeners)==null||y.call(w,"destroyed")}catch{}try{(k=a.isDestroyed)!=null&&k.call(a)}catch{}}}catch{}},c=async()=>{var h,u;try{if(!a||(h=a.isDestroyed)!=null&&h.call(a))return null;const f=a.webContents;return!f||(u=f.isDestroyed)!=null&&u.call(f)?null:await f.session.cookies.get({url:`https://${this.host}/`})??null}catch{return null}};try{a=new r({width:900,height:680,show:!0,webPreferences:{nodeIntegration:!1,contextIsolation:!0,webSecurity:!0}}),a.webContents.on("did-finish-load",async()=>{try{await a.webContents.executeJavaScript(`
              (function () {
                if (document.getElementById('__tts_auth_bar')) return;
                const bar = document.createElement('div');
                bar.id = '__tts_auth_bar';
                bar.style.position = 'fixed';
                bar.style.right = '24px';
                bar.style.bottom = '24px';
                bar.style.display = 'flex';
                bar.style.gap = '8px';
                bar.style.zIndex = '999999';
                bar.style.pointerEvents = 'none';

                const mkBtn = (id, text, bg) => {
                  const b = document.createElement('button');
                  b.id = id;
                  b.textContent = text;
                  b.style.pointerEvents = 'auto';
                  b.style.padding = '10px 16px';
                  b.style.border = 'none';
                  b.style.borderRadius = '6px';
                  b.style.boxShadow = '0 3px 10px rgba(0,0,0,0.2)';
                  b.style.color = '#fff';
                  b.style.fontWeight = '600';
                  b.style.cursor = 'pointer';
                  b.style.background = bg;
                  return b;
                };

                const finishBtn = mkBtn('__tts_finish', 'Finish', '#4b8bf4');
                const cancelBtn = mkBtn('__tts_cancel', 'Cancel', '#666');

                finishBtn.onclick = () => { window.__TTS_FINISH = true; };
                cancelBtn.onclick = () => { window.__TTS_CANCEL = true; };

                bar.appendChild(cancelBtn);
                bar.appendChild(finishBtn);
                document.body.appendChild(bar);
              })();
            `)}catch{}}),o=setInterval(async()=>{var h,u,f,p;if(!(!a||(h=a.isDestroyed)!=null&&h.call(a)||t))try{const m=await a.webContents.executeJavaScript("({ f: !!window.__TTS_FINISH, c: !!window.__TTS_CANCEL })");if(m!=null&&m.c){l();try{(u=a.close)==null||u.call(a)}catch{}i(null);return}if(m!=null&&m.f){const v=await c(),w=v?cl.findSessionCookie(v):null;if(!w){new F.Notice("Could not detect session cookie. Are you signed in?",5e3),l();try{(f=a.close)==null||f.call(a)}catch{}i(null);return}l();try{(p=a.close)==null||p.call(a)}catch{}i({name:w.name,value:w.value});return}}catch{}},400),O().debugMode||a.webContents.on("did-navigate",async(h,u)=>{var f;if(!t&&u)try{if(u.includes(`${this.host}/#/`)||u.includes(`${this.host}/webapp`)){const m=await c(),v=m?cl.findSessionCookie(m):null;if(v){l();try{(f=a.close)==null||f.call(a)}catch{}i({name:v.name,value:v.value})}}}catch{}}),a.on("close",()=>{t||i(null)}),a.on("closed",()=>{t||i(null)}),a.webContents.on("destroyed",()=>{t||i(null)}),await a.loadURL(`https://${this.host}/signin`),new F.Notice("Please sign in, then click Finish or Cancel.",5e3)}catch{i(null)}})}}const Fm=Object.freeze(Object.defineProperty({__proto__:null,DesktopAuth:Dm},Symbol.toStringTag,{value:"Module"}));module.exports=Lm;

/* nosourcemap */